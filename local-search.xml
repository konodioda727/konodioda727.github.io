<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>é‡æ„çš„è‰ºæœ¯</title>
    <link href="/2024/03/06/refactor/"/>
    <url>/2024/03/06/refactor/</url>
    
    <content type="html"><![CDATA[<h1 id="é‡æ„çš„è‰ºæœ¯ğŸ¤ª"><a href="#é‡æ„çš„è‰ºæœ¯ğŸ¤ª" class="headerlink" title="é‡æ„çš„è‰ºæœ¯ğŸ¤ª"></a>é‡æ„çš„è‰ºæœ¯ğŸ¤ª</h1><blockquote><p>å¼ºçƒˆå»ºè®®å¤§å®¶å»çœ‹ä¸€ä¸‹ï¼š <code>ã€Šé‡æ„ï¼šæ”¹å–„ä»£ç çš„æ—¢æœ‰è®¾è®¡ã€‹</code>è¿™æœ¬ä¹¦ï¼Œè¶…çº§å¥½çœ‹ï¼Œè®¡ç®—æœºåœ£ç»ã€‚ğŸ¥³</p><p>å‰åŠéƒ¨åˆ†è®²è§£<strong>ä¸ºä»€ä¹ˆè¦è¿›è¡Œé‡æ„</strong>ã€<strong>ä»€ä¹ˆæ—¶å€™è¿›è¡Œé‡æ„</strong>ä»¥åŠ<strong>é‡æ„çš„å¥½å¤„</strong>ï¼Œè¶…çº§æœ‰æ„æ€ï¼›ååŠéƒ¨åˆ†å°±æ˜¯çº¯çº¯å·¥å…·ä¹¦ï¼Œä¸çŸ¥é“å’‹é‡æ„çš„æ—¶å€™ç¿»ä¸€ç¿»å°±è¡ŒğŸ’©</p><p>é‡Œé¢æœ‰å¥è¯æˆ‘ç°åœ¨éƒ½è®°å¾—ï¼š<em><strong>å‚»ç“œéƒ½èƒ½å†™å‡ºè®¡ç®—æœºèƒ½çœ‹æ‡‚çš„ä»£ç ï¼Œè€Œèƒ½å†™å‡ºäººèƒ½å¤Ÿçœ‹æ‡‚çš„ä»£ç çš„æ‰å«ä¼˜ç§€çš„ç¨‹åºå‘˜</strong></em></p></blockquote><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦é‡æ„ğŸ¤¡"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦é‡æ„ğŸ¤¡" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦é‡æ„ğŸ¤¡"></a>ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦é‡æ„ğŸ¤¡</h2><p>å…¶å®åœ¨è®¡ç®—æœº<code>æ—©æœŸå‘å±•é˜¶æ®µ</code>æ˜¯æ²¡æœ‰é‡æ„çš„æ¦‚å¿µçš„ï¼Œå› ä¸ºé‚£ä¸ªæ—¶å€™ç¨‹åº<strong>ä½“é‡å¾ˆå°</strong>ï¼Œæ‰€ä»¥æ¨å´‡<strong>åœ¨å¼€å‘ä¹‹å‰å°±è§„åˆ’å¥½ä¸€æ•´ä¸ªç¨‹åº</strong>ã€‚</p><p>ä½†æ˜¯éšç€ç¨‹åºä½“é‡è¶Šæ¥è¶Šå¤§ï¼Œå³ä½¿æ˜¯æœ€ä¼˜ç§€çš„å¤§ç‰›ä¹Ÿä¸èƒ½åœ¨å¼€å‘ä¹‹å‰å°±æŠŠæ‰€æœ‰æƒ…å†µéƒ½è€ƒè™‘è¿›å»ã€‚ğŸ‘¾</p><p>æ‰€ä»¥åªèƒ½ä¸€æ¬¡åˆä¸€æ¬¡åœ°ç»™åŸæ¥çš„ç¨‹åºè´´è¡¥ä¸ï¼Œç„¶è€Œè¿™ç§<strong>é¢å¯¹bugè´´è¡¥ä¸</strong>çš„æ²»æ ‡ä¸æ²»æœ¬çš„æ–¹å¼åªä¼šä½¿è¡¥ä¸è¶Šæ¥è¶Šå¤šï¼Œç¨‹åº<strong>è¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œè¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤</strong>ğŸ«¨</p><p>ç»ˆäºï¼Œåˆ°äº†ä¸€ç‚¹éƒ½å†™ä¸ä¸‹å»çš„æ—¶å€™ï¼Œ<code>é‡æ„</code>çš„æ¦‚å¿µå°±è¯ç”Ÿäº†ï¼Œå¹¶ä¸”è¿…é€Ÿè·å¾—äº†å¤§å®¶çš„é’çï¼Œå¹¶è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¯ä»¥æå¤§æé«˜å¼€å‘æ•ˆç‡çš„æ–¹å¼ã€‚</p><blockquote><p>åœ¨å¤§å®¶çš„<code>miniproject</code>ä¸­è‚¯å®šä¹Ÿä¼šé‡åˆ°ç›¸ä¼¼çš„é—®é¢˜ï¼šäº§å“è¦æ±‚è¶Šæ¥è¶Šå¤šğŸ˜µï¼Œä¸€äº›åŸæ¥æ ¹æœ¬æ²¡è€ƒè™‘çš„ç”¨æ³•çš„äº§ç”Ÿï¼Œä¼šå¯¼è‡´ä»£ç é€»è¾‘è¶Šæ¥è¶Šæ··ä¹±ï¼Œè¶Šå†™è¶Šè‡ªé—­ï¼ˆå»å¹´æˆ‘å°±åœ¨æ˜¯è¿™æ ·çš„ğŸ¤¡ğŸ¤¡ğŸ¤¡ï¼‰ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œåˆ«å®³æ€•ï¼Œæ‹æ¸…æ€è·¯ï¼Œæœæ–­é‡æ„ï¼ï¼ï¼</p></blockquote><p>ä½†æ˜¯ï¼Œ<code>é‡æ„</code>çš„æ„ä¹‰ä¸æ­¢äºæ­¤ï¼šéšç€æŠ€æœ¯çš„è¿…é€Ÿå‘å±•ï¼Œè€ä¸€ä»£æŠ€æœ¯æ¸æ¸è¢«å–ä»£ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œ<code>ç”¨æ–°æŠ€æœ¯é‡æ„è€é¡¹ç›®</code>å°±æ˜¾å¾—æ ¼å¤–é‡è¦</p><p>å°±æ¯”å¦‚ç”¨<code>react</code>é‡æ„ä¹‹å‰<code>jQuery</code>çš„é¡¹ç›®ğŸ¤ª</p><p><em>å› æ­¤ï¼Œå°å°æ€»ç»“ä¸€ä¸‹ï¼Œé‡æ„å°±æ˜¯å› ä¸ºï¼š</em></p><ul><li>ä¹‹å‰å†™çš„çƒ‚ï¼Œæ”¹ä¸äº†ä¸€ç‚¹æˆ–è€…æ”¹çš„å¾ˆè€—æ—¶å¾ˆè´¹ç²¾åŠ›</li><li>é¡¹ç›®è¦ä¸æ—¶ä¿±è¿›ï¼Œæ¢ä¸Šæ–°æŠ€æœ¯ï¼Œæé«˜æ•ˆèƒ½</li></ul><h2 id="äºŒã€è¦æ€ä¹ˆé‡æ„ğŸ¤•"><a href="#äºŒã€è¦æ€ä¹ˆé‡æ„ğŸ¤•" class="headerlink" title="äºŒã€è¦æ€ä¹ˆé‡æ„ğŸ¤•"></a>äºŒã€è¦æ€ä¹ˆé‡æ„ğŸ¤•</h2><p><strong>ã€Šé‡æ„ã€‹çš„ä½œè€…ç§°è¿™ä¸ªä¸ºå‘ç°ä»£ç é‡Œçš„åå‘³é“ğŸ’©</strong></p><blockquote><p>é¦–å…ˆï¼Œè‚¯å®šæ˜¯è¦æ‹æ¸…<code>é€»è¾‘æ··ä¹±</code>äº§ç”Ÿçš„åŸå› ï¼Œåˆ†æè¿‡åï¼ŒæŠŠé€»è¾‘é‡å†™ï¼Œé‡æ–°ç»„ç»‡å‡½æ•°ã€ç»„ä»¶çš„å…³ç³»</p></blockquote><ul><li><p>ä¸€äº›é€»è¾‘æ··ä¹±æ¥æºäºä¸åˆç†çš„ç»„ä»¶æ‹†åˆ†ï¼Œ<em><strong>ä¸è¦æƒ³ç€è®©ä¸€ä¸ªç»„ä»¶é€‚åº”æ‰€æœ‰çš„æƒ…å†µ</strong></em>ï¼Œè¿™æ ·åªä¼šè®©è¿™ä¸€ä¸ªç»„ä»¶è¶Šæ¥è¶Šéš¾æ‡‚å¤æ‚</p><p><em><strong>ä¸€ä¸ªç»„ä»¶åªå¹²ä¸€ä»¶äº‹æƒ…ğŸ˜ƒğŸ˜ƒğŸ˜ƒ</strong></em></p><blockquote><p>å°±æ¯”å¦‚<code>button</code>ç»„ä»¶ï¼Œä¸€å¼€å§‹çš„åŠŸèƒ½å°±æ˜¯æŒ‰ä¸‹æœ‰ååº”ã€‚ä½†æ˜¯ç°åœ¨å‘ç°åˆéœ€è¦ä¸€ä¸ªå¯ä»¥æœ‰å¼¹çª—çš„<code>button</code>ç»„ä»¶ã€‚</p><p>è¿™æ—¶å€™ä¸€èˆ¬çš„æƒ³æ³•å°±æ˜¯åšä¸ªåˆ¤æ–­ï¼Œç»™åŸæ¥çš„ç»„ä»¶ä¸ŠåŠ ä¸€ä¸ª<code>hasModal</code>ï¼Œæœ‰è¿™ä¸ªå±æ€§å°±æœ‰å¼¹çª—ï¼Œä¹Ÿä¸æ˜¯ä¸è¡Œå—·ğŸ¤£ã€‚</p><p>ç¡®å®æ˜¯è¿™æ ·ï¼Œç¨å¾®åŠ ä¸€ç‚¹<code>prop</code>ä¼šè®©æˆ‘ä»¬çš„ç»„ä»¶åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†æ˜¯è¿‡å¤šçš„<code>props</code>å°±æŒºè®©äººå¤´å¤§äº†</p><p>å°±æ¯”å¦‚å†ç»™è¿™ä¸ª<code>button</code>åŠ ä¸Šè·³è½¬é¡µé¢ã€ä¸‹è½½æ–‡ä»¶ã€ä¸Šä¼ æ–‡ä»¶ç­‰ç­‰çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ—¶å€™æµ…æµ…çœ‹ä¸€ä¸‹æœ‰å¤šå°‘ä¸ª<code>props</code>å‘¢ï¼Ÿ <code>hasModal</code>,<code>navigatePath</code>,<code>download</code>,<code>upload</code></p><p>è¿™ä¸ªæ—¶å€™æˆ‘å°±å·²ç»ç›¸å½“çƒ¦äº†ï¼Œä½†æ˜¯æƒ…å†µå¯èƒ½æ›´è¶…ä¹æ„æ–™ï¼Œå¯èƒ½è¿˜æœ‰<code>button</code>åœ¨é¡µé¢ä¸Šå­˜åœ¨3ç§’ä¹‹åé¡µé¢å°±è¦å¼€å§‹æŠ–åŠ¨è¿™ç§é€†å¤©çš„åŠŸèƒ½å‘¢ã€‚ä½ æ°¸è¿œæƒ³è±¡ä¸åˆ°ä½ çš„è€æ¿æœ‰ä»€ä¹ˆé¬¼é©¬ç‚¹å­ğŸ˜</p><p>æ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™å®Œå…¨å¯ä»¥æŠŠè¿™äº›ä¸ª<code>button</code>æ‹†å¼€ï¼Œæ­£å¸¸çš„<code>button</code>ç”¨ä¸€ä¸ªç»„ä»¶ï¼Œæœ‰ç‰¹æ®ŠåŠŸèƒ½çš„ï¼Œå°±å•ç‹¬å†å†™ä¸€ä¸ªï¼Œé¿å…åˆ«äººè¦è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ç‚¹å¼€çœ‹åˆ°1000è¡Œçš„<code>propsæç¤º</code>å‘å‘†ã€‚ğŸ‘¾</p></blockquote></li><li><p>ä¸€äº›é€»è¾‘é—®é¢˜å‡ºç°åœ¨<em><strong>ç»„ä»¶ä¹‹é—´<code>è€¦åˆåº¦</code>å¤ªé«˜</strong></em>ï¼Œæ”¹åŠ¨ä¸€ä¸ªå°éƒ¨åˆ†è¦ä¿®æ”¹å¤§åŠä¸ªé¡µé¢çš„ä»£ç ï¼Œè¿™ç§æ˜¯çœŸçš„ç—›è‹¦ğŸ¤—</p><blockquote><p>è¿˜æ˜¯æ‹¿ä¸Šè¾¹çš„<code>button</code>åšä¾‹å­ï¼Œ<code>hasModal</code>,<code>navigatePath</code>,<code>download</code>,<code>upload</code>è¿™äº›åŠŸèƒ½ï¼Œå®Œå…¨å¯ä»¥æ”¹æˆä¸€ä¸ª<code>onClick</code>å›è°ƒå‡½æ•°ğŸ˜,ä¹‹åè¦ç”¨çš„æ—¶å€™æŠŠè¦æ‰§è¡Œçš„ä»»åŠ¡ä½œä¸ºå‡½æ•°ä¼ è¿›æ¥ï¼Œè¿™æ ·<code>button</code>å°±åªç”¨å•ç‹¬å¤„ç†è‡ªèº«<code>onClick</code>çš„é€»è¾‘å°±è¡Œå•¦ï¼Œå¤ç”¨æ€§è‡ªç„¶ä¹Ÿå°±æé«˜äº†</p><p><strong>ä¸€ä¸ªå¥½çš„ç»„ä»¶å†™å®Œä¹‹åç”¨800å¹´ä¹Ÿä¸éœ€è¦æ”¹ä¸€æ¬¡ä»£ç </strong></p></blockquote></li><li><p>è¿˜æœ‰ä¸€äº›å‡ºåœ¨<em><strong>ä¹±ä¸ƒå…«ç³Ÿçš„é€»è¾‘æ¡ä»¶åˆ¤æ–­</strong></em>ä¸Š</p><p><code>if</code>åµŒ800è¡Œï¼Œå›¾çµæ¥äº†éƒ½çœ‹ä¸æ‡‚ï¼Œå†æ¥ç‚¹å¾ªç¯ï¼Œä¸Šå¸éƒ½çœ‹ä¸æ‡‚ğŸ¦¢</p><p>å¥½å¥½<code>review</code>è‡ªå·±å†™çš„ğŸ’©ğŸ’©ğŸ’©,æŠŠç±»ä¼¼ä»€ä¹ˆ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">True</span> = flag ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>è¿™ç§è„±è£¤å­æ”¾å±çš„ä¸œè¥¿éƒ½åŒ–ç®€äº†ï¼ˆæœ‰æ—¶å€™<code>ide</code>éƒ½çœ‹ä¸ä¸‹å»ä¼šç»™ä½ æ ‡é»„ğŸ¤£ï¼‰ï¼›å†æŠŠ<code>if</code>è¿™ç§è¯­å¥å°½é‡æ”¹æˆ<code>ä¸‰ç›®è¿ç®—ç¬¦</code>ï¼›æŠŠ<code>switch</code>è¿™ç§è¯­å¥æ¢æˆ<code>å¤šæ€ç±»</code>ï¼›</p><p>æé«˜ç‚¹å¯è¯»æ€§ï¼Œå¯¹ä½ å’Œä½ çš„<code>partner</code>éƒ½å¥½ğŸ¤¯ğŸ¤¯ğŸ¤¯</p></li></ul><blockquote><p>å…¶æ¬¡å°±æ˜¯<em><strong>é‡æ–°ç»„ç»‡æ–‡ä»¶ç»“æ„</strong></em></p></blockquote><ul><li><p>æ–‡ä»¶ç»“æ„åº”è¯¥å±‚æ¬¡åˆ†æ˜ï¼Œé€»è¾‘æ¸…æ™°ï¼Œä»¥ä¸‹æ˜¯<code>huskyğŸ¶</code>æ¨èçš„ç›®å½•ç»“æ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">â”œâ”€â”€ .husky              <span class="hljs-comment"># huskyçš„é…ç½®æ–‡ä»¶</span><br>â”œâ”€â”€ dist               <span class="hljs-comment"># æ‰“åŒ…åçš„ä»£ç å’Œèµ„æºæ–‡ä»¶</span><br>â”œâ”€â”€ node_modules        <span class="hljs-comment"># ä¾èµ–åº“å’Œæ¨¡å—</span><br>â”œâ”€â”€ src<br>â”‚   â”œâ”€â”€ assets          <span class="hljs-comment"># é™æ€èµ„æº</span><br>â”‚   â”œâ”€â”€ components      <span class="hljs-comment"># å…¬å…±ç»„ä»¶</span><br>â”‚   â”œâ”€â”€ pages           <span class="hljs-comment"># é¡µé¢</span><br>â”‚   â”œâ”€â”€ <span class="hljs-built_in">type</span>            <span class="hljs-comment"># å…¨å±€ç±»å‹å£°æ˜</span><br>â”‚   â”œâ”€â”€ utils           <span class="hljs-comment"># å·¥å…·å‡½æ•°</span><br>â”‚   â”œâ”€â”€ App.tsx<br>â”‚   â”œâ”€â”€ fetch.ts        <span class="hljs-comment"># ç½‘ç»œè¯·æ±‚</span><br>â”‚   â”œâ”€â”€ main.tsx<br>â”‚   â”œâ”€â”€ router.tsx      <span class="hljs-comment"># è·¯ç”±é…ç½®ä¿¡æ¯</span><br>â”‚   â””â”€â”€ vite-env.d.ts<br>â”œâ”€â”€ .commitlintrc.cjs<span class="hljs-comment"># commitlintçš„é…ç½®æ–‡ä»¶</span><br>â”œâ”€â”€ .eslintignore<br>â”œâ”€â”€ .eslintrc.cjs       <span class="hljs-comment"># ESLintçš„é…ç½®æ–‡ä»¶</span><br>â”œâ”€â”€ .gitignore<br>â”œâ”€â”€ .prettierignore<br>â”œâ”€â”€ .prettierrc.cjs     <span class="hljs-comment"># Prettierçš„é…ç½®æ–‡ä»¶</span><br>â”œâ”€â”€ index.html<br>â”œâ”€â”€ package.json<br>â”œâ”€â”€ README.md<br>â”œâ”€â”€ tsconfig.json<br>â”œâ”€â”€ tsconfig.node.json<br>â”œâ”€â”€ vite.config.ts<br>â””â”€â”€ yarn.lock<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œæ¯ä¸ª<code>page</code>å’Œ<code>component</code>ä¹Ÿéƒ½å¯ä»¥æœ‰è‡ªå·±ç‹¬æœ‰çš„<code>component</code>ï¼Œæœ€å¤–å±‚çš„<code>component</code>åªæ”¾ä¸åŒé¡µé¢ä¸åŒç»„ä»¶å‡è¦ç”¨åˆ°çš„ç»„ä»¶</p></li></ul><blockquote><p>ç„¶åå°±æ˜¯ä¸€ä¸ªè¢«å¾ˆå¤šäººå¿½ç•¥çš„ç‚¹ï¼š<em><strong>æ¢ä¸ªå¥½çš„åå­—</strong></em></p></blockquote><ul><li><p>æœ‰æ—¶å€™ï¼Œæ¢ä¸€ä¸ªäººç±»èƒ½çœ‹æ‡‚çš„åå­—çœŸçš„èƒ½å¸®ä¸Šå¤§å¿™ğŸ˜ã€‚</p><p>ä¸è¦æ€•åå­—å¤ªé•¿ä»€ä¹ˆçš„ï¼Œåˆä¸æ˜¯ä½ è‡ªå·±å†™ï¼Œ<code>ide</code>éƒ½æ²¡æŠ±æ€¨ä½ æ€¥ä»€ä¹ˆï¼Ÿ</p><blockquote><p>å°±æ¯”å¦‚è¯´ï¼ˆçœŸå®æ¡ˆä¾‹å“ˆğŸ˜•ï¼‰ï¼š</p><p>ä½ çœ‹åˆ°ä¸€ä¸ªç»„ä»¶ï¼Œå«<code>Ritem</code>ï¼Œä½ èƒ½çœ‹å‡ºæ¥å®ƒæ˜¯å¹²å•¥çš„å—ï¼Ÿ</p><p>ä½†æ˜¯ï¼Œå¦‚æœæ”¹ä¸ªåå­—ï¼Œå«<code>RescueInfoItem</code>,æ˜¯ä¸æ˜¯å°±æ¸…æ™°å¤šäº†</p><p>é¡ºå¸¦æä¸€å¥ï¼Œå‰å‡ å¤©æˆ‘èµ·å‡ºäº†è¿™è¾ˆå­æ¥æœ€é•¿çš„åå­—ï¼š <code>RescueInfoSortedByTargetIDSlice</code>ğŸ˜¶â€ğŸŒ«ï¸</p></blockquote></li></ul><h2 id="å››ã€é‡æ„çš„æ­¥éª¤"><a href="#å››ã€é‡æ„çš„æ­¥éª¤" class="headerlink" title="å››ã€é‡æ„çš„æ­¥éª¤"></a>å››ã€é‡æ„çš„æ­¥éª¤</h2><p><strong>å…‰è¯´è¯´å¯èƒ½æ²¡ä»€ä¹ˆæ„Ÿè§‰ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä¼šä½¿ç”¨æˆ‘æœ€è¿‘é‡æ„çš„ä¸€æ®µä»£ç ï¼ˆjs-&gt;tsï¼‰æ¥ç»™å¤§å®¶å±•ç¤ºé‡æ„çš„é­…åŠ›ğŸ‘½ï¼Œç”¨ä¾‹å­çš„æ–¹å¼ç»™å¤§å®¶è®²è§£ä¸€ä¸‹é‡æ„çš„æ­¥éª¤ï¼ˆè¿™æ®µä»£ç çš„æ¥æºä¿å¯†ğŸ¤ªï¼‰</strong></p><blockquote><p>msgItem.jsx (è¿™æ˜¯æˆ‘ä»¬è¦é‡æ„çš„ç»„ä»¶)</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Taro</span>, &#123;useReady&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@tarojs/taro&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">View</span> ,<span class="hljs-title class_">Image</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@tarojs/components&#x27;</span><br><span class="hljs-keyword">import</span> &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./index.less&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Fetch</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../Service/fetch&#x27;</span><br><br><br><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">MsgItem</span>=(<span class="hljs-params">props</span>)=&gt;&#123;<br><br>        <span class="hljs-keyword">const</span> [flag,setFlag]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>        <span class="hljs-keyword">const</span> [finish,setFinish]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;å·²æ•‘æ´&#x27;</span>)<br>      <span class="hljs-comment">//  const [jiean,setJiean]=useState(&#x27;&#x27;)</span><br>        <span class="hljs-keyword">const</span> [color,setColor]=<span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)<span class="hljs-comment">//0:#f57b70  1:#76A9FF 2:#f9a53e</span><br>       <span class="hljs-comment">// const [status,setStatus]=useState(0)</span><br>        <span class="hljs-keyword">const</span> [text,setText]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">const</span> [area,setArea]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">const</span> [level,setLevel]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">const</span> [data,setData]=<span class="hljs-title function_">useState</span>([])<br>        <span class="hljs-keyword">const</span> [ifmine,setIfmine] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)<br><br>        <span class="hljs-keyword">const</span> param=props<br><br>        <span class="hljs-keyword">const</span> status = [<br>            <span class="hljs-string">&#x27;æœªæ•‘æ´&#x27;</span>,<br>            <span class="hljs-string">&#x27;æ•‘æ´ä¸­&#x27;</span>,<br>            <span class="hljs-string">&#x27;å·²æ•‘æ´&#x27;</span><br>        ]<br>        <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>            <span class="hljs-comment">/* console.log(param.flag) */</span><br>          <span class="hljs-comment">//  setStatus(param.status)//ä¸»é¡µitem</span><br>        <br>          <span class="hljs-keyword">if</span>(param.<span class="hljs-property">flag</span>==<span class="hljs-string">&#x27;main&#x27;</span>)  <span class="hljs-comment">//ä¸»é¡µ</span><br>          &#123;<br>            <span class="hljs-title function_">setFlag</span>(<span class="hljs-string">&#x27;alarm&#x27;</span>)<br>            <span class="hljs-keyword">if</span>(param.<span class="hljs-property">ifmine</span>)<br>            &#123;<br>                <span class="hljs-title function_">setIfmine</span>(<span class="hljs-literal">true</span>)<br>                <span class="hljs-title function_">setFinish</span>(<span class="hljs-string">&#x27;æ•‘æ´ä¸­&#x27;</span>)<br>                <span class="hljs-title function_">setColor</span>(<span class="hljs-number">1</span>)<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">//  æœªè®¤é¢†çš„æ•‘æ´</span><br>                <span class="hljs-title function_">setIfmine</span>(<span class="hljs-literal">false</span>)<br>                <span class="hljs-title class_">Fetch</span>(<br>                    <span class="hljs-string">&#x27;/rescue/targetinfo&#x27;</span>,<br>                    &#123;<br>                        <span class="hljs-string">&quot;rescue_target_id&quot;</span>: param.<span class="hljs-property">rescue_target_id</span>,<br>                    &#125;,<br>                    <span class="hljs-string">&#x27;POST&#x27;</span><br>                ).<span class="hljs-title function_">then</span>(<br>                    <span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>                        <span class="hljs-comment">//console.log(res)</span><br>                        <span class="hljs-title function_">setFinish</span>(status[res.<span class="hljs-property">data</span>.<span class="hljs-property">rescue_target_info</span>.<span class="hljs-property">status</span>])<br>                        <span class="hljs-title function_">setColor</span>(res.<span class="hljs-property">data</span>.<span class="hljs-property">rescue_target_info</span>.<span class="hljs-property">status</span>)<br>                    &#125;<br>                )<br>          &#125;&#125;<br>          <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">//record</span><br>            <span class="hljs-title function_">setFlag</span>(<span class="hljs-string">&#x27;record&#x27;</span>)<br>            <span class="hljs-title function_">setFinish</span>(status[param.<span class="hljs-property">status</span>])<br>            <span class="hljs-title function_">setColor</span>(param.<span class="hljs-property">status</span>)<br>          &#125;<br>            <span class="hljs-title function_">setText</span>(param.<span class="hljs-property">text</span>)<br>            <span class="hljs-title function_">setArea</span>(param.<span class="hljs-property">area</span>)<br>            <span class="hljs-title function_">setLevel</span>(param.<span class="hljs-property">risk_level</span>)<br>            <span class="hljs-title function_">setData</span>(param.<span class="hljs-property">data</span>)<br>        &#125;,[param])<br>      <br>        <span class="hljs-keyword">function</span> <span class="hljs-title function_">toR_detail</span>(<span class="hljs-params"></span>)<br>        &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(flag)<br>            <span class="hljs-keyword">if</span>(flag==<span class="hljs-string">&#x27;alarm&#x27;</span>)<br>            <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">navigateTo</span>(&#123;<br>                <span class="hljs-attr">url</span>:<span class="hljs-string">`/moduleA/pages/Alarm/index?ifmine=<span class="hljs-subst">$&#123;ifmine&#125;</span>&amp;data=<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(data)&#125;</span>&amp;finish=<span class="hljs-subst">$&#123;finish&#125;</span>&amp;color=<span class="hljs-subst">$&#123;color&#125;</span>`</span><br>            &#125;)<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;todetail&#x27;</span>)<br>                <span class="hljs-keyword">const</span> jiean = param.<span class="hljs-property">status</span>==<span class="hljs-number">1</span>?<span class="hljs-string">&#x27;æœªç»“æ¡ˆ&#x27;</span>:<span class="hljs-string">&#x27;å·²ç»“æ¡ˆ&#x27;</span><br>                <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">navigateTo</span>(&#123;<br>                    <span class="hljs-attr">url</span>:<span class="hljs-string">`/moduleA/pages/Rescue_detail/index?finish=<span class="hljs-subst">$&#123;jiean&#125;</span>&amp;data=<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(data)&#125;</span>&amp;teacher=<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(param.teacher)&#125;</span>&amp;lap=<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(param.lap)&#125;</span>`</span><br>                &#125;)<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span>(<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;noti-item column&#x27;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;toR_detail&#125;</span> &gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;inline&#x27;</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;state&#x27;</span><span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;backgroundColor:color</span>==<span class="hljs-string">2?</span>&#x27;#<span class="hljs-attr">76A9FF</span>&#x27;<span class="hljs-attr">:color</span>==<span class="hljs-string">1?</span>&#x27;#<span class="hljs-attr">f9a53e</span>&#x27;<span class="hljs-attr">:</span>&#x27;#<span class="hljs-attr">f57b70</span>&#x27;&#125;&#125;&gt;</span>&#123;finish&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;rescued_level&#x27;</span>&gt;</span></span><br><span class="language-xml">                    é£é™©ç­‰çº§ï¼š&#123;level&#125;</span><br><span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;rescued_info&#x27;</span>&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;row&#x27;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;border_l&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>å¾®åšå†…å®¹ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;demand&#x27;</span>&gt;</span>&#123;text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;rescued_city&#x27;</span>&gt;</span></span><br><span class="language-xml">                    åœ°ç‚¹ï¼š&#123;area&#125;</span><br><span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            &#123;/* <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;require&#x27;</span>&gt;</span>ä¸»è¦è¯‰æ±‚ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>æ„Ÿæƒ…å—æŒ«ï¼Œå®¶åº­ä¸å’Œï¼Œå’Œäº²äººæœ‰éš”é˜‚<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span> */&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>        )<br><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MsgItem</span>;<br></code></pre></td></tr></table></figure><p><strong>è¿™æ˜¯ä¸€æ®µè¶…çº§é•¿çš„ä»£ç ï¼Œæœ‰110è¡Œï¼Œä¸€èˆ¬æˆ‘ä»¬ç»„ä»¶è¶…è¿‡70è¡Œå°±å·²ç»ä¸æ˜¯å¾ˆä¼˜é›…äº†ï¼ˆåæ­£æˆ‘çœ‹åˆ°è¶…è¿‡70è¡Œçš„ç»„ä»¶å°±å¤´å¤§ğŸ¥ºï¼‰ï¼Œå› æ­¤ï¼Œé‡æ„å°±åº”è¯¥æä¸Šæ—¥ç¨‹</strong></p><p><em><strong>é‚£é—®é¢˜æ¥äº†ï¼Œè¯¥å¦‚ä½•ä¸‹æ‰‹å‘¢ï¼ŸğŸ¤¨</strong></em></p><ol><li><p>è¦é‡æ„ä¸€ä¸ªç»„ä»¶ï¼Œé¦–å…ˆè¦æ¸…é™¤åœ¨å“ªé‡Œä¼šè¢«ç”¨åˆ°ï¼Œæˆ‘è¿™é‡Œæ‰¾äº†å®ƒçš„å‡ ä¸ªç”¨æ³•ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">// R_record.jsx </span><br><span class="hljs-comment">// è¿™é‡ŒRitemå°±æ˜¯msgItem</span><br>&#123;list?list.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>)=&gt;</span>&#123;<br>                    <span class="hljs-keyword">return</span> (<br>                        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Ritem</span> &#123;<span class="hljs-attr">...item</span>&#125; <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;item&#125;</span> <span class="hljs-attr">teacher</span>=<span class="hljs-string">&#123;teacher&#125;</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&#123;status&#125;</span> <span class="hljs-attr">lap</span>=<span class="hljs-string">&#123;lap&#125;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#x27;rescue&#x27;</span> <span class="hljs-attr">flag</span>=<span class="hljs-string">&#x27;record&#x27;</span> /&gt;</span></span><br>                    )<br>                &#125;):<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;img&#x27;</span>&gt;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">// Main.jsx</span><br>&#123;mine?mine.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>)=&gt;</span>&#123;<br>                    <span class="hljs-keyword">return</span> (<br>                      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MsgItem</span> &#123;<span class="hljs-attr">...item</span>&#125; <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;item&#125;</span>  <span class="hljs-attr">ifmine</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#x27;item&#x27;</span> <span class="hljs-attr">flag</span>=<span class="hljs-string">&#x27;main&#x27;</span> /&gt;</span></span><br>                    )<br>                  &#125;)<br></code></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">//Search.jsx </span><br><span class="hljs-comment">// è¿™æ®µæ˜¯ä¹‹å‰æˆ‘å†™çš„ï¼Œä¸€å¨ğŸ’©</span><br> &#123;form &amp;&amp;<br>          form.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MsgItem</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;item&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            &#123;<span class="hljs-attr">...item</span>&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">ifmine</span>=<span class="hljs-string">&#123;form.some(itm</span> =&gt;</span> JSON.stringify(item) === JSON.stringify(itm))&#125;</span><br><span class="language-xml">            key=&#x27;item&#x27;</span><br><span class="language-xml">            flag=&#x27;main&#x27;</span><br><span class="language-xml">          &gt;<span class="hljs-tag">&lt;/<span class="hljs-name">MsgItem</span>&gt;</span></span>)&#125;<br></code></pre></td></tr></table></figure><p>åœ¨çœŸæ­£é‡æ„çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šè¦ç†è§£è¿™äº›ä¸ªç»„ä»¶æœ‰ä»€ä¹ˆç”¨ï¼Œæ˜¯å¹²å•¥çš„ï¼Œä½†æ˜¯ç°åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…ˆä¸ç”¨ç®¡ï¼Œå› ä¸ºè¿™ä¸ªä¸œè¥¿æœ‰ç‚¹å­å¤æ‚çš„ï¼Œæˆ‘è‡ªå·±éƒ½çœ‹åŠå¤©ğŸ˜ï¼ŒåªçŸ¥é“å®ƒæ¥å—å•¥å‚æ•°å°±å¯ä»¥äº†ã€‚</p><blockquote><p>è§‚å¯Ÿä¸éš¾å‘ç°</p><ul><li><p>å‚æ•°ä¸­æœ‰ä¸ª<code>flag</code>å’Œ<code>key</code>ï¼Œè¿™ä¿©åå­—ä¸€èˆ¬æ˜¯ç”¨æ¥åŒºåˆ†ç»„ä»¶è¡Œä¸ºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªç»„ä»¶å¾ˆå¯èƒ½ä¼šæœ‰ä¸¤ä¸‰ä¸ªä¸åŒçš„åŠŸèƒ½</p></li><li><p><code>&#123;...item&#125;</code>å’Œ<code>data=&#123;item&#125;</code>è¿™ä¿©ç©æ„ä¼ çš„ä¸€æ‘¸ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥åˆ å»</p></li><li><p>è¿˜æœ‰ä¸€äº›<code>teacher</code> ,<code>status</code>ç­‰å¯ä¼ å¯ä¸ä¼ çš„<code>props</code>,è¿™äº›è¯´æ˜ç»„ä»¶åŠŸèƒ½å¯èƒ½æœ‰è¾ƒå¤§å·®å¼‚ï¼Œå¯èƒ½ä¹‹åè¦æŠŠå®ƒåˆ†ä¸ºå¤šä¸ªç»„ä»¶ï¼›æˆ–è€…æŠŠå‚æ•°å–æ¶ˆï¼Œä¼ å›è°ƒå‡½æ•°ï¼Œå®Œå…¨å—æ§ç»„ä»¶é™ä½è€¦åˆåº¦</p></li></ul></blockquote><p>åˆ†æå®Œä¹‹åï¼Œå‘ç°ä»»åŠ¡å¾ˆè‰°å·¨å•Šï¼Œå¼€æ‘†å¾—äº†ï¼ˆbushiï¼‰</p></li><li><p>ä¹‹åï¼Œé¢å¯¹è¿™æ ·è‰°å·¨çš„ä»»åŠ¡ï¼Œæˆ‘ä¸€èˆ¬æ˜¯å…ˆæŒ‘è½¯æŸ¿å­æï¼Œå•¥äº‹è½¯æŸ¿å­å˜ï¼Ÿ</p><p>å°±æ˜¯<code>åç§°</code>ï¼Œ<code>ç›®å½•ç»“æ„</code>è¿™äº›æ”¹äº†æ— ä¼¤å¤§é›…ä½†æ˜¯çœ‹ç€ä¼šå¾ˆèˆ’æœçš„ä¸œè¥¿ğŸ¶</p><blockquote><p>ã€Šé‡æ„ã€‹çš„ä½œè€…åœ¨ä¹¦ä¸­è¯´ï¼š <em><strong>å¦‚æœæœ‰ä¸€ä¸ªäººåœ¨é‡æ„çš„è¿‡ç¨‹ä¸­æœ‰ä¸€æ®µæ—¶é—´ä»£ç æ— æ³•è¿è¡Œï¼Œé‚£ä»–è‚¯å®šä¸åœ¨é‡æ„</strong></em></p><p>å› æ­¤ï¼Œå’±ä»¬é‡æ„è¦ä¸€æ­¥ä¸€æ­¥æ¥ã€‚</p><p>ä»<code>åç§°</code>ï¼Œ<code>ç›®å½•ç»“æ„</code>è¿™äº›â€œçš®æ¯›â€çš„ä¸œè¥¿å¼€å§‹ï¼Œä¿è¯èƒ½æ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œä¸€ç‚¹ç‚¹æ…¢æ…¢æ”¹ğŸ˜</p></blockquote><p>è¿™é‡Œç›®å½•ç»“æ„æ²¡å•¥é—®é¢˜ï¼Œæ”¹ä¸ªåå­—å°±è¡Œäº†ï¼Œæˆ‘ç»™å®ƒèµ·äº†ä¸ªå“å½“å½“çš„å¤§åï¼š <code>RerscueInfoItem</code>,ä¹‹åéƒ½ç”¨<code>RescueInfoItem</code>ä»£æ›¿<code>MsgItem</code></p><p>ä¹‹åæ‰«ä¸€çœ¼ä»£ç ï¼Œå‘ç°</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> jiean = param.<span class="hljs-property">status</span>==<span class="hljs-number">1</span>?<span class="hljs-string">&#x27;æœªç»“æ¡ˆ&#x27;</span>:<span class="hljs-string">&#x27;å·²ç»“æ¡ˆ&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-attr">backgroundColor</span>:color==<span class="hljs-number">2</span>?<span class="hljs-string">&#x27;#76A9FF&#x27;</span>:color==<span class="hljs-number">1</span>?<span class="hljs-string">&#x27;#f9a53e&#x27;</span>:<span class="hljs-string">&#x27;#f57b70&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> status = [<br>            <span class="hljs-string">&#x27;æœªæ•‘æ´&#x27;</span>,<br>            <span class="hljs-string">&#x27;æ•‘æ´ä¸­&#x27;</span>,<br>            <span class="hljs-string">&#x27;å·²æ•‘æ´&#x27;</span><br>        ]<br><span class="hljs-title function_">setFinish</span>(status[res.<span class="hljs-property">data</span>.<span class="hljs-property">rescue_target_info</span>.<span class="hljs-property">status</span>])<br></code></pre></td></tr></table></figure><p>è¿™ç§ä¸œè¥¿ï¼Œå®Œå…¨å¯ä»¥æŠŠå®ƒä»¬ææˆä¸€ä¸ª<code>Map</code>,å†æ‹¿åˆ°å¤–è¾¹çš„<code>type</code>æˆ–<code>config</code>æ–‡ä»¶é‡Œé¢å˜›</p><p>æ–°å¼€ä¸ªæ–‡ä»¶å’¯,å°±å«<code>rescueMessageItemTypes</code>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// rescueMessageItemTypes.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> rescueStatusType = &#123;<br>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span><br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">rescueStatus</span>: rescueStatusType[] = [<br>  &#123;<br>    <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;æœªæ•‘æ´&#x27;</span>,<br>    <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#f57b70&#x27;</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;æ•‘æ´ä¸­&#x27;</span>,<br>    <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#f9a53e&#x27;</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;å·²æ•‘æ´&#x27;</span>,<br>    <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#76A9FF&#x27;</span>,<br>  &#125;,<br>]<br></code></pre></td></tr></table></figure><p>ç»“æ¡ˆè¿™ç§ä¸€ä¸‹å­å°±æå®šè€Œä¸”éå¸¸æ˜“æ‡‚çš„äº‹æƒ…ï¼Œå°±ä¸å•ç‹¬æ‹å‡ºæ¥åšå˜é‡äº†,æ”¹å®Œä¹‹å<code>return</code>é‡Œå°±å˜æˆè¿™æ ·ï¼š</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs tsx">&lt;<span class="hljs-title class_">View</span> className=<span class="hljs-string">&quot;inline&quot;</span>&gt;<br>       <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span></span></span><br><span class="hljs-tag"><span class="language-xml">         <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;state&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">         <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">           <span class="hljs-attr">backgroundColor:</span></span></span><br><span class="hljs-tag"><span class="language-xml">             <span class="hljs-attr">rescueStatus</span>[<span class="hljs-attr">targetInfo</span> ? <span class="hljs-attr">targetInfo.status</span> <span class="hljs-attr">:</span> <span class="hljs-attr">0</span>]<span class="hljs-attr">.color</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">         &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">       &gt;</span></span><br><span class="language-xml">         &#123;rescueStatus[targetInfo ? targetInfo.status : 0].text&#125;</span><br><span class="language-xml">       <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>       <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;rescued_level&quot;</span>&gt;</span>é£é™©ç­‰çº§ï¼š&#123;props.risk_level&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>     &lt;/<span class="hljs-title class_">View</span>&gt;<br>     <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;rescued_info&quot;</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span></span><br><span class="language-xml">           <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;border_l&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>å¾®åšå†…å®¹ï¼š</span><br><span class="language-xml">         <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;demand&quot;</span>&gt;</span>&#123;props.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;rescued_city&quot;</span>&gt;</span>åœ°ç‚¹ï¼š&#123;props.area&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br></code></pre></td></tr></table></figure></li><li><p>è¿˜æ˜¯èšç„¦äºè¡¨é¢åŠŸå¤«ï¼Œä½œä¸º<code>props</code>ä¼ è¿›çš„å‚æ•°ä¸€å †ï¼Œè€Œä¸”è¦<code>state</code>æ•°é‡ä¹Ÿä¸å°‘,å½±å“æ€§èƒ½ä¸è¯´ï¼Œåæ­£æ˜¯ä¸å¥½çœ‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> [flag,setFlag]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>        <span class="hljs-keyword">const</span> [finish,setFinish]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;å·²æ•‘æ´&#x27;</span>)<br>      <span class="hljs-comment">//  const [jiean,setJiean]=useState(&#x27;&#x27;)</span><br>        <span class="hljs-keyword">const</span> [color,setColor]=<span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)<span class="hljs-comment">//0:#f57b70  1:#76A9FF 2:#f9a53e</span><br>       <span class="hljs-comment">// const [status,setStatus]=useState(0)</span><br>        <span class="hljs-keyword">const</span> [text,setText]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">const</span> [area,setArea]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">const</span> [level,setLevel]=<span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">const</span> [data,setData]=<span class="hljs-title function_">useState</span>([])<br>        <span class="hljs-keyword">const</span> [ifmine,setIfmine] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)<br><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œå¾ˆå¤š<code>state</code>åªæ˜¯è·Ÿ<code>props</code>ç»‘å®šï¼Œè€Œ<code>props</code>ä¸ä¼šç»å¸¸æ”¹å˜ï¼Œå› æ­¤å®Œå…¨å¯ä»¥å»æ‰è¿™äº›<code>state</code>ï¼Œç›´æ¥ä½¿ç”¨<code>props</code>,ä¼˜åŒ–æ€§èƒ½ã€‚</p><p>æ³¨æ„åˆ°è·³è½¬æ—¶ä¼ å‚å¾ˆå¤šï¼Œå®Œå…¨å¯ä»¥é‡‡ç”¨<code>redux</code>çš„æ–¹å¼ï¼Œä¼˜åŒ–é€»è¾‘ï¼ŒæŠŠç›¸ä¼¼çš„å˜é‡å’Œå‚æ•°éƒ½æåˆ°å¤–éƒ¨ </p><p>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// rescueInfoSlice.ts</span><br><br><span class="hljs-keyword">import</span> &#123; createSlice, <span class="hljs-title class_">PayloadAction</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@reduxjs/toolkit&#x27;</span><br><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">SingleRescueInfo</span>,<br>  <span class="hljs-title class_">RescueTargetInfoType</span>,<br>  <span class="hljs-title class_">RescueProcess</span>,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../Service/fetchTypes&#x27;</span><br><span class="hljs-keyword">import</span> &#123; rescueInfoSliceType &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./sliceTypes&#x27;</span><br><br><span class="hljs-keyword">const</span> rescueInfoSlice = <span class="hljs-title function_">createSlice</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;rescueInfo&#x27;</span>,<br>  <span class="hljs-attr">initialState</span>: &#123;<br>    <span class="hljs-attr">rescueInfo</span>: &#123;&#125; <span class="hljs-keyword">as</span> <span class="hljs-title class_">SingleRescueInfo</span>,<br>    <span class="hljs-attr">targetInfo</span>: &#123;&#125; <span class="hljs-keyword">as</span> <span class="hljs-title class_">RescueTargetInfoType</span>,<br>    <span class="hljs-attr">process</span>: [],<br>    <span class="hljs-attr">eventID</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">targetID</span>: <span class="hljs-number">0</span>,<br>  &#125; <span class="hljs-keyword">as</span> rescueInfoSliceType,<br>  <span class="hljs-attr">reducers</span>: &#123;<br>    <span class="hljs-attr">updateRescueInfo</span>: <span class="hljs-function">(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-function">      state: rescueInfoSliceType,</span></span><br><span class="hljs-params"><span class="hljs-function">      action: PayloadAction&lt;SingleRescueInfo&gt;,</span></span><br><span class="hljs-params"><span class="hljs-function">    </span>) =&gt;</span> (&#123;<br>      ...state,<br>      <span class="hljs-attr">rescueInfo</span>: action.<span class="hljs-property">payload</span>,<br>      <span class="hljs-attr">eventID</span>: action.<span class="hljs-property">payload</span>.<span class="hljs-property">id</span>,<br>      <span class="hljs-attr">targetID</span>: action.<span class="hljs-property">payload</span>.<span class="hljs-property">rescue_target_id</span>,<br>    &#125;),<br>    <span class="hljs-attr">updateTargetInfo</span>: <span class="hljs-function">(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-function">      state: rescueInfoSliceType,</span></span><br><span class="hljs-params"><span class="hljs-function">      action: PayloadAction&lt;RescueTargetInfoType&gt;,</span></span><br><span class="hljs-params"><span class="hljs-function">    </span>) =&gt;</span> (&#123; ...state, <span class="hljs-attr">targetInfo</span>: action.<span class="hljs-property">payload</span> &#125;),<br>    <span class="hljs-attr">updateProcess</span>: <span class="hljs-function">(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-function">      state: rescueInfoSliceType,</span></span><br><span class="hljs-params"><span class="hljs-function">      action: PayloadAction&lt;RescueProcess[]&gt;,</span></span><br><span class="hljs-params"><span class="hljs-function">    </span>) =&gt;</span> (&#123; ...state, <span class="hljs-attr">process</span>: action.<span class="hljs-property">payload</span> &#125;),<br>  &#125;,<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> rescueInfoSlice.<span class="hljs-property">reducer</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> &#123; updateTargetInfo, updateRescueInfo, updateProcess &#125; =<br>  rescueInfoSlice.<span class="hljs-property">actions</span><br><br></code></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œ<code>redux</code>ä¸ç†è§£ä¸è¦ç´§ï¼Œä¸»è¦æ˜¯ç†è§£æŠ½å‡º<code>state</code>çš„è¿™ä¸ªæ€è·¯ï¼Œå‡å°‘ä¼ å‚ï¼Œæå‡å¯ç»´æŠ¤æ€§ğŸ˜Š</p><p>ç°åœ¨ï¼Œåªéœ€è¦ä¸€ä¸ªå˜é‡ï¼šä½¿ç”¨å˜é‡åªéœ€è¦ä»<code>store</code>ä¸­å–å‡ºå³å¯ï¼Œä¹Ÿä¸éœ€è¦å¦å¤–ä¼ å‚ç»™å…¶ä½™é¡µé¢ã€‚</p></blockquote><p>åŒæ—¶ï¼Œæ³¨æ„åˆ°<code>useEffect</code>ä¸­çš„è°ƒç”¨ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>            <span class="hljs-comment">/* console.log(param.flag) */</span><br>          <span class="hljs-comment">//  setStatus(param.status)//ä¸»é¡µitem</span><br>        <br>          <span class="hljs-keyword">if</span>(param.<span class="hljs-property">flag</span>==<span class="hljs-string">&#x27;main&#x27;</span>)  <span class="hljs-comment">//ä¸»é¡µ</span><br>          &#123;<br>            <span class="hljs-title function_">setFlag</span>(<span class="hljs-string">&#x27;alarm&#x27;</span>)<br>            <span class="hljs-keyword">if</span>(param.<span class="hljs-property">ifmine</span>)<br>            &#123;<br>                <span class="hljs-title function_">setIfmine</span>(<span class="hljs-literal">true</span>)<br>                <span class="hljs-title function_">setFinish</span>(<span class="hljs-string">&#x27;æ•‘æ´ä¸­&#x27;</span>)<br>                <span class="hljs-title function_">setColor</span>(<span class="hljs-number">1</span>)<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">//  æœªè®¤é¢†çš„æ•‘æ´</span><br>                <span class="hljs-title function_">setIfmine</span>(<span class="hljs-literal">false</span>)<br>                <span class="hljs-title class_">Fetch</span>(<br>                    <span class="hljs-string">&#x27;/rescue/targetinfo&#x27;</span>,<br>                    &#123;<br>                        <span class="hljs-string">&quot;rescue_target_id&quot;</span>: param.<span class="hljs-property">rescue_target_id</span>,<br>                    &#125;,<br>                    <span class="hljs-string">&#x27;POST&#x27;</span><br>                ).<span class="hljs-title function_">then</span>(<br>                    <span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<br>                        <span class="hljs-comment">//console.log(res)</span><br>                        <span class="hljs-title function_">setFinish</span>(status[res.<span class="hljs-property">data</span>.<span class="hljs-property">rescue_target_info</span>.<span class="hljs-property">status</span>])<br>                        <span class="hljs-title function_">setColor</span>(res.<span class="hljs-property">data</span>.<span class="hljs-property">rescue_target_info</span>.<span class="hljs-property">status</span>)<br>                    &#125;<br>                )<br>          &#125;&#125;<br>          <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">//record</span><br>            <span class="hljs-title function_">setFlag</span>(<span class="hljs-string">&#x27;record&#x27;</span>)<br>            <span class="hljs-title function_">setFinish</span>(status[param.<span class="hljs-property">status</span>])<br>            <span class="hljs-title function_">setColor</span>(param.<span class="hljs-property">status</span>)<br>          &#125;<br>            <span class="hljs-title function_">setText</span>(param.<span class="hljs-property">text</span>)<br>            <span class="hljs-title function_">setArea</span>(param.<span class="hljs-property">area</span>)<br>            <span class="hljs-title function_">setLevel</span>(param.<span class="hljs-property">risk_level</span>)<br>            <span class="hljs-title function_">setData</span>(param.<span class="hljs-property">data</span>)<br>        &#125;,[param])<br></code></pre></td></tr></table></figure><p>è¿™äº›<code>setState</code>éƒ½å¯ä»¥çœå»ï¼Œä½†æ˜¯ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œé€»è¾‘å¾ˆå¤æ‚, éœ€è¦é‡æ–°ç»„ç»‡ä¸€ä¸‹é€»è¾‘</p><p>è¿™ä¸ªæ—¶å€™ï¼Œå°˜å°å·²ä¹…çš„å¤§è„‘å°±è¦å¼€å§‹è½¬åŠ¨äº†ï¼š</p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦æ˜¯<code>flag</code>è¿™ä¸ªå€¼æ˜¯é€»è¾‘å¤æ‚çš„å¼€å§‹ï¼Œæ ¹æ®æ³¨é‡Šå¯ä»¥çŸ¥é“ï¼Œå†™çš„äººå½“æ—¶ä¹Ÿå¾ˆæŒ£æ‰ğŸ¶ã€‚</p><p>è¿™å¯èƒ½æ˜¯å› ä¸ºåç«¯æ¥å£çš„é—®é¢˜ï¼Œå¯¼è‡´ä¸»é¡µé¢ä¸Šæœ‰æœªè®¤é¢†çš„ä»»åŠ¡ï¼Œéœ€è¦é‡æ–°è¯·æ±‚æ‰èƒ½å¾—åˆ°ä¿¡æ¯ã€‚</p><p>ç„¶è€ŒçŒ›ç„¶ä¸€çœ‹ï¼Œçœ‹åˆ°è¿™æ®µï¼Œ</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">if</span>(param.<span class="hljs-property">ifmine</span>)<br>            &#123;<br>                <span class="hljs-title function_">setIfmine</span>(<span class="hljs-literal">true</span>)<br>                <span class="hljs-title function_">setFinish</span>(<span class="hljs-string">&#x27;æ•‘æ´ä¸­&#x27;</span>)<br>                <span class="hljs-title function_">setColor</span>(<span class="hljs-number">1</span>)<br>            &#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿæ²¡åœ¨å¹²ä»€ä¹ˆï¼Œæ‰€ä»¥å°±ç´¢æ€§ä¸€è§†åŒä»ï¼Œéƒ½å‘ä¸ªè¯·æ±‚å‘—</p></blockquote></li><li><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘æ˜¯å–œæ¬¢æŠŠè¯·æ±‚è¿™äº›ä¸œè¥¿æ”¾åˆ°å¤–è¾¹å»çš„ï¼Œæä¸ª<code>service</code>æ–‡ä»¶å¤¹å’¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /service/fetchType.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">BaseResType</span>&lt;T&gt; = &#123;<br>  <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">msg</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">data</span>: T<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> requestType = <span class="hljs-string">&#x27;GET&#x27;</span> | <span class="hljs-string">&#x27;POST&#x27;</span> | <span class="hljs-string">&#x27;PUT&#x27;</span> | <span class="hljs-string">&#x27;DELETE&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RescueTargetInfoResponse</span> &#123;<br>  <span class="hljs-attr">rescue_target_info</span>: <span class="hljs-title class_">RescueTargetInfoType</span><br>&#125;<br><br><span class="hljs-comment">// è¿™æ®µç›´æ¥ä»apifoxä¸Šcopyå°±è¡Œ</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RescueTargetInfoType</span> &#123;<br>  <span class="hljs-attr">create_time</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è¿‡ç¨‹æè¿°</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´ç»“æŸæ—¶é—´</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">end_time</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æœ€ç»ˆè¯„ä»·</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">evalutaion</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´å¯¹è±¡id</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´å¯¹è±¡æ˜µç§°ï¼ˆæŒ‰æœ€æ–°çš„æ•‘æ´ä¿¡æ¯æ•°æ®ï¼‰</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">nickname</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è€å¸ˆ1id</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">rescue_teacher1_id</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è€å¸ˆ1å§“å</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">rescue_teacher1_name</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è€å¸ˆ1èº«ä»½</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">rescue_teacher1_role</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è€å¸ˆ2id</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">rescue_teacher2_id</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è€å¸ˆ2å§“å</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">rescue_teacher2_name</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è€å¸ˆ2èº«ä»½</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">rescue_teacher2_role</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è€å¸ˆ3id</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">rescue_teacher3_id</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è€å¸ˆ3å§“å</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">rescue_teacher3_name</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´è€å¸ˆ3èº«ä»½</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">rescue_teacher3_role</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´èµ·å§‹æ—¶é—´</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">start_time</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´çŠ¶æ€ï¼ˆ0-å¾…æ•‘æ´ 1-æ•‘æ´ä¸­ 2-å·²æ•‘æ´ï¼‰</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">status</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">update_time</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * æ•‘æ´å¯¹è±¡å¾®åšåœ°å€ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">weibo_address</span>: <span class="hljs-built_in">string</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /service/rescueInfoByID.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">FetchRescueTargetInfo</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">targetID: <span class="hljs-built_in">number</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> data = &#123;<br>    <span class="hljs-attr">rescue_target_id</span>: targetID,<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Fetch</span>&lt;<span class="hljs-title class_">BaseResType</span>&lt;<span class="hljs-title class_">RescueTargetInfoResponse</span>&gt;&gt;(<br>    <span class="hljs-string">&#x27;/rescue/targetinfo&#x27;</span>,<br>    data,<br>    <span class="hljs-string">&#x27;POST&#x27;</span>,<br>  )<br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹æ®å®ƒä¼ è¿›æ¥çš„<code>props</code>,æ¥è¯·æ±‚<code>target_info</code>ï¼Œå¹¶ä¸”å˜æˆ<code>state</code>æ”¾èµ·æ¥</p><p>è¿™ä¸ªæ—¶å€™ï¼Œæ–‡ä»¶å·²ç»å¼€å§‹å˜å¾—æ¸…çˆ½äº†ï¼š</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">MsgItem</span>=(<span class="hljs-params">props</span>)=&gt;&#123;<br>  <span class="hljs-keyword">const</span> &#123; navURL, ...restProps &#125; = props<br>  <span class="hljs-keyword">const</span> [targetInfo, setTargetInfo] = useState&lt;<span class="hljs-title class_">RescueTargetInfoType</span>&gt;()<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title class_">FetchRescueTargetInfo</span>(restProps.<span class="hljs-property">rescue_target_id</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setTargetInfo</span>(res.<span class="hljs-property">data</span>.<span class="hljs-property">rescue_target_info</span>)<br>    &#125;)<br>  &#125;, [])<br>        <span class="hljs-keyword">function</span> <span class="hljs-title function_">toR_detail</span>(<span class="hljs-params"></span>)<br>        &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(flag)<br>            <span class="hljs-keyword">if</span>(flag==<span class="hljs-string">&#x27;alarm&#x27;</span>)<br>            <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">navigateTo</span>(&#123;<br>                <span class="hljs-attr">url</span>:<span class="hljs-string">`/moduleA/pages/Alarm/index?ifmine=<span class="hljs-subst">$&#123;ifmine&#125;</span>&amp;data=<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(data)&#125;</span>&amp;finish=<span class="hljs-subst">$&#123;finish&#125;</span>&amp;color=<span class="hljs-subst">$&#123;color&#125;</span>`</span><br>            &#125;)<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;todetail&#x27;</span>)<br>                <span class="hljs-keyword">const</span> jiean = param.<span class="hljs-property">status</span>==<span class="hljs-number">1</span>?<span class="hljs-string">&#x27;æœªç»“æ¡ˆ&#x27;</span>:<span class="hljs-string">&#x27;å·²ç»“æ¡ˆ&#x27;</span><br>                <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">navigateTo</span>(&#123;<br>                    <span class="hljs-attr">url</span>:<span class="hljs-string">`/moduleA/pages/Rescue_detail/index?finish=<span class="hljs-subst">$&#123;jiean&#125;</span>&amp;data=<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(data)&#125;</span>&amp;teacher=<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(param.teacher)&#125;</span>&amp;lap=<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(param.lap)&#125;</span>`</span><br>                &#125;)<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span>(<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;noti-item column&#x27;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;toR_detail&#125;</span> &gt;</span></span><br><span class="language-xml">             <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;inline&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;state&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">backgroundColor:</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">rescueStatus</span>[<span class="hljs-attr">targetInfo</span> ? <span class="hljs-attr">targetInfo.status</span> <span class="hljs-attr">:</span> <span class="hljs-attr">0</span>]<span class="hljs-attr">.color</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">          &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        &gt;</span></span><br><span class="language-xml">          &#123;rescueStatus[targetInfo ? targetInfo.status : 0].text&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;rescued_level&quot;</span>&gt;</span>é£é™©ç­‰çº§ï¼š&#123;props.risk_level&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;rescued_info&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;border_l&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>å¾®åšå†…å®¹ï¼š</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;demand&quot;</span>&gt;</span>&#123;props.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;rescued_city&quot;</span>&gt;</span>åœ°ç‚¹ï¼š&#123;props.area&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>        )<br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¥ä¸‹æ¥ï¼Œå°±å‰©ä¸€ä¸ª<code>toR_detail</code>å‡½æ•°è¦æ”¹å’¯ï¼Œä¹Ÿæ˜¯æ’’æ’’æ°´å•¦,å› ä¸ºåˆšåˆšæˆ‘ä»¬æŠŠstateéƒ½æ”¾åˆ°å¤–è¾¹å»äº†ï¼Œè¿™é‡Œä¹Ÿä¸ç”¨é€šè¿‡ä¼ å‚æ¥è®©å…¶ä»–é¡µé¢è®¿é—®å’¯ï¼Œè¶…çº§çˆ½ï¼Œç•¥å¾®æ”¹æ”¹ï¼Œå°±è¿™æ ·å’¯ï¼Œå…¶ä¸­<code>Nav</code>æ˜¯æˆ‘å°è£…çš„è·³è½¬å‡½æ•°ï¼Œå› ä¸ºä¸æƒ³å†™é‚£ä¹ˆå¤š<code>Taro.navigateTo(&#123;url:&quot;......&quot;&#125;)</code>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Navi</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> navURL_real = navURL || <span class="hljs-string">&#x27;/moduleA/pages/Alarm/index&#x27;</span><br>    store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">updateRescueInfo</span>(restProps))<br>    targetInfo &amp;&amp; store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">updateTargetInfo</span>(targetInfo))<br>    <span class="hljs-title class_">Nav</span>(navURL_real)<br>  &#125;<br></code></pre></td></tr></table></figure></li><li><p>è¿™ä¸‹å°±å¤§åŠŸå‘Šæˆäº†ï¼Œå—ï¼Ÿè¿˜è®°å¾—ä¸€å¼€å§‹çš„é‚£äº›ç»„ä»¶ä¼ çš„<code>props</code>å—?ä¹Ÿè¯¥æ¸…æ¸…å•¦ï¼ï¼Œåƒä»€ä¹ˆ<code>flag</code>,<code>ifmine</code>,éƒ½å¯ä»¥æ‰”æ‰å•¦ï¼Œåªç•™ä¸‹åŸºæœ¬çš„msgä¿¡æ¯å°±è¡Œ</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// R_record.jsx </span><br><span class="hljs-comment">// è¿™é‡ŒRitemå°±æ˜¯msgItem</span><br>&#123;list?list.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>)=&gt;</span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Ritem</span> &#123;<span class="hljs-attr">...item</span>&#125; /&gt;</span></span>):<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;img&#x27;</span>&gt;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// Main.jsx</span><br>&#123;mine?mine.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>)=&gt;</span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MsgItem</span> &#123;<span class="hljs-attr">...item</span>&#125;/&gt;</span></span>)<br></code></pre></td></tr></table></figure><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">//Search.jsx </span><br><span class="hljs-comment">// è¿™æ®µæ˜¯ä¹‹å‰æˆ‘å†™çš„ï¼Œä¸€å¨ğŸ’©</span><br> &#123;form &amp;&amp; form.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MsgItem</span> &#123;<span class="hljs-attr">...item</span>&#125; /&gt;</span></span>)&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç°åœ¨å›å¤´çœ‹çœ‹æˆ‘ä»¬é‡æ„åçš„ç»„ä»¶çš„å…¨è²Œå§ï¼š</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">View</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@tarojs/components&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./index.less&#x27;</span><br><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">RescueMessageItemProps</span>,<br>  rescueStatus,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../types/rescueMessageItemTypes&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Nav</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utils/taroFunctions&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">FetchRescueTargetInfo</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../Service/rescueInfoByID&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RescueTargetInfoType</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../Service/fetchTypes&#x27;</span><br><span class="hljs-keyword">import</span> &#123;<br>  updateRescueInfo,<br>  updateTargetInfo,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../slices/rescueInfoSlice&#x27;</span><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../store/store&#x27;</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">RescueMessageItem</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">RescueMessageItemProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; navURL, ...restProps &#125; = props<br>  <span class="hljs-keyword">const</span> [targetInfo, setTargetInfo] = useState&lt;<span class="hljs-title class_">RescueTargetInfoType</span>&gt;()<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title class_">FetchRescueTargetInfo</span>(restProps.<span class="hljs-property">rescue_target_id</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setTargetInfo</span>(res.<span class="hljs-property">data</span>.<span class="hljs-property">rescue_target_info</span>)<br>    &#125;)<br>  &#125;, [])<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Navi</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> navURL_real = navURL || <span class="hljs-string">&#x27;/moduleA/pages/Alarm/index&#x27;</span><br>    store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">updateRescueInfo</span>(restProps))<br>    targetInfo &amp;&amp; store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">updateTargetInfo</span>(targetInfo))<br>    <span class="hljs-title class_">Nav</span>(navURL_real)<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;noti-item column&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;Navi&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;inline&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;state&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">backgroundColor:</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">rescueStatus</span>[<span class="hljs-attr">targetInfo</span> ? <span class="hljs-attr">targetInfo.status</span> <span class="hljs-attr">:</span> <span class="hljs-attr">0</span>]<span class="hljs-attr">.color</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">          &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        &gt;</span></span><br><span class="language-xml">          &#123;rescueStatus[targetInfo ? targetInfo.status : 0].text&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;rescued_level&quot;</span>&gt;</span>é£é™©ç­‰çº§ï¼š&#123;props.risk_level&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;rescued_info&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;border_l&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>å¾®åšå†…å®¹ï¼š</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;demand&quot;</span>&gt;</span>&#123;props.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;rescued_city&quot;</span>&gt;</span>åœ°ç‚¹ï¼š&#123;props.area&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  )<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">RescueMessageItem</span><br><br></code></pre></td></tr></table></figure><p>ä¸€å…±æ˜¯59è¡Œï¼Œæ˜¯ä¸æ˜¯ç‰¹åˆ«çš„ä¸€ç›®äº†ç„¶ï¼Œçœ‹åˆ°ä¹‹åï¼Œå¿ƒæƒ…éƒ½å˜å¥½äº†ï¼Œä¸æ‰æˆ‘é‡æ„è¿™ä¹ˆä¹…ğŸ¤—</p></li></ol><h2 id="äº”ã€æ€»ç»“â¬‡ï¸"><a href="#äº”ã€æ€»ç»“â¬‡ï¸" class="headerlink" title="äº”ã€æ€»ç»“â¬‡ï¸"></a>äº”ã€æ€»ç»“â¬‡ï¸</h2><p>åœ¨<code>ã€Šé‡æ„ã€‹</code>ä¸­ï¼Œä½œè€…æåˆ°äº†<em><strong>è¥åœ°æ³•åˆ™</strong></em>ï¼Œå³<strong>è¦ä¿è¯åœ¨ä½ æ¥ä¹‹åï¼Œä»£ç å˜å¾—æ›´å¥½è€Œä¸æ˜¯æ›´ç³Ÿç³•</strong>ï¼Œè€Œä¿è¯ä»£ç å˜å¾—æ›´å¥½çš„ç§˜è¯€ï¼Œå°±æ˜¯<strong>é‡æ„</strong>ã€‚è¿™æ¬¡é€šè¿‡ä¸€ä¸ªå°ä¾‹å­ï¼Œæ¥è®©å¤§å®¶çŸ¥é“æŠŠæ—¶é—´èŠ±åœ¨é‡æ„ä¸Šå¹¶ä¸å¯æ€•ï¼Œç»å¸¸é‡æ„å¹¶ä¸è§å¾—æ˜¯ä¸€ä»¶åäº‹ï¼Œç›¸åçš„ï¼Œç»å¸¸é‡æ„ä»£è¡¨ç€ä½ åœ¨ç§¯ææ€è€ƒï¼ŒåŠªåŠ›è®©ä»£ç å˜å¾—æ›´ä¼˜ç§€ï¼›è€Œä¸é‡æ„ï¼Œåªèƒ½æ˜¯ç»™æœªæ¥çš„è‡ªå·±å’ŒåŒä¼´æ·»å µå’¯ã€‚å½“ç„¶ï¼Œè¿‡æ—©è¿‡é¢‘ç¹çš„é‡æ„ä¹Ÿæ˜¯ä¸æå€¡çš„ï¼Œå°±æ¯”å¦‚ï¼šæœ¬æ¥è¿™ä¸ªæŒ‰é’®åªç”¨è´Ÿè´£è·³è½¬ï¼Œä½ å†™ç€å†™ç€ï¼Œçªç„¶æƒ³åˆ°ä»¥åè¦æ˜¯è¦è®©ä»–èƒ½ç‚¹ä¸€ä¸‹å‡ºæ¥ä¸€ä¸ª<code>ggbond</code>æ€ä¹ˆåŠï¼Œä½ åº“åº“å¼€å§‹é‡æ„ï¼Œé‡æ„å®Œä¹‹åï¼Œä¸€å¤©å°±è¿‡å»äº†ã€‚ç„¶è€Œäº§å“è€æ¿åˆ°æœ€åä¹Ÿæ²¡æœ‰ç‚¹ä¸€ä¸‹å‡ºæ¥ä¸€ä¸ª<code>ggbond</code>çš„éœ€æ±‚ï¼ˆè™½ç„¶è¿™çœŸçš„å¾ˆé…·ğŸ˜ï¼‰ã€‚é‚£è¿™ä¸€å¤©å°±æ˜¯ç™½è´¹çš„ã€‚æ€»ä¹‹ï¼Œé‡æ„å°±æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œè¿‡å¤šè¿‡å°‘éƒ½ä¸æå€¡ï¼Œè¦æ ¹æ®é¡¹ç›®è¦æ±‚ï¼Œçµæ´»é‡æ„ã€‚ä¸å¤šè¯´äº†ï¼Œè¿™äº›å†™å¤šäº†è‡ªç„¶å°±æœ‰æ„Ÿè§‰å•¦ğŸ¤—</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®å‰ç«¯</title>
    <link href="/2024/03/03/micro/"/>
    <url>/2024/03/03/micro/</url>
    
    <content type="html"><![CDATA[<h1 id="å¾®å‰ç«¯å…¥é—¨ğŸ”"><a href="#å¾®å‰ç«¯å…¥é—¨ğŸ”" class="headerlink" title="å¾®å‰ç«¯å…¥é—¨ğŸ”"></a>å¾®å‰ç«¯å…¥é—¨ğŸ”</h1><h2 id="1-å•¥æ˜¯å¾®å‰ç«¯ï¼ŸğŸ¥°"><a href="#1-å•¥æ˜¯å¾®å‰ç«¯ï¼ŸğŸ¥°" class="headerlink" title="1. å•¥æ˜¯å¾®å‰ç«¯ï¼ŸğŸ¥°"></a>1. å•¥æ˜¯å¾®å‰ç«¯ï¼ŸğŸ¥°</h2><p>å¾®å‰ç«¯è¿™ä¸ª <code>idea</code> å…¶å®å’Œ<code>router</code>ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä»åç«¯é‚£é‡Œå·è¿‡æ¥çš„ã€‚</p><p>å·å¸ˆçš„ä¸œè¥¿ä½ ä»¬å¯èƒ½ä¹Ÿå¬è¯´è¿‡ï¼Œå°±æ˜¯å¤§åé¼é¼çš„<code>å¾®æœåŠ¡(micro web service)</code></p><p>é‚£å•¥æ˜¯å¾®æœåŠ¡å˜ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠåŸæ¥åºå¤§çš„ç³»ç»Ÿï¼Œæ‹†æˆä¸€ä¸ªä¸ªç»†å°çš„æœåŠ¡ï¼Œæ”¾åœ¨<code>åˆ†å¸ƒå¼ç³»ç»Ÿ</code>ä¸Šè¾¹ã€‚</p><blockquote><p>ä¸¾ä¸ªğŸŒ°çš„è¯ï¼Œå°±ç›¸å½“äºä½ æŠŠä¸€æ•´å—å¤§åˆ—å·´åˆ‡å¼€ï¼Œç„¶åæ”¾åœ¨ä¸åŒçš„æŸœå­é‡Œï¼ˆå¤§åˆ—å·´å¥½åƒçˆ±åƒğŸ¥°ï¼‰</p></blockquote><p>è¿™ä¹ˆè¯´æ˜¯ä¸æ˜¯æœ‰ç‚¹æ¦‚å¿µäº†ï¼Œé‚£å¥½ï¼Œ<code>å¾®æœåŠ¡</code>ä»‹ç»å¥½äº†ï¼Œç°åœ¨å°±çœ‹çœ‹å’±ä»¬çš„<code>å¾®å‰ç«¯</code>æ˜¯å’‹ä¸ªäº‹å’¯ï¼š</p><ul><li>å‰è¾¹è¯´äº†è¿™ä¹ˆå¤šï¼Œé‚£ä¸€æƒ³è‚¯å®šæ˜¯å¾—æŠŠå·¥ç¨‹æ‹†å¼€å’¯ï¼Œç°åœ¨ä¸€èˆ¬æ˜¯æ‹†æˆä¸¤ä¸ªå¤§å—ï¼š<ul><li>ä¸»åº”ç”¨ï¼šè´Ÿè´£ç®¡ç†å„ä¸ªå­åº”ç”¨çš„<code>ç”Ÿå‘½å‘¨æœŸ</code>ï¼Œ<code>æ³¨å†Œ</code></li><li>å­åº”ç”¨ï¼šå…·ä½“å®ç°å„ä¸ªé¡µé¢</li></ul></li></ul><p>åœ¨ä¸»åº”ç”¨é‡Œï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¦å¹²çš„äº‹æƒ…å’Œ<code>router</code>æ˜¯æå…¶ç±»ä¼¼çš„ï¼Œå®é™…ä¸Šï¼Œä¸ªäººæ„Ÿè§‰å¾®å‰ç«¯å°±æ˜¯<code>router-pro-max</code>ï¼Œåªä¸è¿‡è¦è€ƒè™‘çš„æ–¹é¢æ›´åŠ å¤šæ›´åŠ å…¨é¢ï¼Œå¾…ä¼šå†ç»†è¯´</p><h2 id="2-é‚£ä¸ºå•¥è¦ç”¨å¾®å‰ç«¯å˜ï¼Œå†™ä¸€å—ä¸å¥½å—ï¼ŸğŸ˜¶"><a href="#2-é‚£ä¸ºå•¥è¦ç”¨å¾®å‰ç«¯å˜ï¼Œå†™ä¸€å—ä¸å¥½å—ï¼ŸğŸ˜¶" class="headerlink" title="2. é‚£ä¸ºå•¥è¦ç”¨å¾®å‰ç«¯å˜ï¼Œå†™ä¸€å—ä¸å¥½å—ï¼ŸğŸ˜¶"></a>2. é‚£ä¸ºå•¥è¦ç”¨å¾®å‰ç«¯å˜ï¼Œå†™ä¸€å—ä¸å¥½å—ï¼ŸğŸ˜¶</h2><blockquote><p>è¿˜æ˜¯é‚£ä¸ªğŸŒ°ï¼Œæƒ³ä¸€ä¸‹ï¼Œä½ æŠŠä¸€å—å¤§åˆ—å·´åˆ‡å¼€äº†æ”¾å¯èƒ½å¸¦æ¥çš„å¥½å¤„ï¼š</p><ul><li>æ¯ä¸ªæŸœå­çš„å‹åŠ›ä¼šå˜å°</li><li>å¦‚æœæœ‰ä¸€å—å¤§åˆ—å·´åäº†ï¼Œå…¶ä»–çš„ä¹Ÿä¸ä¼šå—å½±å“</li><li>å¦‚æœæœ‰å¤©æƒ³æ¢ä¸ªå£å‘³ï¼Œé‚£æŠŠå…¶ä¸­ä¸€å—å¤§åˆ—å·´æ¢æˆåœŸè±†ï¼Œä¹Ÿå¾ˆæ–¹ä¾¿å‘€</li></ul></blockquote><p>é‚£å°±ä¸€æ¡ä¸€æ¡æ¥çœ‹å’¯ï¼š</p><ul><li>æŠŠä¸åŒé¡µé¢æ”¾åˆ°ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œå•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›è‚¯å®šä¼šå‡å°ï¼ˆè™½ç„¶ä¸»è¦å‹åŠ›ä¸åœ¨è¿™ï¼‰</li><li>å¦‚æœä¸€ä¸ªé¡µé¢å‡ºç°äº†é—®é¢˜ï¼Œå…¶ä»–çš„é¡µé¢ä¸å—å½±å“ï¼Œä¸ä¼šåƒä¼ ç»Ÿå•ä½“é‚£æ ·<code>ä¸€æŒ‚å…¨æŒ‚</code></li><li>å„ä¸ªé¡µé¢ç‹¬ç«‹ï¼Œå‡ºäº†é—®é¢˜ç»´æŠ¤å¾ˆæ–¹ä¾¿</li><li>ç”±äºå„ä¸ªé¡µé¢ç‹¬ç«‹ï¼Œå› æ­¤é¡¹ç›®å¯ä»¥é€‰ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆï¼Œæ¯”å¦‚<code>ç™»å½•</code>ç”¨<code>react</code>å†™ï¼Œ<code>å‘å¸–</code>ç”¨<code>vue</code>å†™ï¼›ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œçµæ´»é€‰æ‹©<code>ssr</code>è¿˜æ˜¯<code>csr</code>ï¼Œè¿™çœŸçš„å¾ˆé…·ğŸ¶</li></ul><p><strong>ä½†æ˜¯æœ‰ä¼˜ç‚¹ï¼Œå°±ä¼šä¼´éšç€éš¾ç‚¹å’Œç¼ºç‚¹</strong></p><ul><li>ä¸åŒé¡µé¢å¦‚ä½•é€šä¿¡ï¼Ÿ</li><li>æ¯ä¸ªé¡µé¢éƒ½æœ‰ä¸€å¥—ä¾èµ–åº“ï¼Œæ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿå¦‚ä½•å…±äº«ä¾èµ–åº“ï¼Ÿ</li><li>å¦‚ä½•ç¡®å®šåº”ç”¨è¾¹ç•Œï¼Ÿ</li><li>â€¦â€¦</li></ul><p>ä½†æ˜¯è¿™äº›ï¼Œä»Šå¤©éƒ½ä¸è®²ğŸ˜</p><p>ä¸»è¦åŸå› æ˜¯æˆ‘ä¸ä¼šï¼Œæ¬¡è¦åŸå› æ˜¯å¤ªå¤æ‚äº†ï¼Œè®²ä¸å®Œï¼ˆæˆ–è®¸ä¸»è¦åŸå› æ˜¯è¿™ä¸ªğŸ˜™ï¼‰</p><h2 id="3-ç›®å‰å¾®å‰ç«¯å®ç°ğŸ¤©"><a href="#3-ç›®å‰å¾®å‰ç«¯å®ç°ğŸ¤©" class="headerlink" title="3. ç›®å‰å¾®å‰ç«¯å®ç°ğŸ¤©"></a>3. ç›®å‰å¾®å‰ç«¯å®ç°ğŸ¤©</h2><p>å¾®å‰ç«¯çš„å®ç°æ–¹æ¡ˆæœ‰æŒºå¤šï¼Œæ¯”å¦‚è¯´ï¼š</p><ol><li><a href="https://github.com/umijs/qiankun">qiankun</a>ï¼Œè‡ªå·±å®ç° JS åŠæ ·å¼éš”ç¦»</li><li><a href="https://github.com/ice-lab/icestark">icestark</a>ï¼Œiframe æ–¹æ¡ˆï¼Œæµè§ˆå™¨åŸç”Ÿéš”ç¦»ï¼Œä½†å­˜åœ¨ä¸€äº›é—®é¢˜</li><li><a href="https://github.com/efoxTeam/emp">emp</a>ï¼ŒWebpack 5 Module Federationï¼ˆè”é‚¦æ¨¡å—ï¼‰æ–¹æ¡ˆ</li><li>WebComponent ç­‰æ–¹æ¡ˆ</li></ol><p>ä½†æ˜¯è¿™ä¹ˆå¤šå®ç°æ–¹æ¡ˆè§£å†³çš„åœºæ™¯é—®é¢˜è¿˜æ˜¯åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>å•å®ä¾‹ï¼šå½“å‰é¡µé¢åªå­˜åœ¨ä¸€ä¸ªå­åº”ç”¨ï¼Œä¸€èˆ¬ä½¿ç”¨ qiankun å°±è¡Œ</li><li>å¤šå®ä¾‹ï¼šå½“å‰é¡µé¢å­˜åœ¨å¤šä¸ªå­åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿéš”ç¦»æ–¹æ¡ˆï¼Œæ¯”å¦‚ iframe æˆ–è€… WebComponent è¿™äº›</li></ul><p>å½“ç„¶äº†ï¼Œå¹¶ä¸æ˜¯è¯´å•å®ä¾‹åªèƒ½ç”¨ qiankunï¼Œæµè§ˆå™¨åŸç”Ÿéš”ç¦»æ–¹æ¡ˆä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œåªè¦ä½ æ¥å—å®ƒä»¬å¸¦æ¥çš„ä¸è¶³å°±è¡Œï¼š</p><blockquote><p>iframe æœ€å¤§çš„ç‰¹æ€§å°±æ˜¯æä¾›äº†æµè§ˆå™¨åŸç”Ÿçš„ç¡¬éš”ç¦»æ–¹æ¡ˆï¼Œä¸è®ºæ˜¯æ ·å¼éš”ç¦»ã€js éš”ç¦»è¿™ç±»é—®é¢˜ç»Ÿç»Ÿéƒ½èƒ½è¢«å®Œç¾è§£å†³ã€‚ä½†ä»–çš„æœ€å¤§é—®é¢˜ä¹Ÿåœ¨äºä»–çš„éš”ç¦»æ€§æ— æ³•è¢«çªç ´ï¼Œå¯¼è‡´åº”ç”¨é—´ä¸Šä¸‹æ–‡æ— æ³•è¢«å…±äº«ï¼Œéšä¹‹å¸¦æ¥çš„å¼€å‘ä½“éªŒã€äº§å“ä½“éªŒçš„é—®é¢˜ã€‚</p></blockquote><p>ä¸Šè¿°å†…å®¹æ‘˜è‡ª<a href="https://www.yuque.com/kuitos/gky7yw/gesexv">Why Not Iframe</a>ã€‚</p><p>æœ¬æ–‡çš„å®ç°æ–¹æ¡ˆå’Œ qiankun ä¸€è‡´ï¼Œä½†æ˜¯å…¶ä¸­æ¶‰åŠåˆ°çš„åŠŸèƒ½åŠåŸç†æ–¹é¢çš„ä¸œè¥¿éƒ½æ˜¯é€šç”¨çš„ï¼Œä½ æ¢ä¸ªå®ç°æ–¹æ¡ˆä¹Ÿéœ€è¦è¿™äº›ã€‚</p><h2 id="4-è¯ä¸å¤šè¯´ï¼Œä¸Šæ‰‹å§ğŸ¥±"><a href="#4-è¯ä¸å¤šè¯´ï¼Œä¸Šæ‰‹å§ğŸ¥±" class="headerlink" title="4. è¯ä¸å¤šè¯´ï¼Œä¸Šæ‰‹å§ğŸ¥±"></a>4. è¯ä¸å¤šè¯´ï¼Œä¸Šæ‰‹å§ğŸ¥±</h2><blockquote><p><em><strong>è®²è®²æ€è·¯å…ˆï¼š</strong></em></p><p>ä¸åŒé¡µé¢åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡<code>ä¸»åº”ç”¨</code>è¿›å…¥ç¨‹åºï¼Œé‚£æ¥ä¸‹æ¥è®¿é—®å­é¡µé¢å…¶å®è¦å¹²çš„äº‹æƒ…å°±æ˜¯<strong>å‘å­åº”ç”¨çš„æœåŠ¡å™¨å‘ä¸ªè¯·æ±‚ï¼Œæ‹¿åˆ°å®ƒçš„html\css\jsç­‰æ–‡ä»¶ï¼Œæ’å…¥è¿›æ¥æ‰§è¡Œ</strong></p><p>æ²¡åˆ«çš„ï¼Œç®€å•ç²—æš´å§ï¼Œå¼€å¹²å’¯</p></blockquote><h3 id="ğŸ¤—é¦–å…ˆï¼Œå¾—æœ‰ä¸ªä¸»åº”ç”¨å§"><a href="#ğŸ¤—é¦–å…ˆï¼Œå¾—æœ‰ä¸ªä¸»åº”ç”¨å§" class="headerlink" title="ğŸ¤—é¦–å…ˆï¼Œå¾—æœ‰ä¸ªä¸»åº”ç”¨å§"></a>ğŸ¤—é¦–å…ˆï¼Œå¾—æœ‰ä¸ªä¸»åº”ç”¨å§</h3><p>éšéšä¾¿ä¾¿åˆ›ä¸€ä¸ªå¾—äº†ï¼Œè·‘åœ¨<code>5173</code>è¿™ä¸ªé»˜è®¤å£ä¸Šã€‚</p><p>å†éšéšä¾¿ä¾¿åˆ›ä¸€ä¸ªå­åº”ç”¨ï¼Œï¼ˆæˆ‘è¿™é‡Œå­åº”ç”¨è¿˜æ˜¯ä¸Šæ¬¡çš„<code>todo-list</code>ï¼‰ï¼Œè·‘åœ¨<code>10086</code>ç«¯å£</p><h3 id="ğŸ¤”ç„¶åï¼Œå°±è¦åŠ¨è„‘å­å•¦ï¼Œä¸»é¡µé¢è¯¥å¦‚ä½•é…ç½®å­é¡µé¢å‘¢ï¼Ÿ"><a href="#ğŸ¤”ç„¶åï¼Œå°±è¦åŠ¨è„‘å­å•¦ï¼Œä¸»é¡µé¢è¯¥å¦‚ä½•é…ç½®å­é¡µé¢å‘¢ï¼Ÿ" class="headerlink" title="ğŸ¤”ç„¶åï¼Œå°±è¦åŠ¨è„‘å­å•¦ï¼Œä¸»é¡µé¢è¯¥å¦‚ä½•é…ç½®å­é¡µé¢å‘¢ï¼Ÿ"></a>ğŸ¤”ç„¶åï¼Œå°±è¦åŠ¨è„‘å­å•¦ï¼Œä¸»é¡µé¢è¯¥å¦‚ä½•é…ç½®å­é¡µé¢å‘¢ï¼Ÿ</h3><p>å’±ä»¬é¦–å…ˆçœ‹çœ‹å­é¡µé¢éœ€è¦ä»€ä¹ˆåŠŸèƒ½å’¯ï¼Œè®°å¾—ä¹‹å‰è¯´è¿‡å’Œ<code>router</code>å¾ˆç›¸ä¼¼å—ï¼Œé‚£å°±çœ‹çœ‹<code>router</code>æœ‰ä»€ä¹ˆåŠŸèƒ½å’¯ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Route</span> exact path=<span class="hljs-string">&quot;/&quot;</span> component=&#123;<span class="hljs-title class_">Home</span>&#125; /&gt;  <br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ‰: <code>path</code>ï¼Œ å’Œ <code>component</code>ä¸¤ä¸ª<code>prop</code>ï¼Œ</p><p>é‚£åœ¨ç°åœ¨çš„è¯ï¼Œå°±ç›¸å½“äº<code>path</code>å’Œ<code>å­é¡µé¢æœåŠ¡å™¨è·¯å¾„å’¯</code></p><blockquote><p>å…¶å®å«<code>path</code>æœ‰å¤±åé¢‡ï¼Œå®ƒå…¶å®æ˜¯ä¸€ä¸ªåŒ¹é…è§„åˆ™ï¼Œè€Œä¸æ˜¯ç®€å•çš„<code>path</code></p><p>æ‰€ä»¥æˆ‘æ¥ä¸‹æ¥é‡‡ç”¨<code>activateRule</code>ä»£æ›¿<code>path</code></p></blockquote><p><em><strong>è¿™å°±å®Œäº†ï¼Ÿæ€ä¹ˆå¯èƒ½ï¼</strong></em></p><p>æŒ‚è½½é¡µé¢æŒ‚è½½åˆ°å“ªé‡Œè¿˜æ²¡è€ƒè™‘å‘¢ï¼æ‰€ä»¥è¿˜å¾—åŠ ä¸€ä¸ª<code>container</code>å±æ€§å­˜æ”¾æŒ‚è½½ä½ç½®,</p><p>é‚£ç°åœ¨æˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„<code>å­é¡µé¢é…ç½®</code>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AppInfo</span> &#123;<br>    <span class="hljs-attr">entry</span>: <span class="hljs-built_in">string</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>,<br>    <span class="hljs-attr">container</span>: <span class="hljs-built_in">string</span>,<br>    <span class="hljs-attr">activeRule</span>: <span class="hljs-built_in">string</span><br>&#125;<br></code></pre></td></tr></table></figure><p><em><strong>è¿™å°±å®Œäº†ï¼Ÿæ€ä¹ˆå¯èƒ½ï¼</strong></em></p><p>å¼€åŠ¨å°è„‘ç“œæƒ³æƒ³ï¼Œé™¤äº†<code>router</code>æœ¬èº«çš„ç‰¹æ€§ï¼Œ<code>component</code>ä¹Ÿæœ‰è‡ªå·±çš„é—ªå…‰ç‚¹ï¼š<code>ç”Ÿå‘½å‘¨æœŸ</code>ï¼Œé¡µé¢ä¹Ÿæ˜¯éœ€è¦ç”Ÿå‘½å‘¨æœŸçš„ï¼Œè€Œä¸”è¿˜è¦åˆ†ä¸º</p><ul><li><p>ä¸»ä½“ç”Ÿå‘½å‘¨æœŸï¼šç»„ä»¶æŒ‚è½½å‰ã€æŒ‚è½½å®Œæ¯•ã€å¸è½½</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /types/type.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">MainLifeCycle</span> = &#123;<br>    beforeLoad?: <span class="hljs-title class_">LifeCycleFunc</span> | <span class="hljs-title class_">LifeCycleFunc</span>[],<br>    mounted?: <span class="hljs-title class_">LifeCycleFunc</span> | <span class="hljs-title class_">LifeCycleFunc</span>[],<br>    unmounted?: <span class="hljs-title class_">LifeCycleFunc</span> | <span class="hljs-title class_">LifeCycleFunc</span>[]<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">LifeCycleFunc</span> = <span class="hljs-function">(<span class="hljs-params">app: AppInfo</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>å•ç‹¬é¡µé¢å£°æ˜å‘¨æœŸï¼šè¿™ä¸ªå°±å¤šäº†ï¼Œæƒ³è¦å‡ ä¸ªè¦å‡ ä¸ªï¼Œè¿™é‡Œå›¾æ–¹ä¾¿ï¼Œå†™äº†ä¸‰ä¸ªï¼Œè·Ÿå­é¡µé¢å…¶ä»–å±æ€§æ··ä¸€èµ·å¾—äº†</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /types/type.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChildAppInfo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppInfo</span> &#123;<br>    <span class="hljs-attr">status</span>: <span class="hljs-title class_">AppStatus</span>,<br>    bootstrap?: <span class="hljs-title class_">LifeCycleFunc</span>, <span class="hljs-comment">//æ„å»ºä¸­</span><br>    mount?: <span class="hljs-title class_">LifeCycleFunc</span>, <span class="hljs-comment">// æŒ‚è½½å®Œæ¯•</span><br>    unmount?: <span class="hljs-title class_">LifeCycleFunc</span>, <span class="hljs-comment">// å¸è½½</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™ä¸ª<code>status</code>å°±æ˜¯ç»„ä»¶çš„è¯¦ç»†çŠ¶æ€å’¯ï¼Œåˆå§‹å€¼ä¸º<code>AppStatus.NOT_LOADED</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /types/enum.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">AppStatus</span> &#123;<br>    <span class="hljs-variable constant_">NOT_LOADED</span> = <span class="hljs-string">&quot;NOT_LOADED&quot;</span>,<br>    <span class="hljs-variable constant_">LOADING</span> = <span class="hljs-string">&quot;LOADING&quot;</span>,<br>    <span class="hljs-variable constant_">LOADED</span> = <span class="hljs-string">&quot;LOADED&quot;</span>,<br>    <span class="hljs-variable constant_">BOOTSTRAPPING</span> = <span class="hljs-string">&quot;BOOTSTRAPPING&quot;</span>,<br>    <span class="hljs-variable constant_">NOT_MOUNTED</span> = <span class="hljs-string">&quot;NOT_MOUNTED&quot;</span>, <span class="hljs-comment">// bootstarpè¿‡åè¿˜æœªmount</span><br>    <span class="hljs-variable constant_">MOUNTING</span> = <span class="hljs-string">&quot;MOUNTING&quot;</span>,<br>    <span class="hljs-variable constant_">MOUNTED</span> = <span class="hljs-string">&quot;MOUNTED&quot;</span>,<br>    <span class="hljs-variable constant_">UNMOUNTING</span> = <span class="hljs-string">&quot;UNMOUNTING&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>æ¯æ¬¡æŒ‚è½½ã€å¸è½½é¡µé¢çš„æ—¶å€™ï¼Œéƒ½è¦åˆ†åˆ«è°ƒç”¨å­é¡µé¢å’Œä¸»ä½“çš„çš„å£°æ˜å‘¨æœŸå‡½æ•°</strong></p><p>ä¸ºæ­¤ï¼Œå°è£…äº†å‡ ä¸ªç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œå‡½æ•°ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /lifeCycle/index.ts</span><br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">ChildAppInfo</span>, <span class="hljs-title class_">MainLifeCycle</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../types/type.ts&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">AppStatus</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../types/enum.ts&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;loadHTML&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../loader&quot;</span>;<br><br><span class="hljs-keyword">let</span> <span class="hljs-attr">lifeCycle</span>: <span class="hljs-title class_">MainLifeCycle</span> = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">setLifeCycle</span> = (<span class="hljs-params">list: MainLifeCycle</span>) =&gt; &#123;<br>    lifeCycle = list;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">runBeforeLoad</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">app: ChildAppInfo</span>) =&gt; &#123;<br>    app.<span class="hljs-property">status</span> = <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">LOADING</span>;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">runLifeCycle</span>(<span class="hljs-string">&quot;beforeLoad&quot;</span>, app);<br><br>    app = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadHTML</span>(app); <span class="hljs-comment">// åŠ è½½HTMLæ–‡ä»¶çš„ï¼Œé©¬ä¸Šè®²</span><br>    app.<span class="hljs-property">status</span> = <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">LOADED</span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">runBoostrap</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">app: ChildAppInfo</span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (app.<span class="hljs-property">status</span> !== <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">LOADED</span>) &#123;<br>        <span class="hljs-keyword">return</span> app;<br>    &#125;<br>    app.<span class="hljs-property">status</span> = <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">BOOTSTRAPPING</span>;<br>    <span class="hljs-keyword">await</span> app.<span class="hljs-property">bootstrap</span>?.(app);<br>    app.<span class="hljs-property">status</span> = <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">NOT_MOUNTED</span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">runMounted</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">app: ChildAppInfo</span>) =&gt; &#123;<br>    app.<span class="hljs-property">status</span> = <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">MOUNTING</span>;<br>    <span class="hljs-keyword">await</span> app.<span class="hljs-property">mount</span>?.(app);<br>    app.<span class="hljs-property">status</span> = <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">MOUNTED</span>;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">runLifeCycle</span>(<span class="hljs-string">&quot;mounted&quot;</span>, app);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">runUnmounted</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">app: ChildAppInfo</span>) =&gt; &#123;<br>    app.<span class="hljs-property">status</span> = <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">UNMOUNTING</span>;<br>    <span class="hljs-keyword">await</span> app.<span class="hljs-property">unmount</span>?.(app);<br>    app.<span class="hljs-property">status</span> = <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">NOT_MOUNTED</span>;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">runLifeCycle</span>(<span class="hljs-string">&quot;unmounted&quot;</span>, app);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">runLifeCycle</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">name: keyof MainLifeCycle, app: ChildAppInfo</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> fn = lifeCycle[name];<br>    <span class="hljs-keyword">if</span> (fn <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>) &#123;<br>        <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(fn.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-title function_">item</span>(app)));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">await</span> fn?.(app);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>çœ‹ä¼¼å¾ˆé•¿ï¼Œå…¶å®å°±æ˜¯æ”¹å˜<code>å­é¡µé¢</code>çš„çŠ¶æ€ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„å›è°ƒå‡½æ•°ï¼Œå†è°ƒç”¨<code>ä¸»ä½“å£°æ˜å‘¨æœŸ</code></p><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p><code>beforeLoad</code>è¿™ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯åœ¨é¡µé¢æŒ‚è½½ä¹‹å‰æ‰§è¡Œçš„ï¼Œæ‰€ä»¥<code>beforeLoad</code>æ‰§è¡Œæ¯”é¡µé¢æœ¬èº«ç”Ÿå‘½å‘¨æœŸè¿˜è¦å‰è¾¹ï¼Œ<strong>æ³¨æ„æ‰§è¡Œé¡ºåº</strong></p></blockquote><h3 id="ç›¸ä¿¡å¤§å®¶ä¹Ÿæ³¨æ„åˆ°é‚£ä¸ªloadHTMLäº†ï¼Œé‚£å°±å…ˆæ¥è®²è®²æ€ä¹ˆloadHTMLå§ğŸ˜"><a href="#ç›¸ä¿¡å¤§å®¶ä¹Ÿæ³¨æ„åˆ°é‚£ä¸ªloadHTMLäº†ï¼Œé‚£å°±å…ˆæ¥è®²è®²æ€ä¹ˆloadHTMLå§ğŸ˜" class="headerlink" title="ç›¸ä¿¡å¤§å®¶ä¹Ÿæ³¨æ„åˆ°é‚£ä¸ªloadHTMLäº†ï¼Œé‚£å°±å…ˆæ¥è®²è®²æ€ä¹ˆloadHTMLå§ğŸ˜"></a>ç›¸ä¿¡å¤§å®¶ä¹Ÿæ³¨æ„åˆ°é‚£ä¸ª<code>loadHTML</code>äº†ï¼Œé‚£å°±å…ˆæ¥è®²è®²æ€ä¹ˆ<code>loadHTML</code>å§ğŸ˜</h3><p>å…¶å®ç›¸å½“ç®€å•ï¼Œç›´æ¥å‘æœåŠ¡å™¨å‘ä¸ª<code>fetch</code>å°±è¡Œäº†ï¼Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /loader/index.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadHTML</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">app: ChildAppInfo</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; container, entry &#125; = app<br>    <span class="hljs-keyword">const</span> htmlFile = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchResource</span>(entry)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(htmlFile)<br>    <span class="hljs-keyword">return</span> app<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /utils/fetchHTMlL.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchResource</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url: <span class="hljs-built_in">string</span></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (res) =&gt; <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">text</span>())<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™å°±ç®€å•å®Œæˆäº†ä¸€ä¸ªfetchæ‹¿å›HTMLæ–‡ä»¶çš„åŠŸèƒ½å’¯ï¼Œ</p><p>é‚£è¿™ä¸ªå‡½æ•°å…ˆæ”¾åœ¨è¿™é‡Œå¥½äº†ï¼Œä¹‹åå†ç»™å®ƒä¸°å¯ŒåŠŸèƒ½ï¼Œæ¯”å¦‚è§£ææ‰§è¡Œjsä»€ä¹ˆçš„</p><p><em><strong>åˆ«å¿˜äº†è§£å†³è·¨åŸŸï¼ï¼ï¼</strong></em></p><h3 id="å†™å®Œè¿™ä¹ˆå¤šå‡½æ•°ï¼Œæ€»å¾—è°ƒç”¨ä¸€ä¸‹å§ï¼Œä½†æ˜¯å…ˆåˆ«æ€¥ï¼Œå…ˆæŠŠé¡µé¢å•¥çš„æŒ‚ä¸Šå»ğŸ¤¨"><a href="#å†™å®Œè¿™ä¹ˆå¤šå‡½æ•°ï¼Œæ€»å¾—è°ƒç”¨ä¸€ä¸‹å§ï¼Œä½†æ˜¯å…ˆåˆ«æ€¥ï¼Œå…ˆæŠŠé¡µé¢å•¥çš„æŒ‚ä¸Šå»ğŸ¤¨" class="headerlink" title="å†™å®Œè¿™ä¹ˆå¤šå‡½æ•°ï¼Œæ€»å¾—è°ƒç”¨ä¸€ä¸‹å§ï¼Œä½†æ˜¯å…ˆåˆ«æ€¥ï¼Œå…ˆæŠŠé¡µé¢å•¥çš„æŒ‚ä¸Šå»ğŸ¤¨"></a>å†™å®Œè¿™ä¹ˆå¤šå‡½æ•°ï¼Œæ€»å¾—è°ƒç”¨ä¸€ä¸‹å§ï¼Œä½†æ˜¯å…ˆåˆ«æ€¥ï¼Œå…ˆæŠŠé¡µé¢å•¥çš„æŒ‚ä¸Šå»ğŸ¤¨</h3><p>ç®€ç®€å•å•å†™ä¸€ä¸ª<code>appList</code>ï¼ŒæŠŠå­é¡µé¢çš„é…ç½®ä¿¡æ¯éƒ½å†™é‡Œè¾¹ï¼Œåˆ°æ—¶å€™<code>forEach</code>å°±å¥½å’¯,æ³¨æ„è¦è®¾ç½®<code>status</code>é»˜è®¤å€¼!</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /appList/index.ts</span><br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">AppInfo</span>, <span class="hljs-title class_">ChildAppInfo</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../types/type.ts&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">AppStatus</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../types/enum.ts&quot;</span>;<br><br><span class="hljs-keyword">let</span> <span class="hljs-attr">appList</span>: <span class="hljs-title class_">AppInfo</span>[] = [];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">setAppList</span> = (<span class="hljs-params">list: AppInfo[]</span>) =&gt; &#123;<br>    appList = list;<br>    appList.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> &#123;<br>        (app <span class="hljs-keyword">as</span> <span class="hljs-title class_">ChildAppInfo</span>).<span class="hljs-property">status</span> = <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">NOT_LOADED</span><br>    &#125;)<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getAppList</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> appList;<br>&#125;;<br></code></pre></td></tr></table></figure><p>ç„¶åå†å†™ä¸€ä¸ªæ³¨å†Œé¡µé¢çš„å‡½æ•°ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /start.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">registerMicroApps</span> = (<span class="hljs-params">appList: AppInfo[], mainLifeCycle?: MainLifeCycle</span>) =&gt; &#123;<br>    <span class="hljs-title function_">setAppList</span>(appList)<br>    mainLifeCycle &amp;&amp; <span class="hljs-title function_">setLifeCycle</span>(mainLifeCycle)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°è·Ÿå¤§å®¶æƒ³è±¡çš„ä¸å¤ªä¸€æ ·å–”ï¼Œä»–è¦åœ¨ä¸»é¡µé¢é‡Œè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯å’±ä»¬çš„<code>react</code>æ–‡ä»¶ä¸­</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// /main.tsx</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom/client&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.tsx&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./index.css&#x27;</span><br><span class="hljs-keyword">import</span> &#123;registerMicroApps, start&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./start.ts&quot;</span>;<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)!).<span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.StrictMode</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">React.StrictMode</span>&gt;</span></span>,<br>)<br><br><span class="hljs-keyword">const</span> appList = [<br>    &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;todo&#x27;</span>,<br>        <span class="hljs-attr">activeRule</span>: <span class="hljs-string">&#x27;/todo&#x27;</span>,<br>        <span class="hljs-attr">container</span>: <span class="hljs-string">&#x27;#micro-container&#x27;</span>,<br>        <span class="hljs-attr">entry</span>: <span class="hljs-string">&#x27;http://localhost:10086&#x27;</span>,<br>    &#125;,<br>]<br><br><span class="hljs-title function_">registerMicroApps</span>(appList)<br></code></pre></td></tr></table></figure><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå’±ä»¬å·²ç»é…ç½®å¥½å’±ä»¬çš„å­é¡µé¢å•¦ï¼Œç°åœ¨è·‘è·‘çœ‹å’¯ï¼å½“ç„¶ä»€ä¹ˆéƒ½æ²¡æœ‰å•¦ï¼é¡µé¢è¿˜æ²¡æŒ‚ä¸Šå‘¢ï¼Œå£°æ˜å‘¨æœŸä¹Ÿæ²¡åŠ ï¼Œæ–‡ä»¶ä¹Ÿæ²¡è·å–ï¼Œè¿˜æœ‰å¥½é•¿çš„è·¯è¦èµ°ğŸ˜£</p><h3 id="è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨appListä¸­æŒ‘å‡ºè¦æ¸²æŸ“çš„é¡µé¢å˜ï¼ŸğŸ¥²"><a href="#è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨appListä¸­æŒ‘å‡ºè¦æ¸²æŸ“çš„é¡µé¢å˜ï¼ŸğŸ¥²" class="headerlink" title="è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨appListä¸­æŒ‘å‡ºè¦æ¸²æŸ“çš„é¡µé¢å˜ï¼ŸğŸ¥²"></a>è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨appListä¸­æŒ‘å‡ºè¦æ¸²æŸ“çš„é¡µé¢å˜ï¼ŸğŸ¥²</h3><p>æ‹æ‹æ€è·¯ï¼š</p><p>å’±ä»¬çš„å­é¡µé¢é…ç½®é‡Œä¸æ˜¯æœ‰<code>actiavteRule</code>è¿™ä¸€é¡¹å—ï¼Œå°±ç”¨å®ƒ!</p><p>æŠŠ<code>appList</code>éå†ä¸€éï¼Œå¦‚æœ<code>activateRule</code>åŒ¹é…å½“å‰è·¯å¾„çš„è¯ï¼Œè¦åšç‚¹ä»€ä¹ˆï¼›å¦‚æœä¸åŒ¹é…çš„è¯ï¼Œå¯èƒ½ä¹Ÿè¦åšç‚¹ä»€ä¹ˆï¼ˆåºŸè¯ï¼‰</p><blockquote><p>ä»”ç»†æƒ³æƒ³å’¯ï¼Œå½“åˆ‡æ¢é¡µé¢çš„æ—¶å€™ï¼Œæ¯”å¦‚è¯´ä»<code>/</code>åˆ‡æ¢åˆ°<code>/todo</code>ï¼Œæ˜¯ä¸æ˜¯è¦æŠŠåŸæ¥çš„é¡µé¢å…ˆ<code>unmount</code>ï¼Œå†å»<code>mount</code>æ–°é¡µé¢ï¼›é‚£å¦‚ä½•åˆ¤æ–­å“ªä¸ªé¡µé¢æ˜¯å½“å‰é¡µé¢å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œå¦‚ä½•åŒ¹é…å½“å‰é¡µé¢å‘¢ï¼Ÿ</p><p>æ¬¸ï¼Œ<code>react-router-dom</code>ä½¿ç”¨äº†<a href="https://www.npmjs.com/package/path-to-regexp">path-to-regexp</a>è¿™ä¸ªåº“ï¼Œçœ‹äº†ä¸‹ï¼Œç›¸å½“å¥½ç”¨,æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨åªéœ€è¦çŸ¥é“å®ƒçš„ä¸€ä¸ªè°ƒç”¨å°±è¡Œäº†ï¼š</p><p><img src="https://s2.loli.net/2024/03/03/78UYVOkJB6XxmHp.png" alt="åˆ«äººåšå®¢å·çš„å›¾"></p><p>å†åŠ ä¸Š<code>location.href</code>ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“èƒ½å†™å‡º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> isActive = <span class="hljs-title function_">match</span>(app.<span class="hljs-property">activeRule</span>, &#123; <span class="hljs-attr">end</span>: <span class="hljs-literal">false</span> &#125;)(location.<span class="hljs-property">pathname</span>)<br></code></pre></td></tr></table></figure><p>åˆ¤æ–­æ˜¯å¦<code>active</code>ï¼Œå†æ ¹æ®é¡µé¢å½“å‰çŠ¶æ€ï¼Œåˆ¤æ–­è¦åšä»€ä¹ˆæ“ä½œï¼Œæ˜¯æŒ‚è½½è¿˜æ˜¯å¸è½½</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /utils/getAppStatus.ts</span><br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">ChildAppInfo</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../types/type.ts&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;getAppList&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../appList&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">AppStatus</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../types/enum.ts&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;match&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;path-to-regexp&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getAppListStatus</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-attr">actives</span>: <span class="hljs-title class_">ChildAppInfo</span>[] = []<br>    <span class="hljs-keyword">const</span> <span class="hljs-attr">unmounts</span>: <span class="hljs-title class_">ChildAppInfo</span>[] = []<br>    <span class="hljs-keyword">const</span> list = <span class="hljs-title function_">getAppList</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">ChildAppInfo</span>[]<br>    list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> isActive = <span class="hljs-title function_">match</span>(app.<span class="hljs-property">activeRule</span>, &#123; <span class="hljs-attr">end</span>: <span class="hljs-literal">false</span> &#125;)(location.<span class="hljs-property">pathname</span>)<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isActive, app)<br>        <span class="hljs-keyword">switch</span> (app.<span class="hljs-property">status</span>) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">NOT_LOADED</span>:<br>            <span class="hljs-keyword">case</span> <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">LOADING</span>:<br>            <span class="hljs-keyword">case</span> <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">LOADED</span>:<br>            <span class="hljs-keyword">case</span> <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">BOOTSTRAPPING</span>:<br>            <span class="hljs-keyword">case</span> <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">NOT_MOUNTED</span>:<br>                isActive &amp;&amp; actives.<span class="hljs-title function_">push</span>(app)<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">case</span> <span class="hljs-title class_">AppStatus</span>.<span class="hljs-property">MOUNTED</span>:<br>                !isActive &amp;&amp; unmounts.<span class="hljs-title function_">push</span>(app)<br>                <span class="hljs-keyword">break</span><br>        &#125;<br>    &#125;)<br><br>    <span class="hljs-keyword">return</span> &#123; actives, unmounts &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªå·¥å…·å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†<code>actives</code> å’Œ<code>unmounts</code>è¿™ä¿©æ•°ç»„ï¼Œä¹‹åå¯¹<code>unmounts</code>æ•°ç»„ä»¥æ­¤<code>unmount</code>ï¼Œå¯¹<code>actives</code>ä¾æ¬¡æ‰§è¡Œä¸€å¥—å£°æ˜å‘¨æœŸå°±å®Œäº‹å’¯ï¼Œç”¨ä¼ªä»£ç å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼Œåˆ°æ—¶å€™æŠŠè¿™ä¸ªå°è£…è¿›å‡½æ•°å°±è¡Œå’¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> &#123; actives, unmounts &#125; = <span class="hljs-title function_">getAppListStatus</span>()<br>        <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(<br>            unmounts<br>                .<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">app</span>: <span class="hljs-title class_">ChildAppInfo</span>) =&gt; &#123;<br>                    <span class="hljs-keyword">await</span> <span class="hljs-title function_">runUnmounted</span>(app)<br>                &#125;)<br>                .<span class="hljs-title function_">concat</span>(<br>                    actives.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">app</span>: <span class="hljs-title class_">ChildAppInfo</span>) =&gt; &#123;<br>                        <span class="hljs-keyword">await</span> <span class="hljs-title function_">runBeforeLoad</span>(app)<br>                        <span class="hljs-keyword">await</span> <span class="hljs-title function_">runBoostrap</span>(app)<br>                        <span class="hljs-keyword">await</span> <span class="hljs-title function_">runMounted</span>(app)<br>                    &#125;)<br>                )<br>        ).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-comment">// ...è¦åšçš„æ“ä½œ</span><br>        &#125;)<br></code></pre></td></tr></table></figure><h3 id="åˆ«çœ‹ç°åœ¨å½¢å¼ä¸€ç‰‡å¤§å¥½ï¼Œå…¶å®çœŸæ­£çš„éš¾ç‚¹è¿˜è—ç€å‘¢ğŸ™„è·¯ç”±åŠ«æŒæ¥å’¯"><a href="#åˆ«çœ‹ç°åœ¨å½¢å¼ä¸€ç‰‡å¤§å¥½ï¼Œå…¶å®çœŸæ­£çš„éš¾ç‚¹è¿˜è—ç€å‘¢ğŸ™„è·¯ç”±åŠ«æŒæ¥å’¯" class="headerlink" title="åˆ«çœ‹ç°åœ¨å½¢å¼ä¸€ç‰‡å¤§å¥½ï¼Œå…¶å®çœŸæ­£çš„éš¾ç‚¹è¿˜è—ç€å‘¢ğŸ™„è·¯ç”±åŠ«æŒæ¥å’¯"></a>åˆ«çœ‹ç°åœ¨å½¢å¼ä¸€ç‰‡å¤§å¥½ï¼Œå…¶å®çœŸæ­£çš„éš¾ç‚¹è¿˜è—ç€å‘¢ğŸ™„è·¯ç”±åŠ«æŒæ¥å’¯</h3><p>å…¶å®è¿™ä¸ªéš¾ç‚¹å°±æ˜¯æœ€åŸºç¡€çš„â€“<strong>å¦‚ä½•æ ¹æ®urlåŠ è½½å’Œåˆ‡æ¢é¡µé¢ï¼Ÿ</strong></p><p>å˜¿å˜¿ï¼Œè¿™å°±æ˜¯å¦ä¸€ä¸ªçŸ¥è¯†ç‚¹å’¯</p><blockquote><p>æƒ³æƒ³<code>React-Router-Dom</code>ä¸­æ˜¯ä¸æ˜¯æœ‰<code>BrowserRouter</code>å’Œ<code>HashRouter</code>ï¼Œå…¶å®ä»–ä¿©å°±å¯¹åº”ç€ JS ä¸­ çš„<code>HashRouter</code>å’Œ<code>History</code>ï¼ŒäºŒè€…æœ‰äº›è®¸å·®åˆ«ã€‚è€webé€šå¸¸æ˜¯<code>HashRouter</code>ï¼Œæ–°webåŸºæœ¬éƒ½æ˜¯<code>History</code>ã€‚äºŒè€…apiä¹Ÿæœ‰å·®å¼‚ï¼Œæˆ‘å°±ä¸è‡ªå·±å†™äº†ï¼Œä»¥ä¸‹å†…å®¹æ‘˜è‡ªï¼š<a href="https://juejin.cn/post/7044530785746944014">https://juejin.cn/post/7044530785746944014</a></p></blockquote><h3 id="reactRouterå®ç°è·¯ç”±çš„ä¸¤ç§æ¨¡å¼"><a href="#reactRouterå®ç°è·¯ç”±çš„ä¸¤ç§æ¨¡å¼" class="headerlink" title="reactRouterå®ç°è·¯ç”±çš„ä¸¤ç§æ¨¡å¼"></a>reactRouterå®ç°è·¯ç”±çš„ä¸¤ç§æ¨¡å¼</h3><ul><li><p>hashæ¨¡å¼(å¯¹åº”HashRouter)</p><p><code>www.test.com/#/name</code> å°±æ˜¯ <code>Hash URL</code>ï¼Œå½“ <code>#</code> åé¢çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸ä¼šå‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ <code>hashchange</code> äº‹ä»¶æ¥ç›‘å¬åˆ° <code>URL</code> çš„å˜åŒ–ï¼Œä»è€Œè¿›è¡Œè·³è½¬é¡µé¢ã€‚</p></li><li><p>browseræ¨¡å¼(å¯¹åº”BrowserRouter)</p><p><code>History</code>æ¨¡å¼ä½¿ç”¨ HTML5 æä¾›çš„ history APIï¼ˆpushStateã€replaceState å’Œ popstate äº‹ä»¶ï¼‰æ¥ä¿æŒ UI å’Œ URL çš„åŒæ­¥</p></li></ul><h3 id="ä¸¤ç§å®ç°æ–¹å¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸¤ç§å®ç°æ–¹å¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸¤ç§å®ç°æ–¹å¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸¤ç§å®ç°æ–¹å¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><p>å…¼å®¹æ€§é—®é¢˜</p><p>ä¸€çœ‹åˆ°browseræ¨¡å¼æ˜¯html5æ–°æ¨å‡ºçš„åŠŸèƒ½ï¼Œå°±å¯ä»¥çŸ¥é“åŒºåˆ«ä¸»è¦æ˜¯<code>å…¼å®¹æ€§</code>é—®é¢˜ï¼Œbrowseræ¨¡å¼ä¸»è¦æ˜¯åœ¨é«˜ç‰ˆæœ¬æµè§ˆå™¨ä½¿ç”¨çš„ï¼Œhashæ¨¡å¼ä¸»è¦æ˜¯åœ¨è€ç‰ˆæœ¬æµè§ˆå™¨ä½¿ç”¨çš„ï¼Œ</p></li><li><p>å†™æ³•çš„ä¸åŒ</p><p>BrowserRouter åˆ›å»ºçš„ URL æ ¼å¼ï¼š<a href="https://link.juejin.cn/?target=http://xxx.com/path">xxx.com&#x2F;path</a></p><p>HashRouter åˆ›å»ºçš„ URL æ ¼å¼ï¼š<a href="https://link.juejin.cn/?target=http://xxx.com/%23/path">xxx.com&#x2F;#&#x2F;path</a></p></li></ul><h3 id="historyä¸­æ–°å¢çš„æ–¹æ³•"><a href="#historyä¸­æ–°å¢çš„æ–¹æ³•" class="headerlink" title="historyä¸­æ–°å¢çš„æ–¹æ³•"></a>historyä¸­æ–°å¢çš„æ–¹æ³•</h3><h4 id="pushState-state-title-url"><a href="#pushState-state-title-url" class="headerlink" title="pushState(state,title,url)"></a>pushState(state,title,url)</h4><p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯ åœ¨å†å²è®°å½•ä¸­æ–°å¢ä¸€æ¡è®°å½•ï¼Œæ”¹å˜æµè§ˆå™¨åœ°å€æ çš„url,<strong>ä½†æ˜¯ï¼Œä¸åˆ·æ–°é¡µé¢</strong>ã€‚</p><p>pushStateå¯¹è±¡æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œ</p><ul><li>stateï¼šä¸€ä¸ªä¸æ·»åŠ çš„è®°å½•ç›¸å…³è”çš„çŠ¶æ€å¯¹è±¡ï¼Œä¸»è¦ç”¨äºpopstateäº‹ä»¶ã€‚è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œè¯¥å¯¹è±¡ä¼šä¼ å…¥å›è°ƒ<a href="https://link.juejin.cn/?target=http://www.fly63.com/tag/%E5%87%BD%E6%95%B0">å‡½æ•°</a>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæµè§ˆå™¨ä¼šå°†è¿™ä¸ªå¯¹è±¡åºåˆ—åŒ–ä»¥åä¿ç•™åœ¨æœ¬åœ°ï¼Œé‡æ–°è½½å…¥è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡ã€‚å¦‚æœä¸éœ€è¦è¿™ä¸ªå¯¹è±¡ï¼Œæ­¤å¤„å¯ä»¥å¡«nullã€‚</li><li>titleï¼šæ–°é¡µé¢çš„æ ‡é¢˜ã€‚ä½†æ˜¯ï¼Œç°åœ¨æ‰€æœ‰æµè§ˆå™¨éƒ½å¿½è§†è¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å¡«ç©ºå­—ç¬¦ä¸²ã€‚</li><li>urlï¼šæ–°çš„ç½‘å€ï¼Œå¿…é¡»ä¸å½“å‰é¡µé¢å¤„åœ¨åŒä¸€ä¸ªåŸŸã€‚æµè§ˆå™¨çš„åœ°å€æ å°†æ˜¾ç¤ºè¿™ä¸ªç½‘å€ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å½“å‰ç½‘å€æ˜¯hello.com&#x2F;1.html,ä½¿ç”¨pushState()æ–¹æ³•åœ¨æµè§ˆè®°å½•ä¸­æ·»åŠ ä¸€ä¸ªæ–°çºªå½•</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp">csharpå¤åˆ¶ä»£ç <span class="hljs-keyword">var</span> stateObj=&#123;foo:<span class="hljs-string">&#x27;bar&#x27;</span>&#125;<br>history.pushState(starteObj,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;2.html&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ·»åŠ æ–°çºªå½•åï¼Œæµè§ˆå™¨çš„åœ°å€æ ç«‹åˆ»æ˜¾ç¤º&#96;hello.com&#x2F;2.html,ä½†ä¸ä¼šè·³è½¬åˆ°2.html,ä¹Ÿä¸ä¼šæ£€æŸ¥2.htmlæ˜¯å¦å­˜åœ¨ï¼Œå®ƒåªæ˜¯æˆä¸ºæµè§ˆå†å²ä¸­çš„æœ€æ–°è®°å½•ã€‚</p><p>æ€»ä¹‹ï¼ŒpushState()æ–¹æ³•ä¸ä¼šè§¦å‘é¡µé¢åˆ·æ–°ï¼Œåªæ˜¯å¯¼è‡´historyå¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼Œåœ°å€æ ä¼šæœ‰ååº”ï¼Œä½¿ç”¨è¯¥æ–¹æ³•åï¼Œå°±å¯ä»¥ä½¿ç”¨history.stateå±æ€§è¯»å‡ºçŠ¶æ€å¯¹è±¡</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp">csharpå¤åˆ¶ä»£ç <span class="hljs-keyword">var</span> stateObj=&#123;foo:<span class="hljs-string">&#x27;bar&#x27;</span>&#125;<br>history.pushState(starteObj,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;2.html&#x27;</span>)<br>history.state <span class="hljs-comment">//=&gt; &#123;foo:&quot;bar&quot;&#125;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¦‚æœpushStateçš„URLå‚æ•°è®¾ç½®äº†ä¸€ä¸ªæ–°çš„hashå€¼ï¼Œå¹¶ä¸ä¼šè§¦å‘hashchangeäº‹ä»¶ã€‚</p><h4 id="replaceState-state-title-url"><a href="#replaceState-state-title-url" class="headerlink" title="replaceState(state,title,url)"></a>replaceState(state,title,url)</h4><p>replaceStateæ–¹æ³•çš„ä½œç”¨æ˜¯æ›¿æ¢å½“å‰çš„å†å²è®°å½•ï¼Œå…¶ä»–çš„éƒ½ä¸pushState()æ–¹æ³•ä¸€æ¨¡ä¸€æ ·ã€‚</p><p>å‡å®šå½“å‰ç½‘é¡µæ˜¯example.com&#x2F;example.htmlã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs ruby">rubyå¤åˆ¶ä»£ç history.pushState(&#123;<span class="hljs-symbol">page:</span> <span class="hljs-number">1</span>&#125;, <span class="hljs-string">&#x27;title 1&#x27;</span>, <span class="hljs-string">&#x27;?page=1&#x27;</span>)<br>/<span class="hljs-regexp">/ URL æ˜¾ç¤ºä¸º http:/</span><span class="hljs-regexp">/example.com/example</span>.html?page=<span class="hljs-number">1</span><br><br>history.pushState(&#123;<span class="hljs-symbol">page:</span> <span class="hljs-number">2</span>&#125;, <span class="hljs-string">&#x27;title 2&#x27;</span>, <span class="hljs-string">&#x27;?page=2&#x27;</span>);<br><span class="hljs-regexp">//</span> <span class="hljs-variable constant_">URL</span> æ˜¾ç¤ºä¸º <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/example.com/example</span>.html?page=<span class="hljs-number">2</span><br><br>history.replaceState(&#123;<span class="hljs-symbol">page:</span> <span class="hljs-number">3</span>&#125;, <span class="hljs-string">&#x27;title 3&#x27;</span>, <span class="hljs-string">&#x27;?page=3&#x27;</span>);<br><span class="hljs-regexp">//</span> <span class="hljs-variable constant_">URL</span> æ˜¾ç¤ºä¸º <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/example.com/example</span>.html?page=<span class="hljs-number">3</span><br><br>history.back()<br>/<span class="hljs-regexp">/ URL æ˜¾ç¤ºä¸º http:/</span><span class="hljs-regexp">/example.com/example</span>.html?page=<span class="hljs-number">1</span><br><br>history.back()<br>/<span class="hljs-regexp">/ URL æ˜¾ç¤ºä¸º http:/</span><span class="hljs-regexp">/example.com/example</span>.html<br><br>history.go(<span class="hljs-number">2</span>)<br>/<span class="hljs-regexp">/ URL æ˜¾ç¤ºä¸º http:/</span><span class="hljs-regexp">/example.com/example</span>.html?page=<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h4 id="popstateäº‹ä»¶"><a href="#popstateäº‹ä»¶" class="headerlink" title="popstateäº‹ä»¶"></a>popstateäº‹ä»¶</h4><blockquote><p>popstateäº‹ä»¶æ˜¯windowå¯¹è±¡ä¸Šçš„äº‹ä»¶ï¼Œé…åˆpushState()å’ŒreplaceState()æ–¹æ³•ä½¿ç”¨ã€‚å½“åŒä¸€ä¸ªæ–‡æ¡£(å¯ä»¥ç†è§£ä¸ºåŒä¸€ä¸ªç½‘é¡µï¼Œä¸èƒ½è·³è½¬ï¼Œè·³è½¬äº†å°±ä¸æ˜¯åŒä¸€ä¸ªç½‘é¡µäº†)çš„æµè§ˆå†å²å‡ºç°å˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘popstateäº‹ä»¶ã€‚</p></blockquote><p>ä¸Šé¢æˆ‘ä»¬è¯´è¿‡ï¼Œè°ƒç”¨pushState()æˆ–è€…replaceState()æ–¹æ³•éƒ½ä¼šæ”¹å˜å½“å‰çš„å†å²è®°å½•ï¼Œä»…ä»…è°ƒç”¨pushState()æ–¹æ³•æˆ–replaceState()æ–¹æ³• ï¼Œå¹¶ä¸ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œå¦å¤–ä¸€ä¸ªæ¡ä»¶æ˜¯ç”¨æˆ·å¿…é¡»ç‚¹å‡»æµè§ˆå™¨çš„å€’é€€æŒ‰é’®æˆ–è€…å‰è¿›æŒ‰é’®ï¼Œæˆ–è€…ä½¿ç”¨<a href="https://link.juejin.cn/?target=https://www.fly63.com/tag/js">js</a>è°ƒç”¨history.back()æˆ–è€…history.forward()ç­‰æ–¹æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œè®°ä½popstateäº‹ä»¶è§¦å‘çš„æ¡ä»¶</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> å¤„åœ¨åŒä¸€ä¸ªæ–‡æ¡£(åŒä¸€ä¸ªhtmlé¡µé¢)<br><span class="hljs-bullet">2.</span> æ–‡æ¡£çš„æµè§ˆå†å²(å³historyå¯¹è±¡)å‘ç”Ÿæ”¹å˜<br></code></pre></td></tr></table></figure><p>åªè¦ç¬¦åˆè¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œpopstateäº‹ä»¶å°±ä¼šè§¦å‘</p><p>å…·ä½“ä¾‹å­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml">//index.html<br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-variable language_">window</span>.<span class="hljs-property">onpopstate</span>=<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;location &#x27;</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span>+<span class="hljs-string">&#x27;,state &#x27;</span>+jsON.<span class="hljs-title function_">stringify</span>(event.<span class="hljs-property">state</span>))</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--ç¬¬äºŒæ­¥ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;window.history.back()&quot;</span>&gt;</span>åé€€<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;window.history.forward()&quot;</span>&gt;</span>å‰è¿›<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--ç¬¬ä¸€æ­¥ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;window.history.pushState(null,&#x27;&#x27;,&#x27;1.html&#x27;)&quot;</span>&gt;</span>pushState<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…ˆç‚¹å‡»pushStateæŒ‰é’®ï¼Œåœ¨ç‚¹å‡»åé€€æŒ‰é’®ï¼Œå°±ä¼šè§¦å‘popstateäº‹ä»¶</p><p>å†æ¥ä¸€ä¸ªä¾‹å­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml">//index.html<br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-variable language_">window</span>.<span class="hljs-property">onpopstate</span>=<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;location &#x27;</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span>+<span class="hljs-string">&#x27;,state &#x27;</span>+<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(event.<span class="hljs-property">state</span>))</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#one&quot;</span>&gt;</span>#one<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>   <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥ç‚¹å‡»aæ ‡ç­¾,ä¹Ÿå¯ä»¥è§¦å‘popstateäº‹ä»¶</p><blockquote><p>OK,æˆ‘æ¥æ€»ç»“ä¸€ä¸‹ï¼Œè€ç‰ˆ<code>hashRouter</code>åªæ‹¥æœ‰<code>hashChange</code>è¿™ä¸€ä¸ªç›‘å¬ï¼Œè€Œåœ¨<code>history</code>ä¸­ï¼ŒæŠŠè¿™ä¸ªç›‘å¬æ‹†æˆäº†ä¸¤éƒ¨åˆ†ï¼š</p><ul><li><code>(push | replace)State</code>:è´Ÿè´£åˆ‡æ¢è·¯ç”±ï¼Œä½†ä¸é‡æ–°æ¸²æŸ“</li><li><code>popState</code>: è§¦å‘äº‹ä»¶</li></ul><p>æ‰€ä»¥æˆ‘ä»¬è¦å¹²çš„ï¼Œå°±æ˜¯è®©æˆ‘ä»¬<code>pushState</code>çš„æ—¶å€™ï¼Œè§¦å‘<code>popState</code>æˆ–è€…<code>hashChange</code>,è°ƒç”¨æˆ‘ä»¬è‡ªå·±çš„å‡½æ•°: æŠŠå­é¡µé¢æ‹‰è¿‡æ¥ï¼Œä¹Ÿå°±æ˜¯é‡å†™è¿™å‡ ä¸ªå‡½æ•°ï¼Œä»–æœ‰ä¸ªå“äº®çš„åå­—ï¼š <strong>è·¯ç”±åŠ«æŒ</strong></p></blockquote><p>é‚£æ—¢ç„¶è¦é‡å†™listenerï¼Œé‚£è‚¯å®šå°±éƒ½å¾—è‡ªå·±ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—å’¯ï¼Œå¤§æ¦‚å°±é•¿è¿™æ ·ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /route/index.ts</span><br><span class="hljs-keyword">const</span> listenedRouterChange : <span class="hljs-title class_">Record</span>&lt;listenedType, <span class="hljs-title class_">Function</span>[]&gt; = &#123;<br>    <span class="hljs-attr">hashchange</span>: [],<br>    <span class="hljs-attr">popstate</span>:[]<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£æ¯æ¬¡<code>pushState</code>æˆ–è€…<code>replaceState</code>å°±å¾—è§¦å‘<code>popState</code>ï¼Œå°±è¦ç›‘å¬<code>popState</code>å¾€è¿™åŠ ä¸œè¥¿å’¯ï¼Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /route/index.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">Route</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-property">pushState</span> = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> &#123;<br>        originalPush.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>, args)<br>        historyEvent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PopStateEvent</span>(<span class="hljs-string">&#x27;popstate&#x27;</span>)<br>        args[<span class="hljs-number">2</span>] &amp;&amp; <span class="hljs-title function_">reroute</span>(args[<span class="hljs-number">2</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>) <span class="hljs-comment">// args[2]å°±æ˜¯ä¼ å…¥çš„url</span><br>    &#125;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-property">replaceState</span> = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> &#123;<br>        originalReplace.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>, args)<br>        historyEvent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PopStateEvent</span>(<span class="hljs-string">&#x27;popstate&#x27;</span>)<br>        args[<span class="hljs-number">2</span>] &amp;&amp; <span class="hljs-title function_">reroute</span>(args[<span class="hljs-number">2</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)<br>    &#125;<br><br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;hashchange&quot;</span>, handleUrlChange)<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;popstate&quot;</span>, handleUrlChange)<br><br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">addEventListener</span> = <span class="hljs-title class_">EventListener</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">addEventListener</span>)<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">removeEventListener</span> = <span class="hljs-title class_">EventListener</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">removeEventListener</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºè¦é‡æ–°ç›‘å¬<code>hashChange</code>å’Œ<code>popState</code>ï¼Œæˆ‘ä»¬é‡æ–°å®šä¹‰<code>EventListener</code>,è®©è¿™ä¿©äº‹ä»¶è§¦å‘æ—¶ï¼Œå¾€<code>listendRouterChange</code>é‡ŒåŠ ç‚¹æ–™</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /route/index.ts</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">hasListener</span> = (<span class="hljs-params">name: listenedType, fn: <span class="hljs-built_in">Function</span></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> listenedRouterChange[name].<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item === fn).<span class="hljs-property">length</span><br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">EventListener</span> = (<span class="hljs-attr">fn</span>: <span class="hljs-title class_">Function</span>): <span class="hljs-function"><span class="hljs-params">any</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">name: <span class="hljs-built_in">string</span>, func: <span class="hljs-built_in">Function</span></span>) &#123;<br>        <span class="hljs-keyword">if</span>(name === <span class="hljs-string">&quot;popstate&quot;</span> || name === <span class="hljs-string">&quot;hashchange&quot;</span>) &#123;<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-title function_">hasListener</span>(name, func)) &#123;<br>                listenedRouterChange[name <span class="hljs-keyword">as</span> listenedType].<span class="hljs-title function_">push</span>(func)<br>                <span class="hljs-keyword">return</span>;<br>            &#125; <br><br>        &#125;<br>        <span class="hljs-keyword">return</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">window</span>, <span class="hljs-variable language_">arguments</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œ<code>pushState</code>çš„æ—¶å€™è¦æŒ‚è½½é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œç”¨çš„æ˜¯<code>reroute</code>è¿™ä¸ªå‡½æ•°ï¼Œè®°å¾—ä¹‹å‰çš„é¡µé¢æŒ‚è½½å‡½æ•°å—,å®ç°ä¸€ä¸‹å’¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /route/index.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">reroute</span> = (<span class="hljs-params">url: <span class="hljs-built_in">string</span></span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (url !== lastUrl) &#123;<br>        <span class="hljs-keyword">const</span> &#123; actives, unmounts &#125; = <span class="hljs-title function_">getAppListStatus</span>()<br>        <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(<br>            unmounts<br>                .<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">app</span>: <span class="hljs-title class_">ChildAppInfo</span>) =&gt; &#123;<br>                    <span class="hljs-keyword">await</span> <span class="hljs-title function_">runUnmounted</span>(app)<br>                &#125;)<br>                .<span class="hljs-title function_">concat</span>(<br>                    actives.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">app</span>: <span class="hljs-title class_">ChildAppInfo</span>) =&gt; &#123;<br>                        <span class="hljs-keyword">await</span> <span class="hljs-title function_">runBeforeLoad</span>(app)<br>                        <span class="hljs-keyword">await</span> <span class="hljs-title function_">runBoostrap</span>(app)<br>                        <span class="hljs-keyword">await</span> <span class="hljs-title function_">runMounted</span>(app)<br>                    &#125;)<br>                )<br>        ).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-title function_">callCapturedListeners</span>() <span class="hljs-comment">//æŒ‚ä¸Šä¹‹åæ‰§è¡Œå›è°ƒ</span><br>        &#125;)<br>    &#125;<br>    lastUrl = url || location.<span class="hljs-property">href</span><br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callCapturedListeners</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (historyEvent) &#123;<br>        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(listenedRouterChange).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">eventName</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> listeners = listenedRouterChange[eventName <span class="hljs-keyword">as</span> listenedType]<br>            <span class="hljs-keyword">if</span> (listeners.<span class="hljs-property">length</span>) &#123;<br>                listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> &#123;<br>                    listener.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, historyEvent)<br>                &#125;)<br>            &#125;<br>        &#125;)<br>        historyEvent = <span class="hljs-literal">null</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="æœ€åï¼Œæ¥çœ‹çœ‹æ–‡ä»¶åŠ è½½å§ï¼Œå¿«ç»“æŸå’¯ğŸ˜"><a href="#æœ€åï¼Œæ¥çœ‹çœ‹æ–‡ä»¶åŠ è½½å§ï¼Œå¿«ç»“æŸå’¯ğŸ˜" class="headerlink" title="æœ€åï¼Œæ¥çœ‹çœ‹æ–‡ä»¶åŠ è½½å§ï¼Œå¿«ç»“æŸå’¯ğŸ˜"></a>æœ€åï¼Œæ¥çœ‹çœ‹æ–‡ä»¶åŠ è½½å§ï¼Œå¿«ç»“æŸå’¯ğŸ˜</h3><p><strong>é¦–å…ˆçš„é¦–å…ˆï¼Œå°±æ˜¯è·¨åŸŸé—®é¢˜</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// vite.config.ts</span><br><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span><br><span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-react&#x27;</span><br><br><span class="hljs-comment">// https://vitejs.dev/config/</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">react</span>()],<br>  <span class="hljs-attr">server</span>: &#123;<br>    <span class="hljs-attr">proxy</span>: &#123;<br>      <span class="hljs-string">&quot;/api&quot;</span>: &#123;<br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;http://localhost:10086&quot;</span>,<br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">&quot;&quot;</span>),<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;)<br><br></code></pre></td></tr></table></figure><p><strong>ä¹‹ååˆè¦åŠ¨è„‘å’¯ï¼Œèµ„æºæ€ä¹ˆåŠ è½½å˜ï¼Ÿ</strong></p><p>é¦–å…ˆï¼Œå’±ä»¬ä¸Šè¾¹æåˆ°çš„çš„<code>html</code>æ–‡ä»¶ä¸­è‚¯å®šæœ‰å¼•å…¥çš„æ–‡ä»¶éœ€è¦åŠ è½½ï¼Œå¯èƒ½æ˜¯å›¾ç‰‡ï¼Œä¹Ÿå¯èƒ½æ˜¯<code>css</code>ã€ <code>js</code>,è¿™é‡Œå°±è¦åšä¸€ä¸ªåˆ¤æ–­ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// src/loader/parse.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">parseHTML</span> = (<span class="hljs-params">parent: HTMLElement, app: IInternalAppInfo</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> children = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(parent.<span class="hljs-property">children</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>[]<br>  children.<span class="hljs-property">length</span> &amp;&amp; children.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-title function_">parseHTML</span>(item, app))<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> dom <span class="hljs-keyword">of</span> children) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(link)$/i</span>.<span class="hljs-title function_">test</span>(dom.<span class="hljs-property">tagName</span>)) &#123;<br>      <span class="hljs-comment">// å¤„ç† link</span><br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(script)$/i</span>.<span class="hljs-title function_">test</span>(dom.<span class="hljs-property">tagName</span>)) &#123;<br>      <span class="hljs-comment">// å¤„ç† script</span><br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(img)$/i</span>.<span class="hljs-title function_">test</span>(dom.<span class="hljs-property">tagName</span>) &amp;&amp; dom.<span class="hljs-title function_">hasAttribute</span>(<span class="hljs-string">&#x27;src&#x27;</span>)) &#123;<br>      <span class="hljs-comment">// å¤„ç†å›¾ç‰‡ï¼Œæ¯•ç«Ÿå›¾ç‰‡èµ„æºç”¨ç›¸å¯¹è·¯å¾„è‚¯å®šä¹Ÿ 404 äº†</span><br>      dom.<span class="hljs-title function_">setAttribute</span>(<br>        <span class="hljs-string">&#x27;src&#x27;</span>,<br>        <span class="hljs-title function_">getCompletionURL</span>(dom.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;src&#x27;</span>)!, app.<span class="hljs-property">entry</span>)!<br>      )<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> &#123;  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>å¯¹äº<code>link</code>æ–‡ä»¶ï¼Œå®ƒå¯èƒ½æ˜¯å¤–éƒ¨å¼•å…¥ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ¬åœ°å¼•ç”¨</p><ul><li><p>å¯¹äºæœ¬åœ°å¼•ç”¨ï¼šè¦æŠŠç›¸å¯¹è·¯å¾„è½¬ä¸ºç»å¯¹è·¯å¾„</p></li><li><p>å¯¹äºå¤–éƒ¨å¼•å…¥ï¼šä¸å˜</p><p>å°±è¿™æ ·â¬‡ï¸</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">parseLink</span> = (<span class="hljs-params"></span><br><span class="hljs-params">    link: HTMLElement,</span><br><span class="hljs-params">    parent: HTMLElement,</span><br><span class="hljs-params">    app: ChildAppInfo</span><br><span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> rel = link.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;rel&#x27;</span>)<br>    <span class="hljs-keyword">const</span> href = link.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;href&#x27;</span>)<br>    <span class="hljs-keyword">if</span> (rel === <span class="hljs-string">&#x27;stylesheet&#x27;</span> &amp;&amp; href) &#123;<br>        parent.<span class="hljs-title function_">appendChild</span>(link)<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getCompletionURL</span>(href, app.<span class="hljs-property">entry</span>)<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (href) &#123;<br>        link.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;href&#x27;</span>, <span class="hljs-title function_">getCompletionURL</span>(href, app.<span class="hljs-property">entry</span>)!)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /utils/concatUrl.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCompletionURL</span>(<span class="hljs-params">src: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>, baseURI: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (!src) <span class="hljs-keyword">return</span> src<br>    <span class="hljs-comment">// å¦‚æœ URL å·²ç»æ˜¯åè®®å¼€å¤´å°±ç›´æ¥è¿”å›</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(https|http)/</span>.<span class="hljs-title function_">test</span>(src)) <span class="hljs-keyword">return</span> src<br>    <span class="hljs-comment">// é€šè¿‡åŸç”Ÿæ–¹æ³•æ‹¼æ¥ URL</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(src, <span class="hljs-title function_">getCompletionBaseURL</span>(baseURI)).<span class="hljs-title function_">toString</span>()<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCompletionBaseURL</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> url.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;//&#x27;</span>) ? <span class="hljs-string">`<span class="hljs-subst">$&#123;location.protocol&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span> : url<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>å¯¹äº<code>script</code>æ–‡ä»¶ï¼Œä¹Ÿæœ‰ä¸¤ç§æƒ…å†µï¼Œå¤–éƒ¨å¼•å…¥çš„è¯è¿˜è¦é¢å¤–<code>fetch</code>ä¸€æ¬¡ï¼Œè¿™é‡Œç”¨<code>url</code>è¡¨ç¤ºå¤–è”ï¼Œ<code>text</code>å¦‚æœæœ‰é‚£å°±æ˜¯å†…è”</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">parseScript</span> = (<span class="hljs-params"></span><br><span class="hljs-params">    script: HTMLElement,</span><br><span class="hljs-params">    parent: HTMLElement,</span><br><span class="hljs-params">    app: ChildAppInfo</span><br><span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> src = script.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;src&#x27;</span>)<br>    parent.<span class="hljs-title function_">appendChild</span>(script)<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">url</span>: <span class="hljs-title function_">getCompletionURL</span>(src, app.<span class="hljs-property">entry</span>), <span class="hljs-attr">text</span>: script.<span class="hljs-property">innerHTML</span> &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p>åˆå¹¶èµ·æ¥å°±æ˜¯è¿™æ ·å’¯ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-attr">scripts</span>: <span class="hljs-built_in">string</span>[] = []<br><span class="hljs-keyword">const</span> <span class="hljs-attr">links</span>: <span class="hljs-built_in">string</span>[] = []<br><span class="hljs-keyword">const</span> <span class="hljs-attr">inlineScript</span>: <span class="hljs-built_in">string</span>[] = []<br><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">parseHTML</span> = (<span class="hljs-params">parent: HTMLElement, app: ChildAppInfo</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> children = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(parent.<span class="hljs-property">children</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>[]<br>    children.<span class="hljs-property">length</span> &amp;&amp; children.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-title function_">parseHTML</span>(item, app))<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> dom <span class="hljs-keyword">of</span> children) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(link)$/i</span>.<span class="hljs-title function_">test</span>(dom.<span class="hljs-property">tagName</span>)) &#123;<br>            <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">parseLink</span>(dom, parent, app)<br>            data &amp;&amp; links.<span class="hljs-title function_">push</span>(data)<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(script)$/i</span>.<span class="hljs-title function_">test</span>(dom.<span class="hljs-property">tagName</span>)) &#123;<br>            <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">parseScript</span>(dom, parent, app)<br>            data.<span class="hljs-property">text</span> &amp;&amp; inlineScript.<span class="hljs-title function_">push</span>(data.<span class="hljs-property">text</span>)<br>            data.<span class="hljs-property">url</span> &amp;&amp; scripts.<span class="hljs-title function_">push</span>(data.<span class="hljs-property">url</span>)<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(img)$/i</span>.<span class="hljs-title function_">test</span>(dom.<span class="hljs-property">tagName</span>) &amp;&amp; dom.<span class="hljs-title function_">hasAttribute</span>(<span class="hljs-string">&#x27;src&#x27;</span>)) &#123;<br>            dom.<span class="hljs-title function_">setAttribute</span>(<br>                <span class="hljs-string">&#x27;src&#x27;</span>,<br>                <span class="hljs-title function_">getCompletionURL</span>(dom.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;src&#x27;</span>)!, app.<span class="hljs-property">entry</span>)!<br>            )<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> &#123; scripts, links, inlineScript &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå‰ç«¯å°±æ˜¯è½®å­å¤šï¼Œè¿™äº›å…¶å®éƒ½ä¸ç”¨è‡ªå·±å†™çš„ï¼Œæœ‰ä¸ª<a href="https://www.npmjs.com/package/import-html-entry">import-html-entry</a>åº“å¯ä»¥ç›´æ¥ç”¨ï¼Œå˜å˜çˆ½</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> &#123; template, getExternalScripts, getExternalStyleSheets &#125; =<br>   <span class="hljs-keyword">await</span> importEntry(entry)<br></code></pre></td></tr></table></figure><h3 id="æ–‡ä»¶åŠ è½½å®Œï¼Œå°±è¦è¿è¡Œjså’¯ï¼Œè¿™å›æ˜¯çœŸå¿«äº†ï¼ğŸ˜"><a href="#æ–‡ä»¶åŠ è½½å®Œï¼Œå°±è¦è¿è¡Œjså’¯ï¼Œè¿™å›æ˜¯çœŸå¿«äº†ï¼ğŸ˜" class="headerlink" title="æ–‡ä»¶åŠ è½½å®Œï¼Œå°±è¦è¿è¡Œjså’¯ï¼Œè¿™å›æ˜¯çœŸå¿«äº†ï¼ğŸ˜"></a>æ–‡ä»¶åŠ è½½å®Œï¼Œå°±è¦è¿è¡Œjså’¯ï¼Œè¿™å›æ˜¯çœŸå¿«äº†ï¼ğŸ˜</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// /loader/index.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadHTML</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">app: ChildAppInfo</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; container, entry &#125; = app<br>    <span class="hljs-keyword">const</span> &#123; template, getExternalScripts, getExternalStyleSheets &#125; =<br>        <span class="hljs-keyword">await</span> importEntry(entry)<br>    <span class="hljs-keyword">const</span> dom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(container)<br><br>    <span class="hljs-keyword">if</span> (!dom) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;å®¹å™¨ä¸å­˜åœ¨&#x27;</span>)<br>    &#125;<br><br>    dom.<span class="hljs-property">innerHTML</span> = template<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dom.<span class="hljs-property">innerHTML</span>)<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">getExternalStyleSheets</span>()<br>    <span class="hljs-keyword">const</span> jsCode = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getExternalScripts</span>()<br><br>    jsCode.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">script</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> lifeCycle = <span class="hljs-title function_">runJS</span>(script, app)<br>        <span class="hljs-keyword">if</span> (lifeCycle) &#123;<br>            app.<span class="hljs-property">bootstrap</span> = lifeCycle.<span class="hljs-property">bootstrap</span><br>            app.<span class="hljs-property">mount</span> = lifeCycle.<span class="hljs-property">mount</span><br>            app.<span class="hljs-property">unmount</span> = lifeCycle.<span class="hljs-property">unmount</span><br>        &#125;<br>    &#125;)<br><br>    <span class="hljs-keyword">return</span> app<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ¬æ¥æ‰“ç®—è¿™ä¹ˆè·‘çš„ï¼Œä½†æ˜¯æ²¡è·‘æˆï¼Œæ™šä¸Šå›å»çœ‹çœ‹å’‹ä¸ªäº‹ï¼Œåæ­£å°±æ˜¯æŠŠjsæ‹¿å‡ºæ¥æ‰§è¡Œï¼Œå°±è¿™ä¸ªæ„æ€</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redux</title>
    <link href="/2024/02/04/redux/"/>
    <url>/2024/02/04/redux/</url>
    
    <content type="html"><![CDATA[<h1 id="Redux-å’Œ-useReducer-ğŸ˜"><a href="#Redux-å’Œ-useReducer-ğŸ˜" class="headerlink" title="Redux å’Œ useReducer ğŸ˜"></a>Redux å’Œ useReducer ğŸ˜</h1><h2 id="ä¸€ã€Redux-çš„æ¥å¤´ğŸ¤¡"><a href="#ä¸€ã€Redux-çš„æ¥å¤´ğŸ¤¡" class="headerlink" title="ä¸€ã€Redux çš„æ¥å¤´ğŸ¤¡"></a>ä¸€ã€Redux çš„æ¥å¤´ğŸ¤¡</h2><p>ç›¸ä¿¡å¤§å®¶åœ¨å†™è¿™ä¸ª <code>todoList</code> çš„æ—¶å€™ï¼Œå‘ç°è¿™ä¸ªç©æ„è¦æ¯”å…¶ä»–çš„éš¾å†™ï¼Œä¸ºä»€ä¹ˆå˜ï¼Ÿ</p><p>![å¤§å®¶åº”è¯¥éƒ½æ˜¯è¿™æ ·ç®€å•æ‹†åˆ†ç»„ä»¶çš„å§(âÂ´â—¡&#96;â)](<a href="https://i2.100024.xyz/2024/02/04/kgsr53.webp">https://i2.100024.xyz/2024/02/04/kgsr53.webp</a>)</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç»„ä»¶<em><strong>è§†è§‰ä¸Š</strong></em>åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œä½†æ˜¯è¿™ä¸‰ä¸ªéƒ¨åˆ†ä¼š<em><strong>ç›¸äº’å½±å“</strong></em>, è¿™å°±å¯¼è‡´å¦‚æœè®¾è®¡ä¸å¥½çš„è¯ï¼ŒçŠ¶æ€æ»¡å¤©é£ï¼Œç»„ä»¶é—´é€šä¿¡æ¥é€šä¿¡å»æ˜¯ä¸ªå¤§é—®é¢˜ã€‚</p><p>çœ‹å¤§å®¶åŸºæœ¬éƒ½æƒ³åˆ°æŠŠçŠ¶æ€æå‡åˆ°å…¨å±€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™<strong>ç¡®å®æŒºä¸é”™</strong>çš„ğŸ˜</p><p>è¿™å…¶å®å°±æœ‰ä¸€ç‚¹ç±»ä¼¼äº<code>redux</code>çš„ç†å¿µäº†ï¼š <em><strong>æ‰¾ä¸ªåœ°æ–¹ä¸“é—¨ç®¡ç†çŠ¶æ€ï¼Œè®©ç»„ä»¶å†…éƒ¨é€»è¾‘æ›´æ¸…æ™°</strong></em>ï¼Œè¿™åœ¨å¤§å·¥ç¨‹é‡Œä¼šç›¸å½“ç›¸å½“æœ‰ç”¨</p><p>æ˜¯ä¸æ˜¯ä¸æ•¢æƒ³è±¡åœ¨ç»„ä»¶å¤–çš„çŠ¶æ€ä¼šæœ‰å¤šé…·ï¼ŸğŸ¤©ç»§ç»­å¾€ä¸‹çœ‹å§</p><blockquote><p><img src="https://redux.js.org/assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif" alt="Redux ç†å¿µ:"></p></blockquote><h2 id="äºŒã€-Reduxä¸‹è½½ğŸ˜Š"><a href="#äºŒã€-Reduxä¸‹è½½ğŸ˜Š" class="headerlink" title="äºŒã€ Reduxä¸‹è½½ğŸ˜Š"></a>äºŒã€ Reduxä¸‹è½½ğŸ˜Š</h2><p>è¿˜æ˜¯è€æ ·å­ï¼Œnpmæ¢­å“ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install redux<br></code></pre></td></tr></table></figure><blockquote><p>å…¶å®è¿™ä¸ªåŒ…å¯ä»¥ä¸è¦çš„ï¼Œè¿™ä¸ªåŒ…è¶…çº§éº»çƒ¦ğŸ‘½</p><p><code>redux</code>å®˜æ–¹ä¹Ÿæ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯å°±å‡ºäº†ä¸€ä¸ªå°ç”œç”œï¼š <code>@reduxjs/toolkit</code>æ¥å–ä»£è¿™ä½ç‰›å¤«äºº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install @reduxjs/toolkit<br></code></pre></td></tr></table></figure><p>ç°åœ¨æ›´æ¨èè¿™ä¸ªå“‡ğŸ¶</p></blockquote><p>å¦‚æœè¦åœ¨å’±çš„<code>react</code>é¡¹ç›®ä¸­ç”¨ï¼Œè¿˜å¾—ä¸‹ä¸€ä¸ª<code>react-redux</code>åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install react-redux<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€Reduxæ–‡ä»¶ç»“æ„ğŸ‘¾"><a href="#ä¸‰ã€Reduxæ–‡ä»¶ç»“æ„ğŸ‘¾" class="headerlink" title="ä¸‰ã€Reduxæ–‡ä»¶ç»“æ„ğŸ‘¾"></a>ä¸‰ã€Reduxæ–‡ä»¶ç»“æ„ğŸ‘¾</h2><p>ä¼ ç»Ÿ<code>Redux</code>ç»“æ„</p><blockquote><p>src&#x2F;<br>|â€“ actions&#x2F;<br>|   |â€“ counterActions.js<br>|â€“ reducers&#x2F;<br>|   |â€“ counterReducer.js<br>|â€“ store&#x2F;<br>|   |â€“ configureStore.js<br>|â€“ components&#x2F;<br>|   |â€“ Counter.js<br>|   |â€“ App.js<br>|â€“ index.js</p></blockquote><p>éƒ½ä»€ä¹ˆå¹´ä»£äº†ï¼Œè¿˜åœ¨ç©ä¼ ç»Ÿ<code>redux</code>?ğŸ˜“</p><p>æœ‰äº†<code>redux-toolkit</code>ä¹‹åï¼Œé‚£å¯æ˜¯å˜äº†å¤©äº†</p><blockquote><p>src&#x2F;<br>|â€“ slices&#x2F;<br>|   |â€“ counterSlice.js<br>|â€“ store&#x2F;<br>|   |â€“ configureStore.js<br>|â€“ components&#x2F;<br>|   |â€“ Counter.js<br>|   |â€“ App.js<br>|â€“ index.js</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤šå‡ºæ¥ä¸€ä¸ª<code>slices</code>ï¼Œå°‘æ‰äº†<code>reducer</code>å’Œ<code>action</code>ï¼Œè¿™æ˜¯å› ä¸º<code>toolkit</code>ä¸­çš„<code>slices</code>æŠŠè¿™ä¸¤ä¸ªåŠŸèƒ½è‡ªåŠ¨æå¥½äº†ï¼Œè¿™æ ·æˆ‘ä»¬å†™èµ·æ¥ä¹Ÿè¶…çº§æ–¹ä¾¿ï¼Œè¶…çº§çˆ±ğŸ˜</p><h2 id="å››ã€reduxç”¨æ³•ğŸ’©"><a href="#å››ã€reduxç”¨æ³•ğŸ’©" class="headerlink" title="å››ã€reduxç”¨æ³•ğŸ’©"></a>å››ã€<code>redux</code>ç”¨æ³•ğŸ’©</h2><ol><li><p>é¦–å…ˆï¼Œä½¿ç”¨<code>createSlice</code>æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ª<code>slice</code>ï¼Œ åŒ…æ‹¬å®ƒçš„</p><ul><li>åç§°<code>name</code>ï¼Œ</li><li>åˆå§‹çŠ¶æ€<code>initialState</code>,</li><li><code>action</code>çš„åˆ›å»ºå‡½æ•°<code>reducers</code>ï¼ˆä¸çŸ¥é“ä¸ºå•¥è¦å«<code>reducer</code>æ ¹æœ¬å°±ä¸æ²¾ä¸€ç‚¹è¾¹ğŸ˜¡ï¼‰</li></ul><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123;createSlice, <span class="hljs-title class_">PayloadAction</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;itemType&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../pages/listType.ts&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;autoKey&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../utils/geneKeys.ts&quot;</span>;<br><br><span class="hljs-keyword">const</span> listInfoSlice = <span class="hljs-title function_">createSlice</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;listInfo&#x27;</span>,<br>    <span class="hljs-attr">initialState</span>: [] <span class="hljs-keyword">as</span> itemType[],<br>    <span class="hljs-attr">reducers</span>: &#123;<br>        <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">state: itemType[], action: PayloadAction&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">return</span> state.<span class="hljs-title function_">concat</span>(&#123;<br>                <span class="hljs-attr">value</span>: action.<span class="hljs-property">payload</span>,<br>                <span class="hljs-attr">key</span>: autoKey.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>,<br>                <span class="hljs-attr">isCompleted</span>: <span class="hljs-literal">false</span>,<br>            &#125;);<br>        &#125;,<br>        <span class="hljs-attr">dele</span>: <span class="hljs-function">(<span class="hljs-params">state: itemType[], action: PayloadAction&lt;<span class="hljs-built_in">number</span>&gt;</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">return</span> state.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">key</span> != action.<span class="hljs-property">payload</span>)<br>        &#125;,<br>        ...<br>    &#125;<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> listActions = listInfoSlice.<span class="hljs-property">actions</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> listInfoSlice.<span class="hljs-property">reducer</span><br></code></pre></td></tr></table></figure><blockquote><p>ä¼ å‚æ•°å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡ <code>action</code>ä¼ é€’çš„ï¼Œå¯ä»¥æŒ‡å®šå‚æ•°ç±»å‹ï¼Œç›¸å½“ä¸é”™</p></blockquote></li><li><p>ç„¶åï¼Œé€šè¿‡<code>configureStore</code>åˆ›å»ºä¸€ä¸ª<code>store</code>æ¥ç®¡ç†å­˜å‚¨è¿™ä¸ª<code>state</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123;configureStore&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;<br><span class="hljs-keyword">import</span> listInfoReducer <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../slices/listInfoSlice.ts&quot;</span>;<br><span class="hljs-keyword">import</span> displayReducer <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../slices/displaySlice.ts&quot;</span>;<br><br><span class="hljs-keyword">const</span> todoStore = <span class="hljs-title function_">configureStore</span>(&#123;<br>    <span class="hljs-attr">reducer</span>: &#123;<br>        <span class="hljs-attr">listReducer</span>: listInfoReducer,<br>        <span class="hljs-attr">displayReducer</span>: displayReducer<br>    &#125;<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> todoStore<br></code></pre></td></tr></table></figure></li><li><p>ä»€ä¹ˆï¼Œä½ é—®æˆ‘ä¹‹åï¼ŸğŸ¤•ä¹‹åå°±ç›´æ¥å¼€è€äº†å•Š,ç»™ä½ ä»¬æ‘˜ä¸€æ®µ</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// listItem.tsx</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">ListItem</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;listItemProps&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> [edit, setEdit] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>);<br>    <span class="hljs-keyword">const</span> &#123;key, value, isCompleted&#125; = props.<span class="hljs-property">itemInfo</span>;<br>    <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCheck</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>        <span class="hljs-title function_">dispatch</span>(listActions.<span class="hljs-title function_">toggle</span>(key))<br>    &#125;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDelete</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>        <span class="hljs-title function_">dispatch</span>(listActions.<span class="hljs-title function_">dele</span>(key))<br>    &#125;<br>    <span class="hljs-comment">// eslint-disable-next-line @typescript-eslint/ban-ts-comment</span><br>    <span class="hljs-comment">// @ts-expect-error</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleEdit</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>        <span class="hljs-keyword">if</span>(e.<span class="hljs-property">keyCode</span> === <span class="hljs-number">13</span>) &#123;<br>            <span class="hljs-title function_">dispatch</span>(listActions.<span class="hljs-title function_">edit</span>([key, e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>]))<br>            e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;&#x27;</span><br>            <span class="hljs-title function_">setEdit</span>(<span class="hljs-literal">false</span>)<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleBlur</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>        <span class="hljs-title function_">setEdit</span>(<span class="hljs-literal">false</span>)<br>    &#125;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDoubleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>        <span class="hljs-title function_">setEdit</span>(<span class="hljs-literal">true</span>)<br>    &#125;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;isCompleted?</span>&#x27;<span class="hljs-attr">completed</span>&#x27;<span class="hljs-attr">:</span>&#x27;<span class="hljs-attr">active</span>&#x27;&#125; <span class="hljs-attr">onDoubleClick</span>=<span class="hljs-string">&#123;handleDoubleClick&#125;</span>&gt;</span></span><br><span class="language-xml">                &#123;!edit</span><br><span class="language-xml">                    ? <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;view&quot;</span>&gt;</span></span><br><span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;toggle&quot;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> null&#125; type=&quot;checkbox&quot; checked=&#123;isCompleted&#125;  onInput=&#123;handleCheck&#125;/&gt;</span><br><span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>&#123;value&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;destroy&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleDelete&#125;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">                    : <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">onKeyDown</span>=<span class="hljs-string">&#123;handleEdit&#125;</span> <span class="hljs-attr">onBlur</span>=<span class="hljs-string">&#123;handleBlur&#125;</span> <span class="hljs-attr">autoFocus</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;new-todo&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span></span><br><span class="language-xml">                &#125;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="äº”ã€å¸¸ç”¨hookğŸ¤£"><a href="#äº”ã€å¸¸ç”¨hookğŸ¤£" class="headerlink" title="äº”ã€å¸¸ç”¨hookğŸ¤£"></a>äº”ã€å¸¸ç”¨<code>hook</code>ğŸ¤£</h2><h3 id="1-useDispatch"><a href="#1-useDispatch" class="headerlink" title="1. useDispatch"></a>1. useDispatch</h3><p>åœ¨ä¸Šè¾¹çš„ä¹Ÿçœ‹åˆ°äº†ï¼Œå°±æ˜¯ä¸€ä¸ªåˆ†é…å·¥ä½œçš„å°åŒ…å·¥å¤´</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-title function_">dispatch</span>(listActions.<span class="hljs-title function_">toggle</span>(key))<br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>dispatch</code>,æŠŠ<code>action</code>ä¼ é€’ç»™<code>store</code>ï¼Œæ›´æ–°<code>state</code></p><h3 id="2-useSelector"><a href="#2-useSelector" class="headerlink" title="2. useSelector"></a>2. useSelector</h3><p>è¿™ä½æ›´æ˜¯é‡é‡çº§,è´Ÿè´£æ‘˜å‡º<code>store</code>ä¸­å¯¹åº”çš„<code>state</code></p><p>æ¯”å¦‚è¿™æ˜¯æˆ‘ä»¬çš„<code>store</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">todoStore</span> = <span class="hljs-title function_ invoke__">configureStore</span>(&#123;<br>    <span class="hljs-attr">reducer</span>: &#123;<br>        <span class="hljs-attr">listReducer</span>: listInfoReducer,<br>        <span class="hljs-attr">displayReducer</span>: displayReducer<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ‹¿åˆ°<code>list</code>çš„å€¼ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> list = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function">(<span class="hljs-params">state: storeType</span>) =&gt;</span> state.<span class="hljs-property">listReducer</span>)<br></code></pre></td></tr></table></figure><p>ä¸è¿‡ä¹‹æ‰€ä»¥è¯´å®ƒé‡é‡çº§æ˜¯å› ä¸ºå®ƒä¸å¤ªæå¾—æ‡‚<code>ts</code>ï¼Œæ‰€ä»¥ç»å¸¸è¦è‡ªå·±å»åˆ›å»ºç±»å‹å–‚ç»™å¥¹ï¼Œæ¯”å¦‚è¿™é‡Œï¼š<code>storeType</code>å°±æ˜¯è‡ªå·±å®šä¹‰çš„ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123;displayState, itemType&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../pages/listType.ts&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> storeType &#123;<br>    <span class="hljs-attr">listReducer</span>: itemType[],<br>    <span class="hljs-attr">displayReducer</span>: displayState<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…­ã€useReducerğŸ¥³"><a href="#å…­ã€useReducerğŸ¥³" class="headerlink" title="å…­ã€useReducerğŸ¥³"></a>å…­ã€<code>useReducer</code>ğŸ¥³</h2><p>è¿™ç©æ„å°±æ˜¯<code>react</code>çœ‹åˆ°<code>redux</code>çš„æˆåŠŸï¼Œæ¨¡ä»¿å‡ºæ¥çš„ä¸€ä¸ª<code>hook</code>ï¼Œå¯ä»¥ç†è§£ä¸º<code>redux</code>é’æ˜¥ç‰ˆ, å¬å®Œ<code>redux</code>ä¹‹åè¿™ä¸ªå°±æ˜¯å°<code>case</code>å•¦</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-comment">// reducerå‡½æ•°æ¥å—å½“å‰çš„stateå’Œä¸€ä¸ªactionï¼Œè¿”å›æ–°çš„state</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">reducer</span> = (<span class="hljs-params">state, action</span>) =&gt; &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;INCREMENT&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;DECREMENT&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> &#125;;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">return</span> state;<br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Counter</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-comment">// useReducerè¿”å›ä¸€ä¸ªå½“å‰stateå’Œdispatchå‡½æ•°çš„æ•°ç»„</span><br>  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, &#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> &#125;);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: &#123;state.count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;INCREMENT&#x27; &#125;)&#125;&gt;Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;DECREMENT&#x27; &#125;)&#125;&gt;Decrement<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Counter</span>;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>reactè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>reactè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>canvasç®€ä»‹</title>
    <link href="/2024/01/24/canvas/"/>
    <url>/2024/01/24/canvas/</url>
    
    <content type="html"><![CDATA[<h2 id="canvasç®€ä»‹"><a href="#canvasç®€ä»‹" class="headerlink" title="canvasç®€ä»‹"></a>canvasç®€ä»‹</h2><p>canvasï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç”»å¸ƒã€‚ç”¨äºç»˜åˆ¶å„ç§å›¾å½¢å›¾ç‰‡ã€‚</p><p>HTML5 canvas å…ƒç´ ç”¨äºå›¾å½¢çš„ç»˜åˆ¶ï¼Œé€šè¿‡è„šæœ¬ (é€šå¸¸æ˜¯JavaScript)æ¥å®Œæˆ.canvasæ ‡ç­¾åªæ˜¯å›¾å½¢å®¹å™¨ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨è„šæœ¬æ¥ç»˜åˆ¶å›¾å½¢ã€‚<br>ä½ å¯ä»¥é€šè¿‡å¤šç§æ–¹æ³•ä½¿ç”¨ canvas ç»˜åˆ¶è·¯å¾„,ç›’ã€åœ†ã€å­—ç¬¦ä»¥åŠæ·»åŠ å›¾åƒã€‚</p><p>ç‰¹ç‚¹ï¼šcanvasç»˜åˆ¶å‡ºæ¥çš„å›¾åƒæ˜¯å•çº¯çš„åƒç´ ç‚¹ï¼ˆsvgå›¾æ˜¯çŸ¢é‡å›¾ï¼Œä¹Ÿæ˜¯domå…ƒç´ ï¼‰ï¼Œæ‰€ç”»çš„å†…å®¹ä¸domå…ƒç´ ä¸åŒï¼Œcanvasæ˜¯ä¸€ä¸ªdomå…ƒç´ ï¼Œå¯¹å…¶æ–¹æ³•æ˜¯å¯¹æŒ‚åœ¨canvasä¸Šå¯¹å†…å®¹çš„æ“ä½œã€‚</p><h2 id="canvasåŸºæœ¬æ“ä½œ"><a href="#canvasåŸºæœ¬æ“ä½œ" class="headerlink" title="canvasåŸºæœ¬æ“ä½œ"></a>canvasåŸºæœ¬æ“ä½œ</h2><p>ç”±äºcanvasæ˜¯h5æ–°å¢çš„æ ‡ç­¾ï¼Œä¸ºäº†é˜²æ­¢æœ‰äººç”¨å¤è‘£ç‰ˆæœ¬æµè§ˆå™¨ï¼Œä¸€èˆ¬ä¼šè¿™ä¹ˆå†™ï¼Œcanvaså‡ºä¸æ¥æ—¶å°±è®©ç”¨æˆ·å‡çº§æµè§ˆå™¨ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;mycanvas&#x27;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;500&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;500&quot;</span>&gt;</span><br>    å½“å‰çš„æµè§ˆå™¨ç‰ˆæœ¬ä¸æ”¯æŒï¼Œè¯·å‡çº§æµè§ˆå™¨<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>  <br></code></pre></td></tr></table></figure><p>ç„¶åå°±è¦ç”¨jså¯¹canvasè¿›è¡Œæ“ä½œï¼ŒåŸºæœ¬çš„ç”»çº¿ã€çŸ©å½¢ã€åœ†å½¢ã€æ–‡å­—éƒ½æœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œåªéœ€è¦å¼„æ‡‚å…¶ä¸­çš„å‚æ•°å«ä¹‰å³å¯ï¼ˆä¸ç”¨èƒŒï¼Œå†™çš„æ—¶å€™ç¿»ä¸€ç¿»å°±å¯ä»¥ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// å¾—åˆ°canvasçš„ç”»å¸ƒ</span><br><span class="hljs-keyword">const</span> myCanvas= <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;mycanvas&quot;</span>)<br><span class="hljs-comment">// å¾—åˆ°ç”»å¸ƒçš„ä¸Šä¸‹æ–‡ï¼Œä¸Šä¸‹æ–‡æœ‰ä¸¤ä¸ªï¼Œ2dçš„ä¸Šä¸‹æ–‡å’Œ3dçš„ä¸Šä¸‹æ–‡</span><br><span class="hljs-comment">// æ‰€æœ‰çš„å›¾åƒç»˜åˆ¶éƒ½æ˜¯é€šè¿‡ctxå±æ€§æˆ–è€…æ˜¯æ–¹æ³•è¿›è¡Œè®¾ç½®çš„ï¼Œå’Œcanvasæ ‡ç­¾æ²¡æœ‰å…³ç³»äº†</span><br><span class="hljs-keyword">const</span> ctx = myCanvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&quot;2d&quot;</span>)<br><br><span class="hljs-keyword">if</span>(ctx !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// è®¾ç½®é¢œè‰²</span><br>    ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&#x27;green&#x27;</span><br>    <span class="hljs-comment">// ç»˜åˆ¶çŸ©å½¢</span><br>    ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">50</span>) <br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€äº›å…·ä½“çš„æ–¹æ³•ï¼š<br>(æ³¨æ„ï¼šcanvasä¸­çš„åæ ‡éƒ½æ˜¯ä»¥å·¦ä¸Šæ–¹ä¸ºåŸç‚¹ï¼Œåæ ‡å‘ä¸‹å‘å³å¢å¤§)</p><h4 id="ç»˜åˆ¶çŸ©å½¢ï¼š"><a href="#ç»˜åˆ¶çŸ©å½¢ï¼š" class="headerlink" title="ç»˜åˆ¶çŸ©å½¢ï¼š"></a>ç»˜åˆ¶çŸ©å½¢ï¼š</h4><ul><li>fillRect(x, y, width, height)<br>ç»˜åˆ¶ä¸€ä¸ªå¡«å……çš„çŸ©å½¢</li><li>strokeRect(x, y, width, height)<br>ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢çš„è¾¹æ¡†</li><li>clearRect(x, y, width, height)<br>æ¸…é™¤æŒ‡å®šçŸ©å½¢åŒºåŸŸï¼Œè®©æ¸…é™¤éƒ¨åˆ†å®Œå…¨é€æ˜ã€‚</li></ul><h4 id="ç»˜åˆ¶è·¯å¾„ä¸ç¬”è§¦ï¼š"><a href="#ç»˜åˆ¶è·¯å¾„ä¸ç¬”è§¦ï¼š" class="headerlink" title="ç»˜åˆ¶è·¯å¾„ä¸ç¬”è§¦ï¼š"></a>ç»˜åˆ¶è·¯å¾„ä¸ç¬”è§¦ï¼š</h4><p>ç»˜åˆ¶è·¯å¾„ä¸­æˆ‘ä»¬è¦æœ‰ä¸€ä¸ªç”»ç¬”çš„æ¦‚å¿µï¼Œç”»ç¬”æœ‰ä¸€ä¸ªä½ç½®</p><ul><li>moveto(x,y)<br>ç”»ç¬”ç§»åŠ¨åˆ°æŸå¤„</li><li>lineTo(x, y)ç”»ä¸€æ¡åˆ°æŸå¤„çš„çº¿</li><li>beginPath()<br>æ–°å»ºä¸€æ¡è·¯å¾„ï¼Œç”Ÿæˆä¹‹åï¼Œå›¾å½¢ç»˜åˆ¶å‘½ä»¤è¢«æŒ‡å‘åˆ°è·¯å¾„ä¸Šç”Ÿæˆè·¯å¾„ã€‚</li><li>closePath()<br>é—­åˆè·¯å¾„ä¹‹åå›¾å½¢ç»˜åˆ¶å‘½ä»¤åˆé‡æ–°æŒ‡å‘åˆ°ä¸Šä¸‹æ–‡ä¸­ã€‚</li><li>stroke()<br>é€šè¿‡çº¿æ¡æ¥ç»˜åˆ¶å›¾å½¢è½®å»“ã€‚</li><li>fill()<br>é€šè¿‡å¡«å……è·¯å¾„çš„å†…å®¹åŒºåŸŸç”Ÿæˆå®å¿ƒçš„å›¾å½¢ã€‚<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//ä¸€ä¸ªç”»å‡ºä¸‰è§’å½¢å¡«è‰²çš„ä¾‹å­</span><br>ctx.<span class="hljs-title function_">beginPath</span>();<br>    ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">75</span>, <span class="hljs-number">50</span>);<br>    ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">75</span>);<br>    ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">25</span>);<br>    ctx.<span class="hljs-title function_">fill</span>();<br></code></pre></td></tr></table></figure></li></ul><h4 id="ç»˜åˆ¶é¢œè‰²ï¼š"><a href="#ç»˜åˆ¶é¢œè‰²ï¼š" class="headerlink" title="ç»˜åˆ¶é¢œè‰²ï¼š"></a>ç»˜åˆ¶é¢œè‰²ï¼š</h4><p>canvasä¸­çš„ç”»ç¬”é¢œè‰²ä¿®æ”¹ï¼ˆå®é™…å¼€å‘ä¸­å®¹æ˜“è¢«ä¹‹å‰çš„é¢œè‰²å¹²æ‰°ï¼Œæ‰€ä»¥å°è£…æ¯ä¸€ä¸ªç»˜åˆ¶å‡½æ•°æ—¶å¯ä»¥å†å¼€å¤´ä¿®æ”¹æˆéœ€è¦çš„é¢œè‰²ï¼‰</p><ul><li>fillStyle &#x3D; color<br>è®¾ç½®å›¾å½¢çš„å¡«å……é¢œè‰²ã€‚</li><li>strokeStyle &#x3D; color<br>è®¾ç½®å›¾å½¢è½®å»“çš„é¢œè‰²ã€‚</li></ul><h4 id="ç»˜åˆ¶æ–‡æœ¬ï¼š"><a href="#ç»˜åˆ¶æ–‡æœ¬ï¼š" class="headerlink" title="ç»˜åˆ¶æ–‡æœ¬ï¼š"></a>ç»˜åˆ¶æ–‡æœ¬ï¼š</h4><ul><li>fillText(text, x, y [, maxWidth])<br>åœ¨æŒ‡å®šçš„ (x,y) ä½ç½®å¡«å……æŒ‡å®šçš„æ–‡æœ¬ï¼Œç»˜åˆ¶çš„æœ€å¤§å®½åº¦æ˜¯å¯é€‰çš„ã€‚</li><li>strokeText(text, x, y [, maxWidth])<br>åœ¨æŒ‡å®šçš„ (x,y) ä½ç½®ç»˜åˆ¶æ–‡æœ¬è¾¹æ¡†ï¼Œç»˜åˆ¶çš„æœ€å¤§å®½åº¦æ˜¯å¯é€‰çš„ã€‚</li><li>æ–‡æœ¬æ ·å¼ï¼š<br>font &#x3D; value<br>å½“å‰æˆ‘ä»¬ç”¨æ¥ç»˜åˆ¶æ–‡æœ¬çš„æ ·å¼ã€‚è¿™ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨å’Œ CSS font å±æ€§ç›¸åŒçš„è¯­æ³•ã€‚é»˜è®¤çš„å­—ä½“æ˜¯ 10px sans-serifã€‚</li></ul><p>é™¤äº†ä»¥ä¸Šï¼Œè¿˜æœ‰æ¸å˜è‰²ã€é€æ˜åº¦ã€çº¿æ¡è½¬è¾¹æ ·å¼ç­‰ã€‚éœ€è¦çš„æ—¶å€™éƒ½å¯ä»¥ä¸€ä¸‹æŸ¥åˆ°è€Œä¸”ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæ‰€ä»¥ä¸å¿…èƒŒä¸‹æ¥ï¼Œåªç”¨çŸ¥é“ä»€ä¹ˆæ˜¯å¯ä»¥åšçš„å’Œåœ¨å“ªé‡ŒæŸ¥åˆ°å°±å¯ä»¥äº†ã€‚</p><h3 id="å›¾ç‰‡ç»˜åˆ¶ï¼š"><a href="#å›¾ç‰‡ç»˜åˆ¶ï¼š" class="headerlink" title="å›¾ç‰‡ç»˜åˆ¶ï¼š"></a>å›¾ç‰‡ç»˜åˆ¶ï¼š</h3><p>è¿™ä¸ªæ˜¯é‡ç‚¹ã€‚å®é™…å¼€å‘ä¸­ä¸å¯èƒ½è®©è‡ªå·±ç”»ä¸‰è§’å½¢çŸ©å½¢åœ†å½¢å†å¡«è‰²ä¸€å †å†…å®¹ï¼Œæ›´å¤šçš„æ—¶å€™æ˜¯ç”¨è®¾è®¡ç»™å¥½çš„å›¾ç‰‡ï¼Œå°±æ˜¯æŠŠå›¾ç‰‡ç”»åˆ°ç”»å¸ƒä¸Šå»ã€‚<br><code>drawImage</code><br>å…¶ä¸­ image æ˜¯ image æˆ–è€… canvas å¯¹è±¡ã€‚<br>ï¼ˆæ³¨æ„è¿™é‡Œçš„imageæ˜¯ä¸€ä¸ªImageå¯¹è±¡æˆ–è€…ä¸€ä¸ªdomè·å–çš„imgæ ‡ç­¾ï¼‰</p><p><code>drawImage</code>çš„å‚æ•°è®¾ç½®æœ‰ç‚¹è®©äººæ™•å¤´è½¬å‘ã€‚æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥çœ‹ã€‚</p><ul><li><code>drawImage(image,x,y)</code>x,yæ˜¯å›¾ç‰‡çš„åæ ‡ï¼Œå›¾ç‰‡çš„å·¦ä¸Šè§’ç‚¹åæ ‡ä¸ºï¼ˆx,yï¼‰,æ­¤æ—¶å›¾ç‰‡çš„å®½é«˜çš†ä¸ºå…¶åƒç´ é»˜è®¤å®½é«˜</li><li><code>drawImage(image, x, y, width, height)</code>è¿™ä¸ªæ–¹æ³•å¤šäº† 2 ä¸ªå‚æ•°ï¼šwidth å’Œ heightï¼Œè¿™ä¸¤ä¸ªå‚æ•°ç”¨æ¥æ§åˆ¶ å½“å‘ canvas ç”»å…¥æ—¶åº”è¯¥ç¼©æ”¾çš„å¤§å°ã€‚æ­¤æ—¶å›¾ç‰‡çš„å®½é«˜ä¸ºwidthã€heightã€‚</li><li><code>drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)</code><br>å‰ 4 ä¸ªæ˜¯å®šä¹‰å›¾åƒæºçš„åˆ‡ç‰‡ä½ç½®å’Œå¤§å°ï¼Œå 4 ä¸ªåˆ™æ˜¯å®šä¹‰åˆ‡ç‰‡çš„ç›®æ ‡æ˜¾ç¤ºä½ç½®å’Œå¤§å°ã€‚å¯ä»¥å¯¹ç…§ä¸‹å›¾ç†è§£ä¸€ä¸‹ã€‚<img src='canvas_drawimage.jpg'></li></ul><h3 id="çŠ¶æ€ä¿å­˜ä¸å›å¤"><a href="#çŠ¶æ€ä¿å­˜ä¸å›å¤" class="headerlink" title="çŠ¶æ€ä¿å­˜ä¸å›å¤"></a>çŠ¶æ€ä¿å­˜ä¸å›å¤</h3><ul><li><code>save()</code><br>ä¿å­˜ç”»å¸ƒ (canvas) çš„æ‰€æœ‰çŠ¶æ€</li><li><code>restore()</code><br>save å’Œ restore æ–¹æ³•æ˜¯ç”¨æ¥ä¿å­˜å’Œæ¢å¤ canvas çŠ¶æ€çš„ï¼Œéƒ½æ²¡æœ‰å‚æ•°ã€‚Canvas çš„çŠ¶æ€å°±æ˜¯å½“å‰ç”»é¢åº”ç”¨çš„æ‰€æœ‰æ ·å¼å’Œå˜å½¢çš„ä¸€ä¸ªå¿«ç…§ã€‚</li><li>ä½ å¯ä»¥è°ƒç”¨ä»»æ„å¤šæ¬¡ saveæ–¹æ³•ã€‚æ¯ä¸€æ¬¡è°ƒç”¨ restore æ–¹æ³•ï¼Œä¸Šä¸€ä¸ªä¿å­˜çš„çŠ¶æ€å°±ä»æ ˆä¸­å¼¹å‡ºï¼Œæ‰€æœ‰è®¾å®šéƒ½æ¢å¤ã€‚</li></ul><h2 id="canvaså®ç°åŠ¨ç”»"><a href="#canvaså®ç°åŠ¨ç”»" class="headerlink" title="canvaså®ç°åŠ¨ç”»"></a>canvaså®ç°åŠ¨ç”»</h2><p>æˆ‘ä»¬ç”¨canvasç»˜åˆ¶äº†ä¸€ä¸ªå›¾å½¢ï¼Œä¸€æ—¦ç»˜åˆ¶æˆåŠŸäº†ï¼Œcanvaså°±åƒç´ åŒ–äº†ä»–ä»¬ã€‚canvasæ²¡æœ‰èƒ½åŠ›ï¼Œä»ç”»å¸ƒä¸Šå†æ¬¡å¾—åˆ°è¿™ä¸ªå›¾å½¢ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æœ‰èƒ½åŠ›å»ä¿®æ”¹å·²ç»åœ¨ç”»å¸ƒä¸Šçš„å†…å®¹ï¼Œè¿™ä¸ªå°±æ˜¯canvasæ¯”è¾ƒè½»é‡çš„åŸå› ï¼ŒFlashé‡çš„åŸå› ä¹‹ä¸€å°±æœ‰å®ƒå¯ä»¥é€šè¿‡å¯¹åº”çš„apiå¾—åˆ°å·²ç»ä¸Šâ€œç”»å¸ƒâ€çš„å†…å®¹ç„¶åå†æ¬¡ç»˜åˆ¶ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†canvasçš„åŠ¨ç”»çš„æµç¨‹ï¼šç”»-&gt;æ›´æ–°æ•°æ®å†…å®¹-&gt;æ¸…é™¤ç”»å¸ƒå†…å®¹-&gt;é‡æ–°ç”»</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// è®¾ç½®é¢œè‰²</span><br>ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;blue&quot;</span><br><span class="hljs-comment">// åˆå§‹ä¿¡å·é‡</span><br><span class="hljs-keyword">let</span> left = -<span class="hljs-number">200</span><br><span class="hljs-comment">// åŠ¨ç”»è¿‡ç¨‹</span><br><span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>   <span class="hljs-comment">// æ¸…é™¤ç”»å¸ƒ,0,0ä»£è¡¨ä»ä»€ä¹ˆä½ç½®å¼€å§‹,600,600ä»£è¡¨æ¸…é™¤çš„å®½åº¦å’Œé«˜åº¦</span><br>   ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">600</span>,<span class="hljs-number">600</span>)<br>   <span class="hljs-comment">// æ›´æ–°ä¿¡å·é‡</span><br>   left++<br>   <span class="hljs-comment">// å¦‚æœå·²ç»èµ°å‡ºç”»å¸ƒï¼Œåˆ™æ›´æ–°ä¿¡å·é‡ä¸ºåˆå§‹ä½ç½®</span><br>   <span class="hljs-keyword">if</span>(left &gt; <span class="hljs-number">600</span>) &#123;<br>       left = -<span class="hljs-number">200</span><br>   &#125;<br>   ctx.<span class="hljs-title function_">fillRect</span>(left, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>)<br>&#125;,<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p>çœ‹çœ‹ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼ŒsetIntervalä¸æ–­çš„è°ƒç”¨å®ƒç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°çš„å†…å®¹ã€‚å‡½æ•°ä¸­æ¸…é™¤å†æ›´æ–°æ–¹å—çš„ä½ç½®å†æ¸²æŸ“ã€‚</p><p>setIntervalé—´éš”ä¸€æ®µæ—¶é—´ä¸æ–­è°ƒç”¨å‡½æ•°çš„ç‰¹æ€§è®©æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥é‡ç»˜ã€‚å½“ç„¶é—´éš”ä¸€æ®µå›ºå®šçš„æ—¶é—´ä¹Ÿæœ‰å…¶å¼Šç«¯ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç”¨rafåŠ¨ç”»ï¼Œè¿™é‡Œä¸å±•å¼€è¯´æ˜ã€‚</p><p>ä¸Šé¢çš„ä¾‹å­ä¸­åªæœ‰ä¸€ä¸ªç®€å•çš„å›¾å½¢å’Œä¸€ä¸ªç®€å•çš„leftåæ ‡ï¼Œå†™èµ·æ¥å¾ˆç®€å•ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€ä¸ªç”»å¸ƒä¸­ä¼šæœ‰å¾ˆå¤šä¸åŒçš„å†…å®¹åœ¨åŠ¨ï¼Œå¦‚æœä¸ºæ¯ä¸€ä¸ªå†…å®¹æ·»åŠ å…¶å˜é‡å±æ€§å†å†™ä¸€å †ç»˜åˆ¶å‡½æ•°çš„è¯ï¼Œæ•´ä¸ªä»£ç å°±ä¼šå…ˆå¾—å¾ˆä¹±ã€‚æ‰€ä»¥æˆ‘ä»¬å°†æ¯ä¸€ç§ç±»å‹çš„å›¾å½¢å°è£…æˆå¯¹åº”çš„ç±»ï¼Œæ¯ä¸€ä¸ªå†…å®¹æ˜¯è¯¥ç±»çš„å¯¹è±¡ï¼Œå°†è¯¥å¯¹è±¡çš„æ•°æ®å†…å®¹å­˜åœ¨å¯¹è±¡ä¸­ä¸è¦æ”¾åœ¨å…¨å±€é‡Œï¼Œæ¯ä¸ªå¯¹è±¡æœ‰å…¶æ›´æ–°æ•°æ®å’Œç»˜åˆ¶çš„æ–¹æ³•ã€‚å†åœ¨setIntervalä¸­ä¸€èµ·è°ƒç”¨å…¨éƒ¨å¯¹è±¡çš„æ›´æ–°ä¸ç»˜åˆ¶å‡½æ•°ã€‚</p><p>å¦‚æœæœ‰å…´è¶£è¿˜å¯çœ‹çœ‹çœ‹ä¸‹é¢çš„æ–‡ç« ï¼š<br><a href="https://www.cnblogs.com/bleaka/p/16143470.html">https://www.cnblogs.com/bleaka/p/16143470.html</a></p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Reflect &amp; Proxy</title>
    <link href="/2023/12/17/Reflect/"/>
    <url>/2023/12/17/Reflect/</url>
    
    <content type="html"><![CDATA[<h1 id="Reflectå’ŒProxy-ğŸ¥³"><a href="#Reflectå’ŒProxy-ğŸ¥³" class="headerlink" title="Reflectå’ŒProxy ğŸ¥³"></a>Reflectå’ŒProxy ğŸ¥³</h1><h2 id="1-Proxy-ğŸ•¶ï¸"><a href="#1-Proxy-ğŸ•¶ï¸" class="headerlink" title="1. Proxy ğŸ•¶ï¸"></a>1. Proxy ğŸ•¶ï¸</h2><h3 id="1-1-è¯­æ³•ğŸ¤¡"><a href="#1-1-è¯­æ³•ğŸ¤¡" class="headerlink" title="1.1 è¯­æ³•ğŸ¤¡"></a>1.1 è¯­æ³•ğŸ¤¡</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Proxy()</code> æ„é€ å™¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Proxy</code> å¯¹è±¡ã€‚æ„é€ å™¨æ¥æ”¶ä¸¤ä¸ªä¸»è¦å‚æ•°ï¼š</p><ul><li><code>target</code> è¢«ä»£ç†çš„å¯¹è±¡</li><li><code>handler</code> è¢«ä»£ç†å¯¹è±¡ä¸Šçš„è‡ªå®šä¹‰è¡Œä¸º</li></ul><p>åƒè¿™æ ·ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler)<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç©ºçš„ <code>handler</code> å‚æ•°å°†ä¼šåˆ›å»ºä¸€ä¸ªä¸è¢«ä»£ç†å¯¹è±¡è¡Œä¸ºå‡ ä¹å®Œå…¨ç›¸åŒçš„ä»£ç†å¯¹è±¡ã€‚é€šè¿‡åœ¨ <code>handler</code> å¯¹è±¡ä¸Šå®šä¹‰ä¸€ç»„å¤„ç†å‡½æ•°ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è¢«ä»£ç†å¯¹è±¡çš„ä¸€äº›ç‰¹å®šè¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å®šä¹‰ <code>get()</code> ä½ å°±å¯ä»¥è‡ªå®šä¹‰è¢«ä»£ç†å¯¹è±¡çš„å±æ€§è®¿é—®å™¨ã€‚</p><h3 id="1-2-handlerä»¬ğŸ˜±"><a href="#1-2-handlerä»¬ğŸ˜±" class="headerlink" title="1.2 handlerä»¬ğŸ˜±"></a>1.2 handlerä»¬ğŸ˜±</h3><table><thead><tr><th>åå­—</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>handler.apply()</td><td>å‡½æ•°è°ƒç”¨åŠ«æŒ</td></tr><tr><td>handler.construct()</td><td><code>new</code> æ“ä½œç¬¦åŠ«æŒ</td></tr><tr><td>handler.defineProperty()</td><td><code>Object.defineProperty</code>è°ƒç”¨åŠ«æŒ</td></tr><tr><td>handler.deleteProperty()</td><td><code>delete</code> æ“ä½œç¬¦åŠ«æŒ</td></tr><tr><td>handler.get()</td><td>è·å–å±æ€§å€¼åŠ«æŒ</td></tr><tr><td>handler.getOwnPropertyDescriptor()</td><td><code>Object.getOwnPropertyDescriptor</code> è°ƒç”¨åŠ«æŒ</td></tr><tr><td>handler.getPrototypeOf()</td><td><code>Object.getPrototypeOf</code>è°ƒç”¨åŠ«æŒ</td></tr><tr><td>handler.has()</td><td><code>in</code>æ“ä½œç¬¦åŠ«æŒ</td></tr><tr><td>handler.isExtensible()</td><td><code>Object.isExtensible</code>è°ƒç”¨åŠ«æŒ</td></tr><tr><td>handler.ownKeys()</td><td><code>Object.getOwnPropertyNames</code>å’Œ<code>Object.getOwnPropertySymbols</code>è°ƒç”¨åŠ«æŒã€‚</td></tr><tr><td>handler.preventExtensions()</td><td><code>Object.preventExtensions</code>è°ƒç”¨åŠ«æŒ</td></tr><tr><td>handler.set()</td><td>è®¾ç½®å±æ€§å€¼åŠ«æŒ</td></tr><tr><td>handler.setPrototypeOf()</td><td><code>Object.setPrototypeOf</code>è°ƒç”¨åŠ«æŒ</td></tr></tbody></table><blockquote><p>å› ä¸ºæ˜¯å¯¹å¯¹è±¡åŠŸèƒ½çš„åŠ«æŒï¼Œæ‰€ä»¥åŠŸèƒ½å·®ä¸å¤šä¸<code>Object</code>çš„æ–¹æ³•åä¸€ä¸€å¯¹åº”ğŸ«¨</p></blockquote><h3 id="1-3-ç¤ºä¾‹ğŸ’©"><a href="#1-3-ç¤ºä¾‹ğŸ’©" class="headerlink" title="1.3 ç¤ºä¾‹ğŸ’©"></a>1.3 ç¤ºä¾‹ğŸ’©</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> cs = &#123;<br>    <span class="hljs-title class_">Ak47</span>: <span class="hljs-number">2700</span>,<br>    <span class="hljs-attr">AWP</span>: <span class="hljs-number">4750</span>,<br>    <span class="hljs-attr">amor</span>: <span class="hljs-number">650</span><br>&#125;;<br><br><span class="hljs-keyword">const</span> valorantHandler = &#123;<br>    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">target, prop, receiver</span>) &#123;<br>        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">&quot;AWP&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">4700</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(...<span class="hljs-variable language_">arguments</span>);<br>    &#125;,<br>&#125;;<br><br><span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(cs, valorantHandler);<br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(proxy).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy[key])<br>&#125;)<br></code></pre></td></tr></table></figure><p>ğŸ¤ªçŒœçŒœä¼šè¾“å‡ºä»€ä¹ˆå˜</p><p>ğŸ¤ªæ‰“ç“¦çš„é—­å˜´</p><blockquote><p><code>Proxy</code>ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯<code>target</code>,æŒ‡å®šä»£ç†çš„å¯¹è±¡ï¼›</p><p>ç¬¬äºŒä¸ªå‚æ•°<code>prop</code>æŒ‡å®šä»£ç†å±æ€§åï¼›</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°<code>receiver</code>ç”¨äºæŒ‡å®š<code>this</code>æŒ‡å‘ï¼Œå¦‚æœä¸åŠ ä¸Šå¯èƒ½ä¼šå¯¼è‡´<code>this</code>ä¸ä¼šæ­£ç¡®é…ç½®ï¼ˆä¸å¤ªæ‡‚ï¼Œæ²¡æ‰¾åˆ°ä¾‹å­ğŸ¤”ï¼‰</p></blockquote><h3 id="1-4-æœ‰getterå’Œsetteräº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¸ªproxyå˜ğŸ¦¢"><a href="#1-4-æœ‰getterå’Œsetteräº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¸ªproxyå˜ğŸ¦¢" class="headerlink" title="1.4 æœ‰getterå’Œsetteräº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¸ªproxyå˜ğŸ¦¢"></a>1.4 æœ‰<code>getter</code>å’Œ<code>setter</code>äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¸ª<code>proxy</code>å˜ğŸ¦¢</h3><p>è™½ç„¶ <code>Getter</code> å’Œ <code>Setter</code> æä¾›äº†å¯¹å•ä¸ªå±æ€§æ“ä½œçš„æ§åˆ¶ï¼Œä½†å®ƒä»¬ä¸èƒ½ç›´æ¥åº”ç”¨äºæ•´ä¸ªå¯¹è±¡æˆ–æ‹¦æˆªå…¶ä»–ç±»å‹çš„æ“ä½œã€‚<code>Proxy</code> æä¾›äº†<em><strong>å¯¹æ•´ä¸ªå¯¹è±¡æ“ä½œçš„å®Œå…¨æ§åˆ¶</strong></em>ï¼Œå¯ä»¥æ‹¦æˆªå’Œè‡ªå®šä¹‰å‡ ä¹æ‰€æœ‰å¯¹å¯¹è±¡çš„æ“ä½œã€‚è¿™ä½¿å¾— Proxy åœ¨è¿›è¡Œå¤æ‚æ“ä½œæˆ–åˆ›å»ºé«˜çº§æŠ½è±¡æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p>è¿˜æ˜¯é‚£æ®µä»£ç ï¼Œæƒ³æƒ³çœ‹è¦æ˜¯æƒ³åŠ¨æ€åŠ ä¸Šä¸€ä¸ªå±æ€§<code>m4</code>,ä¸ç®¡è¾“å…¥ä»€ä¹ˆæœ€åéƒ½æ‰“å°å‡º0<code>ã€‚ç”¨</code>getter<code>æˆ–è€…</code>setter<code>æ€ä¹ˆå†™ï¼Ÿæ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸º</code>getter<code>å’Œ</code>setter<code>ç®¡ä¸åˆ°</code>defineProperties<code>, ä½†æ˜¯è¦æ¢æˆ</code>proxy&#96;å°±å¾ˆç®€å•äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> cs = &#123;<br>    <span class="hljs-title class_">Ak47</span>: <span class="hljs-number">2700</span>,<br>    <span class="hljs-attr">AWP</span>: <span class="hljs-number">4750</span>,<br>    <span class="hljs-attr">amor</span>: <span class="hljs-number">650</span><br>&#125;;<br><br><span class="hljs-keyword">const</span> valorantHandler = &#123;<br>    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">target, prop, receiver</span>) &#123;<br>        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">&quot;AWP&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">4700</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(...<span class="hljs-variable language_">arguments</span>);<br>    &#125;,<br>    <span class="hljs-title function_">defineProperty</span>(<span class="hljs-params">target, prop, descriptor</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Defining property: <span class="hljs-subst">$&#123;prop&#125;</span>`</span>);<br>        <span class="hljs-keyword">if</span>(prop === <span class="hljs-string">&#x27;usp&#x27;</span>) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>)<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineProperty</span>(target, prop, descriptor);<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(cs, valorantHandler);<br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(proxy,<span class="hljs-string">&quot;usp&quot;</span>, &#123;<br>    <span class="hljs-attr">value</span>:<span class="hljs-number">8848</span>,<br>    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span><br>&#125;)<br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(proxy).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key, proxy[key])<br>&#125;)<br></code></pre></td></tr></table></figure><blockquote><p>ä½†æ˜¯<code>proxy</code>ç›¸å¯¹äºåŸç”Ÿ<code>object</code>å¤„ç†é€Ÿåº¦ä¼šæ…¢å¾ˆå¤šï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½å¤§é‡ä½¿ç”¨<code>proxy</code>ï¼Œä¼šä¸¥é‡å½±å“æ€§èƒ½ğŸ‘½</p></blockquote><h2 id="2-ReflectğŸ¤•"><a href="#2-ReflectğŸ¤•" class="headerlink" title="2. ReflectğŸ¤•"></a>2. ReflectğŸ¤•</h2><blockquote><p><strong>Reflect</strong> æ˜¯ä¸€ä¸ªå†…ç½®çš„å¯¹è±¡ï¼Œå®ƒæä¾›<em><strong>æ‹¦æˆª JavaScript</strong></em> æ“ä½œçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸ <code>proxy </code>çš„æ–¹æ³•ç›¸åŒã€‚<code>Reflect</code> ä¸æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå› æ­¤å®ƒæ˜¯<em><strong>ä¸å¯æ„é€ </strong></em>çš„ã€‚</p></blockquote><h3 id="2-1-å±æ€§è¡¨"><a href="#2-1-å±æ€§è¡¨" class="headerlink" title="2.1 å±æ€§è¡¨"></a>2.1 å±æ€§è¡¨</h3><table><thead><tr><th>åå­—</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>Reflect.apply(target, thisArgument, argumentsList)</td><td>å¯¹ä¸€ä¸ªå‡½æ•°è¿›è¡Œè°ƒç”¨æ“ä½œï¼ŒåŒæ—¶å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ•°ç»„ä½œä¸ºè°ƒç”¨å‚æ•°ã€‚å’Œ <code>Function.prototype.apply()</code> åŠŸèƒ½ç±»ä¼¼ã€‚</td></tr><tr><td>Reflect.construct(target, argumentsList[, newTarget])</td><td>å¯¹æ„é€ å‡½æ•°è¿›è¡Œ <code>new</code>æ“ä½œï¼Œç›¸å½“äºæ‰§è¡Œ <code>new target(...args)</code></td></tr><tr><td>Reflect.defineProperty(target, propertyKey, attributes)</td><td>å’Œ <code>Object.defineProperty()</code> ç±»ä¼¼ã€‚å¦‚æœè®¾ç½®æˆåŠŸå°±ä¼šè¿”å› <code>true</code></td></tr><tr><td>Reflect.deleteProperty(target, propertyKey)</td><td>ä½œä¸ºå‡½æ•°çš„<code>delete</code>æ“ä½œç¬¦ï¼Œç›¸å½“äºæ‰§è¡Œ <code>delete target[name]</code></td></tr><tr><td>Reflect.get(target, propertyKey[, receiver])</td><td>è·å–å¯¹è±¡èº«ä¸ŠæŸä¸ªå±æ€§çš„å€¼ï¼Œç±»ä¼¼äº <code>target[name]</code>ã€‚</td></tr><tr><td>Reflect.getOwnPropertyDescriptor(target, propertyKey)</td><td>ç±»ä¼¼äº <code>Object.getOwnPropertyDescriptor()</code>å¦‚æœå¯¹è±¡ä¸­å­˜åœ¨è¯¥å±æ€§ï¼Œåˆ™è¿”å›å¯¹åº”çš„å±æ€§æè¿°ç¬¦ï¼Œå¦åˆ™è¿”å› <code>undefined</code>ã€‚</td></tr><tr><td>Reflect.getPrototypeOf(target)</td><td>ç±»ä¼¼äº <code>Object.getPrototypeOf()</code></td></tr><tr><td>Reflect.has(target, propertyKey)</td><td>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜åœ¨æŸä¸ªå±æ€§ï¼Œå’Œ <code>in</code> è¿ç®—ç¬¦ çš„åŠŸèƒ½å®Œå…¨ç›¸åŒ</td></tr><tr><td>Reflect.isExtensible(target)</td><td>ç±»ä¼¼äº <code>Object.isExtensible()</code>.</td></tr><tr><td>Reflect.ownKeys(target)</td><td>è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰è‡ªèº«å±æ€§ï¼ˆä¸åŒ…å«ç»§æ‰¿å±æ€§ï¼‰çš„æ•°ç»„ã€‚(ç±»ä¼¼äº <code>Object.keys()</code>, ä½†ä¸ä¼šå—<code>enumerable</code> å½±å“).</td></tr><tr><td>Reflect.preventExtensions(target)</td><td>ç±»ä¼¼äº <code>Object.preventExtensions()</code>è¿”å›ä¸€ä¸ª<code>Boolean</code></td></tr><tr><td>Reflect.set(target, propertyKey, value[, receiver])</td><td>å°†å€¼åˆ†é…ç»™å±æ€§çš„å‡½æ•°ã€‚è¿”å›ä¸€ä¸ª<code>Boolean</code>ï¼Œå¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™è¿”å›<code>true</code>ã€‚</td></tr><tr><td>Reflect.setPrototypeOf(target, prototype)</td><td>è®¾ç½®å¯¹è±¡åŸå‹çš„å‡½æ•°ã€‚è¿”å›ä¸€ä¸ª <code>Boolean</code>ï¼Œå¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™è¿”å› <code>true</code>ã€‚</td></tr></tbody></table><p>æ‚‰å¿ƒè§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œè¿™ä¸Šæ–¹çš„æ‰€æœ‰å±æ€§ï¼Œéƒ½æ¥è‡ª<code>Object</code>ï¼Œé‚£ä¹ˆå°±æœ‰é—®é¢˜äº†ï¼Œä¸ºä»€ä¹ˆ<code>Object</code>ä¸Šæœ‰çš„å±æ€§ï¼Œè¿˜è¦å•æ‹¿å‡ºæ¥å‘¢ï¼Ÿ</p><h3 id="2-2-ä¸ºä»€ä¹ˆè¦ç”¨Reflectï¼ŒObjectä¸å¥½å—ï¼ŸğŸ˜Ÿ"><a href="#2-2-ä¸ºä»€ä¹ˆè¦ç”¨Reflectï¼ŒObjectä¸å¥½å—ï¼ŸğŸ˜Ÿ" class="headerlink" title="2.2 ä¸ºä»€ä¹ˆè¦ç”¨Reflectï¼ŒObjectä¸å¥½å—ï¼ŸğŸ˜Ÿ"></a>2.2 ä¸ºä»€ä¹ˆè¦ç”¨<code>Reflect</code>ï¼Œ<code>Object</code>ä¸å¥½å—ï¼ŸğŸ˜Ÿ</h3><p>è¿™å°±åˆè¦æåˆ°<code>js</code>ç‹¬æœ‰çš„æŠ½è±¡äº†ğŸ¤ª</p><p>è¦çŸ¥é“<code>js</code>å¯æ˜¯ä¸€é—¨èŠ±äº†æ•´æ•´<em><strong>10å¤©</strong></em>æ‰è¯ç”Ÿçš„è¯­è¨€ğŸ¤¡ï¼Œé‚£ä¹Ÿéš¾å…ä¼šæœ‰æŠ½è±¡çš„äº‹æƒ…å‘ç”Ÿ</p><blockquote><p>ç‚¹åæ‰¹è¯„<code>undefined</code>ä»¥åŠ<code>arguments</code>ğŸ˜“ï¼Œä¸€ä¸ªBYDä¸æ˜¯å…³é”®å­—ï¼Œä¸€ä¸ªä¼ è¿›å»äº†è¿˜èƒ½æ”¹ï¼Œå±äºæ˜¯æŠ½è±¡å·…å³°äº†ğŸ¤ª</p></blockquote><p><code>Object</code>ä¹Ÿä¸ä¾‹å¤–ï¼Œæœ‰äº›æ–¹æ³•ä¼šæœ‰<em><strong>å±€é™æ€§</strong></em>ä»¥åŠ<em><strong>ä¸æ ‡å‡†å®ç°ä¸ä¸€è‡´çš„åœ°æ–¹</strong></em> </p><blockquote><p>ä¾‹å¦‚ï¼Œ <code>Object.defineProperty()</code> ç”¨äºå®šä¹‰ä¸€ä¸ªæ–°çš„å±æ€§ï¼Œåœ¨æˆåŠŸæ—¶è¿”å› <code>true</code>ï¼Œä½†åœ¨å¤±è´¥æ—¶ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚æˆåŠŸå¤±è´¥è¿”å›ç±»å‹ä¸ä¸€è‡´ï¼Œè€Œä¸”è¿˜ä¼šæŠ¥é”™ï¼Œè¿™å¾ˆä»¤äººæ¼ç«ğŸ˜¡</p></blockquote><p>é‚£å’‹åŠå‘¢ï¼Ÿ</p><p>ECMAé€‰æ‹©äº†å’Œè§£å†³ä¸Šé¢çš„<code>arguments</code>bugä¸€æ ·çš„è§£å†³æ–¹æ³•â€”â€”å†å†™ä¸€å¥—ä¸å°±å®Œäº†ï¼Ÿï¼Ÿï¼ŸğŸ¤£</p><p>äºæ˜¯å°±æœ‰äº†å’±ä»¬çš„<code>Reflect</code></p><p>å…¶å®è¿˜æœ‰ä¸€ä¸ªæ›´é‡è¦çš„åŸå› ï¼Œä¹Ÿæ˜¯æˆ‘æŠŠ<code>Reflect</code>å’Œ<code>Proxy</code>æ”¾ä¸€èµ·è®²çš„ç†ç”±ï¼š <em><strong><code>Proxy</code> å¤„ç†ç¨‹åºçš„æ–¹æ³•ä¸ <code>Reflect</code> çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œè¿™æ„å‘³ç€å¯ä»¥åœ¨ <code>Proxy</code> çš„æ‹¦æˆªå™¨å‡½æ•°ä¸­ç›´æ¥ä½¿ç”¨ <code>Reflect</code> çš„æ–¹æ³•ã€‚è¿™ä½¿å¾—åœ¨åˆ›å»ºå¤æ‚çš„ä»£ç†è¡Œä¸ºæ—¶ï¼Œèƒ½å¤Ÿè½»æ¾åœ°ç»´æŠ¤é»˜è®¤è¡Œä¸ºï¼ŒåŒæ—¶æ·»åŠ æˆ–ä¿®æ”¹æŸäº›ç‰¹å®šçš„è¡Œä¸ºã€‚</strong></em></p><h2 id="3-æ€»ç»“ğŸ¤©"><a href="#3-æ€»ç»“ğŸ¤©" class="headerlink" title="3. æ€»ç»“ğŸ¤©"></a>3. æ€»ç»“ğŸ¤©</h2><p><code>proxy</code>å’Œ<code>reflect</code>éƒ½æ˜¯å¾ˆå¼ºå¤§çš„å·¥å…·ï¼Œä¸¤è€…ç»“åˆå¯ä»¥è½»æ¾åœ°ç»´æŠ¤é»˜è®¤è¡Œä¸ºï¼ŒåŒæ—¶æ·»åŠ æˆ–ä¿®æ”¹æŸäº›ç‰¹å®šçš„è¡Œä¸ºï¼Œå®ç°æ›´é«˜è‡ªç”±åº¦çš„ç¼–ç¨‹ï¼ŒçœŸçš„å¾ˆé…·å¥½å—ğŸ˜</p><p>å¦‚æœæƒ³ç»§ç»­æ·±å…¥äº†è§£ <code>Reflect</code>ä»¥åŠ<code>Proxy</code>ï¼Œ å¯ä»¥å»MDNä¸Šé€›é€›ï¼š</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">Reflect</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy">Proxy</a></p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Service Worker</title>
    <link href="/2023/12/01/serviceWorker/"/>
    <url>/2023/12/01/serviceWorker/</url>
    
    <content type="html"><![CDATA[<h1 id="Service-WorkerğŸ³"><a href="#Service-WorkerğŸ³" class="headerlink" title="Service WorkerğŸ³"></a>Service WorkerğŸ³</h1><blockquote><p><code> Web Worker</code>å¤§å®¶å·²ç»å¾ˆç†Ÿæ‚‰äº†å§ï¼Œé‚£æˆ‘ä»Šå¤©æ¥è®²è®²å®ƒçš„å¥½å…„å¼Ÿ <code>Service Worker</code>ã€‚</p><p>å“¥ä»¬ä¹Ÿæ˜¯æœ€è¿‘ä¸¤å¤©æ‰çŸ¥é“è¿™ä¸ªç©æ„ï¼Œè¿™å‡ å¤©ç©ä¸‹æ¥æ„Ÿè§‰è¿™ç©æ„è¦æ¯” <code>Web Worker</code> å®ç”¨ä¸€ä¸‡å€</p></blockquote><h2 id="1-å•¥æ˜¯Service-Worker-ğŸ‘¹"><a href="#1-å•¥æ˜¯Service-Worker-ğŸ‘¹" class="headerlink" title="1. å•¥æ˜¯Service Worker?ğŸ‘¹"></a>1. å•¥æ˜¯<code>Service Worker</code>?ğŸ‘¹</h2><blockquote><p>ä»¥ä¸‹å†…å®¹æ¥è‡ª<code>MDN</code>: </p><ul><li>Service worker æœ¬è´¨ä¸Šå……å½“ Web åº”ç”¨ç¨‹åºã€æµè§ˆå™¨ä¸ç½‘ç»œï¼ˆå¯ç”¨æ—¶ï¼‰ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ã€‚è¿™ä¸ª API æ—¨åœ¨åˆ›å»ºæœ‰æ•ˆçš„ç¦»çº¿ä½“éªŒï¼Œå®ƒä¼š **æ‹¦æˆªç½‘ç»œè¯·æ±‚ **å¹¶æ ¹æ®ç½‘ç»œæ˜¯å¦å¯ç”¨æ¥é‡‡å–é€‚å½“çš„åŠ¨ä½œã€æ›´æ–°æ¥è‡ªæœåŠ¡å™¨çš„çš„èµ„æºã€‚å®ƒè¿˜æä¾›å…¥å£ä»¥æ¨é€é€šçŸ¥å’Œè®¿é—®åå°åŒæ­¥ APIã€‚</li></ul></blockquote><p>è¯´äº†è¿™ä¹ˆä¸€å¤§å †ï¼Œä¸ªäººè§‰å¾—æœ€æ ¸å¿ƒçš„è¿˜æ˜¯: <code>æ‹¦æˆªç½‘ç»œè¯·æ±‚</code>ğŸ˜¶â€ğŸŒ«ï¸ã€‚</p><p>å¦‚æœå¤§å®¶ç”¨è¿‡<code>axios</code>çš„<code>interceptor</code>ï¼Œé‚£ä¼šæ„Ÿè§‰è¿™ä¿©ç©æ„æ˜¯å‡ºå¥‡çš„ç›¸ä¼¼ğŸ™Šï¼Œï¼ˆè€Œä¸”å¥½åƒçœŸèƒ½ç”¨<code>ServiceWorker</code>æ¨¡æ‹Ÿ<code>interceptor</code>?è™½ç„¶å¾ˆé‚ªé—¨å°±æ˜¯äº†ï¼‰</p><h2 id="2-ä¼šæ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼ŸğŸ¦„"><a href="#2-ä¼šæ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼ŸğŸ¦„" class="headerlink" title="2.ä¼šæ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼ŸğŸ¦„"></a>2.ä¼šæ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼ŸğŸ¦„</h2><ul><li><strong>è¯·æ±‚å°è£…</strong>ï¼šé¦–å…ˆï¼Œæ­£å¦‚ä¸Šé¢æ‰€è¯´çš„ï¼Œå®ƒå¯ä»¥åƒ<code>interceptor</code>ä¸€æ ·å·¥ä½œï¼Œé‚£å°±å¯ä»¥ç»™å’±ä»¬æ¯ä¸ªè¯·æ±‚éƒ½è‡ªåŠ¨çš„åŠ ä¸Š<code>token</code>ä¹‹ç±»çš„ï¼Œè™½ç„¶å…¶ä»–æ–¹æ³•ä¹Ÿèƒ½åšï¼Œä½†è¿™æ ·çœŸçš„å¾ˆé…·ğŸ˜,å½“ç„¶ï¼Œè¿™ä¹Ÿä¸æ˜¯äººå®¶çš„ä¸»è¦ä¸šåŠ¡</li><li><strong>æ‹¦æˆªç½‘ç»œè¯·æ±‚</strong>ï¼šå½“æ²¡æœ‰ç½‘æˆ–è€…ç½‘ç»œå¾ˆå·®çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©<strong>ä¸å‘é€ç½‘è·¯è¯·æ±‚ï¼Œç›´æ¥é‡‡ç”¨ç¼“å­˜å†…å®¹</strong>ï¼Œä¿è¯ç”¨æˆ·çœ‹åˆ°çš„ä¸æ˜¯ä¸€ç‰‡æƒ¨ç™½æˆ–è€…æ˜¯åªå°æé¾™ğŸ¦–</li><li><strong>å¯¼èˆªé¢„åŠ è½½</strong>ï¼šå½“ç”¨æˆ·é€‰æ‹©è·³è½¬é¡µé¢çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å®ƒç‡å…ˆ<code>preLoad</code>ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œæˆ–è€…ç›´æ¥é‡‡ç”¨é¢„è®¾å¥½çš„é¡µé¢ï¼Œè¿™æœ‰ä¸ªå“äº®çš„åå­—ï¼š <strong>å¯¼èˆªé¢„åŠ è½½</strong></li><li><strong>æ¨é€é€šçŸ¥</strong>ï¼š<code>Service Worker</code> èƒ½å¤Ÿæ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¨é€é€šçŸ¥ï¼Œå¹¶åœ¨åº”ç”¨ä¸åœ¨å‰å°è¿è¡Œæ—¶å‘ç”¨æˆ·æ˜¾ç¤ºè¿™äº›é€šçŸ¥ã€‚è¿™å¯¹äºä¿æŒç”¨æˆ·å‚ä¸åº¦å’ŒåŠæ—¶ä¼ é€’ä¿¡æ¯éå¸¸æœ‰ç”¨ã€‚ï¼ˆæœ‰<code>api</code>ï¼‰</li><li><strong>ç½‘ç»œè¯·æ±‚ä»£ç†</strong>ï¼š<code>Service Worker </code> å¯ä»¥ä»£ç†ç½‘ç»œè¯·æ±‚ï¼Œå®ç°å¦‚æ•°æ®å‹ç¼©ã€å›¾ç‰‡ä¼˜åŒ–ã€å®‰å…¨ç­–ç•¥åŠ å¼ºç­‰åŠŸèƒ½ã€‚</li></ul><h2 id="3-Service-Workerå·¥ä½œæµç¨‹ğŸ‘»"><a href="#3-Service-Workerå·¥ä½œæµç¨‹ğŸ‘»" class="headerlink" title="3. Service Workerå·¥ä½œæµç¨‹ğŸ‘»"></a>3. Service Workerå·¥ä½œæµç¨‹ğŸ‘»</h2><ol><li>è·å– service worker ä»£ç ï¼Œç„¶åä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerContainer/register"><code>serviceWorkerContainer.register()</code></a> æ¥æ³¨å†Œã€‚å¦‚æœæˆåŠŸï¼Œservice worker å°†åœ¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerGlobalScope"><code>ServiceWorkerGlobalScope</code></a> ä¸­æ‰§è¡Œï¼›è¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¸Šä¸‹æ–‡ï¼Œåœ¨ä¸»è„šæœ¬æ‰§è¡Œçº¿ç¨‹ä¹‹å¤–è¿è¡Œï¼Œæ²¡æœ‰è®¿é—® DOM çš„æƒé™ã€‚Service Worker ç°åœ¨å·²ä¸ºå¤„ç†äº‹ä»¶åšå¥½å‡†å¤‡ã€‚</li><li>å®‰è£…å®Œæˆã€‚<code>install</code> äº‹ä»¶å§‹ç»ˆæ˜¯å‘é€ç»™ service worker çš„ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼ˆè¿™å¯ç”¨äºå¯åŠ¨å¡«å…… IndexedDB å’Œç¼“å­˜ç«™ç‚¹èµ„æºçš„è¿‡ç¨‹ï¼‰ã€‚åœ¨æ­¤æ­¥éª¤æœŸé—´ï¼Œåº”ç”¨ç¨‹åºæ­£åœ¨ä¸ºç¦»çº¿å¯ç”¨åšå‡†å¤‡ã€‚</li><li>å½“ <code>install</code> ç¨‹åºå¤„ç†å®Œæˆæ—¶ï¼Œservice worker è¢«è§†ä¸ºå·²å®‰è£…ã€‚æ­¤æ—¶ï¼Œservice worker çš„å…ˆå‰ç‰ˆæœ¬å¯èƒ½å¤„äºæ¿€æ´»çš„çŠ¶æ€å¹¶æ§åˆ¶ç€æ‰“å¼€çš„é¡µé¢ã€‚ç”±äºæˆ‘ä»¬ä¸å¸Œæœ›åŒä¸€ service worker çš„ä¸¤ä¸ªä¸åŒç‰ˆæœ¬åŒæ—¶è¿è¡Œï¼Œå› æ­¤æ–°ç‰ˆæœ¬å°šæœªæ¿€æ´»ã€‚</li><li>ä¸€æ—¦ service worker çš„æ—§ç‰ˆæœ¬æ§åˆ¶çš„é¡µé¢éƒ½å·²å…³é—­ï¼Œå°±å¯ä»¥å®‰å…¨åœ°åœç”¨æ—§ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ–°å®‰è£…çš„ service worker å°†æ”¶åˆ° <code>activate</code> äº‹ä»¶ã€‚<code>activate</code> çš„ä¸»è¦ç”¨é€”æ˜¯å»æ¸…ç† service worker ä¹‹å‰ç‰ˆæœ¬ä½¿ç”¨çš„èµ„æºã€‚æ–°çš„ service worker å¯ä»¥è°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerGlobalScope/skipWaiting"><code>skipWaiting()</code></a> è¦æ±‚ç«‹å³æ¿€æ´»ï¼Œè€Œæ— éœ€è¦æ±‚æ‰“å¼€çš„é¡µé¢å…³é—­ã€‚ç„¶åï¼Œæ–°çš„ service worker å°†ç«‹å³æ”¶åˆ° <code>activate</code> äº‹ä»¶ï¼Œå¹¶å°†æ¥ç®¡ä»»ä½•æ‰“å¼€çš„é¡µé¢ã€‚</li><li>æ¿€æ´»åï¼Œservice worker å°†ç«‹å³æ§åˆ¶é¡µé¢ï¼Œä½†æ˜¯åªä¼šæ§åˆ¶é‚£äº›åœ¨ <code>register()</code> æˆåŠŸåæ‰“å¼€çš„é¡µé¢ã€‚æ¢å¥è¯è¯´ï¼Œæ–‡æ¡£å¿…é¡»é‡æ–°åŠ è½½æ‰èƒ½çœŸæ­£çš„å—åˆ°æ§åˆ¶ï¼Œå› ä¸ºæ–‡æ¡£åœ¨æœ‰æˆ–è€…æ²¡æœ‰ service worker çš„æƒ…å†µä¸‹å¼€å§‹å­˜åœ¨ï¼Œå¹¶åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…ç»´æŠ¤å®ƒã€‚ä¸ºäº†è¦†ç›–æ¬¡é»˜è®¤è¡Œä¸ºå¹¶åœ¨é¡µé¢æ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œservice worker å¯ä»¥è°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Clients/claim"><code>clients.claim()</code></a> æ–¹æ³•ã€‚</li><li>æ¯å½“è·å–æ–°ç‰ˆæœ¬çš„ service worker æ—¶ï¼Œéƒ½ä¼šå†æ¬¡å‘ç”Ÿæ­¤å¾ªç¯ï¼Œå¹¶åœ¨æ–°ç‰ˆæœ¬çš„æ¿€æ´»æœŸé—´æ¸…ç†ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ®‹ç•™ã€‚</li></ol><blockquote><p>åŒä¸€ä¸ªworkerçš„ä¸åŒç‰ˆæœ¬:</p><p>è¿™ä¸èƒ½è¯´æ˜¯<code>Service Worker</code>çš„ç‰¹æ€§ï¼Œåè€Œæ˜¯<code>Cache</code>çš„ç‰¹æ€§ã€‚ ä¸‹é¢ä¼šè®²åˆ°ï¼Œ <code>Cache</code>æ˜¯<code>Service Worker</code>çš„å¥½å“¥ä»¬ï¼Œ<code>Cache</code>å¯ä»¥ç”¨<code>Open(version)</code>æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ç¼“å­˜ï¼Œè€Œ<code>Service Worker</code>ä¹Ÿä¼šæ ¹æ®è¿™ä¸ªè¡ç”Ÿå‡ºä¸åŒç‰ˆæœ¬ï¼Œè€Œæˆ‘ä»¬ä¸æƒ³è¦å¤šä¸ªç‰ˆæœ¬çš„ worker åŒæ—¶å­˜åœ¨ï¼Œå› æ­¤ <code>worker</code> çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ¯”è¾ƒç‰¹åˆ« ğŸ¤¯</p></blockquote><h2 id="4-æ¥çœ‹çœ‹å¦‚ä½•ç”¨å®ƒæå‡ç”¨æˆ·ä½“éªŒå§ğŸ¤£"><a href="#4-æ¥çœ‹çœ‹å¦‚ä½•ç”¨å®ƒæå‡ç”¨æˆ·ä½“éªŒå§ğŸ¤£" class="headerlink" title="4. æ¥çœ‹çœ‹å¦‚ä½•ç”¨å®ƒæå‡ç”¨æˆ·ä½“éªŒå§ğŸ¤£"></a>4. æ¥çœ‹çœ‹å¦‚ä½•ç”¨å®ƒæå‡ç”¨æˆ·ä½“éªŒå§ğŸ¤£</h2><blockquote><p>å…¶å®ä¸»è¦ä¹Ÿå°±ä¸€ç‚¹ï¼š</p><ul><li>å½“ç¼“å­˜é‡Œæœ‰æ•°æ®æ—¶ï¼Œä¸åº”è¯¥å†æ¬¡è¯·æ±‚ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ç¼“å­˜å†…å®¹ï¼ŒåŠ å¿«é¡µé¢å“åº”é€Ÿåº¦</li></ul></blockquote><p>è€Œæåˆ°ç¼“å­˜ï¼Œå¤§å®¶é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä»€ä¹ˆï¼Ÿå¯èƒ½æ˜¯<code>indexDB</code>,ä¹Ÿå¯èƒ½æ˜¯<code>localStorage</code>,ä½†æ˜¯<code>Service Worker</code>ç”¨çš„æ˜¯å¦ä¸€ç§å«åš<code>cache</code>çš„ç¼“å­˜</p><blockquote><p><code>Cache</code>:</p><p><code>cache</code>æ˜¯<code>web api</code>çš„ä¸€éƒ¨åˆ†ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥åœ¨<code>Service Worker</code>å¤–ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒçš„ä¸»è¦ä¼˜åŠ¿è¿˜æ˜¯ç¼“å­˜é‡è¦èµ„æºï¼Œæ¯”å¦‚å›¾ç‰‡ã€æ–‡ä»¶ï¼Œå› æ­¤ç»å¸¸å’Œ<code>Service Worker</code>æˆå¯¹å‡ºç°ï¼Œæˆ–è€…è¯´ï¼Œå°±æ˜¯ä¸º<code>Service Worker</code>é‡èº«æ‰“é€ çš„apiã€‚</p><p>å…³äº<code>cache</code>ï¼Œè¿™é‡Œä¸å†è¿‡å¤šä»‹ç»ï¼Œå¯ä»¥å»ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Cache">cacheè¯¦è§£</a> çœ‹çœ‹</p></blockquote><p>å¥½ï¼Œè¯ä¸å¤šè¯´ï¼Œå’±ä»¬å¼€å¹²ï¼â›½</p><hr><p>å“¥ä»¬çš„æ–‡ä»¶ç›®å½•ï¼ˆå¿½ç•¥webworkerï¼‰ï¼š</p><p><img src="https://s2.loli.net/2023/12/01/cBsw52A3C8n7yiQ.png" alt="æ–‡ä»¶ç›®å½•"></p><ol><li><p>è·Ÿ<code>Web Worker</code>ä¸€æ ·ï¼Œéƒ½å¾—åœ¨<code>ä¸»js</code>ä¸­æ³¨å†Œ<code>worker</code>ï¼ŒåŒæ ·çš„ï¼Œå®ƒä¹Ÿæœ‰<code>messageChannel</code>ï¼Œç”¨äºå’Œä¸»çº¿ç¨‹é€šä¿¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">registerServiceWorker</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;serviceWorker&quot;</span> <span class="hljs-keyword">in</span> navigator) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> serviceWorkerRegistration = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">&quot;../serviceWorker.js&quot;</span>, &#123;<br>                <span class="hljs-attr">scope</span>: <span class="hljs-string">&quot;/webworker/public/&quot;</span><br>            &#125;);<br>            <span class="hljs-keyword">const</span> statusGroup = [<span class="hljs-string">&quot;installing&quot;</span>, <span class="hljs-string">&quot;waiting&quot;</span>, <span class="hljs-string">&quot;active&quot;</span>];<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">group</span>(<span class="hljs-string">&quot;status&quot;</span>)<br>            statusGroup.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>                serviceWorkerRegistration[item] &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item);<br>            &#125;)<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">groupEnd</span>()<br>        &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`registration failed: <span class="hljs-subst">$&#123;err&#125;</span>`</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;service worker is forbidden&quot;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-title function_">registerServiceWorker</span>();<br></code></pre></td></tr></table></figure><blockquote><p>å“¦å¯¹äº†ï¼Œå®ƒå’Œ<code>Web Worker</code>å¾ˆå¤§çš„ä¸åŒå°±æ˜¯å®ƒæ²¡å¾—è‡ªå·±çš„æ„é€ å‡½æ•°ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæŒ‚è½½åœ¨<code>navigation</code>ä¸‹é¢çš„å°ç‰¹æ€§ğŸ¤è€Œä¸”åªæœ‰<code>https</code>æˆ–è€…<code>localhost</code>æ‰èƒ½ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒå®åœ¨å¼ºçš„æœ‰ç‚¹ç¦»è°±.å› æ­¤ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç”¨<code>try</code> <code>catch</code>åŒ…è£¹æ³¨å†Œäº‹ä»¶ï¼Œä¿è¯å³ä½¿ä¸æ˜¯<code>https</code>åè®®ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ç½‘ç«™</p><p>ä¹‹æ‰€ä»¥ä¸ç”¨<code>http</code>æ˜¯å› ä¸ºï¼Œä¸‡ä¸€å“ªå¤©è¿™ç©æ„è¢«åŠ«æŒäº†ï¼Œåæœä¸å ªè®¾æƒ³ğŸ™ˆ</p></blockquote></li><li><p>æ ¹æ®ä½ ä¸Šé¢å¡«çš„è·¯å¾„ï¼Œæä¸ª<code>serviceWorker.js</code>å‡ºæ¥ğŸ˜‡ğŸ˜‡</p><p>æˆ‘å–œæ¬¢æŠŠè¿™ä¸ª<code>serviceWorker.js</code>å½“æˆçº¯çº¯çš„å…¥å£æ–‡ä»¶ï¼Œå½“ç„¶ï¼Œä½ ä»¬è¦å…¨å†™åœ¨è¿™ä¸€ä¸ªæ–‡ä»¶é‡Œä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œä½†æ˜¯é‚£æ ·æˆ‘è§‰å¾—ä¸æ¸…æ™°ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„<code>serviceWorker.js</code>ï¼Œé‡Œé¢ä¸»è¦æ˜¯ç›‘å¬äº‹ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js">importScripts(<span class="hljs-string">&quot;./workers/installServiceWorker.js&quot;</span>)<br>importScripts(<span class="hljs-string">&quot;./workers/cacheServiceWorker.js&quot;</span>)<br><br>self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;install&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    event.<span class="hljs-title function_">waitUntil</span>(<br>        <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<br>            <span class="hljs-title function_">addResourcesToCache</span>([<br>                <span class="hljs-string">&quot;/webworker/public/html/index.html&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/css/index.css&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/js/serviceWorker.js&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/workers/installServiceWorker.js&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/workers/cacheServiceWorker.js&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/assets/3.jpg&quot;</span>,<br>            ]),<br>            self.<span class="hljs-property">registration</span>.<span class="hljs-property">navigationPreload</span>.<span class="hljs-title function_">enable</span>()<br>        ])<br>    );<br>&#125;);<br>self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;fetch&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    event.<span class="hljs-title function_">respondWith</span>(<br>        <span class="hljs-title function_">cacheFirstWithFallback</span>(&#123;<br>            <span class="hljs-attr">request</span>: event.<span class="hljs-property">request</span>,<br>            <span class="hljs-attr">preloadResponsePromise</span>: event.<span class="hljs-property">preloadResponse</span>,<br>            <span class="hljs-attr">fallbackUrl</span>: <span class="hljs-string">&quot;/webworker/public/assets/3.jpg&quot;</span>,<br>        &#125;),<br>    );<br>&#125;);<br></code></pre></td></tr></table></figure><blockquote><p>å¤§å®¶æœ‰ç©ºä¹Ÿå¯ä»¥çœ‹çœ‹ <em>Martin Fowler</em> çš„ <em>é‡æ„ï¼šæ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡</em>(è¶…çº§å¥½çœ‹ğŸ¤ª)ï¼Œå“¥ä»¬çš„è¿™ç§æ–¹å¼ä¹Ÿæ˜¯ä»–çš„è®¾è®¡ç†å¿µ</p></blockquote><blockquote><p><strong><code>Service Worker</code>ä¹Ÿæ˜¯æœ‰ç®¡ç†èŒƒå›´çš„ï¼</strong></p><p><strong>å¯ä»¥é€šè¿‡<code>scope</code>æŒ‡å®šèŒƒå›´</strong>ï¼Œä½†æ˜¯å®ƒçš„èŒƒå›´åªèƒ½æ˜¯è·Ÿè‡ªå·±åŒçº§æˆ–è€…ä¸‹çº§çš„æ–‡ä»¶ï¼Œè‡ªå·±çš„ä¸Šçº§æ–‡ä»¶å°±æä¸åˆ°äº†ï¼Œå› æ­¤æˆ‘ä»¬æŠŠ<code>serviceWorker.js</code>æ”¾åœ¨æ ¹ç›®å½•é‡Œï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç¬¬ä¸€ç‚¹çš„è·¯å¾„æ˜¯â€..&#x2F;serviceWorker.jsâ€</p></blockquote></li><li><p>ç„¶ååˆ›å»ºä¸€ä¸ª<code>installServiceWorker.js</code>ï¼Œç”¨äºå­˜æ”¾è·Ÿ<code>install</code>ç›¸å…³çš„å‡½æ•°å’Œé…ç½®ï¼Œå¤§è‡´å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">addResourcesToCache</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">resources</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;v1&quot;</span>);<br>    <span class="hljs-keyword">await</span> cache.<span class="hljs-title function_">addAll</span>(resources)<br>&#125;<br><br>self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;install&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    event.<span class="hljs-title function_">waitUntil</span>(<br>            <span class="hljs-title function_">addResourcesToCache</span>([<br>                <span class="hljs-string">&quot;/webworker/public/html/index.html&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/css/index.css&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/js/serviceWorker.js&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/workers/installServiceWorker.js&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/workers/cacheServiceWorker.js&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/workers/3.jpg&quot;</span>,<br>            ]),<br>    );<br>&#125;);<br></code></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­<code>cache.addAll</code>æ˜¯<code>Cache</code>çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼Œé€šå¸¸æ˜¯<code>urlæ•°ç»„</code>ï¼Œå¹¶æŠŠå®ƒä»¬å…¨éƒ¨å­˜å‚¨åˆ°<code>cache</code>çš„<code>v1</code>ä¸­</p></blockquote><blockquote><p><code>waitUntil</code>çš„ä½œç”¨æ˜¯<code>Service Worker</code>å¿…é¡»åœ¨è¯¥å‡½æ•°çš„Promiseæ‰§è¡Œå®Œä¹‹åæ‰èƒ½ç»§ç»­ï¼Œæ¥ä¸‹æ¥ä¼šè¯¦ç»†ä»‹ç»ï¼Œéœ¸é“ï¼ï¼</p></blockquote><blockquote><p><strong>è·¯å¾„ä¸€å®šè¦å†™å…¨ï¼</strong>ğŸ™ƒ</p></blockquote><p>åˆ°ç°åœ¨ï¼Œå’±ä»¬å·²ç»å®Œæˆäº†<code>Service Worker</code>çš„æŒ‚è½½å’Œç¼“å­˜çš„ä¸‹è½½äº†,å’±ä»¬å¯ä»¥ç‚¹å¼€æ§åˆ¶å°ï¼Œçœ‹çœ‹<code>application</code>é‡Œçš„<code>ç¼“å­˜ç©ºé—´</code>æˆ–è€…<code>å­˜å‚¨</code>ï¼Œæœ‰æ²¡æœ‰ç¼“å­˜ğŸ¤©</p><p>å¦‚æœé¡ºåˆ©çš„è¯ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ¡ç›®ï¼š</p><p><img src="https://s2.loli.net/2023/12/02/vrYXuh9pIwEiHl7.png" alt="å­˜å‚¨"></p></li><li><p>å­˜å‚¨æå®šäº†ï¼Œé‚£æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è¿ç”¨å­˜å‚¨äº†ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘åœ¨<code>workers</code>ä¸­æ–°å»ºäº†<code>cacheServiceWorker.js</code>æ¥å¤„ç†åˆ©ç”¨ç¼“å­˜ç›¸å…³çš„é€»è¾‘ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">cacheFirst</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">request</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cachedResponse = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">match</span>(request);<br>    <span class="hljs-keyword">if</span>(cachedResponse) &#123;<br>        <span class="hljs-keyword">return</span> cachedResponse<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(request);<br>&#125;<br><br>self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;fetch&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event)<br>    event.<span class="hljs-title function_">respondWith</span>(<br>        <span class="hljs-title function_">cacheFirst</span>(event.<span class="hljs-property">request</span>),<br>    );<br>&#125;);<br></code></pre></td></tr></table></figure><p>é€»è¾‘å¾ˆç®€å•å¯¹å§ï¼Œå°±æ˜¯é¦–å…ˆåœ¨<code>caches</code>ä¸­å¯»æ‰¾æœ‰æ— ç¼“å­˜è¿‡çš„æ¡ç›®ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±è¿”å›<code>fetch(request)</code>çš„ç»“æœ</p><blockquote><p>é¡ºä¾¿æä¸€å˜´ï¼Œ<code>cacheFirst</code>çš„<code>request</code>æ˜¯<code>Request</code>ç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯å’±ä»¬å¹³æ—¶å‘è¯·æ±‚å¸¦çš„å¯¹è±¡ã€‚<code>fetch</code>ä¼šè‡ªåŠ¨æŠŠæˆ‘ä»¬ä¼ çš„å‚æ•°è½¬æ¢æˆè¿™ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¼ ä¸€ä¸ª<code>request</code>ç»™<code>fetch</code>ï¼Œå› æ­¤è¿™é‡Œå¯ä»¥ç›´æ¥<code>fetch(request)</code>ğŸ‘½</p><p>è€Œä¸‹é¢<code>eventListener</code>ä¸­çš„<code>event</code>å±äº<code>FetchEvent</code>å¯¹è±¡ï¼Œ<code>Service Worker</code>å¯¹è±¡ä¸“å±çš„<code>api</code>ï¼Œç»§æ‰¿äº<code>Event</code></p><p>ï¼ˆå¦‚æœå¯¹<code>Event</code>ä¸æ˜¯å¾ˆäº†è§£å¯ä»¥å»çœ‹æˆ‘çš„ä¸Šä¸€ç¯‡ï¼š<a href="https://konodioda727.github.io/2023/11/26/addEventListener1/%EF%BC%89">https://konodioda727.github.io/2023/11/26/addEventListener1/ï¼‰</a></p><p>å®ƒåªåœ¨ç›‘å¬<code>fetch</code>äº‹ä»¶æ—¶ä¼šäº§ç”Ÿï¼Œå®ƒæœ‰ä»¥ä¸‹ä¸‰å¤§ç‰¹æ€§ï¼ˆåŒ…æ‹¬æˆ‘ä»¬ä¸Šé¢è®²çš„<code>waitUntil</code>)ï¼š</p><ul><li><strong>event.request</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª <code>Request</code> å¯¹è±¡ï¼ŒåŒ…å«äº†è¢«æ‹¦æˆªçš„ç½‘ç»œè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚çš„ URLã€è¯·æ±‚å¤´ã€è¯·æ±‚æ–¹æ³•ç­‰ã€‚</li><li>**event.respondWith()**ï¼šè¿™ä¸ªæ–¹æ³•å…è®¸ä½ æä¾›ä¸€ä¸ªç”¨äºç”Ÿæˆå“åº”çš„ Promiseã€‚è¿™æ˜¯æ§åˆ¶ç½‘ç»œå“åº”è¡Œä¸ºçš„å…³é”®æ–¹æ³•ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥è¿”å›ç¼“å­˜ä¸­çš„å“åº”ã€ç”Ÿæˆä¸€ä¸ªæ–°çš„å“åº”æˆ–è€…ç›´æ¥è°ƒç”¨ <code>fetch</code> æ¥è·å–ç½‘ç»œä¸Šçš„èµ„æºã€‚</li><li>**event.waitUntil()**ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºå»¶é•¿äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚å®ƒå¯¹äºæ‰§è¡Œä¸€äº›é¢å¤–çš„å¼‚æ­¥å¤„ç†ï¼ˆå¦‚ç¼“å­˜æ›´æ–°ï¼‰å¾ˆæœ‰ç”¨ã€‚</li></ul></blockquote><p>é‚£æ¥è¯•è¯•çœ‹æ˜¯ä»€ä¹ˆæ•ˆæœå˜ï¼Œ<strong>åˆ·æ–°é¡µé¢</strong>ï¼Œæ‰“å¼€æ§åˆ¶å°-&gt;ç½‘ç»œï¼Œçœ‹åˆ°å¦‚ä¸‹çº¢æ¡†ä¸­çš„<code>(Service Worker)</code>å°±ç®—æˆåŠŸå•¦ï¼</p><p><img src="https://s2.loli.net/2023/12/02/wruMQzWOVN69Dpv.png" alt="ç½‘ç»œ"></p></li><li><p>è¿™æ ·å·²ç»åˆå…·äººå½¢å•¦ğŸ¤«ï¼Œä½†æ˜¯å®é™…ä¸­è¿˜æœ‰è®¸å¤šå¼‚æ­¥åŠ è½½çš„åœºæ™¯ï¼Œæˆ‘ä»¬è¦å¼‚æ­¥åŠ è½½ä¹Ÿèƒ½ç¼“å­˜ä¸‹æ¥ï¼Œé‚£å°±å¾—ä½¿ç”¨æ›´å¤æ‚çš„ç­–ç•¥ï¼Œæˆ‘ä»¬<strong>ä¸ä»…å¯ä»¥ä»ç½‘ç»œä¸­è¯·æ±‚èµ„æºï¼Œè¿˜å¯ä»¥å°†å…¶ä¿å­˜åˆ°ç¼“å­˜ä¸­</strong>ï¼Œä»¥ä¾¿ç¨åå¯¹è¯¥èµ„æºçš„è¯·æ±‚ä¹Ÿå¯ä»¥ç¦»çº¿æ£€ç´¢ğŸ™€,åšæ³•å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå°±åœ¨å’±ä»¬åˆšæ‰çš„åŸºç¡€ä¸Š<strong>è®©ç»è¿‡è¯·æ±‚å¾—åˆ°çš„èµ„æºä¹Ÿå­˜å…¥<code>Cache</code>ä¸­å³å¯</strong>ï¼Œä¸ºæ­¤ï¼Œæˆ‘æ–°åŠ äº†<code>putInCache</code>å‡½æ•°ï¼Œå¹¶å¯¹<code>cacheFirst</code>å‡½æ•°ç¨åŠ ä¿®æ”¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">putInCache</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">request, response</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;v1&quot;</span>);<br>    <span class="hljs-keyword">await</span> cache.<span class="hljs-title function_">put</span>(request, response);<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">cacheFirst</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">request</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cachedResponse = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">match</span>(request);<br>    <span class="hljs-keyword">if</span>(cachedResponse) &#123;<br>        <span class="hljs-keyword">return</span> cachedResponse<br>    &#125;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title class_">NetworkResponse</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(request);<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">putInCache</span>(request, <span class="hljs-title class_">NetworkResponse</span>.<span class="hljs-title function_">clone</span>());<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NetworkResponse</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç°åœ¨å·²ç»éå¸¸ä¸é”™å•¦ğŸ‘¾ï¼Œä½†è¿˜éœ€è¦æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š <strong>æ²¡ç½‘æ€ä¹ˆåŠï¼Ÿ</strong>ï¼Œåˆå¬å¯èƒ½ä¼šè§‰å¾—å¾ˆæ¼ç«ğŸ˜¡ï¼Œæµè§ˆå™¨æ²¡ç½‘æ€ä¹ˆç©ï¼Ÿä½†æ˜¯è¿™ä¹Ÿæ˜¯<code>Service Worker</code>å­˜åœ¨çš„åŸå› ä¹‹ä¸€ï¼Œä¸ºäº†èƒ½è®©ç”¨æˆ·åœ¨æ²¡ç½‘çš„æ—¶å€™ä¹Ÿæœ‰ç‚¹ä¸œè¥¿çœ‹ï¼Œæˆ‘ä»¬å°±åªèƒ½å†æ¬¡æ‰“ç£¨<code>cacheFirst</code>å‡½æ•°ï¼Œè®©å®ƒåœ¨è¯·æ±‚å¤±è´¥çš„æ—¶å€™ï¼Œä¹Ÿèƒ½æœ‰ä¸€ä¸ª<code>fallback</code>å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">cacheFirst</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">&#123; request, fallbackUrl &#125;</span>) =&gt; &#123;<br>  <span class="hljs-comment">// é¦–å…ˆï¼Œå°è¯•ä»ç¼“å­˜ä¸­è·å–èµ„æº</span><br>  <span class="hljs-keyword">const</span> responseFromCache = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">match</span>(request);<br>  <span class="hljs-keyword">if</span> (responseFromCache) &#123;<br>    <span class="hljs-keyword">return</span> responseFromCache;<br>  &#125;<br><br>  <span class="hljs-comment">// ç„¶åå°è¯•ä»ç½‘ç»œä¸­è·å–èµ„æº</span><br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> responseFromNetwork = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(request);<br>    <span class="hljs-comment">// å“åº”å¯èƒ½ä¼šè¢«ä½¿ç”¨</span><br>    <span class="hljs-comment">// æˆ‘ä»¬éœ€è¦å°†å®ƒçš„æ‹·è´æ”¾å…¥ç¼“å­˜</span><br>    <span class="hljs-comment">// ç„¶åå†è¿”å›è¯¥å“åº”</span><br>    <span class="hljs-title function_">putInCache</span>(request, responseFromNetwork.<span class="hljs-title function_">clone</span>());<br>    <span class="hljs-keyword">return</span> responseFromNetwork;<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-keyword">const</span> fallbackResponse = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">match</span>(fallbackUrl);<br>    <span class="hljs-keyword">if</span> (fallbackResponse) &#123;<br>      <span class="hljs-keyword">return</span> fallbackResponse;<br>    &#125;<br>    <span class="hljs-comment">// å½“å›è½çš„å“åº”ä¹Ÿä¸å¯ç”¨æ—¶ï¼Œ</span><br>    <span class="hljs-comment">// æˆ‘ä»¬ä¾¿æ— èƒ½ä¸ºåŠ›äº†ï¼Œä½†æˆ‘ä»¬å§‹ç»ˆéœ€è¦</span><br>    <span class="hljs-comment">// è¿”å› Response å¯¹è±¡</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">&quot;Network error happened&quot;</span>, &#123;<br>      <span class="hljs-attr">status</span>: <span class="hljs-number">408</span>,<br>      <span class="hljs-attr">headers</span>: &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/plain&quot;</span> &#125;,<br>    &#125;);<br>  &#125;<br>&#125;;<br><br>self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;fetch&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  event.<span class="hljs-title function_">respondWith</span>(<br>    <span class="hljs-title function_">cacheFirst</span>(&#123;<br>      <span class="hljs-attr">request</span>: event.<span class="hljs-property">request</span>,<br>      <span class="hljs-attr">fallbackUrl</span>: <span class="hljs-string">&quot;/webworker/public/assets/3.jpg&quot;</span>,<br>    &#125;),<br>  );<br>&#125;);<br></code></pre></td></tr></table></figure><p>å¥½äº†ï¼Œè¿™ä¸‹å½»åº•åœ†æ»¡äº†ğŸ¤£ï¼Œå½“æˆ‘ä»¬æ‰“å¼€æ§åˆ¶å°ï¼Œå…³é—­ç½‘ç»œæ—¶ï¼Œç°åœ¨ä¹Ÿä¸ä¼šæœ‰å¤ªå¤šçš„å˜åŒ–ï¼Œæˆ‘ä»¬çš„ç›®çš„ä¹Ÿå°±è¾¾åˆ°äº†ï¼Œå½“ç„¶ï¼Œå®é™…è¿‡ç¨‹ä¸­è‚¯å®šè¿˜è¦ä¸ºä¸åŒæƒ…å†µæä¸åŒçš„<code>fallback</code>ï¼Œä½†è¿™é‡Œæ„æ€æ„æ€å°±å·®ä¸å¤šäº†ğŸ’©</p></li></ol><h2 id="5-å¯¼èˆªé¢„åŠ è½½ğŸ¥¸"><a href="#5-å¯¼èˆªé¢„åŠ è½½ğŸ¥¸" class="headerlink" title="5. å¯¼èˆªé¢„åŠ è½½ğŸ¥¸"></a>5. å¯¼èˆªé¢„åŠ è½½ğŸ¥¸</h2><p>å¦‚æœå¯ç”¨äº†<strong>å¯¼èˆªé¢„åŠ è½½</strong>åŠŸèƒ½ï¼Œå…¶å°†åœ¨å‘å‡º fetch è¯·æ±‚åï¼Œç«‹å³å¼€å§‹ä¸‹è½½èµ„æºï¼Œå¹¶åŒæ—¶æ¿€æ´» service workerã€‚<strong>è¿™ç¡®ä¿äº†åœ¨å¯¼èˆªåˆ°ä¸€ä¸ªé¡µé¢æ—¶ï¼Œç«‹å³å¼€å§‹ä¸‹è½½ï¼Œè€Œä¸æ˜¯ç­‰åˆ° service worker è¢«æ¿€æ´»ã€‚</strong></p><blockquote><p>å½“ç”¨æˆ·å¯¼èˆªåˆ°ä¸€ä¸ªæ–°é¡µé¢æ—¶ï¼Œæµè§ˆå™¨å¯ä»¥ç«‹å³å¼€å§‹åŠ è½½é¡µé¢èµ„æºï¼Œè€Œä¸éœ€è¦ç­‰å¾…<code> Service Worker</code> å¯åŠ¨å’Œæ¿€æ´»ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ª <code>Service Worker </code>æ§åˆ¶ç€ç½‘ç«™ï¼Œå½“ç”¨æˆ·ç‚¹å‡»é“¾æ¥æˆ–è¿›è¡Œé¡µé¢è·³è½¬æ—¶ï¼Œæµè§ˆå™¨é¦–å…ˆéœ€è¦å¯åŠ¨å¹¶æ¿€æ´» <code>Service Worker</code>ï¼Œç„¶å <code>Service Worker</code> æ‰ä¼šå¤„ç†é¡µé¢çš„ç½‘ç»œè¯·æ±‚ã€‚è¿™å¯èƒ½ä¼šå¼•å…¥ä¸€äº›å»¶è¿Ÿ</p></blockquote><p>è¿™ç§å»¶è¿Ÿå‘ç”Ÿçš„æ¬¡æ•°ç›¸å¯¹è¾ƒå°‘ï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿå°±ä¸å¯é¿å…ï¼Œè€Œä¸”å¯èƒ½å¾ˆé‡è¦ã€‚</p><p>é¦–å…ˆï¼Œå¿…é¡»åœ¨ service worker æ¿€æ´»æœŸé—´ä½¿ç”¨ <code>registration.navigationPreload.enable()</code> æ¥å¯ç”¨è¯¥åŠŸèƒ½ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;activate&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  event.<span class="hljs-title function_">waitUntil</span>(self.<span class="hljs-property">registration</span>?.<span class="hljs-property">navigationPreload</span>.<span class="hljs-title function_">enable</span>());<br>&#125;);<br></code></pre></td></tr></table></figure><blockquote><p><code>MDN</code>ä¸Šè¯´å¿…é¡»åœ¨<code>activate</code>é‡Œæ¿€æ´»ï¼Œä½†æ˜¯å“¥ä»¬å®æµ‹<code>install</code>ä¹Ÿå¯ä»¥ï¼Œæ¯•ç«Ÿ<code>install</code>æ˜¯ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼Œç†è®ºä¸Š<code>activate</code>ä¸­å¹²çš„åœ¨å®ƒé‡Œè¾¹ä¸€æ ·å¯ä»¥.</p><p>å› æ­¤ï¼Œæˆ‘åœ¨<code>installServiceWorker.js</code>ä¸­å†™äº†å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js">self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;install&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    event.<span class="hljs-title function_">waitUntil</span>(<br>        <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<br>            <span class="hljs-title function_">addResourcesToCache</span>([<br>                <span class="hljs-string">&quot;/webworker/public/html/index.html&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/css/index.css&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/js/serviceWorker.js&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/workers/installServiceWorker.js&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/workers/cacheServiceWorker.js&quot;</span>,<br>                <span class="hljs-string">&quot;/webworker/public/assets/3.jpg&quot;</span>,<br>            ]),<br>            self.<span class="hljs-property">registration</span>.<span class="hljs-property">navigationPreload</span>.<span class="hljs-title function_">enable</span>()<br>        ])<br>    );<br>&#125;);<br></code></pre></td></tr></table></figure><p>åªæ˜¯å¢åŠ äº†<code>Promise.all()</code>ï¼Œè·ŸåŸæ¥çš„å˜åŒ–ä¸å¤§</p></blockquote><p>ç„¶åä½¿ç”¨ <code>event.preloadResponse</code> ç­‰å¾…é¢„åŠ è½½çš„èµ„æºåœ¨ <code>fetch</code> äº‹ä»¶å¤„ç†ç¨‹åºä¸­å®Œæˆä¸‹è½½ã€‚</p><p>ç»§ç»­å‰å‡ èŠ‚çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ’å…¥ä»£ç ï¼Œä»¥ä¾¿åœ¨ç¼“å­˜æ£€æŸ¥åç­‰å¾…é¢„åŠ è½½çš„èµ„æºï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™å†ä»ç½‘ç»œä¸­è·å–ã€‚</p><p>æ–°æµç¨‹æ˜¯ï¼š</p><ol><li>æ£€æŸ¥ç¼“å­˜</li><li>ç­‰å¾… <code>event.preloadResponse</code>ï¼Œå®ƒä½œä¸º <code>preloadResponsePromise</code> ä¼ é€’ç»™ <code>cacheFirst()</code> å‡½æ•°ã€‚å¦‚æœè¿”å›ç»“æœï¼Œåˆ™ç¼“å­˜å®ƒã€‚</li><li>å¦‚æœä¸¤è€…å‡æ²¡æœ‰ç»“æœï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±é€šè¿‡<code>Service Worker</code>ä»ç½‘ç»œä¸­è·å–ã€‚</li></ol><blockquote><p><code>preload</code>ä¸»è¦å¤„ç†çš„æ˜¯<strong>å¯¼èˆªè¯·æ±‚</strong>ï¼Œå…¶è¿‡ç¨‹å®Œå…¨ç”±æµè§ˆå™¨æ“çºµï¼Œä¸å¿…æ‹…å¿ƒï¼ŒåŸç†å°±æ˜¯å½“é‡åˆ°å¯¼èˆªè¯·æ±‚æ—¶ï¼Œä¼šä¸ç­‰å¾…<code>Service Worker</code>ï¼Œç»•è¿‡<code>Service Worker</code>å‘é€è¯·æ±‚ï¼Œæ¥æ”¶åˆ°è¯·æ±‚å°±è¿”å›åˆ°<code>preloadResponse</code>ä¸­</p></blockquote><p>å†å¯¹ç€<code>cacheFirstWithFallback</code>ç¼ç¼è¡¥è¡¥ï¼ŒåŠ ä¸Š<code>preload</code>çš„é€»è¾‘</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">cacheFirstWithFallback</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">&#123;request, fallbackUrl, preloadResponsePromise&#125;</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cachedResponse = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">match</span>(request);<br>    <span class="hljs-keyword">if</span>(cachedResponse) &#123;<br>        <span class="hljs-keyword">return</span> cachedResponse<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> preloadResponse = <span class="hljs-keyword">await</span> preloadResponsePromise;<br>    <span class="hljs-keyword">if</span> (preloadResponse) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;using preload response&quot;</span>, preloadResponse);<br>        <span class="hljs-title function_">putInCache</span>(request, preloadResponse.<span class="hljs-title function_">clone</span>());<br>        <span class="hljs-keyword">return</span> preloadResponse;<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">const</span> <span class="hljs-title class_">NetworkResponse</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(request);<br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">putInCache</span>(request, <span class="hljs-title class_">NetworkResponse</span>.<span class="hljs-title function_">clone</span>());<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NetworkResponse</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>        <span class="hljs-keyword">const</span> fallbackResponse = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">match</span>(fallbackUrl);<br>        <span class="hljs-keyword">if</span> (fallbackResponse) &#123;<br>            <span class="hljs-keyword">return</span> fallbackResponse;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">&quot;Network error happened&quot;</span>, &#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-number">408</span>,<br>            <span class="hljs-attr">headers</span>: &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/plain&quot;</span> &#125;,<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="6-æ›´æ–°Service-WorkerğŸ¥³"><a href="#6-æ›´æ–°Service-WorkerğŸ¥³" class="headerlink" title="6. æ›´æ–°Service WorkerğŸ¥³"></a>6. æ›´æ–°<code>Service Worker</code>ğŸ¥³</h2><p>ä¹‹å‰æåˆ°è¿‡ï¼Œæµè§ˆå™¨ä¸å…è®¸**ä¸åŒç‰ˆæœ¬çš„ç›¸åŒ<code>Service Worker</code>**åŒæ—¶è¿è¡Œï¼Œä¸ºæ­¤ï¼Œ<code>Service Worker</code>çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¾å¾—å¾ˆå¥‡æ€ªï¼š</p><ul><li>å¦‚æœä½ çš„<code> service worker</code> å·²ç»è¢«å®‰è£…ï¼Œä½†æ˜¯åˆ·æ–°é¡µé¢æ—¶æœ‰ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„å¯ç”¨ï¼Œæ–°ç‰ˆçš„<code> service worker</code>ä¼šåœ¨åå°å®‰è£…ï¼Œä½†æ˜¯ä»ç„¶ä¸ä¼šè¢«æ¿€æ´»ã€‚å½“ä¸å†æœ‰ä»»ä½•å·²åŠ è½½çš„é¡µé¢åœ¨ä½¿ç”¨æ—§ç‰ˆçš„ <code> service worker</code> çš„æ—¶å€™ï¼Œæ–°ç‰ˆæœ¬æ‰ä¼šæ¿€æ´»ã€‚ä¸€æ—¦å†ä¹Ÿæ²¡æœ‰è¿™æ ·çš„å·²åŠ è½½çš„é¡µé¢ï¼Œæ–°çš„<code> service worker</code>å°±ä¼šè¢«æ¿€æ´»ã€‚</li></ul><p>å¦‚æœæˆ‘æŠŠcacheçš„ç‰ˆæœ¬æ”¹æˆ<code>v2</code>ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>service worker</code>è·Ÿä¹‹å‰çš„å°±ä¸ä¸€æ ·äº†ï¼Œè¿™æ—¶ï¼Œåœ¨<code>install</code>ä¸­åå°ä¼šé»˜é»˜ä¸‹è½½è¿™ä¸ª<code>v2</code>çš„workerï¼Œ<strong>å½“æ²¡æœ‰é¡µé¢åœ¨ä½¿ç”¨ä¹‹å‰çš„ç‰ˆæœ¬çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–°çš„ service worker å°±ä¼šæ¿€æ´»å¹¶å¼€å§‹å“åº”è¯·æ±‚ã€‚</strong>ğŸ«¨</p><hr><p>å½“ä½ æ›´æ–° service worker åˆ°ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œä½ å°†åœ¨å®ƒçš„ <code>install</code> äº‹ä»¶å¤„ç†ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å­˜ã€‚åœ¨ä»æœ‰ç”±ä¸Šä¸€ä¸ª worker çš„ç‰ˆæœ¬æ§åˆ¶çš„æ‰“å¼€çš„é¡µé¢ï¼Œä½ å°±éœ€è¦åŒæ—¶ä¿ç•™è¿™ä¸¤ä¸ªç‰ˆæœ¬çš„ç¼“å­˜ï¼Œå› ä¸ºä¹‹å‰çš„ç‰ˆæœ¬éœ€è¦å®ƒç¼“å­˜çš„ç‰ˆæœ¬ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>activate</code> äº‹ä»¶ä»ä¹‹å‰çš„ç¼“å­˜ä¸­ç§»é™¤æ•°æ®ã€‚</p><p>ä¼ ç»™ <code>waitUntil()</code> çš„ promise ä¼šé˜»å¡å…¶ä»–çš„äº‹ä»¶ï¼Œç›´åˆ°å®ƒå®Œæˆï¼Œå› æ­¤ä½ å¯ä»¥æ”¾å¿ƒï¼Œå½“ä½ åœ¨æ–°çš„ service worker ä¸­å¾—åˆ°ä½ çš„ç¬¬ä¸€ä¸ª <code>fetch</code> äº‹ä»¶æ—¶ï¼Œä½ çš„æ¸…ç†æ“ä½œå·²ç»å®Œæˆã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">deleteCache</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">key</span>) =&gt; &#123;<br>  <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">delete</span>(key);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">deleteOldCaches</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> cacheKeepList = [<span class="hljs-string">&quot;v2&quot;</span>];<br>  <span class="hljs-keyword">const</span> keyList = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">keys</span>();<br>  <span class="hljs-keyword">const</span> cachesToDelete = keyList.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> !cacheKeepList.<span class="hljs-title function_">includes</span>(key));<br>  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(cachesToDelete.<span class="hljs-title function_">map</span>(deleteCache));<br>&#125;;<br><br>self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;activate&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  event.<span class="hljs-title function_">waitUntil</span>(<span class="hljs-title function_">deleteOldCaches</span>());<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="7-å¦‚ä½•å¤„ç†è¿‡æœŸèµ„æºï¼ŸğŸ˜“"><a href="#7-å¦‚ä½•å¤„ç†è¿‡æœŸèµ„æºï¼ŸğŸ˜“" class="headerlink" title="7.å¦‚ä½•å¤„ç†è¿‡æœŸèµ„æºï¼ŸğŸ˜“"></a>7.å¦‚ä½•å¤„ç†è¿‡æœŸèµ„æºï¼ŸğŸ˜“</h2><p>é—æ†¾çš„æ˜¯ï¼Œ<code>Service Worker</code>å¹¶æ²¡æœ‰æ£€æµ‹è¿‡æœŸèµ„æºçš„<code>api</code>ï¼Œé‚£å°±åªèƒ½é å’±ä»¬è‡ªå·±æ‰‹æ“äº†ï¼Œæˆ‘çš„æƒ³æ³•å°±æ˜¯ç»™<code>cache</code>åŠ ä¸€æ¡<code>timeStamp</code>ï¼Œæˆ–è€…<code>maxAge</code>,</p><p>å¦‚æœç¼“å­˜æ—¶é—´å¤§äº<code>maxAge</code>å°±æ¸…é™¤èµ„æºå¹¶é‡æ–°è¯·æ±‚ç¼“å­˜(è¿™ä¸å°±httpå—ï¼Ÿ)</p><p>è¿˜æ˜¯è€è§„çŸ©ï¼Œå†å¯¹<code>cacheServiceWorker</code>ç¼ç¼è¡¥è¡¥ï¼Œè¿™æ¬¡ä¿®æ”¹çš„æ—¥å¿—ï¼š</p><ul><li>æ–°å¢äº†ä¸€ä¸ªç”¨äºåˆ é™¤è¿‡æœŸèµ„æºçš„<code>deleteCache</code>å‡½æ•°</li><li>æ–°å¢äº†ä¸€ä¸ªç”¨äºåˆ¤æ–­æ˜¯å¦è¿‡æœŸçš„<code>isResourceExpired</code>å‡½æ•°</li><li>å¯¹<code>putInCache</code>ä»¥åŠ<code>cacheServiceWorker</code>æ·»åŠ äº†åˆ é™¤è¿‡æœŸç¼“å­˜çš„é€»è¾‘</li></ul><p>ä¿®æ”¹å®Œæ¯•åå¤§æ¦‚é•¿è¿™æ ·ğŸ¤”ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> cacheName = <span class="hljs-string">&quot;v1&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">putInCache</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">request, response</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">open</span>(cacheName);<br>    <span class="hljs-keyword">await</span> cache.<span class="hljs-title function_">put</span>(request, response);<br>    <span class="hljs-keyword">await</span> cache.<span class="hljs-title function_">put</span>(request.<span class="hljs-property">url</span> + <span class="hljs-string">&#x27;-timestamp&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>()));<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">deleteCache</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">request</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">open</span>(cacheName);<br>    cache.<span class="hljs-title function_">delete</span>(request)<br>    cache.<span class="hljs-title function_">delete</span>(request.<span class="hljs-property">url</span> + <span class="hljs-string">&#x27;-timestamp&#x27;</span>)<br>&#125;<br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isResourceExpired</span>(<span class="hljs-params">request, maxAge</span>) &#123;<br>    <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">open</span>(cacheName);<br>    <span class="hljs-keyword">const</span> timestampResponse = <span class="hljs-keyword">await</span> cache.<span class="hljs-title function_">match</span>(request.<span class="hljs-property">url</span> + <span class="hljs-string">&#x27;-timestamp&#x27;</span>);<br>    <span class="hljs-keyword">if</span> (timestampResponse) &#123;<br>        <span class="hljs-keyword">const</span> timestamp = <span class="hljs-keyword">await</span> timestampResponse.<span class="hljs-title function_">text</span>();<br>        <span class="hljs-keyword">const</span> age = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-built_in">parseInt</span>(timestamp, <span class="hljs-number">10</span>);<br>        <span class="hljs-keyword">return</span> age &gt; maxAge;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">cacheFirstWithFallback</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">&#123;request, fallbackUrl, preloadResponsePromise, maxAge=<span class="hljs-number">60</span>&#125;</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> cachedResponse = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">match</span>(request);<br>    <span class="hljs-keyword">if</span>(cachedResponse &amp;&amp; !(<span class="hljs-keyword">await</span> <span class="hljs-title function_">isResourceExpired</span>(request, maxAge))) &#123;<br>        <span class="hljs-keyword">return</span> cachedResponse<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">isResourceExpired</span>(request, maxAge)) &#123;<br>        <span class="hljs-title function_">deleteCache</span>(request)<br>    &#125;<br>    <span class="hljs-keyword">const</span> preloadResponse = <span class="hljs-keyword">await</span> preloadResponsePromise;<br>    <span class="hljs-keyword">if</span> (preloadResponse) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;using preload response&quot;</span>, preloadResponse);<br>        <span class="hljs-title function_">putInCache</span>(request, preloadResponse.<span class="hljs-title function_">clone</span>());<br>        <span class="hljs-keyword">return</span> preloadResponse;<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">const</span> <span class="hljs-title class_">NetworkResponse</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(request);<br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">putInCache</span>(request, <span class="hljs-title class_">NetworkResponse</span>.<span class="hljs-title function_">clone</span>());<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NetworkResponse</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>        <span class="hljs-keyword">const</span> fallbackResponse = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">match</span>(fallbackUrl);<br>        <span class="hljs-keyword">if</span> (fallbackResponse) &#123;<br>            <span class="hljs-keyword">return</span> fallbackResponse;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">&quot;Network error happened&quot;</span>, &#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-number">408</span>,<br>            <span class="hljs-attr">headers</span>: &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/plain&quot;</span> &#125;,<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="8-ç»ˆäºå·®ä¸å¤šäº†ğŸ¥³"><a href="#8-ç»ˆäºå·®ä¸å¤šäº†ğŸ¥³" class="headerlink" title="8.ç»ˆäºå·®ä¸å¤šäº†ğŸ¥³"></a>8.ç»ˆäºå·®ä¸å¤šäº†ğŸ¥³</h2><p>åˆ°è¿™é‡Œï¼Œ<code>Service Worker</code>çš„åŸºæœ¬å†…å®¹å·²ç»ç»“æŸäº†ï¼Œä½†è¿˜æœ‰äº›<code>worker</code>å…±æœ‰çš„å±æ€§æˆ–è€…æ–¹æ³•ï¼Œæ¯”å¦‚: <code>messageChannel</code>ï¼ˆè¶…çº§å¥½ç”¨ï¼Œè¿˜å¯ä»¥ç”¨æ¥ç»„ä»¶é—´é€šä¿¡ï¼‰å› ä¸ºå¤ªæ‡’å°±æ²¡æœ‰è®²ï¼Œä¹‹åå¯èƒ½è¿˜ä¼šæœ‰<code>Web Worker</code>çš„æ–‡ç« ï¼Ÿå¯èƒ½åˆ°é‚£æ—¶å€™å†è®²è®²å¥½äº†ğŸ¦–ã€‚</p><p>èƒ½å†™è¿™ä¹ˆå¤šå“¥ä»¬ä¹Ÿè¦ç´¯æ­»äº†ğŸ˜“</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>addEventListener-Event</title>
    <link href="/2023/11/26/addEventListener1/"/>
    <url>/2023/11/26/addEventListener1/</url>
    
    <content type="html"><![CDATA[<h1 id="addEventListenerå¤åˆ»ä¹‹EventğŸ˜ˆ"><a href="#addEventListenerå¤åˆ»ä¹‹EventğŸ˜ˆ" class="headerlink" title="addEventListenerå¤åˆ»ä¹‹EventğŸ˜ˆ"></a>addEventListenerå¤åˆ»ä¹‹EventğŸ˜ˆ</h1><blockquote><p>åœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œå“¥ä»¬ä¸€ç›´ä»¥ä¸º<code>eventListener</code>æ˜¯è½®è¯¢å‡ºæ¥çš„ğŸ–,æ²¡æƒ³åˆ°å®ƒå±…ç„¶æ˜¯ç”¨é˜Ÿåˆ—å®ç°çš„ï¼Œæ„Ÿè§‰æŒºæ–°å¥‡çš„ã€‚</p><p>ä¸œè¥¿å¥½å¤šï¼Œåˆ†ä¸¤ç¯‡åšå®¢ï¼Œæœ¬ç¯‡ä¸»æ”»<code>Event</code>ï¼ˆè™½ç„¶åŸºæœ¬ä¸Šéƒ½æ˜¯åˆ«äººçš„æ–‡ç« å†…å®¹ï¼Œä½†å“¥ä»¬å¥½æ­¹ä¹Ÿæ˜¯ç²¾ç®€è¿‡çš„å—·ï¼Œä¸èƒ½è¯´æˆ‘çº¯copyğŸ˜œï¼‰</p></blockquote><h3 id="1-EventğŸ²"><a href="#1-EventğŸ²" class="headerlink" title="1. EventğŸ²"></a>1. EventğŸ²</h3><blockquote><p>ç›‘å¬äº‹ä»¶æ€»å¾—æœ‰ä¸ª<code>äº‹ä»¶</code>å§ï¼Œæ¬¸ï¼Œä½ è¿˜åˆ«è¯´ï¼Œjsè¿˜çœŸæäº†ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ <code>Event</code>, æ¥çœ‹çœ‹å§</p><p>(ä»¥ä¸‹å†…å®¹å‡æ¥è‡ªäºåšå®¢ï¼š<a href="https://developer.aliyun.com/article/875782%EF%BC%8C">https://developer.aliyun.com/article/875782ï¼Œ</a> å®åœ¨å¤ªå¤šäº†ï¼Œå†™ä¸å®Œç›´æ¥copyç°æˆçš„ğŸ¤¢ï¼‰</p></blockquote><p><strong>äº‹ä»¶å‘ç”Ÿä»¥åï¼Œä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œä½œä¸ºå‚æ•°ä¼ ç»™ç›‘å¬å‡½æ•°</strong>ã€‚æµè§ˆå™¨åŸç”Ÿæä¾›ä¸€ä¸ª<code>Event</code>å¯¹è±¡ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½æ˜¯è¿™ä¸ªå¯¹è±¡çš„å®ä¾‹ï¼Œæˆ–è€…è¯´ç»§æ‰¿äº†<code>Event.prototype</code>å¯¹è±¡ã€‚</p><p><strong><code>Event</code>å¯¹è±¡æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥ç”Ÿæˆæ–°çš„å®ä¾‹</strong>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">event = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(type, options);<span class="hljs-comment">// å‚æ•°ä¸€ï¼Œäº‹ä»¶åç§°ï¼› å‚æ•°äºŒï¼Œäº‹ä»¶å¯¹è±¡çš„é…ç½®å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p><code>Event</code>æ„é€ å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°<code>type</code>æ˜¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºäº‹ä»¶çš„åç§°ï¼›ç¬¬äºŒä¸ªå‚æ•°<code>options</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºäº‹ä»¶å¯¹è±¡çš„é…ç½®ã€‚è¯¥å¯¹è±¡ä¸»è¦æœ‰ä¸‹é¢ä¸¤ä¸ªå±æ€§ã€‚</p><ul><li><code>bubbles</code>ï¼šå¸ƒå°”å€¼ï¼Œå¯é€‰ï¼Œé»˜è®¤ä¸º<code>false</code>ï¼Œè¡¨ç¤ºäº‹ä»¶å¯¹è±¡<strong>æ˜¯å¦å†’æ³¡</strong>ã€‚</li><li><code>cancelable</code>ï¼šå¸ƒå°”å€¼ï¼Œå¯é€‰ï¼Œé»˜è®¤ä¸º<code>false</code>ï¼Œè¡¨ç¤ºäº‹ä»¶<strong>æ˜¯å¦å¯ä»¥è¢«å–æ¶ˆ</strong>ï¼Œå³èƒ½å¦ç”¨<code>Event.preventDefault()</code>å–æ¶ˆè¿™ä¸ªäº‹ä»¶ã€‚ä¸€æ—¦äº‹ä»¶è¢«å–æ¶ˆï¼Œå°±å¥½åƒä»æ¥æ²¡æœ‰å‘ç”Ÿè¿‡ï¼Œä¸ä¼šè§¦å‘æµè§ˆå™¨å¯¹è¯¥äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> ev = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>( <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å®ä¾‹</span><br>  <span class="hljs-string">&#x27;look&#x27;</span>, <span class="hljs-comment">// äº‹ä»¶åç§°</span><br>  &#123; <span class="hljs-comment">// äº‹ä»¶é…ç½®</span><br>    <span class="hljs-string">&#x27;bubbles&#x27;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// äº‹ä»¶æ˜¯å¦å†’æ³¡</span><br>    <span class="hljs-string">&#x27;cancelable&#x27;</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// äº‹ä»¶æ˜¯å¦å¯ä»¥è¢«å–æ¶ˆ</span><br>  &#125;<br>);<br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">dispatchEvent</span>(ev); <span class="hljs-comment">// è§¦å‘evå®ä¾‹ï¼Œè¯¥å®ä¾‹æ˜¯lookäº‹ä»¶</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ–°å»ºä¸€ä¸ª<code>look</code>äº‹ä»¶å®ä¾‹ï¼Œç„¶åä½¿ç”¨<code>dispatchEvent</code>æ–¹æ³•è§¦å‘è¯¥äº‹ä»¶ã€‚</p><p>æ³¨æ„ï¼Œå¦‚æœä¸æ˜¯æ˜¾å¼æŒ‡å®š<code>bubbles</code>å±æ€§ä¸º<code>true</code>ï¼Œç”Ÿæˆçš„äº‹ä»¶å°±åªèƒ½åœ¨â€œæ•è·é˜¶æ®µâ€è§¦å‘ç›‘å¬å‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// HTML ä»£ç ä¸º</span><br><span class="hljs-comment">// &lt;div&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/div&gt;</span><br><span class="hljs-keyword">let</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br><span class="hljs-keyword">let</span> p = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;p&#x27;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-keyword">let</span> tag = event.<span class="hljs-property">currentTarget</span>.<span class="hljs-property">tagName</span>;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Tag: &#x27;</span> + tag); <span class="hljs-comment">// æ²¡æœ‰ä»»ä½•è¾“å‡º</span><br>&#125;<br><br>div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, callback, <span class="hljs-literal">false</span>); <span class="hljs-comment">// è¯¥äº‹ä»¶æ˜¯åœ¨å†’æ³¡é˜¶æ®µç›‘å¬å‡½æ•°</span><br><br><span class="hljs-keyword">let</span> click = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&#x27;click&#x27;</span>); <br>p.<span class="hljs-title function_">dispatchEvent</span>(click); <span class="hljs-comment">// ç»™på‘å‡ºä¸€ä¸ªclickäº‹ä»¶ï¼Œè¯¥äº‹ä»¶é»˜è®¤ä¸ä¼šå†’æ³¡ï¼Œå› æ­¤ä¸ä¼šè§¦å‘çˆ¶å…ƒç´ divçš„clickäº‹ä»¶</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>p</code>å…ƒç´ å‘å‡ºä¸€ä¸ª<code>click</code>äº‹ä»¶ï¼Œè¯¥äº‹ä»¶é»˜è®¤ä¸ä¼šå†’æ³¡ã€‚<code>div.addEventListener</code>æ–¹æ³•æŒ‡å®šåœ¨å†’æ³¡é˜¶æ®µç›‘å¬ï¼Œå› æ­¤ç›‘å¬å‡½æ•°ä¸ä¼šè§¦å‘ã€‚å¦‚æœå†™æˆ<code>div.addEventListener(&#39;click&#39;, callback, true)</code>ï¼Œé‚£ä¹ˆåœ¨â€œæ•è·é˜¶æ®µâ€å¯ä»¥ç›‘å¬åˆ°è¿™ä¸ªäº‹ä»¶ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè¿™ä¸ªäº‹ä»¶åœ¨<code>div</code>å…ƒç´ ä¸Šè§¦å‘ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">div.<span class="hljs-title function_">dispatchEvent</span>(click);<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œä¸ç®¡<code>div</code>å…ƒç´ æ˜¯åœ¨å†’æ³¡é˜¶æ®µç›‘å¬ï¼Œè¿˜æ˜¯åœ¨æ•è·é˜¶æ®µç›‘å¬ï¼Œéƒ½ä¼šè§¦å‘ç›‘å¬å‡½æ•°ã€‚å› ä¸ºè¿™æ—¶<code>div</code>å…ƒç´ æ˜¯äº‹ä»¶çš„ç›®æ ‡ï¼Œä¸å­˜åœ¨æ˜¯å¦å†’æ³¡çš„é—®é¢˜ï¼Œ<code>div</code>å…ƒç´ æ€»æ˜¯ä¼šæ¥æ”¶åˆ°äº‹ä»¶ï¼Œå› æ­¤å¯¼è‡´ç›‘å¬å‡½æ•°ç”Ÿæ•ˆã€‚</p><h3 id="2-Eventçš„å®ä¾‹å±æ€§ğŸ™ˆ"><a href="#2-Eventçš„å®ä¾‹å±æ€§ğŸ™ˆ" class="headerlink" title="2. Eventçš„å®ä¾‹å±æ€§ğŸ™ˆ"></a>2. Eventçš„å®ä¾‹å±æ€§ğŸ™ˆ</h3><h4 id="2-1-Event-bubbles-æ˜¯å¦ä¼šå†’æ³¡-åªè¯»-ï¼ŒEvent-eventPhase-è¿”å›æ•´æ•°ï¼Œè¡¨ç¤ºäº‹ä»¶æ‰€å¤„é˜¶æ®µ-åªè¯»"><a href="#2-1-Event-bubbles-æ˜¯å¦ä¼šå†’æ³¡-åªè¯»-ï¼ŒEvent-eventPhase-è¿”å›æ•´æ•°ï¼Œè¡¨ç¤ºäº‹ä»¶æ‰€å¤„é˜¶æ®µ-åªè¯»" class="headerlink" title="2.1 Event.bubbles æ˜¯å¦ä¼šå†’æ³¡(åªè¯»)ï¼ŒEvent.eventPhase è¿”å›æ•´æ•°ï¼Œè¡¨ç¤ºäº‹ä»¶æ‰€å¤„é˜¶æ®µ(åªè¯»)"></a>2.1 Event.bubbles æ˜¯å¦ä¼šå†’æ³¡(<em>åªè¯»</em>)ï¼ŒEvent.eventPhase è¿”å›æ•´æ•°ï¼Œè¡¨ç¤ºäº‹ä»¶æ‰€å¤„é˜¶æ®µ(åªè¯»)</h4><p><code>Event.bubbles</code>å±æ€§<strong>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå½“å‰äº‹ä»¶æ˜¯å¦ä¼šå†’æ³¡</strong>ã€‚è¯¥å±æ€§ä¸º<strong>åªè¯»</strong>å±æ€§ï¼Œä¸€èˆ¬ç”¨æ¥äº†è§£ Event å®ä¾‹æ˜¯å¦å¯ä»¥å†’æ³¡ã€‚å‰é¢è¯´è¿‡ï¼Œé™¤éæ˜¾å¼å£°æ˜ï¼Œ<code>Event</code>æ„é€ å‡½æ•°ç”Ÿæˆçš„äº‹ä»¶ï¼Œé»˜è®¤æ˜¯ä¸å†’æ³¡çš„ã€‚</p><p><code>Event.eventPhase</code>å±æ€§<strong>è¿”å›ä¸€ä¸ªæ•´æ•°å¸¸é‡ï¼Œè¡¨ç¤ºäº‹ä»¶ç›®å‰æ‰€å¤„çš„é˜¶æ®µã€‚è¯¥å±æ€§åªè¯»</strong>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> phase = event.<span class="hljs-property">eventPhase</span>;<br></code></pre></td></tr></table></figure><p><code>Event.eventPhase</code>çš„è¿”å›å€¼æœ‰å››ç§å¯èƒ½ã€‚</p><ul><li>0ï¼Œäº‹ä»¶ç›®å‰<strong>æ²¡æœ‰å‘ç”Ÿ</strong>ã€‚</li><li>1ï¼Œäº‹ä»¶ç›®å‰å¤„äº<strong>æ•è·é˜¶æ®µ</strong>ï¼Œå³å¤„äºä»ç¥–å…ˆèŠ‚ç‚¹å‘ç›®æ ‡èŠ‚ç‚¹çš„ä¼ æ’­è¿‡ç¨‹ä¸­ã€‚</li><li>2ï¼Œäº‹ä»¶<strong>åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹</strong>ï¼Œå³<code>Event.target</code>å±æ€§æŒ‡å‘çš„é‚£ä¸ªèŠ‚ç‚¹ã€‚</li><li>3ï¼Œäº‹ä»¶å¤„äº<strong>å†’æ³¡é˜¶æ®µ</strong>ï¼Œå³å¤„äºä»ç›®æ ‡èŠ‚ç‚¹å‘ç¥–å…ˆèŠ‚ç‚¹çš„åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ã€‚</li></ul><h4 id="2-2-Event-cancelable-æ˜¯å¦å¯å–æ¶ˆé»˜è®¤è¡Œä¸ºï¼ŒEvent-cancelBubbleæ˜¯å¦é˜»æ­¢å†’æ³¡ï¼Œevent-defaultPrevented-æ˜¯å¦è°ƒç”¨è¿‡å–æ¶ˆé»˜è®¤è¡Œä¸ºæ–¹æ³•"><a href="#2-2-Event-cancelable-æ˜¯å¦å¯å–æ¶ˆé»˜è®¤è¡Œä¸ºï¼ŒEvent-cancelBubbleæ˜¯å¦é˜»æ­¢å†’æ³¡ï¼Œevent-defaultPrevented-æ˜¯å¦è°ƒç”¨è¿‡å–æ¶ˆé»˜è®¤è¡Œä¸ºæ–¹æ³•" class="headerlink" title="2.2 Event.cancelable æ˜¯å¦å¯å–æ¶ˆé»˜è®¤è¡Œä¸ºï¼ŒEvent.cancelBubbleæ˜¯å¦é˜»æ­¢å†’æ³¡ï¼Œevent.defaultPrevented æ˜¯å¦è°ƒç”¨è¿‡å–æ¶ˆé»˜è®¤è¡Œä¸ºæ–¹æ³•"></a>2.2 Event.cancelable æ˜¯å¦å¯å–æ¶ˆé»˜è®¤è¡Œä¸ºï¼ŒEvent.cancelBubbleæ˜¯å¦é˜»æ­¢å†’æ³¡ï¼Œevent.defaultPrevented æ˜¯å¦è°ƒç”¨è¿‡å–æ¶ˆé»˜è®¤è¡Œä¸ºæ–¹æ³•</h4><p><code>Event.cancelable</code>å±æ€§<strong>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºäº‹ä»¶æ˜¯å¦å¯ä»¥å–æ¶ˆ</strong>ã€‚è¯¥å±æ€§ä¸º<strong>åªè¯»</strong>å±æ€§ï¼Œä¸€èˆ¬ç”¨æ¥äº†è§£ Event å®ä¾‹çš„ç‰¹æ€§ã€‚</p><p><strong>å¤§å¤šæ•°æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶æ˜¯å¯ä»¥å–æ¶ˆçš„</strong>ã€‚æ¯”å¦‚ï¼Œå–æ¶ˆ<code>click</code>äº‹ä»¶ï¼Œç‚¹å‡»é“¾æ¥å°†æ— æ•ˆã€‚ä½†æ˜¯é™¤éæ˜¾å¼å£°æ˜ï¼Œ<code>Event</code>æ„é€ å‡½æ•°ç”Ÿæˆçš„äº‹ä»¶ï¼Œ<strong>é»˜è®¤æ˜¯ä¸å¯ä»¥å–æ¶ˆçš„</strong>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> evt = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&#x27;foo&#x27;</span>);<br>evt.<span class="hljs-property">cancelable</span>  <span class="hljs-comment">// false é»˜è®¤ä¸å¯å–æ¶ˆ</span><br></code></pre></td></tr></table></figure><p>å½“<code>Event.cancelable</code>å±æ€§ä¸º<code>true</code>æ—¶ï¼Œè°ƒç”¨<code>Event.preventDefault()</code>å°±å¯ä»¥å–æ¶ˆè¿™ä¸ªäº‹ä»¶ï¼Œé˜»æ­¢æµè§ˆå™¨å¯¹è¯¥äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºã€‚</p><p>å¦‚æœäº‹ä»¶ä¸èƒ½å–æ¶ˆï¼Œè°ƒç”¨<code>Event.preventDefault()</code>ä¼šæ²¡æœ‰ä»»ä½•æ•ˆæœã€‚æ‰€ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæœ€å¥½ç”¨<code>Event.cancelable</code>å±æ€§åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å¯ä»¥å–æ¶ˆã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">preventEvent</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">cancelable</span>) &#123;<br>    event.<span class="hljs-title function_">preventDefault</span>();<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;This event couldn\&#x27;t be canceled.&#x27;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">dir</span>(event);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Event.cancelBubble</code>å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœè®¾ä¸º<code>true</code>ï¼Œç›¸å½“äºæ‰§è¡Œ<code>Event.stopPropagation()</code>ï¼Œå¯ä»¥<strong>é˜»æ­¢äº‹ä»¶çš„ä¼ æ’­ã€‚</strong></p><p><code>Event.defaultPrevented</code>å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥äº‹ä»¶<strong>æ˜¯å¦è°ƒç”¨è¿‡<code>Event.preventDefault</code>æ–¹æ³•ã€‚è¯¥å±æ€§åªè¯»ã€‚</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (event.<span class="hljs-property">defaultPrevented</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¯¥äº‹ä»¶å·²ç»å–æ¶ˆäº†&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-3-Event-currentTargetå½“å‰æ­£åœ¨é€šè¿‡çš„èŠ‚ç‚¹ï¼ŒEvent-targetç›®æ ‡èŠ‚ç‚¹"><a href="#2-3-Event-currentTargetå½“å‰æ­£åœ¨é€šè¿‡çš„èŠ‚ç‚¹ï¼ŒEvent-targetç›®æ ‡èŠ‚ç‚¹" class="headerlink" title="2.3 Event.currentTargetå½“å‰æ­£åœ¨é€šè¿‡çš„èŠ‚ç‚¹ï¼ŒEvent.targetç›®æ ‡èŠ‚ç‚¹"></a>2.3 Event.currentTargetå½“å‰æ­£åœ¨é€šè¿‡çš„èŠ‚ç‚¹ï¼ŒEvent.targetç›®æ ‡èŠ‚ç‚¹</h4><p>äº‹ä»¶å‘ç”Ÿä»¥åï¼Œä¼šç»è¿‡æ•è·å’Œå†’æ³¡ä¸¤ä¸ªé˜¶æ®µï¼Œä¾æ¬¡é€šè¿‡å¤šä¸ª DOM èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œä»»æ„æ—¶ç‚¹éƒ½æœ‰ä¸¤ä¸ªä¸äº‹ä»¶ç›¸å…³çš„èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶çš„<strong>åŸå§‹è§¦å‘èŠ‚ç‚¹</strong>ï¼ˆ<code>Event.target</code>ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯äº‹ä»¶<strong>å½“å‰æ­£åœ¨é€šè¿‡çš„èŠ‚ç‚¹</strong>ï¼ˆ<code>Event.currentTarget</code>ï¼‰ã€‚<strong>å‰è€…é€šå¸¸æ˜¯åè€…çš„åä»£èŠ‚ç‚¹</strong>ã€‚</p><p><code>Event.currentTarget</code>å±æ€§è¿”å›äº‹ä»¶<strong>å½“å‰æ‰€åœ¨çš„èŠ‚ç‚¹</strong>ï¼Œå³äº‹ä»¶å½“å‰æ­£åœ¨é€šè¿‡çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„ç›‘å¬å‡½æ•°æ‰€åœ¨çš„é‚£ä¸ªèŠ‚ç‚¹ã€‚<strong>éšç€äº‹ä»¶çš„ä¼ æ’­ï¼Œè¿™ä¸ªå±æ€§çš„å€¼ä¼šå˜</strong>ã€‚</p><p><code>Event.target</code>å±æ€§è¿”å›<strong>åŸå§‹è§¦å‘äº‹ä»¶çš„é‚£ä¸ªèŠ‚ç‚¹</strong>ï¼Œå³äº‹ä»¶æœ€åˆå‘ç”Ÿçš„èŠ‚ç‚¹ã€‚è¿™ä¸ªå±æ€§ä¸ä¼šéšç€äº‹ä»¶çš„ä¼ æ’­è€Œæ”¹å˜ã€‚</p><p>äº‹ä»¶ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œä¸åŒèŠ‚ç‚¹çš„ç›‘å¬å‡½æ•°å†…éƒ¨çš„<code>Event.target</code>ä¸<code>Event.currentTarget</code>å±æ€§çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// HTML ä»£ç ä¸º</span><br><span class="hljs-comment">// &lt;p id=&quot;para&quot;&gt;Hello &lt;em&gt;World&lt;/em&gt;&lt;/p&gt;</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">hide</span>(<span class="hljs-params">e</span>) &#123;<br>  <span class="hljs-comment">// ä¸ç®¡ç‚¹å‡» Hello æˆ– Worldï¼Œæ€»æ˜¯è¿”å› true</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span> === e.<span class="hljs-property">currentTarget</span>);<br><br>  <span class="hljs-comment">// ç‚¹å‡» Helloï¼Œè¿”å› true</span><br>  <span class="hljs-comment">// ç‚¹å‡» Worldï¼Œè¿”å› false</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span> === e.<span class="hljs-property">target</span>);<br>&#125;<br><br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;para&#x27;</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, hide, <span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>&lt;em&gt;</code>æ˜¯<code>&lt;p&gt;</code>çš„å­èŠ‚ç‚¹ï¼Œç‚¹å‡»<code>&lt;em&gt;</code>æˆ–è€…ç‚¹å‡»<code>&lt;p&gt;</code>ï¼Œéƒ½ä¼šå¯¼è‡´ç›‘å¬å‡½æ•°æ‰§è¡Œã€‚è¿™æ—¶ï¼Œ<code>e.target</code>æ€»æ˜¯æŒ‡å‘åŸå§‹ç‚¹å‡»ä½ç½®çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œè€Œ<code>e.currentTarget</code>æŒ‡å‘äº‹ä»¶ä¼ æ’­è¿‡ç¨‹ä¸­æ­£åœ¨ç»è¿‡çš„é‚£ä¸ªèŠ‚ç‚¹ã€‚ç”±äºç›‘å¬å‡½æ•°åªæœ‰äº‹ä»¶ç»è¿‡æ—¶æ‰ä¼šè§¦å‘ï¼Œæ‰€ä»¥<code>e.currentTarget</code>æ€»æ˜¯ç­‰åŒäºç›‘å¬å‡½æ•°å†…éƒ¨çš„<code>this</code>ã€‚</p><h4 id="2-4-Event-type-äº‹ä»¶ç±»å‹ï¼ˆå¦‚ï¼šâ€™clickâ€™ï¼‰"><a href="#2-4-Event-type-äº‹ä»¶ç±»å‹ï¼ˆå¦‚ï¼šâ€™clickâ€™ï¼‰" class="headerlink" title="2.4 Event.type äº‹ä»¶ç±»å‹ï¼ˆå¦‚ï¼šâ€™clickâ€™ï¼‰"></a>2.4 Event.type äº‹ä»¶ç±»å‹ï¼ˆå¦‚ï¼šâ€™clickâ€™ï¼‰</h4><p><code>Event.type</code>å±æ€§<strong>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºäº‹ä»¶ç±»å‹</strong>ã€‚äº‹ä»¶çš„ç±»å‹æ˜¯åœ¨ç”Ÿæˆäº‹ä»¶çš„æ—¶å€™æŒ‡å®šçš„ã€‚è¯¥å±æ€§åªè¯»ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> evt = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">&#x27;foo&#x27;</span>);<br>evt.<span class="hljs-property">type</span> <span class="hljs-comment">// &quot;foo&quot;</span><br></code></pre></td></tr></table></figure><h4 id="2-5-Event-isTrusted-æ˜¯å¦ç”±çœŸå®ç”¨æˆ·è¡Œä¸ºäº§ç”Ÿçš„äº‹ä»¶"><a href="#2-5-Event-isTrusted-æ˜¯å¦ç”±çœŸå®ç”¨æˆ·è¡Œä¸ºäº§ç”Ÿçš„äº‹ä»¶" class="headerlink" title="2.5 Event.isTrusted æ˜¯å¦ç”±çœŸå®ç”¨æˆ·è¡Œä¸ºäº§ç”Ÿçš„äº‹ä»¶"></a>2.5 Event.isTrusted æ˜¯å¦ç”±çœŸå®ç”¨æˆ·è¡Œä¸ºäº§ç”Ÿçš„äº‹ä»¶</h4><p><code>Event.isTrusted</code>å±æ€§è¿”å›ä¸€ä¸ª<strong>å¸ƒå°”å€¼</strong>ï¼Œè¡¨ç¤º<strong>è¯¥äº‹ä»¶æ˜¯å¦ç”±çœŸå®çš„ç”¨æˆ·è¡Œä¸ºäº§ç”Ÿ</strong>ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·ç‚¹å‡»é“¾æ¥ä¼šäº§ç”Ÿä¸€ä¸ª<code>click</code>äº‹ä»¶ï¼Œè¯¥äº‹ä»¶æ˜¯ç”¨æˆ·äº§ç”Ÿçš„ï¼›<code>Event</code>æ„é€ å‡½æ•°ç”Ÿæˆçš„äº‹ä»¶ï¼Œåˆ™æ˜¯è„šæœ¬äº§ç”Ÿçš„ã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">var</span> evt = <span class="hljs-keyword">new</span> <span class="hljs-type">Event</span>(<span class="hljs-string">&#x27;foo&#x27;</span>);<br>evt.isTrusted <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>evt</code>å¯¹è±¡æ˜¯è„šæœ¬äº§ç”Ÿçš„ï¼Œæ‰€ä»¥<code>isTrusted</code>å±æ€§è¿”å›<code>false</code>ã€‚</p><h4 id="2-6-Event-detail-äº‹ä»¶çš„ç»†èŠ‚ï¼ˆå•å‡»oråŒå‡»ç­‰ï¼‰"><a href="#2-6-Event-detail-äº‹ä»¶çš„ç»†èŠ‚ï¼ˆå•å‡»oråŒå‡»ç­‰ï¼‰" class="headerlink" title="2.6 Event.detail äº‹ä»¶çš„ç»†èŠ‚ï¼ˆå•å‡»oråŒå‡»ç­‰ï¼‰"></a>2.6 Event.detail äº‹ä»¶çš„ç»†èŠ‚ï¼ˆå•å‡»oråŒå‡»ç­‰ï¼‰</h4><p><code>Event.detail</code>å±æ€§åªæœ‰æµè§ˆå™¨çš„ UI ï¼ˆç”¨æˆ·ç•Œé¢ï¼‰äº‹ä»¶æ‰å…·æœ‰ã€‚è¯¥å±æ€§è¿”å›ä¸€ä¸ªæ•°å€¼ï¼Œè¡¨ç¤ºäº‹ä»¶çš„æŸç§ä¿¡æ¯ã€‚å…·ä½“å«ä¹‰ä¸äº‹ä»¶ç±»å‹ç›¸å…³ã€‚æ¯”å¦‚ï¼Œå¯¹äº<code>click</code>å’Œ<code>dblclick</code>äº‹ä»¶ï¼Œ<code>Event.detail</code>æ˜¯é¼ æ ‡æŒ‰ä¸‹çš„æ¬¡æ•°ï¼ˆ<code>1</code>è¡¨ç¤ºå•å‡»ï¼Œ<code>2</code>è¡¨ç¤ºåŒå‡»ï¼Œ<code>3</code>è¡¨ç¤ºä¸‰å‡»ï¼‰ï¼›å¯¹äºé¼ æ ‡æ»šè½®äº‹ä»¶ï¼Œ<code>Event.detail</code>æ˜¯æ»šè½®æ­£å‘æ»šåŠ¨çš„è·ç¦»ï¼Œè´Ÿå€¼å°±æ˜¯è´Ÿå‘æ»šåŠ¨çš„è·ç¦»ï¼Œè¿”å›å€¼æ€»æ˜¯3çš„å€æ•°ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">// HTML ä»£ç å¦‚ä¸‹</span><br><span class="hljs-comment">// &lt;p&gt;Hello&lt;/p&gt;</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">giveDetails</span>(<span class="hljs-params">e</span>) &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(e.detail); <span class="hljs-comment">// å¿«é€Ÿç‚¹å‡»çš„æ¬¡æ•°</span><br>&#125;<br><br>document.querySelector(<span class="hljs-string">&#x27;p&#x27;</span>).onclick = giveDetails;<br></code></pre></td></tr></table></figure><h3 id="3ã€å®ä¾‹æ–¹æ³•ğŸ‘¹"><a href="#3ã€å®ä¾‹æ–¹æ³•ğŸ‘¹" class="headerlink" title="3ã€å®ä¾‹æ–¹æ³•ğŸ‘¹"></a>3ã€å®ä¾‹æ–¹æ³•ğŸ‘¹</h3><h4 id="3-1-Event-preventDefault-å–æ¶ˆæµè§ˆå™¨å¯¹å½“å‰äº‹ä»¶çš„é»˜è®¤è¡Œä¸º"><a href="#3-1-Event-preventDefault-å–æ¶ˆæµè§ˆå™¨å¯¹å½“å‰äº‹ä»¶çš„é»˜è®¤è¡Œä¸º" class="headerlink" title="3.1 Event.preventDefault() å–æ¶ˆæµè§ˆå™¨å¯¹å½“å‰äº‹ä»¶çš„é»˜è®¤è¡Œä¸º"></a>3.1 Event.preventDefault() å–æ¶ˆæµè§ˆå™¨å¯¹å½“å‰äº‹ä»¶çš„é»˜è®¤è¡Œä¸º</h4><p><code>Event.preventDefault</code>æ–¹æ³•<strong>å–æ¶ˆæµè§ˆå™¨å¯¹å½“å‰äº‹ä»¶çš„é»˜è®¤è¡Œä¸º</strong>ã€‚æ¯”å¦‚ç‚¹å‡»é“¾æ¥åï¼Œæµè§ˆå™¨é»˜è®¤ä¼šè·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä»¥åï¼Œå°±ä¸ä¼šè·³è½¬äº†ï¼›å†æ¯”å¦‚ï¼ŒæŒ‰ä¸€ä¸‹ç©ºæ ¼é”®ï¼Œé¡µé¢å‘ä¸‹æ»šåŠ¨ä¸€æ®µè·ç¦»ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä»¥åä¹Ÿä¸ä¼šæ»šåŠ¨äº†ã€‚è¯¥æ–¹æ³•ç”Ÿæ•ˆçš„å‰ææ˜¯ï¼Œäº‹ä»¶å¯¹è±¡çš„<code>cancelable</code>å±æ€§ä¸º<code>true</code>ï¼Œå¦‚æœä¸º<code>false</code>ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ²¡æœ‰ä»»ä½•æ•ˆæœã€‚</p><p><strong>æ³¨æ„ï¼Œè¯¥æ–¹æ³•åªæ˜¯å–æ¶ˆäº‹ä»¶å¯¹å½“å‰å…ƒç´ çš„é»˜è®¤å½±å“ï¼Œä¸ä¼šé˜»æ­¢äº‹ä»¶çš„ä¼ æ’­</strong>ã€‚å¦‚æœè¦é˜»æ­¢ä¼ æ’­ï¼Œå¯ä»¥ä½¿ç”¨<code>stopPropagation()</code>æˆ–<code>stopImmediatePropagation()</code>æ–¹æ³•ã€‚</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ada">// HTML ä»£ç ä¸º<br>// &lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> id=<span class="hljs-string">&quot;my-checkbox&quot;</span> /&gt;<br>var cb = document.getElementById(<span class="hljs-symbol">&#x27;my</span>-checkbox&#x27;);<br><br>cb.addEventListener(<br>  <span class="hljs-symbol">&#x27;click</span>&#x27;,<br>  <span class="hljs-keyword">function</span> <span class="hljs-title"></span>(e)&#123; e.preventDefault(); &#125;,<br>  <span class="hljs-literal">false</span><br>);<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæµè§ˆå™¨çš„é»˜è®¤è¡Œä¸ºæ˜¯å•å‡»ä¼šé€‰ä¸­å•é€‰æ¡†ï¼Œå–æ¶ˆè¿™ä¸ªè¡Œä¸ºï¼Œå°±å¯¼è‡´æ— æ³•é€‰ä¸­å•é€‰æ¡†ã€‚</p><p>åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä¸ºæ–‡æœ¬è¾“å…¥æ¡†è®¾ç½®æ ¡éªŒæ¡ä»¶ã€‚å¦‚æœç”¨æˆ·çš„è¾“å…¥ä¸ç¬¦åˆæ¡ä»¶ï¼Œå°±æ— æ³•å°†å­—ç¬¦è¾“å…¥æ–‡æœ¬æ¡†ã€‚</p><h6 id="ä¾‹å­ï¼šåªèƒ½è¾“å…¥å­—æ¯çš„è¾“å…¥æ¡†"><a href="#ä¾‹å­ï¼šåªèƒ½è¾“å…¥å­—æ¯çš„è¾“å…¥æ¡†" class="headerlink" title="ä¾‹å­ï¼šåªèƒ½è¾“å…¥å­—æ¯çš„è¾“å…¥æ¡†"></a>ä¾‹å­ï¼šåªèƒ½è¾“å…¥å­—æ¯çš„è¾“å…¥æ¡†</h6><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs lua">// HTML ä»£ç ä¸º<br>// &lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text&quot;</span> id=<span class="hljs-string">&quot;my-input&quot;</span> /&gt;<br>var <span class="hljs-built_in">input</span> = document.getElementById(<span class="hljs-string">&#x27;my-input&#x27;</span>);<br><span class="hljs-built_in">input</span>.addEventListener(<span class="hljs-string">&#x27;keypress&#x27;</span>, checkName, <span class="hljs-literal">false</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkName</span><span class="hljs-params">(e)</span></span> &#123;<br>  <span class="hljs-keyword">if</span> (e.charCode &lt; <span class="hljs-number">97</span> || e.charCode &gt; <span class="hljs-number">122</span>) &#123;<br>    e.preventDefault();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸ºæ–‡æœ¬æ¡†çš„<code>keypress</code>äº‹ä»¶è®¾å®šç›‘å¬å‡½æ•°åï¼Œå°†åªèƒ½è¾“å…¥å°å†™å­—æ¯ï¼Œå¦åˆ™è¾“å…¥äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºï¼ˆå†™å…¥æ–‡æœ¬æ¡†ï¼‰å°†è¢«å–æ¶ˆï¼Œå¯¼è‡´ä¸èƒ½å‘æ–‡æœ¬æ¡†è¾“å…¥å†…å®¹ã€‚</p><h4 id="3-2-Event-stopPropagation-é˜»æ­¢äº‹ä»¶ä¼ æ’­"><a href="#3-2-Event-stopPropagation-é˜»æ­¢äº‹ä»¶ä¼ æ’­" class="headerlink" title="3.2 Event.stopPropagation() é˜»æ­¢äº‹ä»¶ä¼ æ’­"></a>3.2 Event.stopPropagation() é˜»æ­¢äº‹ä»¶ä¼ æ’­</h4><p><code>stopPropagation</code>æ–¹æ³•é˜»æ­¢äº‹ä»¶åœ¨ DOM ä¸­ç»§ç»­ä¼ æ’­ï¼Œé˜²æ­¢å†è§¦å‘å®šä¹‰åœ¨åˆ«çš„èŠ‚ç‚¹ä¸Šçš„ç›‘å¬å‡½æ•°ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬åœ¨å½“å‰èŠ‚ç‚¹ä¸Šå…¶ä»–çš„äº‹ä»¶ç›‘å¬å‡½æ•°ã€‚</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">stopEvent</span><span class="hljs-params">(e)</span> &#123;<br>  e.stopPropagation(); <span class="hljs-comment">// é˜»æ­¢äº‹ä»¶å†’æ³¡</span><br>&#125;<br><br>el.addEventListener(<span class="hljs-string">&#x27;click&#x27;</span>, stopEvent, <span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>click</code>äº‹ä»¶å°†ä¸ä¼šè¿›ä¸€æ­¥å†’æ³¡åˆ°<code>el</code>èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚</p><h4 id="3-3-Event-stopImmediatePropagation-é˜»æ­¢åŒä¸€ä¸ªäº‹ä»¶çš„å…¶ä»–ç›‘å¬å‡½æ•°è¢«è°ƒç”¨"><a href="#3-3-Event-stopImmediatePropagation-é˜»æ­¢åŒä¸€ä¸ªäº‹ä»¶çš„å…¶ä»–ç›‘å¬å‡½æ•°è¢«è°ƒç”¨" class="headerlink" title="3.3 Event.stopImmediatePropagation() é˜»æ­¢åŒä¸€ä¸ªäº‹ä»¶çš„å…¶ä»–ç›‘å¬å‡½æ•°è¢«è°ƒç”¨"></a>3.3 Event.stopImmediatePropagation() é˜»æ­¢åŒä¸€ä¸ªäº‹ä»¶çš„å…¶ä»–ç›‘å¬å‡½æ•°è¢«è°ƒç”¨</h4><p><code>Event.stopImmediatePropagation</code>æ–¹æ³•é˜»æ­¢åŒä¸€ä¸ªäº‹ä»¶çš„å…¶ä»–ç›‘å¬å‡½æ•°è¢«è°ƒç”¨ï¼Œä¸ç®¡ç›‘å¬å‡½æ•°å®šä¹‰åœ¨å½“å‰èŠ‚ç‚¹è¿˜æ˜¯å…¶ä»–èŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ–¹æ³•é˜»æ­¢äº‹ä»¶çš„ä¼ æ’­ï¼Œæ¯”<code>Event.stopPropagation()</code>æ›´å½»åº•ã€‚</p><p>å¦‚æœåŒä¸€ä¸ªèŠ‚ç‚¹å¯¹äºåŒä¸€ä¸ªäº‹ä»¶æŒ‡å®šäº†å¤šä¸ªç›‘å¬å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä¼šæ ¹æ®æ·»åŠ çš„é¡ºåºä¾æ¬¡è°ƒç”¨ã€‚åªè¦å…¶ä¸­æœ‰ä¸€ä¸ªç›‘å¬å‡½æ•°è°ƒç”¨äº†<code>Event.stopImmediatePropagation</code>æ–¹æ³•ï¼Œå…¶ä»–çš„ç›‘å¬å‡½æ•°å°±ä¸ä¼šå†æ‰§è¡Œäº†ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">l1</span>(<span class="hljs-params">e</span>)&#123;<br>  e.stopImmediatePropagation();<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">l2</span>(<span class="hljs-params">e</span>)&#123; <span class="hljs-comment">// ä¸ä¼šè¢«è°ƒç”¨</span><br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;hello world&#x27;</span>);<br>&#125;<br><br>el.addEventListener(<span class="hljs-string">&#x27;click&#x27;</span>, l1, <span class="hljs-literal">false</span>);<br>el.addEventListener(<span class="hljs-string">&#x27;click&#x27;</span>, l2, <span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç åœ¨<code>el</code>èŠ‚ç‚¹ä¸Šï¼Œä¸º<code>click</code>äº‹ä»¶æ·»åŠ äº†ä¸¤ä¸ªç›‘å¬å‡½æ•°<code>l1</code>å’Œ<code>l2</code>ã€‚ç”±äº<code>l1</code>è°ƒç”¨äº†<code>event.stopImmediatePropagation</code>æ–¹æ³•ï¼Œæ‰€ä»¥<code>l2</code>ä¸ä¼šè¢«è°ƒç”¨ã€‚</p><h4 id="3-4-Event-composedPath-æ•°ç»„ï¼Œç›®æ ‡å’Œå†’æ³¡çš„èŠ‚ç‚¹"><a href="#3-4-Event-composedPath-æ•°ç»„ï¼Œç›®æ ‡å’Œå†’æ³¡çš„èŠ‚ç‚¹" class="headerlink" title="3.4 Event.composedPath() æ•°ç»„ï¼Œç›®æ ‡å’Œå†’æ³¡çš„èŠ‚ç‚¹"></a>3.4 Event.composedPath() æ•°ç»„ï¼Œç›®æ ‡å’Œå†’æ³¡çš„èŠ‚ç‚¹</h4><p><code>Event.composedPath()</code>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯äº‹ä»¶çš„æœ€åº•å±‚èŠ‚ç‚¹å’Œä¾æ¬¡å†’æ³¡ç»è¿‡çš„æ‰€æœ‰ä¸Šå±‚èŠ‚ç‚¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// HTML ä»£ç å¦‚ä¸‹</span><br><span class="hljs-comment">// &lt;div&gt;</span><br><span class="hljs-comment">//   &lt;p&gt;Hello&lt;/p&gt;</span><br><span class="hljs-comment">// &lt;/div&gt;</span><br><span class="hljs-keyword">var</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br><span class="hljs-keyword">var</span> p = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;p&#x27;</span>);<br><br>div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-title function_">composedPath</span>());<br>&#125;, <span class="hljs-literal">false</span>);<br><span class="hljs-comment">// [p, div, body, html, document, Window]</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>click</code>äº‹ä»¶çš„æœ€åº•å±‚èŠ‚ç‚¹æ˜¯<code>p</code>ï¼Œå‘ä¸Šä¾æ¬¡æ˜¯<code>div</code>ã€<code>body</code>ã€<code>html</code>ã€<code>document</code>ã€<code>Window</code>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Reconciler</title>
    <link href="/2023/11/17/reconciler/"/>
    <url>/2023/11/17/reconciler/</url>
    
    <content type="html"><![CDATA[<h1 id="Reconciler"><a href="#Reconciler" class="headerlink" title="Reconciler"></a>Reconciler</h1><h2 id="1-Reconcilerä¸»è¦åŠŸèƒ½"><a href="#1-Reconcilerä¸»è¦åŠŸèƒ½" class="headerlink" title="1. Reconcilerä¸»è¦åŠŸèƒ½"></a>1. Reconcilerä¸»è¦åŠŸèƒ½</h2><ol><li>è¾“å…¥: æš´éœ²<code>api</code>å‡½æ•°(å¦‚: <code>scheduleUpdateOnFiber</code>), ä¾›ç»™å…¶ä»–åŒ…(å¦‚<code>react</code>åŒ…)è°ƒç”¨.</li><li>æ³¨å†Œè°ƒåº¦ä»»åŠ¡: ä¸è°ƒåº¦ä¸­å¿ƒ(<code>scheduler</code>åŒ…)äº¤äº’, æ³¨å†Œè°ƒåº¦ä»»åŠ¡<code>task</code>, ç­‰å¾…ä»»åŠ¡å›è°ƒ.</li><li>æ‰§è¡Œä»»åŠ¡å›è°ƒ: åœ¨å†…å­˜ä¸­æ„é€ å‡º<code>fiberæ ‘</code>, åŒæ—¶ä¸ä¸æ¸²æŸ“å™¨(<code>react-dom</code>)äº¤äº’, åœ¨å†…å­˜ä¸­åˆ›å»ºå‡ºä¸<code>fiber</code>å¯¹åº”çš„<code>DOM</code>èŠ‚ç‚¹.</li><li>è¾“å‡º: ä¸æ¸²æŸ“å™¨(<code>react-dom</code>)äº¤äº’, æ¸²æŸ“<code>DOM</code>èŠ‚ç‚¹.</li></ol><p>ä»¥ä¸Šè¿™äº›åŠŸèƒ½å¯ä»¥æ±‡é›†åˆ°ä¸€å¼ å›¾ä¸­ï¼š</p><p><img src="https://s2.loli.net/2023/11/17/vfPgm4BpGcZt3UK.png" alt="reconcileråŠŸèƒ½å›¾"></p><h2 id="2-æ­¥éª¤åˆ†è§£"><a href="#2-æ­¥éª¤åˆ†è§£" class="headerlink" title="2. æ­¥éª¤åˆ†è§£"></a>2. æ­¥éª¤åˆ†è§£</h2><h3 id="è¾“å…¥ğŸ¤—"><a href="#è¾“å…¥ğŸ¤—" class="headerlink" title="è¾“å…¥ğŸ¤—"></a>è¾“å…¥ğŸ¤—</h3><p> åœ¨<code>react-reconciler</code>å¯¹å¤–æš´éœ²çš„ api å‡½æ•°ä¸­, åªè¦æ¶‰åŠåˆ°éœ€è¦æ”¹å˜ fiber çš„æ“ä½œ(æ— è®ºæ˜¯<code>é¦–æ¬¡æ¸²æŸ“</code>æˆ–<code>åç»­æ›´æ–°</code>æ“ä½œ), æœ€åéƒ½ä¼šé—´æ¥è°ƒç”¨<code>scheduleUpdateOnFiber</code>, æ‰€ä»¥<code>scheduleUpdateOnFiber</code>å‡½æ•°æ˜¯è¾“å…¥é“¾è·¯ä¸­çš„<code>å¿…ç»ä¹‹è·¯</code>.</p><p>é€»è¾‘è¿›å…¥åˆ°<code>scheduleUpdateOnFiber</code>ä¹‹å, åé¢æœ‰ 2 ç§å¯èƒ½:</p><ol><li>ä¸ç»è¿‡è°ƒåº¦, ç›´æ¥è¿›è¡Œ<code>fiberæ„é€ </code>.</li><li>æ³¨å†Œè°ƒåº¦ä»»åŠ¡, ç»è¿‡<code>Scheduler</code>åŒ…çš„è°ƒåº¦, é—´æ¥è¿›è¡Œ<code>fiberæ„é€ </code>.</li></ol><blockquote><p><code>ç›´æ¥è¿›è¡Œfiberæ„é€ </code>é€šå¸¸æ˜¯åœ¨é¢å¯¹é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œä¾‹å¦‚<code>ç”¨æˆ·ç‚¹å‡»äº‹ä»¶</code> æˆ–è€…æ˜¯<code>åŒæ­¥æ›´æ–°äº‹ä»¶</code>ï¼ˆä¸å…è®¸è¢«ä¸­æ–­ï¼Œå› æ­¤ä¹Ÿå°±ä¸éœ€è¦<code>scheduler</code>è¿›è¡Œæ§åˆ¶ï¼Œå¯ä»¥ç†è§£ä¸ºæ€¥è¯Šï¼‰æ‰ä¼šè¿›è¡Œ.</p><p>è€Œé¢å¯¹ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œreactä¼šå…ˆå»<code>scheduler</code>æ³¨å†Œè°ƒåº¦ä»»åŠ¡ï¼ˆå¯ä»¥ç†è§£ä¸ºå…ˆå»å–å·ï¼‰ï¼Œä¹‹åç”±<code>scheduler</code>è¿›è¡Œè°ƒåº¦æ‰§è¡Œæ¸²æŸ“ã€‚åœ¨æµè§ˆå™¨ç¹å¿™çš„æ—¶å€™ï¼Œ<code>scheduler</code>ä¼šä¼˜å…ˆæš‚åœè¿™äº›ä»»åŠ¡ä»è€Œæ‰§è¡Œæ›´é‡è¦çš„ä»»åŠ¡ï¼ˆå¯ä»¥ç†è§£ä¸ºåŒ»ç”Ÿäººæ‰‹ä¸è¶³, ä¼˜å…ˆä¿è¯æ€¥è¯Šè¿è½¬ï¼‰</p></blockquote><hr><h3 id="æ³¨å†Œè°ƒåº¦äº‹ä»¶ğŸŒŸ"><a href="#æ³¨å†Œè°ƒåº¦äº‹ä»¶ğŸŒŸ" class="headerlink" title="æ³¨å†Œè°ƒåº¦äº‹ä»¶ğŸŒŸ"></a>æ³¨å†Œè°ƒåº¦äº‹ä»¶ğŸŒŸ</h3><p>ä¸<code>è¾“å…¥</code>ç¯èŠ‚ç´§å¯†ç›¸è¿, <code>scheduleUpdateOnFiber</code>å‡½æ•°ä¹‹å, ç«‹å³è¿›å…¥<code>ensureRootIsScheduled</code>å‡½æ•°ï¼ˆå¦‚æœè¦æ³¨å†Œäº‹ä»¶çš„è¯ï¼‰</p><blockquote><p><code>ensureRootIsScheduled</code>ä¸»è¦é€»è¾‘ï¼š</p><ol><li><strong>æ£€æŸ¥å½“å‰å·¥ä½œ</strong>ï¼šå‡½æ•°é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»æœ‰å·¥ä½œæ­£åœ¨è¿›è¡Œã€‚React ä¿æŒäº†å½“å‰æ­£åœ¨è¿›è¡Œçš„å·¥ä½œçš„çŠ¶æ€ï¼Œä»¥é¿å…ä¸å¿…è¦çš„é‡å¤å·¥ä½œã€‚ï¼ˆ<strong>å¦‚æœæœ‰ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡åœ¨æ‰§è¡Œï¼Œå¯ä»¥æ‰“æ–­ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ç›¸åŒä»»åŠ¡åœ¨æ‰§è¡Œï¼Œå¯ä»¥å‡å°‘ä¸€æ¬¡é‡å¤å·¥ä½œ</strong>ï¼‰</li><li><strong>ç¡®å®šæ›´æ–°ä¼˜å…ˆçº§</strong>ï¼šæ ¹æ®å½“å‰çš„æ›´æ–°ï¼ˆå¦‚çŠ¶æ€æ”¹å˜ã€props æ›´æ–°ç­‰ï¼‰ç¡®å®šæ›´æ–°çš„ä¼˜å…ˆçº§ã€‚React ä½¿ç”¨ä¸åŒçš„ä¼˜å…ˆçº§æ¥å¤„ç†ä¸åŒç±»å‹çš„æ›´æ–°ï¼Œä¾‹å¦‚ç”¨æˆ·äº¤äº’ä¼šè¢«è§†ä¸ºé«˜ä¼˜å…ˆçº§ã€‚</li><li><strong>å®‰æ’æ›´æ–°ä»»åŠ¡</strong>ï¼šä¸€æ—¦ç¡®å®šäº†æ›´æ–°çš„ä¼˜å…ˆçº§ï¼Œ<code>ensureRootIsScheduled</code> ä¼šä½¿ç”¨ React çš„ <code>Scheduler</code> å®‰æ’ä¸€ä¸ªæ–°çš„æ›´æ–°ä»»åŠ¡ã€‚å¹¶ä¸”ä¼šæŠŠ<code>performSyncWorkOnRoot</code>ç­‰å‡½æ•°å°è£…åˆ°å›è°ƒä¸­ï¼Œäº¤ç»™<code>Scheduler</code> ã€‚</li></ol></blockquote><hr><h3 id="æ‰§è¡Œå›è°ƒğŸ¶"><a href="#æ‰§è¡Œå›è°ƒğŸ¶" class="headerlink" title="æ‰§è¡Œå›è°ƒğŸ¶"></a>æ‰§è¡Œå›è°ƒğŸ¶</h3><p><code>performSyncWorkOnRoot</code>çš„é€»è¾‘å¾ˆæ¸…æ™°, åˆ†ä¸º 3 éƒ¨åˆ†:</p><ol><li>fiber æ ‘æ„é€ </li><li>å¼‚å¸¸å¤„ç†: æœ‰å¯èƒ½ fiber æ„é€ è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸</li><li>è°ƒç”¨è¾“å‡ºï¼ˆ<code>commitRoot</code>ï¼‰</li></ol><p>åœ¨é€€å‡ºå‰ï¼Œè¿˜ä¼šæ£€æµ‹æœ‰æ— å…¶ä»–æ›´æ–°ï¼Œæ˜¯å¦éœ€è¦å‘èµ·æ–°è°ƒåº¦è¯·æ±‚</p><p><code>performConcurrentWorkOnRoot</code>çš„é€»è¾‘ä¸<code>performSyncWorkOnRoot</code>çš„ä¸åŒä¹‹å¤„åœ¨äº, å¯¹äº<code>å¯ä¸­æ–­æ¸²æŸ“</code>çš„æ”¯æŒ:</p><ol><li>è°ƒç”¨<code>performConcurrentWorkOnRoot</code>å‡½æ•°æ—¶, é¦–å…ˆæ£€æŸ¥æ˜¯å¦å¤„äº<code>render</code>è¿‡ç¨‹ä¸­, æ˜¯å¦éœ€è¦æ¢å¤ä¸Šä¸€æ¬¡æ¸²æŸ“.</li><li>å¦‚æœæœ¬æ¬¡æ¸²æŸ“è¢«ä¸­æ–­, æœ€åè¿”å›ä¸€ä¸ªæ–°çš„ <code>performConcurrentWorkOnRoot</code> å‡½æ•°, ç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒç”¨</li></ol><hr><h3 id="è¾“å‡ºğŸ˜"><a href="#è¾“å‡ºğŸ˜" class="headerlink" title="è¾“å‡ºğŸ˜"></a>è¾“å‡ºğŸ˜</h3><p>åœ¨è¾“å‡ºé˜¶æ®µ,<code>commitRoot</code>çš„å®ç°é€»è¾‘æ˜¯åœ¨<code>commitRootImpl</code>å‡½æ•°ä¸­, å…¶ä¸»è¦é€»è¾‘æ˜¯å¤„ç†å‰¯ä½œç”¨é˜Ÿåˆ—, å°†æœ€æ–°çš„ fiber æ ‘ç»“æ„åæ˜ åˆ° DOM ä¸Š.</p><p>æ ¸å¿ƒé€»è¾‘åˆ†ä¸º 3 ä¸ªæ­¥éª¤:</p><ol><li><p><code>commitBeforeMutationEffects</code></p><ul><li>dom å˜æ›´ä¹‹å‰, ä¸»è¦å¤„ç†å‰¯ä½œç”¨é˜Ÿåˆ—ä¸­å¸¦æœ‰<code>Snapshot</code>,<code>Passive</code>æ ‡è®°çš„<code>fiber</code>èŠ‚ç‚¹.</li></ul></li><li><p><code>commitMutationEffects</code></p><ul><li>dom å˜æ›´, ç•Œé¢å¾—åˆ°æ›´æ–°. ä¸»è¦å¤„ç†å‰¯ä½œç”¨é˜Ÿåˆ—ä¸­å¸¦æœ‰<code>Placement</code>, <code>Update</code>, <code>Deletion</code>, <code>Hydrating</code>æ ‡è®°çš„<code>fiber</code>èŠ‚ç‚¹.</li></ul></li><li><p><code>commitLayoutEffects</code></p><ul><li>dom å˜æ›´å, ä¸»è¦å¤„ç†å‰¯ä½œç”¨é˜Ÿåˆ—ä¸­å¸¦æœ‰<code>Update | Callback</code>æ ‡è®°çš„<code>fiber</code>èŠ‚ç‚¹.</li></ul></li></ol><blockquote><p>Reactä¼šç»™æ¯æ¬¡æ›´æ–°çš„å†…å®¹æ‰“ä¸Šæ ‡ç­¾ï¼Œä¸Šé¢è¯´çš„<code>Snapshot</code>,<code>Passvie</code>ç­‰å°±æ˜¯æ ‡ç­¾çš„å‡ ä¸ªç§ç±»ï¼Œè¿™äº›æ ‡ç­¾å¤§å¤šå’Œ<code>æ¸²æŸ“å‰¯ä½œç”¨</code>ç›¸å…³</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>reactè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>reactè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸå‹é“¾</title>
    <link href="/2023/11/17/proto/"/>
    <url>/2023/11/17/proto/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸå‹é“¾ğŸ¤”"><a href="#åŸå‹é“¾ğŸ¤”" class="headerlink" title="åŸå‹é“¾ğŸ¤”"></a>åŸå‹é“¾ğŸ¤”</h1><h2 id="1-åŸå‹é“¾çš„å½¢æˆ"><a href="#1-åŸå‹é“¾çš„å½¢æˆ" class="headerlink" title="1. åŸå‹é“¾çš„å½¢æˆ"></a>1. åŸå‹é“¾çš„å½¢æˆ</h2><p><code>åŸå‹é“¾</code> æ˜¯ <code>js</code> å®ç°ç»§æ‰¿çš„é‡è¦æ–¹å¼ï¼Œä¹Ÿæ˜¯ <code>js</code> ä¸å…¶ä»–è¯­è¨€ä¸ä¼—ä¸åŒçš„åœ°æ–¹ä¹‹ä¸€ï¼Œ <code>js</code> ä¸­ï¼ŒåŸå‹é“¾çš„å½¢æˆæ–¹å¼å¦‚ä¸‹ï¼š</p><blockquote><ol><li><code>js</code>ä¸­æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª <code>åŸå‹å¯¹è±¡</code>, è¿™ä¸ªå¯¹è±¡åªèƒ½åœ¨ <code>new</code> æ„é€ æ—¶æ‰èƒ½ä½¿ç”¨ï¼Œå½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œè®¿é—®è¿™ä¸ªå¯¹è±¡å°†ä¼šå¾—åˆ° <code>undefined</code>ğŸª¨</li><li>æ¯ä¸ªåŸå‹å¯¹è±¡ä¸­åŒ…å«ç€ <code>æŒ‡å‘ä¸Šä¸€ä¸ªåŸå‹å¯¹è±¡çš„æŒ‡é’ˆ</code>, å½“è‡ªèº«å¯¹è±¡æ²¡æœ‰è¿™ä¸ªå±æ€§æ—¶ï¼Œ ä¼šæ ¹æ®è¿™ä¸ªæŒ‡é’ˆå¯»æ‰¾ä¸Šä¸€å±‚å¯¹è±¡çš„ç›¸åº”å±æ€§ ï¼Œäºæ˜¯å°±å½¢æˆäº† <code>é“¾å¼ç»“æ„</code></li></ol></blockquote><h2 id="2-åŸå‹å¯¹è±¡çš„ç»„æˆğŸ¤"><a href="#2-åŸå‹å¯¹è±¡çš„ç»„æˆğŸ¤" class="headerlink" title="2. åŸå‹å¯¹è±¡çš„ç»„æˆğŸ¤"></a>2. åŸå‹å¯¹è±¡çš„ç»„æˆğŸ¤</h2><p>å¯èƒ½çœ‹å®Œä¸Šé¢çš„è§£é‡Šå¤§å®¶è¿˜æœ‰äº›è¿·ç³Šï¼Œæ²¡å…³ç³»ï¼Œåœ¨è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä¼šè·Ÿå¤§å®¶è¯¦ç»†ä»‹ç» <code>åŸå‹å¯¹è±¡</code> è¿™ä¸ªç©æ„ã€‚</p><p>åˆå§‹çš„<code>åŸå‹å¯¹è±¡</code>ä¸­æœ‰ä¸‰ç§å±æ€§ï¼š </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">GGBond</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = &#123;<br>    <span class="hljs-attr">__proto__</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>,<br>    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">GGBond</span>,<br>    <span class="hljs-attr">super_bang_bang_tang</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;è¶…çº§æ£’æ£’ç³–&quot;</span>);<br>    &#125;<br>    <span class="hljs-attr">fei_fei_gong_zhu</span>: <span class="hljs-string">&#x27;wife&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>ä¸€ç§å«åš <code>__proto__</code>ï¼Œ è¿™ä¸ªå°±æ˜¯åˆšåˆšæ‰€è¯´æŒ‡å‘ä¸Šçº§çš„æŒ‡é’ˆï¼Œå½“è‡ªèº«çš„<code>prototype</code>æ‰¾ä¸åˆ°ç›¸åº”å±æ€§æ—¶ï¼Œå°±è¦é¡ºç€è¿™ä¸ªæŒ‡é’ˆå¯»æ‰¾ä¸Šä¸€çº§é‡Œçš„å±æ€§ğŸ¤£</p><blockquote><p><code>__proto__</code>æ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„å˜é‡ï¼Œå¦‚æœä½ å°è¯•æ‰“å°å®ƒ:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">GGBond</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span>);<br></code></pre></td></tr></table></figure><p>ä½ å°†ä¼šå¾—åˆ° <code>&#123;&#125;</code>ï¼Œä½†å®ƒå®é™…ä¸Šå¹¶ä¸ä¸ºç©ºå¯¹è±¡ï¼Œå¦‚æœä½ å°è¯•ä»¥ä¸‹æ¯”è¾ƒï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">GGBond</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br></code></pre></td></tr></table></figure><p>é‚£ä½ ä¼šæƒŠå¥‡çš„å‘ç°å®ƒä¼šè¿”å› <code>true</code>ğŸ˜, è¿™æ˜¯å› ä¸º<code>__proto__</code>æ˜¯ä¸€ä¸ªå†…éƒ¨å±æ€§ï¼Œæ‰€ä»¥æŸäº›æ—¶å€™ä¼šè¢«é™åˆ¶æ˜¾ç¤ºã€‚</p><p>å› æ­¤ï¼Œåœ¨ <code>ES6</code>ä¸­ï¼Œæ›´æ¨èä½¿ç”¨æ–°å¢çš„ <code>Object.getPrototypeOf</code>å’Œ<code>Object.getPrototypeOf</code>æ–¹æ³•è€Œä¸æ˜¯ç›´æ¥è®¿é—®<code>__proto__</code></p><p>æœ‰æ„æ€çš„æ˜¯ï¼Œ<code>__proto__</code> è¿™ä¸ªå±æ€§æœ¬æ¥å°±ä¸æ˜¯ <code>ES </code>çš„è§„èŒƒï¼Œç›´åˆ° <code>ES6 </code>æ‰è¢«æ­£å¼å¼•å…¥ï¼Œä½†æ˜¯å®˜æ–¹åœ¨ <code>ES6</code> åˆç»™å‡ºäº†å®ƒçš„æ›¿ä»£æ–¹æ¡ˆï¼ˆå®é™…ä¸Šå°±æ˜¯å°è£…äº†ä¸€å°ä¸‹ğŸ˜¡ï¼‰ï¼Œå±äºæ˜¯ç”Ÿä¸é€¢æ—¶äº†</p></blockquote></li><li><p>ä¸€ç§å«åš<code>constructor</code>ï¼Œå®ƒæŒ‡å‘è‡ªèº«ï¼Œä¸»è¦æ˜¯ç”¨æ¥åˆ¤åˆ«æ˜¯å¦ä¸ºæŸä¸ªæ„é€ å‡½æ•°çš„å®ä¾‹ï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰å®ƒçš„åŠŸèƒ½å¿«è¢«æŸä¸ª<code>Symbol</code>æ›¿ä»£äº†ï¼Œè¿˜è®°å¾—æ˜¯å“ªä¸ªå—ğŸ˜ï¼Œä¸è®°å¾—äº†è®°å¾—å»çœ‹çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ã€‚</p><blockquote><p>ä¸ªäººæ„Ÿè§‰ç½‘ä¸Šæ‰€è¯´çš„å®ƒæ˜¯<code>ç»´æŠ¤åŸå‹é“¾çš„æ–¹æ³•</code>ä¸æ˜¯å¾ˆè´´åˆ‡ğŸ˜µï¼Œä»–ä»¬æ‰€è¯´çš„<code>ç»´æŠ¤åŸå‹é“¾</code>,ä¹Ÿå°±æ˜¯è®©ç»§æ‰¿æ›´è§„èŒƒï¼Œç±»å‹è¯†åˆ«æ›´åŠ æ–¹ä¾¿ã€‚å®é™…ä¸Š<code>constructor</code>æ ¹æœ¬ä¸ä¼šå½±å“ç»§æ‰¿ï¼Œä¹Ÿä¸ä¼šå½±å“åŸå‹é“¾ä¸Šä¸‹çš„ä¸œè¥¿ï¼Œæ„Ÿè§‰å«åš<code>ç±»å‹æ ‡è¯†</code>ä¹Ÿæ¯”<code>ç»´æŠ¤åŸå‹é“¾</code>æ›´å¥½ä¸€äº›ğŸ¤</p></blockquote></li><li><p>æœ€åå°±æ˜¯å’±ä»¬æŒ‚è½½åˆ°åŸå‹å¯¹è±¡ä¸Šçš„å±æ€§å’Œæ–¹æ³•äº†ï¼Œåœ¨ä¸Šé¢ï¼Œ å°±æ˜¯<code>super_bang_bang_tang</code>å’Œ<code>fei_fei_gong_zhu</code></p><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>æœ‰äº›å±æ€§å¹¶ä¸ä¼šè¢«æŒ‚è½½åˆ°åŸå‹é“¾ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸå‹é“¾ä¸Šä¸ä¼šæœ‰æ‰€æœ‰çš„å±æ€§ã€‚ğŸ¶å…·ä½“å“ªäº›ä¸èƒ½åœ¨ä¹‹åä¼šæœ‰ä»‹ç»</p></blockquote></li></ul><p>æœ‰æ²¡æœ‰æ„Ÿè§‰è¿™ä¸ªè¿‡ç¨‹å¾ˆåƒå’±ä»¬äº²çˆ±çš„ <code>é—­åŒ…</code> ğŸ˜</p><h2 id="3-åŸå‹å¯¹è±¡æœ€åå»å“ªäº†ï¼Ÿ"><a href="#3-åŸå‹å¯¹è±¡æœ€åå»å“ªäº†ï¼Ÿ" class="headerlink" title="3. åŸå‹å¯¹è±¡æœ€åå»å“ªäº†ï¼Ÿ"></a>3. åŸå‹å¯¹è±¡æœ€åå»å“ªäº†ï¼Ÿ</h2><p>ç”±ä¸Šé¢ï¼Œå’±ä»¬å¯ä»¥çŸ¥é“ï¼Œ<code>åŸå‹å¯¹è±¡</code>æ˜¯å‡½æ•°ä¸Šæ‰æœ‰çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚æœå’±ä»¬æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£æ„é€ å‡½æ•°çš„<code>åŸå‹å¯¹è±¡</code>ä¼šå»å“ªé‡Œå‘¢ï¼ŸğŸ¤”</p><p>è¿˜æ˜¯ä»¥ <code>GGBond</code> ä¸ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> dead_pig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GGBond</span>();<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> dead_pig) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key);<br>&#125;<br></code></pre></td></tr></table></figure><p>å‡è®¾æ‰€æœ‰å±æ€§éƒ½æ˜¯<code>å¯æšä¸¾</code>çš„ï¼Œé‚£ä¹ˆä¸Šé¢çš„è¾“å‡ºä¼šå˜æˆ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">constructor</span><br>super_bang_bang_tang<br>fei_fei_gong_zhu<br></code></pre></td></tr></table></figure><p><code>__proto__</code>ä¸ºä»€ä¹ˆä¸åœ¨ï¼Œçœ‹çœ‹ä¸Šè¾¹ï¼Œå†™äº†å¥½é•¿ä¸€æ®µå˜ğŸ˜µ</p><p>ç”±æ­¤å¯è§ï¼Œ<code>åŸå‹å¯¹è±¡</code>åœ¨æ„å»ºæˆå¯¹è±¡ä¹‹åï¼Œä¼šè‡ªåŠ¨æ•£å¼€<code>constructor</code>å’Œ<code>__proto__</code>ï¼Œå˜æˆå¯¹è±¡çš„ä¸¤ä¸ªå±æ€§ï¼Œè€Œå…¶ä»–åˆ™è¢«èˆå¼ƒï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœä½ è¦è®¿é—®æŸä¸ªå½“å‰å¯¹è±¡æ²¡æœ‰çš„å±æ€§ï¼Œé‚£ä¹ˆä»–å°±ä¼šé¡ºç€<code>__proto__</code>ä¸Šæº¯å»æ‰¾å’¯</p><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>è¿™é‡Œæœ‰ <code>fei_fei_gong_zhu</code>å’Œ<code>super_bang_bang_tang</code>æ˜¯å› ä¸ºå¹¶æ²¡æœ‰æŠŠä»–ä»¬æŒ‚è½½åˆ°åŸå‹é“¾ä¸Šï¼Œè€Œæ˜¯æŒ‚è½½åˆ°å®ä¾‹ä¸Šï¼ŒåŸå‹é“¾ä¸Šçš„å±æ€§å¹¶ä¸ä¼šè¢«æ•£å¼€åˆ°å¯¹è±¡ä¸­</p></blockquote><h2 id="4-ä½ å·²ç»å­¦ä¼šåŸå‹é“¾äº†ï¼Œæ¥è¯•è¯•å†™å‡ºES6çš„classå§ğŸ˜"><a href="#4-ä½ å·²ç»å­¦ä¼šåŸå‹é“¾äº†ï¼Œæ¥è¯•è¯•å†™å‡ºES6çš„classå§ğŸ˜" class="headerlink" title="4.ä½ å·²ç»å­¦ä¼šåŸå‹é“¾äº†ï¼Œæ¥è¯•è¯•å†™å‡ºES6çš„classå§ğŸ˜"></a>4.ä½ å·²ç»å­¦ä¼šåŸå‹é“¾äº†ï¼Œæ¥è¯•è¯•å†™å‡ºES6çš„classå§ğŸ˜</h2><p><code>ES6</code>çš„<code>class</code>å…¶å®å°±æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œæ˜¯å¯¹åŸå‹é“¾æ“ä½œçš„ç®€å•å°è£…ï¼Œæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç®€å•å®ç°ä»¥ä¸‹ <code>class</code> ä¸­ <code>extends</code> æ“ä½œå§ï¼š</p><p>è¿˜æ˜¯ä»¥<code>GGBond</code>ä¸ºä¾‹ï¼Œå…ˆç®€å•å®šä¹‰ä¸€ä¸ª<code>DeadPig</code>æ„é€ å‡½æ•°å’Œä¸€ä¸ª<code>GGBond</code>æ„é€ å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">DeadPig</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">category</span> = <span class="hljs-string">&quot;pig&quot;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">food</span> = <span class="hljs-string">&quot;vegetable&quot;</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">GGBond</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;GGBond&quot;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">food</span> = <span class="hljs-string">&quot;è¶…çº§æ£’æ£’ç³–&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œè¦è®©<code>GGBond</code>æ„é€ å‡½æ•°ç»§æ‰¿<code>DeadPig</code>å‡½æ•°ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ğŸ˜</p><hr><p>é‚£è‚¯å®šæ˜¯è¦ä¿®æ”¹<code>GGBond</code>çš„<code>prototype</code>ä¸º<code>DeadPig</code>å¯¹ä¸å¯¹ï¼Œå¼€å¹²ï¼</p><p>ä¸”æ…¢ï¼Œå’±ä»¬è¦æƒ³å®ç°ç»§æ‰¿ï¼Œé¦–å…ˆè¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>å­ç±»è¦æœ‰çˆ¶ç±»å®šä¹‰çš„å…±ç”¨å±æ€§</li><li>å­ç±»çš„æ”¹åŠ¨ä¸å½±å“çˆ¶ç±»</li></ul><p>è¦æƒ³å®ç°è¿™ä¸¤ç‚¹ï¼Œå°±è‚¯å®šä¸èƒ½ç”¨çˆ¶ç±»çš„ç›´æ¥å¼•ç”¨ï¼Œè€Œè¦ç”¨é—´æ¥å¼•ç”¨ï¼Œè€Œä»€ä¹ˆæ˜¯é—´æ¥å¼•ç”¨å‘¢ï¼Ÿ<code>æ„é€ å‡ºæ¥çš„å®ä¾‹</code>å°±æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œè¿™æ ·ä¸»è¦æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p><ul><li>å­ç±»ä¸ä¼šå½±å“çˆ¶ç±»</li><li>å­ç±»å®ä¾‹ä¸Šçš„æŸäº›æ–¹æ³•ä¹Ÿä¼šè¢«å¸¦è¿›æ¥ï¼ŒèŒƒå›´æ›´å¹¿</li></ul><p>äºæ˜¯å°±æœ‰äº†ä¸‹é¢çš„æ“ä½œ:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">GGBond</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeadPig</span>();<br></code></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ“ä½œç©¶ç«Ÿéƒ½åšäº†ä»€ä¹ˆï¼š</p><p>é¦–å…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ª<code>DeadPig</code>å¯¹è±¡ï¼Œå¤§æ¦‚å¼ è¿™æ ·ï¼š </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>    <span class="hljs-attr">__proto__</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>,<br>    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">DeadPig</span>,<br>    <span class="hljs-attr">category</span>: <span class="hljs-string">&quot;pig&quot;</span>,<br>    <span class="hljs-attr">food</span>: <span class="hljs-string">&quot;vegetable&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹‹åæŠŠè¿™ä¸ªå¯¹è±¡èµ‹å€¼ç»™ <code>GGBond.prototype</code>,è¿™æ—¶<code>GGBond</code>å¤§æ¦‚é•¿è¿™æ ·ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>    <span class="hljs-attr">prototype</span>: &#123;<br>        <span class="hljs-attr">__proto__</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>,<br>        <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">DeadPig</span>,<br>        <span class="hljs-attr">category</span>: <span class="hljs-string">&quot;pig&quot;</span>,<br>        <span class="hljs-attr">food</span>: <span class="hljs-string">&quot;vegetable&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™å°±å·²ç»åŸºæœ¬å®Œæˆç»§æ‰¿äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯<code>GGBond</code>çš„<code>constructor</code>è¿˜æ˜¯<code>DeadPig</code>ï¼Œè¿™å¾ˆè®©äººæ¼ç«.ğŸ˜¡</p><p>å¦‚æœåˆ«äººè®¿é—®<code>GGBond</code>å®ä¾‹çš„<code>constructor</code>ï¼Œå°±ä¼šå¾—åˆ°<code>DeadPig</code>,è¿™è¿˜ä¸æ˜¯æœ€çƒ¦äººçš„ï¼Œæ›´é‡è¦çš„æ˜¯**å¦‚æœ<code>GGBond</code>ä¹Ÿè¢«ç»§æ‰¿ï¼Œé‚£ä¹ˆå®ƒçš„å­ç±»çš„<code>constructor</code>**ä¹Ÿä¼šæ˜¯<code>DeadPig</code>ï¼Œæ¥çœ‹ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//å¦‚æœGGBondä¹Ÿæœ‰å®ä¾‹ï¼Œé‚£åº”è¯¥é•¿è¿™æ ·</span><br>&#123;<br>    <span class="hljs-attr">__proto__</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>,<br>    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">DeadPig</span>,<br>    <span class="hljs-attr">food</span>: <span class="hljs-string">&quot;è¶…çº§æ£’æ£’ç³–&quot;</span>, <br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;GGBond&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœå®ƒå†è¢«ç»§æ‰¿ï¼Œé‚£ä¹ˆè¢«ç»§æ‰¿çš„æ„é€ å‡½æ•°åº”è¯¥é•¿è¿™æ ·ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>    <span class="hljs-attr">prototype</span>: &#123;<br>        <span class="hljs-attr">__proto__</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>,<br>        <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">DeadPig</span>,<br>        <span class="hljs-attr">food</span>: <span class="hljs-string">&quot;è¶…çº§æ£’æ£’ç³–&quot;</span>, <br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;GGBond&quot;</span>,<br>    &#125;<br>    <span class="hljs-comment">// ...å…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„å±æ€§</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£å®ƒçš„<code>constructor</code>è‡ªç„¶è€Œç„¶çš„ä¹Ÿæ˜¯<code>DeadPig</code></p><p>é‚£ä¹ˆå¦‚ä½•ä¿®æ”¹<code>constructor</code>å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæš´åŠ›ä¿®æ”¹å°±è¡Œäº†ğŸ˜¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-title class_">GGBond</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, <span class="hljs-string">&quot;constructor&quot;</span>, &#123;<br>    <span class="hljs-attr">enumberable</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-title class_">GGBond</span><br>&#125;)<br></code></pre></td></tr></table></figure><p>è¿™ä¸‹å°±åœ†æ»¡å’¯ğŸ¤£ä½†è¿˜æœ‰ä¸€äº›å°ç»†èŠ‚è¦æ</p><h2 id="5-æ·±å…¥ç†è§£æ„é€ å‡½æ•°å’ŒClass"><a href="#5-æ·±å…¥ç†è§£æ„é€ å‡½æ•°å’ŒClass" class="headerlink" title="5.æ·±å…¥ç†è§£æ„é€ å‡½æ•°å’ŒClass"></a>5.æ·±å…¥ç†è§£æ„é€ å‡½æ•°å’ŒClass</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">GGBond</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;ggb&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>name</code> å±æ€§æ˜¯æŒ‚è½½åˆ° <code>å®ä¾‹</code> ä¸Šçš„ï¼Œè€ŒéåŸå‹é“¾ã€‚å› æ­¤ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼š</p><p><img src="https://s2.loli.net/2023/11/17/kjg4xGHlWOPoybh.png" alt="image1"></p><p>å¯ä»¥çœ‹åˆ°<code>GGBond.prototype</code>å†…å¹¶æ²¡æœ‰è‡ªèº«çš„å±æ€§,å¦‚æœæƒ³è®©å±æ€§å­˜åˆ°åŸå‹é“¾ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ï¼š <code>Object.defineProperty(GGBond.prototype, &#39;name&#39;, &#123;value: value&#125;)</code> æˆ–è€… <code>GGBond.prototype[name] = value </code>æ¥å®ç°</p><hr><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GGBond</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;&#125;,<br>    <span class="hljs-attr">name</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-number">2</span>,<br>    <span class="hljs-title function_">getValue</span>(<span class="hljs-params"></span>) &#123;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä½†æ˜¯</strong>å¦‚æœåˆ°äº†<code>Class</code>ä¸­, <code>name</code>è¿™ç§å±æ€§è¿˜æ˜¯æŒ‚è½½åˆ°ç¤ºä¾‹ä¸Šï¼Œè€Œ<code>getValue</code>è¿™ç§æ–¹æ³•ï¼Œåˆ™ä¼š<strong>ç›´æ¥æŒ‚è½½åˆ°åŸå‹é“¾ä¸Š</strong></p><hr><p>è¿˜æœ‰ä¸€ä»¶å¾ˆæœ‰æ„æ€çš„äº‹æƒ…ï¼š</p><p>å¦‚æœä½ ä¿®æ”¹<code>prototype</code>çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶æ²¡æœ‰å®Œå…¨ä¿®æ”¹çš„è¯ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹ä¹‹å‰åˆ›å»ºçš„å®ä¾‹ä¼š<code>éšä¹‹ä¸€èµ·å˜åŠ¨</code></p><p>ä½†å¦‚æœå®Œå…¨ä¿®æ”¹ï¼Œé‚£ä¹ˆåœ¨<strong>ä¿®æ”¹ä¹‹å‰åˆ›å»ºçš„å®ä¾‹ä¼šåƒ<code>é—­åŒ…</code>ä¸€æ ·ä¸å—å½±å“</strong></p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> ggb = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GGBond</span>();<br><span class="hljs-title class_">GGBond</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">status</span> = <span class="hljs-string">&quot;dead&quot;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ggb.<span class="hljs-property">status</span>)<br><span class="hljs-comment">// &gt; dead</span><br><br><span class="hljs-title class_">GGBond</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = &#123;<br>    <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;alive&quot;</span><br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ggb.<span class="hljs-property">status</span>)<br><span class="hljs-comment">// &gt; dead</span><br></code></pre></td></tr></table></figure><blockquote><p>å‡ºç°è¿™ç§æƒ…å†µæ˜¯å› ä¸ºå½“ä¿®æ”¹ä¸€éƒ¨åˆ†å±æ€§çš„æ—¶å€™ï¼Œæ„é€ å‡½æ•°çš„<code>åŸå‹å¼•ç”¨</code>ä»æœªæ”¹å˜ï¼Œåªæ˜¯ä¿®æ”¹äº†å¼•ç”¨ä¸Šçš„å‡ ä¸ªæ–¹æ³•æˆ–å±æ€§ï¼Œè€Œ<code>js</code>åˆæ˜¯åŠ¨æ€æŸ¥æ‰¾ï¼Œæ‰€ä»¥ä¼šåŒæ­¥åˆ°æ‰€æœ‰æ„é€ å‡ºçš„å¯¹è±¡ã€‚è€Œä¸€æ—¦ä¿®æ”¹äº†æ•´ä¸ª<code>prrototype</code>ï¼Œåˆ™ä¼šå¯¼è‡´æ„é€ å‡½æ•°çš„<code>åŸå‹å¼•ç”¨</code>æ•´ä¸ªæ›´æ”¹ï¼Œè€Œ<strong>ä¹‹å‰æ„é€ çš„å¯¹è±¡ä»ä¿æŒä¹‹å‰çš„å¼•ç”¨</strong>ï¼Œå› æ­¤ä¸ä¼šæ”¹å˜</p></blockquote><p>æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯å’Œ<code>é—­åŒ…</code>æå…¶çš„ç›¸ä¼¼ğŸ˜</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>reactä¸¤å¤§å¾ªç¯</title>
    <link href="/2023/11/12/loopInReact/"/>
    <url>/2023/11/12/loopInReact/</url>
    
    <content type="html"><![CDATA[<h1 id="Reactä¸¤å¤§å¾ªç¯"><a href="#Reactä¸¤å¤§å¾ªç¯" class="headerlink" title="Reactä¸¤å¤§å¾ªç¯"></a>Reactä¸¤å¤§å¾ªç¯</h1><h2 id="ä¸€ã€äº‹ä»¶è°ƒåº¦å¾ªç¯"><a href="#ä¸€ã€äº‹ä»¶è°ƒåº¦å¾ªç¯" class="headerlink" title="ä¸€ã€äº‹ä»¶è°ƒåº¦å¾ªç¯"></a>ä¸€ã€äº‹ä»¶è°ƒåº¦å¾ªç¯</h2><p>è´Ÿè´£<code>ä»»åŠ¡è°ƒåº¦</code>ï¼Œæ˜¯æ•´ä¸ª<code>React</code>å·¥ä½œçš„æ ¸å¿ƒï¼Œå®ƒéœ€è¦å¾ªç¯è°ƒç”¨ï¼Œæ¥ä¿è¯æ‰€æœ‰<code>task</code>çš„è°ƒåº¦ã€‚</p><blockquote><p>å‰æ–‡æåˆ°<code>scheduler</code>ä¸»è¦æ¥å—æ¥è‡ª<code>reconciler</code>çš„å›è°ƒå‡½æ•°ï¼Œå¹¶è°ƒç”¨(<code>performSyncWorkOnRoot</code>æˆ–<code>performConcurrentWorkOnRoot</code>,è¿˜è®°å¾—å—ï¼ŸğŸ˜€)ï¼Œå¹¶ä¸”æ ¹æ®å›è°ƒç”Ÿæˆ<code>task</code>ã€‚å½“ <code>task</code>ç”Ÿæˆå®Œæ¯•ä¹‹åï¼Œ<code>äº‹ä»¶è°ƒåº¦å¾ªç¯</code>ä¼šæŒ‰ç…§<code>ä¼˜å…ˆçº§</code>è°ƒåº¦æ¯ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”ç”Ÿæˆå›è°ƒï¼Œä¼ ç»™<code>reconciler</code></p></blockquote><p><img src="https://s2.loli.net/2023/11/12/7aUPfbwRgTpSQrq.png"></p><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>å…¶å®<code>scheduler</code>çš„éƒ¨åˆ†ä¸æ­¢å›¾ä¸­è¿™äº›ï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„<code>performSyncWorkOnRoot</code>æˆ–<code>performConcurrentWorkOnRoot</code>ä¹Ÿå¤§æ¦‚æ˜¯<code>scheduler</code>çš„ä¸€éƒ¨åˆ†ï¼Œåˆ†åˆ«è´Ÿè´£<code>åŒæ­¥äº‹ä»¶å¤„ç†</code>å’Œ<code>å¹¶å‘äº‹ä»¶å¤„ç†</code>,åªä¸è¿‡åœ¨è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯<code>ensureRootIsScheduled</code>å°è£…åˆ°å›è°ƒå‡½æ•°<code>scheduleCallback</code>ä¸­å†è¢«<code>scheduler</code>ç‹¬ç«‹è°ƒç”¨çš„ï¼Œæ‰€ä»¥æŠŠä»–ä»¬æ”¾åœ¨äº†å¤–è¾¹ã€‚åŒæ ·çš„ï¼Œä¸‹å›¾ä¸­çš„<code>schedulerWithReactIntergration</code>ä¹Ÿå±äºschedulerçš„èŒƒç•´ï¼ˆçœ‹åå­—ä¹Ÿçœ‹å¾—å‡ºæ¥ğŸ¶ï¼‰</p></blockquote><h2 id="äºŒã€fiberæ„é€ å¾ªç¯-ReactFiberWorkLoop"><a href="#äºŒã€fiberæ„é€ å¾ªç¯-ReactFiberWorkLoop" class="headerlink" title="äºŒã€fiberæ„é€ å¾ªç¯(ReactFiberWorkLoop)"></a>äºŒã€fiberæ„é€ å¾ªç¯(ReactFiberWorkLoop)</h2><p>åªè´Ÿè´£<code>fiberæ ‘</code>çš„æ„é€ ï¼Œæ˜¯ä¸Šé¢<code>äº‹ä»¶è°ƒåº¦å¾ªç¯</code>çš„åç»­ï¼ˆåº”è¯¥å¯ä»¥è¿™ä¹ˆè¯´ï¼ŸğŸ˜ï¼‰éƒ¨åˆ†</p><p>æ¯æ¬¡<code>reconciler</code>æ¥æ”¶åˆ°æ›´æ–°è¯·æ±‚æ—¶ï¼Œä¼šå‘<code>scheduler</code>æ³¨å†Œä¸€ä¸ªä»»åŠ¡,è¿›å…¥åˆ°ä¸Šé¢â¬†ï¸å›¾ç‰‡çš„æµç¨‹ï¼ˆå³è¾¹ä¸¤ä¸ªç²‰ç²‰çš„ç®­å¤´æ¥æºå°±æ˜¯<code>reconciler</code>ï¼‰,<code>scheduler</code>é€šè¿‡<code>äº‹ä»¶è°ƒåº¦å¾ªç¯</code>æŠŠè¿™äº‹å®‰æ’äº†ï¼Œè¿”å›å›è°ƒ</p><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>ç”±äº<code>äº‹ä»¶è°ƒåº¦å¾ªç¯</code>ä¼šæ ¹æ®ä¼˜å…ˆçº§å®‰æ’ä»»åŠ¡ï¼Œæ‰€ä»¥æ¥æ”¶åˆ°æ›´æ–°è¯·æ±‚åä¸ä¸€å®šç«‹å³æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå°±åƒæ˜¯å­¦ç”Ÿäº‹åŠ¡å¤§å…ğŸ˜µ</p></blockquote><p>è¿™æ—¶å€™è¿˜æ²¡åˆ°å’±ä»¬çš„<code>fiberæ„é€ å¾ªç¯</code>å‘¢,åˆ«ç€æ€¥</p><p><img src="https://s2.loli.net/2023/11/12/fy3hNnuvwm5K7ac.png"></p><p>çœ‹åˆ°æ²¡ï¼Œåœ¨å†³å®šå®Œä½•æ—¶æ‰§è¡Œ<code>performSyncWorkOnRoot</code>æˆ–<code>performCocurrentWorkOnRoot</code>ä¹‹åï¼Œ<code>scheduler</code>æŠŠçš®çƒï¼ˆå°±æ˜¯<code>task</code>å•¦ğŸ¤ï¼‰è¸¢ç»™äº†<code>reconciler</code>ï¼Œ<code>reconciler</code>ç«‹å³æ‰§è¡Œè¿™ä¿©å‡½æ•°ï¼Œè°ƒç”¨<code>ReactFiberWorkLoop</code>æ„å»ºæ–°çš„<code>fiber tree</code>, æ„é€ å®Œä¹‹åï¼Œå°±ä¼šæ‰§è¡Œæœ€åæ“ä½œâ€“<code>commitRoot</code>ï¼ŒæŠŠæœ€æ–°çš„<code>fiber tree</code>æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚</p><p>ä½†é‚£å°±æ˜¯å¦ä¸€ä¸ªæ•…äº‹å’¯ğŸ˜</p><h2 id="ä¸‰ã€äºŒè€…è”ç³»å’ŒåŒºåˆ«"><a href="#ä¸‰ã€äºŒè€…è”ç³»å’ŒåŒºåˆ«" class="headerlink" title="ä¸‰ã€äºŒè€…è”ç³»å’ŒåŒºåˆ«"></a>ä¸‰ã€äºŒè€…è”ç³»å’ŒåŒºåˆ«</h2><ol><li>åŒºåˆ«<ul><li><code>ä»»åŠ¡è°ƒåº¦å¾ªç¯</code>æ˜¯ä»¥<code>äºŒå‰å †</code>ä¸ºæ•°æ®ç»“æ„, å¾ªç¯æ‰§è¡Œ<code>å †</code>çš„é¡¶ç‚¹, ç›´åˆ°<code>å †</code>è¢«æ¸…ç©º.</li><li><code>ä»»åŠ¡è°ƒåº¦å¾ªç¯</code>çš„é€»è¾‘åå‘å®è§‚, å®ƒè°ƒåº¦çš„æ˜¯æ¯ä¸€ä¸ªä»»åŠ¡(<code>task</code>), è€Œä¸å…³å¿ƒè¿™ä¸ªä»»åŠ¡å…·ä½“æ˜¯å¹²ä»€ä¹ˆçš„(ç”šè‡³å¯ä»¥å°†<code>Scheduler</code>åŒ…è„±ç¦»<code>react</code>ä½¿ç”¨), å…·ä½“ä»»åŠ¡å…¶å®å°±æ˜¯æ‰§è¡Œå›è°ƒå‡½æ•°<code>performSyncWorkOnRoot</code>æˆ–<code>performConcurrentWorkOnRoot</code>.</li><li><code>fiberæ„é€ å¾ªç¯</code>æ˜¯ä»¥<code>æ ‘</code>ä¸ºæ•°æ®ç»“æ„, ä»ä¸Šè‡³ä¸‹æ‰§è¡Œæ·±åº¦ä¼˜å…ˆéå†</li><li><code>fiberæ„é€ å¾ªç¯</code>çš„é€»è¾‘åå‘å…·ä½“å®ç°, å®ƒåªæ˜¯ä»»åŠ¡(<code>task</code>)çš„ä¸€éƒ¨åˆ†(å¦‚<code>performSyncWorkOnRoot</code>åŒ…æ‹¬: <code>fiber</code>æ ‘çš„æ„é€ , <code>DOM</code>æ¸²æŸ“, è°ƒåº¦æ£€æµ‹), åªè´Ÿè´£<code>fiber</code>æ ‘çš„æ„é€ .</li></ul></li><li>è”ç³»<ul><li><code>fiberæ„é€ å¾ªç¯</code>æ˜¯<code>ä»»åŠ¡è°ƒåº¦å¾ªç¯</code>ä¸­çš„ä»»åŠ¡(<code>task</code>)çš„ä¸€éƒ¨åˆ†. å®ƒä»¬æ˜¯ä»å±å…³ç³», æ¯ä¸ªä»»åŠ¡éƒ½ä¼šé‡æ–°æ„é€ ä¸€ä¸ª<code>fiber</code>æ ‘.</li></ul></li></ol><h2 id="å››ã€å¥½å¥‡å®å®"><a href="#å››ã€å¥½å¥‡å®å®" class="headerlink" title="å››ã€å¥½å¥‡å®å®"></a>å››ã€å¥½å¥‡å®å®</h2><p>å¥½å•¦ï¼Œçœ‹åˆ°è¿™é‡Œï¼Œä¸¤ä¸ªåŸºæœ¬å¾ªç¯å°±å·²ç»å·®ä¸å¤šå•¦ï¼Œä½†æ˜¯ä¸çŸ¥é“å„ä½æœ‰æ²¡æœ‰è·Ÿæˆ‘ä¸€æ ·çš„ç–‘æƒ‘ï¼Œå°±æ˜¯ <strong>æ„å»ºä¸ªç ´<code>fiber tree</code>è¦ä»€ä¹ˆå¾ªç¯å‘¢ï¼Ÿ</strong>ğŸ˜¡</p><p>ä¸ºæ­¤ï¼Œæˆ‘å»é—®äº†GPTå¤§äºº, ä»¥ä¸‹æ˜¯å®ƒçš„å›ç­”ï¼š</p><blockquote><p>åœ¨Fiberæ¶æ„ä¹‹å‰ï¼ŒReactçš„æ›´æ–°è¿‡ç¨‹æ˜¯<strong>é€’å½’çš„ä¸”ä¸èƒ½ä¸­æ–­</strong>ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦å¼€å§‹æ›´æ–°è¿‡ç¨‹ï¼Œå°±å¿…é¡»ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œå³ä½¿å®ƒå¯èƒ½é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´ç”¨æˆ·ç•Œé¢å˜å¾—æ— å“åº”ã€‚</p><p>Fiberæ¶æ„é€šè¿‡å¼•å…¥å·¥ä½œå¾ªç¯å’ŒFiberæ ‘æ¥è§£å†³è¿™äº›é—®é¢˜ï¼š</p><ol><li><strong>å¢é‡æ¸²æŸ“</strong>ï¼š<ul><li>é€šè¿‡å°†æ¸²æŸ“å·¥ä½œåˆ†è§£æˆå°çš„å•å…ƒï¼ŒReactå¯ä»¥åœ¨éœ€è¦æ—¶æš‚åœå’Œæ¢å¤å·¥ä½œã€‚è¿™ç§æ–¹å¼è¢«ç§°ä¸ºå¢é‡æ¸²æŸ“ï¼ˆIncremental Renderingï¼‰ã€‚</li></ul></li><li><strong>ä»»åŠ¡å¯ä¸­æ–­</strong>ï¼š<ul><li>å·¥ä½œå¾ªç¯å…è®¸Reactçš„æ¸²æŸ“è¿‡ç¨‹å¯ä»¥è¢«ä¸­æ–­ã€‚å½“æµè§ˆå™¨éœ€è¦æ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå¦‚å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ŒReactå¯ä»¥ä¸­æ–­æ­£åœ¨è¿›è¡Œçš„æ¸²æŸ“ï¼Œå…ˆå»å“åº”ç”¨æˆ·çš„æ“ä½œã€‚</li></ul></li><li><strong>ä»»åŠ¡ä¼˜å…ˆçº§</strong>ï¼š<ul><li>ä¸åŒçš„æ›´æ–°å¯ä»¥æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ã€‚Reactå¯ä»¥å†³å®šå“ªäº›æ›´æ–°æ˜¯ç´§æ€¥çš„ï¼Œå“ªäº›å¯ä»¥ç¨åå†å¤„ç†ã€‚</li></ul></li><li><strong>æ›´å¥½çš„èµ„æºç®¡ç†</strong>ï¼š<ul><li>ä½¿ç”¨å·¥ä½œå¾ªç¯ï¼ŒReactå¯ä»¥æ ¹æ®æµè§ˆå™¨çš„å¸§ç‡å’Œå…¶ä»–æŒ‡æ ‡æ¥è°ƒæ•´å·¥ä½œè´Ÿè½½ï¼Œè¿™æœ‰åŠ©äºé¿å…æ‰å¸§ï¼Œä½¿å¾—åº”ç”¨çœ‹èµ·æ¥æ›´å¹³æ»‘ã€‚</li></ul></li><li><strong>å¹¶å‘æ¨¡å¼</strong>ï¼š<ul><li>Fiberæ¶æ„æ˜¯Reactå¹¶å‘æ¨¡å¼ï¼ˆConcurrent Modeï¼‰çš„åŸºç¡€ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒReactå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªæ›´æ–°ï¼Œè€Œä¸”å¯ä»¥æ ¹æ®æ›´æ–°çš„é‡è¦æ€§æ¥è°ƒæ•´å®ƒä»¬çš„å®Œæˆé¡ºåºã€‚</li></ul></li></ol><p>åœ¨æ„å»ºFiberæ ‘æ—¶ä½¿ç”¨å·¥ä½œå¾ªç¯ä½¿å¾—Reactèƒ½å¤Ÿæ›´åŠ çµæ´»å’Œé«˜æ•ˆåœ°å¤„ç†æ›´æ–°ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ä¿æŒåº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒæ–¹é¢éƒ½æœ‰é‡å¤§æ”¹è¿›çš„æ¶æ„å†³ç­–ã€‚é€šè¿‡å·¥ä½œå¾ªç¯ï¼ŒReactå¯ä»¥æ›´æ™ºèƒ½åœ°åˆ©ç”¨æµè§ˆå™¨çš„ä¸»çº¿ç¨‹ï¼Œé¿å…é•¿æ—¶é—´å ç”¨å¯¼è‡´çš„ç”¨æˆ·ç•Œé¢å¡é¡¿ï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p></blockquote><p>çœ‹æ¥è¿™æ˜¯<code>æ¸²æŸ“</code>å’Œ<code>scheduler</code>çš„ä¸€åœºå®«æ–—å¤§æˆå•ŠğŸ¤£ï¼ŒåŸæ¥çš„<code>æ¸²æŸ“</code>æ˜¯è€å¤§ï¼Œè°éƒ½åŠ¨ä¸äº†ä»–ï¼Œä¹‹å<code>schduler</code>è¢«å® å¹¸ï¼Œåœ°ä½ä¸Šå»äº†ï¼Œæ¸²æŸ“å°±è¢«æ‰“å…¥<code>ReactFiberWorkLoop</code>è¿™ä¸ªå†·å®«ğŸ¥¶ï¼Œä»»<code>scheduler</code>æ‘†å¸ƒ</p><p>è™½ç„¶å¦‚æ­¤ï¼Œè¿˜æ˜¯æ”¯æŒ<code>fiber loop</code>æ­£ä¹‰è–„çº±ï¼Œ æ¯•ç«Ÿç”¨æˆ·æ‰æ˜¯å”¯ä¸€æ­£å®«ğŸ¤£</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>reactè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>reactè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>reactåŸºæœ¬åŒ…</title>
    <link href="/2023/11/05/ReactBasePackage/"/>
    <url>/2023/11/05/ReactBasePackage/</url>
    
    <content type="html"><![CDATA[<h1 id="React-åº”ç”¨çš„å®è§‚åŒ…ç»“æ„-web-å¼€å‘"><a href="#React-åº”ç”¨çš„å®è§‚åŒ…ç»“æ„-web-å¼€å‘" class="headerlink" title="React åº”ç”¨çš„å®è§‚åŒ…ç»“æ„(web å¼€å‘)"></a>React åº”ç”¨çš„å®è§‚åŒ…ç»“æ„(web å¼€å‘)</h1><blockquote><p>React å·¥ç¨‹ç›®å½•çš„ packages ä¸‹åŒ…å« 35 ä¸ªåŒ…(<a href="https://github.com/facebook/react/tree/v17.0.2"><code>@17.0.2</code>ç‰ˆæœ¬</a>).<br>å…¶ä¸­ä¸<code>web</code>å¼€å‘ç›¸å…³çš„æ ¸å¿ƒåŒ…å…±æœ‰ 4 ä¸ª</p></blockquote><h2 id="åŸºç¡€åŒ…ç»“æ„"><a href="#åŸºç¡€åŒ…ç»“æ„" class="headerlink" title="åŸºç¡€åŒ…ç»“æ„"></a>åŸºç¡€åŒ…ç»“æ„</h2><ol><li><p>react</p><blockquote><p>react åŸºç¡€åŒ…, åªæä¾›å®šä¹‰ react ç»„ä»¶(<code>ReactElement</code>)çš„å¿…è¦å‡½æ•°, ä¸€èˆ¬æ¥è¯´éœ€è¦å’Œæ¸²æŸ“å™¨(<code>react-dom</code>,<code>react-native</code>)ä¸€åŒä½¿ç”¨. åœ¨ç¼–å†™<code>react</code>åº”ç”¨çš„ä»£ç æ—¶, å¤§éƒ¨åˆ†éƒ½æ˜¯è°ƒç”¨æ­¤åŒ…çš„ api.</p></blockquote></li><li><p>react-dom</p><blockquote><p>react æ¸²æŸ“å™¨ä¹‹ä¸€, æ˜¯ react ä¸ web å¹³å°è¿æ¥çš„æ¡¥æ¢(å¯ä»¥åœ¨æµè§ˆå™¨å’Œ nodejs ç¯å¢ƒä¸­ä½¿ç”¨), å°†<code>react-reconciler</code>ä¸­çš„è¿è¡Œç»“æœè¾“å‡ºåˆ° web ç•Œé¢ä¸Š. åœ¨ç¼–å†™<code>react</code>åº”ç”¨çš„ä»£ç æ—¶,å¤§å¤šæ•°åœºæ™¯ä¸‹, èƒ½ç”¨åˆ°æ­¤åŒ…çš„å°±æ˜¯ä¸€ä¸ªå…¥å£å‡½æ•°<code>ReactDOM.render(&lt;App/&gt;, document.getElementById(&#39;root&#39;))</code>, å…¶ä½™ä½¿ç”¨çš„ api, åŸºæœ¬æ˜¯<code>react</code>åŒ…æä¾›çš„.</p></blockquote></li><li><p>react-reconciler</p><blockquote><p>react å¾—ä»¥è¿è¡Œçš„æ ¸å¿ƒåŒ…(ç»¼åˆåè°ƒ<code>react-dom</code>,<code>react</code>,<code>scheduler</code>å„åŒ…ä¹‹é—´çš„è°ƒç”¨ä¸é…åˆ).<br>ç®¡ç† react åº”ç”¨çŠ¶æ€çš„è¾“å…¥å’Œç»“æœçš„è¾“å‡º. å°†è¾“å…¥ä¿¡å·æœ€ç»ˆè½¬æ¢æˆè¾“å‡ºä¿¡å·ä¼ é€’ç»™æ¸²æŸ“å™¨.</p></blockquote><ul><li>æ¥å—è¾“å…¥(<code>scheduleUpdateOnFiber</code>), å°†<code>fiber</code>æ ‘ç”Ÿæˆé€»è¾‘å°è£…åˆ°ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­(æ¶‰åŠ<code>fiber</code>æ ‘å½¢ç»“æ„, <code>fiber.updateQueue</code>é˜Ÿåˆ—, è°ƒå’Œç®—æ³•ç­‰),</li><li>æŠŠæ­¤å›è°ƒå‡½æ•°(<code>performSyncWorkOnRoot</code>æˆ–<code>performConcurrentWorkOnRoot</code>)é€å…¥<code>scheduler</code>è¿›è¡Œè°ƒåº¦</li><li><code>scheduler</code>ä¼šæ§åˆ¶å›è°ƒå‡½æ•°æ‰§è¡Œçš„æ—¶æœº, å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæˆåå¾—åˆ°å…¨æ–°çš„ fiber æ ‘</li><li>å†è°ƒç”¨æ¸²æŸ“å™¨(å¦‚<code>react-dom</code>, <code>react-native</code>ç­‰)å°† fiber æ ‘å½¢ç»“æ„æœ€ç»ˆåæ˜ åˆ°ç•Œé¢ä¸Š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">ä¸»è¦èŒè´£æ˜¯å¤„ç†ç»„ä»¶æ ‘çš„æ›´æ–°ã€‚è¿™åŒ…æ‹¬æ¯”è¾ƒæ—§çš„ç»„ä»¶æ ‘ä¸æ–°çš„ç»„ä»¶æ ‘ï¼ˆç”±ç»„ä»¶çš„çŠ¶æ€æˆ–å±æ€§å˜åŒ–è§¦å‘ï¼‰,ä¹Ÿå°±æ˜¯diffç®—æ³•ï¼Œå¹¶å†³å®šéœ€è¦è¿›è¡Œå“ªäº›DOMæ›´æ–°ã€‚Reconciler è¿˜å†³å®šæ›´æ–°çš„ä¼˜å…ˆçº§ï¼Œå¹¶ä¸ºè¿™äº›æ›´æ–°ç”Ÿæˆå·¥ä½œå•å…ƒï¼ˆå³Fibersï¼‰ã€‚`performSyncWorkOnRoot` æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¢«è°ƒç”¨ï¼Œç”¨äºå¤„ç†é‚£äº›è¢«æ ‡è®°ä¸ºåŒæ­¥çš„æ›´æ–°ä»»åŠ¡<br></code></pre></td></tr></table></figure></li><li><p>scheduler</p><blockquote><p>è°ƒåº¦æœºåˆ¶çš„æ ¸å¿ƒå®ç°, æ§åˆ¶ç”±<code>react-reconciler</code>é€å…¥çš„å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœº, åœ¨<code>concurrent</code>æ¨¡å¼ä¸‹å¯ä»¥å®ç°ä»»åŠ¡åˆ†ç‰‡. åœ¨ç¼–å†™<code>react</code>åº”ç”¨çš„ä»£ç æ—¶, åŒæ ·å‡ ä¹ä¸ä¼šç›´æ¥ç”¨åˆ°æ­¤åŒ…æä¾›çš„ api.</p></blockquote><ul><li>æ ¸å¿ƒä»»åŠ¡å°±æ˜¯æ‰§è¡Œå›è°ƒ(å›è°ƒå‡½æ•°ç”±<code>react-reconciler</code>æä¾›)</li><li>é€šè¿‡æ§åˆ¶å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœº, æ¥è¾¾åˆ°ä»»åŠ¡åˆ†ç‰‡çš„ç›®çš„, å®ç°å¯ä¸­æ–­æ¸²æŸ“(<code>concurrent</code>æ¨¡å¼ä¸‹æ‰æœ‰æ­¤ç‰¹æ€§)</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">ä¸ªäººç†è§£ï¼Œå®ƒå°±åƒæ˜¯ä¸ªå°†å†›ï¼Œè´Ÿè´£æŒ‡æŒ¥ä¹‹åçš„ä»»åŠ¡ï¼Œåè¾¹çš„å°å¼Ÿéƒ½å¾—å¬ä»–çš„<br></code></pre></td></tr></table></figure></li></ol><h2 id="å®è§‚æ€»è§ˆ"><a href="#å®è§‚æ€»è§ˆ" class="headerlink" title="å®è§‚æ€»è§ˆ"></a>å®è§‚æ€»è§ˆ</h2><h3 id="æ¶æ„åˆ†å±‚"><a href="#æ¶æ„åˆ†å±‚" class="headerlink" title="æ¶æ„åˆ†å±‚"></a>æ¶æ„åˆ†å±‚</h3><p>ä¸ºäº†ä¾¿äºç†è§£, å¯å°† react åº”ç”¨æ•´ä½“ç»“æ„åˆ†ä¸ºæ¥å£å±‚(<code>api</code>)å’Œå†…æ ¸å±‚(<code>core</code>)2 ä¸ªéƒ¨åˆ†</p><ol><li><p>æ¥å£å±‚(api)<br><code>react</code>åŒ…, å¹³æ—¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ç»å¤§éƒ¨åˆ†<code>api</code>å‡æ¥è‡ªæ­¤åŒ…(ä¸æ˜¯æ‰€æœ‰). åœ¨<code>react</code>å¯åŠ¨ä¹‹å, æ­£å¸¸å¯ä»¥æ”¹å˜æ¸²æŸ“çš„åŸºæœ¬æ“ä½œæœ‰ 3 ä¸ª.</p><ul><li>class ç»„ä»¶ä¸­ä½¿ç”¨<code>setState()</code></li><li>function ç»„ä»¶é‡Œé¢ä½¿ç”¨ hook,å¹¶å‘èµ·<code>dispatchAction</code>å»æ”¹å˜ hook å¯¹è±¡</li><li>æ”¹å˜ context(å…¶å®ä¹Ÿéœ€è¦<code>setState</code>æˆ–<code>dispatchAction</code>çš„è¾…åŠ©æ‰èƒ½æ”¹å˜)</li></ul><p>ä»¥ä¸Š<code>setState</code>å’Œ<code>dispatchAction</code>éƒ½ç”±<code>react</code>åŒ…ç›´æ¥æš´éœ². æ‰€ä»¥è¦æƒ³ react å·¥ä½œ, åŸºæœ¬ä¸Šæ˜¯è°ƒç”¨<code>react</code>åŒ…çš„ api å»ä¸å…¶ä»–åŒ…è¿›è¡Œäº¤äº’.</p></li><li><p>å†…æ ¸å±‚(core)<br>æ•´ä¸ªå†…æ ¸éƒ¨åˆ†, ç”± 3 éƒ¨åˆ†æ„æˆ:</p><ol><li>è°ƒåº¦å™¨<br><code>scheduler</code>åŒ…, æ ¸å¿ƒèŒè´£åªæœ‰ 1 ä¸ª, å°±æ˜¯æ‰§è¡Œå›è°ƒ.<ul><li>æŠŠ<code>react-reconciler</code>æä¾›çš„å›è°ƒå‡½æ•°, åŒ…è£…åˆ°ä¸€ä¸ªä»»åŠ¡å¯¹è±¡ä¸­.</li><li>åœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—, ä¼˜å…ˆçº§é«˜çš„æ’åœ¨æœ€å‰é¢.</li><li>å¾ªç¯æ¶ˆè´¹ä»»åŠ¡é˜Ÿåˆ—, ç›´åˆ°é˜Ÿåˆ—æ¸…ç©º.</li></ul></li><li>æ„é€ å™¨<br><code>react-reconciler</code>åŒ…, æœ‰ 3 ä¸ªæ ¸å¿ƒèŒè´£:<ol><li>è£…è½½æ¸²æŸ“å™¨, æ¸²æŸ“å™¨å¿…é¡»å®ç°<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/README.md#practical-examples"><code>HostConfig</code>åè®®</a>(å¦‚: <code>react-dom</code>), ä¿è¯åœ¨éœ€è¦çš„æ—¶å€™, èƒ½å¤Ÿæ­£ç¡®è°ƒç”¨æ¸²æŸ“å™¨çš„ api, ç”Ÿæˆå®é™…èŠ‚ç‚¹(å¦‚: <code>dom</code>èŠ‚ç‚¹).</li><li>æ¥æ”¶<code>react-dom</code>åŒ…(åˆæ¬¡<code>render</code>)å’Œ<code>react</code>åŒ…(åç»­æ›´æ–°<code>setState</code>)å‘èµ·çš„æ›´æ–°è¯·æ±‚.</li><li>å°†<code>fiber</code>æ ‘çš„æ„é€ è¿‡ç¨‹åŒ…è£…åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­, å¹¶å°†æ­¤å›è°ƒå‡½æ•°ä¼ å…¥åˆ°<code>scheduler</code>åŒ…ç­‰å¾…è°ƒåº¦.</li></ol></li><li>æ¸²æŸ“å™¨<br><code>react-dom</code>åŒ…, æœ‰ 2 ä¸ªæ ¸å¿ƒèŒè´£:<ol><li>å¼•å¯¼<code>react</code>åº”ç”¨çš„å¯åŠ¨(é€šè¿‡<code>ReactDOM.render</code>).</li><li>å®ç°<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/README.md#practical-examples"><code>HostConfig</code>åè®®</a>, èƒ½å¤Ÿå°†<code>react-reconciler</code>åŒ…æ„é€ å‡ºæ¥çš„<code>fiber</code>æ ‘è¡¨ç°å‡ºæ¥, ç”Ÿæˆ dom èŠ‚ç‚¹(æµè§ˆå™¨ä¸­), ç”Ÿæˆå­—ç¬¦ä¸²(ssr).</li></ol></li></ol></li></ol><h3 id="å†…æ ¸å…³ç³»"><a href="#å†…æ ¸å…³ç³»" class="headerlink" title="å†…æ ¸å…³ç³»"></a>å†…æ ¸å…³ç³»</h3><p>ç°å°†å†…æ ¸ 3 ä¸ªåŒ…çš„ä¸»è¦èŒè´£å’Œè°ƒç”¨å…³ç³», ç»˜åˆ¶åˆ°ä¸€å¼ æ¦‚è§ˆå›¾ä¸Š:</p><p><img src="https://s2.loli.net/2023/11/05/fPF5V7rGqxmtkjw.png"></p><p>æ³¨æ„:</p><ul><li>çº¢è‰²æ–¹å—ä»£è¡¨å…¥å£å‡½æ•°, ç»¿è‰²æ–¹å—ä»£è¡¨å‡ºå£å‡½æ•°.</li><li>package ä¹‹é—´çš„è°ƒç”¨è„‰ç»œå°±æ˜¯é€šè¿‡æ¿å—é—´çš„å…¥å£å’Œå‡ºå£å‡½æ•°è¿æ¥èµ·æ¥çš„.</li></ul>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>reactè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>reactè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Symbolå…¬è®¤ç¬¦å·</title>
    <link href="/2023/10/29/Symbol/"/>
    <url>/2023/10/29/Symbol/</url>
    
    <content type="html"><![CDATA[<h2 id="Symbolçš„å…¬è®¤ç¬¦å·"><a href="#Symbolçš„å…¬è®¤ç¬¦å·" class="headerlink" title="Symbolçš„å…¬è®¤ç¬¦å·"></a>Symbolçš„å…¬è®¤ç¬¦å·</h2><h3 id="ç»å…¸é¢è¯•é¢˜èµ·æ‰‹ğŸ˜€"><a href="#ç»å…¸é¢è¯•é¢˜èµ·æ‰‹ğŸ˜€" class="headerlink" title="ç»å…¸é¢è¯•é¢˜èµ·æ‰‹ğŸ˜€"></a>ç»å…¸é¢è¯•é¢˜èµ·æ‰‹ğŸ˜€</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dts">let <span class="hljs-attr">girlfriend</span><span class="hljs-operator">=</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">    name:</span>â€™è‚–é¹¿ğŸ˜â€™,<br><span class="hljs-symbol">    age:</span><span class="hljs-number">18</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>è¦å®ç°ä»¥ä¸‹æ•ˆæœï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>([...pro]) <br><span class="hljs-comment">// è¾“å‡º [&#x27;è‚–é¹¿ğŸ˜&#x27;, 18]</span><br></code></pre></td></tr></table></figure><p>å’±ä»¬çŸ¥é“ <code>[...arg]</code> è¿™ç§å±•å¼€æ–¹æ³•åªèƒ½å¯¹ <code>å¯è¿­ä»£å¯¹è±¡</code> ä½¿ç”¨ï¼Œç„¶è€Œå¯è¿­ä»£å¯¹è±¡åªåŒ…æ‹¬ <code>Map, Set, Array, WeakMap</code>ï¼Œé‚£ä¹ˆå¦‚ä½•è®©ä¸€ä¸ªæ™®é€šå¯¹è±¡å˜å¾—å¯è¿­ä»£å‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ°å’±ä»¬ä»Šå¤©è¯´çš„å…¬è®¤ç¬¦å·å•¦â˜‘ï¸</p><hr><h3 id="1-è¶çƒ­æ‰“é“ï¼ŒSymbol-iterator-å’Œ-Symbol-asyncIteratorğŸ˜"><a href="#1-è¶çƒ­æ‰“é“ï¼ŒSymbol-iterator-å’Œ-Symbol-asyncIteratorğŸ˜" class="headerlink" title="1. è¶çƒ­æ‰“é“ï¼ŒSymbol.iterator å’Œ Symbol.asyncIteratorğŸ˜"></a>1. è¶çƒ­æ‰“é“ï¼ŒSymbol.iterator å’Œ Symbol.asyncIteratorğŸ˜</h3><p>è¿™ä¸€åˆ»ä¹Ÿæ²¡æœ‰ä¸ºå¯è¿­ä»£å¯¹è±¡å“€æ‚¼ï¼Œå³å°†èµ¶åˆ°æˆ˜åœºçš„æ˜¯ <code>Symbol.iterator</code>, å®ƒçš„ä½œç”¨å°±æ˜¯è®©ä¸€ä¸ªæ™®é€šå¯¹è±¡è½¬å˜ä¸ºä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå®ç°çš„å§ğŸ¤©</p><p>å°±æ¯”å¦‚è¯´å’±ä»¬æœ€ç†Ÿæ‚‰çš„ <code>map</code> æ–¹æ³•ï¼Œå½“æˆ‘ä»¬ <code>map</code> çš„æ—¶å€™ï¼Œ<code>iterator</code>èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ è®©æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„ <code>map</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">map</span>(<span class="hljs-params">ite, f</span>) &#123;<br>    <span class="hljs-comment">// ç”Ÿæˆè¿­ä»£å™¨</span><br>    <span class="hljs-keyword">let</span> iterator = ite[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]()<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-comment">// è¿­ä»£å™¨è‡ªèº«ä¹Ÿè¿­ä»£ï¼Œæ›´ç¬¦åˆé€»è¾‘</span><br>        [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;<br>        &#125;<br>        <span class="hljs-comment">// è¿­ä»£å™¨å¿…é¡»æœ‰ä¸€ä¸ªnext()æ–¹æ³•</span><br>        <span class="hljs-title function_">next</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">let</span> res = iterator.<span class="hljs-title function_">next</span>()<br>            <span class="hljs-keyword">if</span>(res.<span class="hljs-property">done</span>) &#123;<br>                <span class="hljs-keyword">return</span> res<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> &#123;<span class="hljs-attr">value</span>: <span class="hljs-title function_">f</span>(res.<span class="hljs-property">value</span>)&#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">åœ¨ `f<span class="hljs-literal">or</span>/of` å¾ªç¯é‡Œï¼Œä¼šå…ˆè°ƒç”¨ `symbol.iterator` ç”Ÿæˆè¿­ä»£å™¨ï¼Œä¹‹åä¸€ç›´è°ƒç”¨ `next()` æ–¹æ³•ï¼Œç›´åˆ°è¿”å›çš„ `done` ä¸º `true`ğŸ˜<br></code></pre></td></tr></table></figure><p>ç°åœ¨å†çœ‹é‚£é“é¢è¯•é¢˜ï¼Œæ˜¯ä¸æ˜¯å°±è¿åˆƒè€Œè§£äº†ğŸ˜—</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> girlfriend= &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;è‚–é¹¿ğŸ˜&#x27;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,<br>    [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">const</span> that = <span class="hljs-variable language_">this</span><br>        <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-title function_">next</span>(<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-keyword">return</span> count &lt; <span class="hljs-number">2</span> ? &#123;<span class="hljs-attr">value</span>:that[<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(that)[count++]]&#125; : &#123;<span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>&#125;<br>            &#125;,<br>            [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() &#123;<span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>&#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([...girlfriend])<br><br></code></pre></td></tr></table></figure><p>è¿™æ ·å…¶å®è¿˜æœ‰ç‚¹éº»çƒ¦ï¼Œå¯ä»¥å’Œç”Ÿæˆå™¨ç»“åˆğŸ˜ï¼Œ ç”±äºç”Ÿæˆå™¨ä¹Ÿæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œæ‰€ä»¥å¯ä»¥å°†ä¸Šé¢çš„ä»£ç ç®€åŒ–ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> girlfriend=&#123;<br>    <span class="hljs-attr">name</span>:â€™è‚–é¹¿ğŸ˜â€™,<br>    <span class="hljs-attr">age</span>:<span class="hljs-number">18</span><br>    *[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]()&#123;<br>        <span class="hljs-keyword">yield</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;<br>        <span class="hljs-keyword">yield</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å½“æ—¶æˆ‘çœ‹åˆ°è¿™ä¸ªçš„æ—¶å€™ç¡®å®è¢«éœ‡æ’¼åˆ°äº†ï¼ŒåŸæ¥è¿˜å¯ä»¥è¿™ä¹ˆç©ğŸŒŸ</p><h4 id="asyncç‰ˆæœ¬çš„iteratoråŠŸèƒ½æ›´å¼ºå¤§ï¼Œå¯ä»¥å¼‚æ­¥æ§åˆ¶è¿­ä»£å™¨çš„è¾“å‡ºï¼Œä½†æ˜¯è¿™ä¸æ˜¯å’±ä»¬ä»Šå¤©çš„é‡ç‚¹ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å»çœ‹çœ‹ğŸ¦ä¹¦çš„ç¬¬12ç« æœ«å°¾ï¼Œæœ‰ä¸€ä¸ªå¼‚æ­¥å¯è¿­ä»£é˜Ÿåˆ—çš„ä¾‹å­"><a href="#asyncç‰ˆæœ¬çš„iteratoråŠŸèƒ½æ›´å¼ºå¤§ï¼Œå¯ä»¥å¼‚æ­¥æ§åˆ¶è¿­ä»£å™¨çš„è¾“å‡ºï¼Œä½†æ˜¯è¿™ä¸æ˜¯å’±ä»¬ä»Šå¤©çš„é‡ç‚¹ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å»çœ‹çœ‹ğŸ¦ä¹¦çš„ç¬¬12ç« æœ«å°¾ï¼Œæœ‰ä¸€ä¸ªå¼‚æ­¥å¯è¿­ä»£é˜Ÿåˆ—çš„ä¾‹å­" class="headerlink" title="asyncç‰ˆæœ¬çš„iteratoråŠŸèƒ½æ›´å¼ºå¤§ï¼Œå¯ä»¥å¼‚æ­¥æ§åˆ¶è¿­ä»£å™¨çš„è¾“å‡ºï¼Œä½†æ˜¯è¿™ä¸æ˜¯å’±ä»¬ä»Šå¤©çš„é‡ç‚¹ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å»çœ‹çœ‹ğŸ¦ä¹¦çš„ç¬¬12ç« æœ«å°¾ï¼Œæœ‰ä¸€ä¸ªå¼‚æ­¥å¯è¿­ä»£é˜Ÿåˆ—çš„ä¾‹å­"></a>asyncç‰ˆæœ¬çš„iteratoråŠŸèƒ½æ›´å¼ºå¤§ï¼Œå¯ä»¥å¼‚æ­¥æ§åˆ¶è¿­ä»£å™¨çš„è¾“å‡ºï¼Œä½†æ˜¯è¿™ä¸æ˜¯å’±ä»¬ä»Šå¤©çš„é‡ç‚¹ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å»çœ‹çœ‹ğŸ¦ä¹¦çš„ç¬¬12ç« æœ«å°¾ï¼Œæœ‰ä¸€ä¸ªå¼‚æ­¥å¯è¿­ä»£é˜Ÿåˆ—çš„ä¾‹å­</h4><hr><h3 id="2-å®šå½¢æ•°ç»„çš„çˆ¹ï¼ŒSymbol-hasInstanceğŸ˜€"><a href="#2-å®šå½¢æ•°ç»„çš„çˆ¹ï¼ŒSymbol-hasInstanceğŸ˜€" class="headerlink" title="2. å®šå½¢æ•°ç»„çš„çˆ¹ï¼ŒSymbol.hasInstanceğŸ˜€"></a>2. å®šå½¢æ•°ç»„çš„çˆ¹ï¼ŒSymbol.hasInstanceğŸ˜€</h3><p>åœ¨ <strong>ES6</strong> ä¸­ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>instanceof </code> çš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨<code> [Symbol.hasInstance]</code>è¿™ä¸ªæ–¹æ³•ï¼Œ å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œåˆ™ä¼šé‡‡ç”¨ <strong>ES5</strong> çš„æ–¹æ³•ï¼Œä»åŸå‹é“¾ä¸ŠæŸ¥æ‰¾å®ƒçš„prototype</p><p><strong>è¿™å°±å¯ä»¥è‡ªå®šä¹‰instanceofå•¦ï¼</strong></p><p>æ¥çœ‹ğŸŒ°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> uint8 = &#123;<br>    [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">hasInstance</span>]() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(x) &amp;&amp; x &gt;= <span class="hljs-number">0</span> &amp;&amp; x &lt;= <span class="hljs-number">256</span><br>    &#125;<br>&#125;<br><br><span class="hljs-number">128</span> <span class="hljs-keyword">instanceof</span> uint8<br><br></code></pre></td></tr></table></figure><h3 id="3-Symbol-toStringTag"><a href="#3-Symbol-toStringTag" class="headerlink" title="3. Symbol.toStringTag"></a>3. Symbol.toStringTag</h3><p>è¿™ä¸ªå°±å‰å®³äº†ï¼Œ åœ¨ <code>ES6</code>ä¸­ï¼Œ toStringæ–¹æ³•ä¼šå…ˆè°ƒç”¨<code>Symbol.toStringTag</code>, å¦‚æœæ²¡æœ‰ï¼Œ é‚£å°±æ˜¯ç»å…¸çš„ <code>[Object, Object]</code></p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">girlfriend</span> &#123;<br>    [<span class="hljs-built_in">Symbol</span>.toStringTag]= <span class="hljs-string">&quot;è‚–é¹¿å°å§ğŸ˜&quot;</span><br>&#125;<br><br> <span class="hljs-regexp">//</span> get [<span class="hljs-built_in">Symbol</span>.toStringTag]() &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è‚–é¹¿å°å§ğŸ˜&quot;</span>&#125; è¿™æ ·ç”¨getterå®šä¹‰æ›´åŠ ä¸“ä¸šï¼Œå¹¶ä¸”ä¸ä¼šè¢«æšä¸¾<br><br>let MyWife = <span class="hljs-keyword">new</span> girlfriend()<br><br>console.log(MyWife.toString())<br></code></pre></td></tr></table></figure><h3 id="4-Symbol-species"><a href="#4-Symbol-species" class="headerlink" title="4. Symbol.species"></a>4. Symbol.species</h3><p>è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå†·é—¨ï¼Œä½†æ˜¯ç¡®å®å®ç”¨ï¼Œåœ¨ <code>ES6</code> ä¸­ï¼Œ ç»§æ‰¿çš„æ—¶å€™ä¼šæŠŠä¸Šä¸€å±‚çš„speciesä¹Ÿç»§æ‰¿è¿‡æ¥ï¼Œ<code>map</code> ä»¥åŠ <code>slice</code> ç­‰å‡½æ•°ä¼šå…ˆè°ƒç”¨ <code>new this.constructor[Symbol.species]() åˆ›å»ºæ–°æ•°ç»„</code></p><p>æ¯”å¦‚ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">WifeArray</span> <span class="hljs-title">extends</span> <span class="hljs-title">Array</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> [Symbol.species]() &#123;<span class="hljs-keyword">return</span> WifeArray&#125;<br>    <span class="hljs-keyword">get</span> [Symbol.toStringTag]() &#123;<span class="hljs-keyword">return</span> WifeArray&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">get</span> <span class="hljs-title">first</span>()</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>]&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">get</span> <span class="hljs-title">last</span>()</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[<span class="hljs-keyword">this</span>.length<span class="hljs-number">-1</span>]&#125;<br>&#125;<br><br><span class="hljs-keyword">let</span> e = <span class="hljs-keyword">new</span> WifeArray(<span class="hljs-string">&#x27;è‚–&#x27;</span>, <span class="hljs-string">&#x27;é¹¿&#x27;</span>, <span class="hljs-string">&#x27;ğŸ˜&#x27;</span>)<br><span class="hljs-keyword">let</span> f = e.map(item =&gt; item + <span class="hljs-string">&#x27;ğŸ¥°&#x27;</span>)<br>console.log(f)<br></code></pre></td></tr></table></figure><h3 id="5-Symbol-isConcatSpreadableğŸ¤"><a href="#5-Symbol-isConcatSpreadableğŸ¤" class="headerlink" title="5. Symbol.isConcatSpreadableğŸ¤"></a>5. Symbol.isConcatSpreadableğŸ¤</h3><p>å¦‚æœæ˜¯ä¸€ä¸ªæ•°ç»„concatå¦ä¸€ä¸ªæ•°ç»„ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæ¯”å¦‚ <code>[1]</code> å’Œ <code>[2]</code>ï¼Œæ˜¯ä¼šå˜æˆ <code>[1,2]</code>, è¿˜æ˜¯ <code>[[1], [2]]</code> ï¼Ÿè¿™å°±æ˜¯å’±ä»¬ isConcatSpreadable å‘æŒ¥çš„åœ°æ–¹äº†</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">let <span class="hljs-built_in">array</span>like = &#123;<br>    length: <span class="hljs-number">1</span>,<br>    <span class="hljs-number">0</span>:<span class="hljs-number">1</span>,<br><span class="hljs-string">    [Symbol.isConcatSpreadable]</span>: <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-string"></span><br><span class="hljs-string">[]</span>.concat(<span class="hljs-built_in">array</span>like)<br></code></pre></td></tr></table></figure><p>ç®€å•å§ğŸ˜</p><h3 id="6-å”¯ä¸€çœŸç¥ï¼ŒSymbol-toPrimitiveğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶"><a href="#6-å”¯ä¸€çœŸç¥ï¼ŒSymbol-toPrimitiveğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶" class="headerlink" title="6. å”¯ä¸€çœŸç¥ï¼ŒSymbol.toPrimitiveğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶"></a>6. å”¯ä¸€çœŸç¥ï¼ŒSymbol.toPrimitiveğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶ğŸ¶</h3><h4 id="è¿˜æ˜¯ç»å…¸é¢è¯•é¢˜èµ·æ‰‹"><a href="#è¿˜æ˜¯ç»å…¸é¢è¯•é¢˜èµ·æ‰‹" class="headerlink" title="è¿˜æ˜¯ç»å…¸é¢è¯•é¢˜èµ·æ‰‹"></a>è¿˜æ˜¯ç»å…¸é¢è¯•é¢˜èµ·æ‰‹</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">let</span> a;<br><span class="hljs-attribute">a</span> == <span class="hljs-number">1</span> &amp;&amp; a == <span class="hljs-number">2</span> &amp;&amp; a == <span class="hljs-number">3</span> ä»€ä¹ˆæ—¶å€™æˆç«‹ï¼Ÿ<br></code></pre></td></tr></table></figure><p>é™¤äº†ç»å…¸åšæ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Symbol.toPrimitiveæ–¹æ³•ï¼Œä¸ºä»€ä¹ˆè¯´å®ƒæ˜¯å”¯ä¸€çœŸç¥ï¼Œå°±æ˜¯å› ä¸ºå®ƒ<strong>å¯ä»¥è¦†ç›– <code>valueOf</code> å’Œ <code>toString</code> è¿™ä¸¤ä¸ªå¹»ç¥æ–¹æ³•</strong></p><p>ä½¿ç”¨ <code>Symbol.toPrimitive</code> ä¹Ÿå¾ˆç®€å•, åªä¸è¿‡è¦æ³¨æ„ï¼Œä¸ <code>valueOf</code> å’Œ <code>toString</code> ä¸åŒï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•° <code>hint</code>, <code>hint</code>æœ‰ä¸‰ä¸ªå–å€¼ï¼š <code>default</code>, <code>string</code>, <code>number</code></p><pre><code class="hljs">--&quot;string&quot;ï¼šå½“éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºçš„å¯¹è±¡æ—¶ï¼Œä¾‹å¦‚é€šè¿‡ String(obj) è¿›è¡Œè½¬æ¢æˆ–åœ¨æŸäº›ä¸å­—ç¬¦ä¸²ç›¸å…³çš„æ“ä½œä¸­ï¼ˆå¦‚è°ƒç”¨ alert(obj)ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJavaScriptä¼šå°è¯•ä¼˜å…ˆè°ƒç”¨å¯¹è±¡çš„ toString æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œç„¶åå°è¯• valueOf æ–¹æ³•ã€‚-- &quot;number&quot;ï¼šå½“éœ€è¦ä¸€ä¸ªæ•°å­—è¡¨ç¤ºçš„å¯¹è±¡æ—¶ï¼Œä¾‹å¦‚é€šè¿‡ Number(obj) è¿›è¡Œè½¬æ¢ã€ç®—æœ¯è¿ç®—ï¼ˆå¦‚ +obj æˆ– obj - 0ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJavaScriptä¼šå°è¯•ä¼˜å…ˆè°ƒç”¨å¯¹è±¡çš„ valueOf æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œç„¶åå°è¯• toString æ–¹æ³•ã€‚-- &quot;default&quot;ï¼šå½“æ“ä½œä¸éœ€è¦ç‰¹å®šçš„ç±»å‹ï¼ˆæ—¢ä¸éœ€è¦å­—ç¬¦ä¸²ä¹Ÿä¸éœ€è¦æ•°å­—ï¼‰ï¼Œä¾‹å¦‚ä½¿ç”¨åŒç­‰å· == è¿›è¡Œæ¯”è¾ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤šæ•°æƒ…å†µä¸‹çš„è¡Œä¸ºä¸ &quot;number&quot; ç±»ä¼¼ï¼Œä½†å¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨äºŒè¿›åˆ¶åŠ æ³•æ“ä½œç¬¦ + æ—¶ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡çš„ Symbol.toPrimitive æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¼šè¢«è°ƒç”¨å¹¶ä¼ å…¥ &quot;default&quot; ä½œä¸º hintã€‚</code></pre><p>å› æ­¤ï¼Œå¯ä»¥å°†ä¸Šé¢çš„é¢è¯•é¢˜æ”¹å†™æˆï¼š </p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">a = &#123;<br>    [<span class="hljs-built_in">Symbol</span>.toPrimitive]: <span class="hljs-function">(<span class="hljs-params">(i)</span> =&gt;</span> () =&gt; ++i) (<span class="hljs-number">0</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„å†™æ³•æ¯”è¾ƒå·§å¦™ï¼Œ åˆ†ä¸ºå¤–å±‚ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œ å†…å±‚(i) &#x3D;&gt; (), æœ€å†…å±‚ () &#x3D;&gt; ++iï¼Œå› æ­¤ä¼šå½¢æˆé—­åŒ…ï¼Œä¹‹åæ¯ä¸€æ¬¡è°ƒç”¨éƒ½ä¼šä½¿è¿”å›å€¼é€’å¢</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsè¿›é˜¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsè¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµè§ˆå™¨æ¸²æŸ“åŸç†</title>
    <link href="/2023/10/14/tmp%20(2)/"/>
    <url>/2023/10/14/tmp%20(2)/</url>
    
    <content type="html"><![CDATA[<h2 id="æµè§ˆå™¨æ¸²æŸ“åŸç†"><a href="#æµè§ˆå™¨æ¸²æŸ“åŸç†" class="headerlink" title="æµè§ˆå™¨æ¸²æŸ“åŸç†"></a>æµè§ˆå™¨æ¸²æŸ“åŸç†</h2><h3 id="1-parseHTML"><a href="#1-parseHTML" class="headerlink" title="1.parseHTML"></a>1.parseHTML</h3><p>ç½‘ç»œçº¿ç¨‹åœ¨æ¥å—åˆ°HTMLæ–‡ä»¶åä¼šç”Ÿæˆä¸€ä¸ªæ¸²æŸ“ä»»åŠ¡ï¼Œæ¨å…¥åˆ°æ¸²æŸ“ä¸»çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œåœ¨äº‹ä»¶å¾ªç¯çš„ä½œç”¨ä¸‹ï¼Œæ¸²æŸ“ä¸»çº¿ç¨‹å–å‡ºæ¸²æŸ“ä»»åŠ¡å¹¶æ‰§è¡Œ</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">ä¸ºäº†å¿«é€Ÿè§£ææ–‡ä»¶ï¼Œåœ¨è§£æå¼€å§‹ä¹‹å‰ï¼Œä¼šå¯åŠ¨é¢„è§£æçº¿ç¨‹ï¼Œé‡åˆ°cssæ–‡ä»¶å°±ä¸‹è½½ï¼Œé‡åˆ°<span class="hljs-keyword">js</span>å°±æ‰§è¡Œï¼Œå¦‚æœè§£ææ—¶é‡åˆ°cssè€Œé¢„è§£æçº¿ç¨‹è¿˜æ²¡ä¸‹è½½å®Œæˆï¼Œä¸»çº¿ç¨‹ä¸ä¼šç­‰å¾…ï¼Œä½†å¦‚æœæ˜¯<span class="hljs-keyword">js</span>ï¼Œä¸»çº¿ç¨‹ä¼šæš‚åœæ‰€æœ‰ä»»åŠ¡<br></code></pre></td></tr></table></figure><p>åœ¨è§£æå®Œæˆåï¼Œä¼šç”ŸæˆDOMæ ‘å’ŒCSSOMæ ‘</p><h3 id="2-1-ç”ŸæˆDOMæ ‘å’ŒCSSOMæ ‘"><a href="#2-1-ç”ŸæˆDOMæ ‘å’ŒCSSOMæ ‘" class="headerlink" title="2.1.ç”ŸæˆDOMæ ‘å’ŒCSSOMæ ‘"></a>2.1.ç”ŸæˆDOMæ ‘å’ŒCSSOMæ ‘</h3><p><code>CSSOMæ ‘</code>: åŒ…å«StyleSheetList -&gt; CSSStyleSheet -&gt; CSSStyleRule</p><p><code>StyleSheetList</code>: åŒ…å«ä¸åŒçš„StyleSheetï¼Œä¸€å…±æœ‰å››ç§ï¼š <code>å†…éƒ¨æ ·å¼è¡¨ï¼Œå†…è”æ ·å¼è¡¨ï¼Œå¤–éƒ¨æ ·å¼è¡¨ï¼Œé»˜è®¤æ ·å¼è¡¨</code></p><p><code>CSSStyleRule</code>: åŒ…å«é€‰æ‹©å™¨å’Œå£°æ˜</p><h3 id="2-2-åˆå¹¶DOMæ ‘å’ŒCSSOMæ ‘ï¼ˆæ ·å¼è®¡ç®—ï¼‰"><a href="#2-2-åˆå¹¶DOMæ ‘å’ŒCSSOMæ ‘ï¼ˆæ ·å¼è®¡ç®—ï¼‰" class="headerlink" title="2.2.åˆå¹¶DOMæ ‘å’ŒCSSOMæ ‘ï¼ˆæ ·å¼è®¡ç®—ï¼‰"></a>2.2.åˆå¹¶DOMæ ‘å’ŒCSSOMæ ‘ï¼ˆæ ·å¼è®¡ç®—ï¼‰</h3><p>æ ·å¼è®¡ç®—ï¼Œè®¡ç®—å‡ºæœ€ç»ˆæ ·å¼ï¼Œæ¯”å¦‚<code>color: red</code>ä¼šå˜æˆ<code>color: rgb(255,0,0)</code></p><h4 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h4><ol><li><p>CSSå±æ€§å€¼çš„è®¡ç®—è¿‡ç¨‹</p><ol><li>å±‚å </li><li>ç»§æ‰¿</li></ol></li><li><p>è§†è§‰æ ¼å¼åŒ–æ¨¡å‹</p><ol><li>ç›’æ¨¡å‹</li><li>åŒ…å«å—</li></ol></li></ol><h3 id="3-ç”Ÿæˆlayoutæ ‘"><a href="#3-ç”Ÿæˆlayoutæ ‘" class="headerlink" title="3.ç”Ÿæˆlayoutæ ‘"></a>3.ç”Ÿæˆlayoutæ ‘</h3><p>åˆå¹¶åçš„domæ ‘å’Œä¸ä¹‹å¯¹åº”ç”Ÿæˆçš„layoutæ ‘ä¸ä¸€å®šä¸€ä¸€å¯¹åº”ï¼Œdisplay:noneçš„å…ƒç´ ,æ²¡æœ‰<code>å‡ ä½•ä¿¡æ¯</code>ï¼Œä¸ä¼šå­˜åœ¨åœ¨layoutæ ‘ä¸­ã€‚æˆ–è€…è¯´ä¼ªå…ƒç´ åœ¨DOMæ ‘ä¸­ä¸å­˜åœ¨ï¼Œä½†æ˜¯ç”±äºä»–æœ‰å‡ ä½•ä¿¡æ¯ï¼Œä¼šå‡ºç°åœ¨layoutæ ‘ä¸­ã€‚</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs glsl">åœ¨<span class="hljs-keyword">layout</span>æ ‘ä¸­ï¼š<br><br>è¡Œç›’å—ç›’ä¸èƒ½ç›¸é‚»<br>å†…å®¹å¿…é¡»åœ¨è¡Œç›’ä¸­<br><br>å¦‚æœç›¸é‚»ï¼Œä¼šåœ¨è¡Œç›’ä¸Šå±‚åˆ›å»ºåŒ¿åå—ç›’åŒ…è£¹è¡Œç›’<br>å¦‚æœå†…å®¹ä¸åœ¨è¡Œç›’ä¸­ï¼Œä¼šåœ¨å†…å®¹å¤–éƒ¨å¥—ä¸€å±‚åŒ¿åè¡Œç›’<br><br>è¿™ä¹Ÿä¼šå¯¼è‡´<span class="hljs-keyword">layout</span>æ ‘å’Œdomæ ‘ä¸ä¸€æ ·<br></code></pre></td></tr></table></figure><h3 id="4-åˆ†å±‚"><a href="#4-åˆ†å±‚" class="headerlink" title="4.åˆ†å±‚"></a>4.åˆ†å±‚</h3><p>æµè§ˆå™¨ä¸»çº¿ç¨‹è‡ªåŠ¨åˆ†å±‚ï¼Œåˆ†å±‚å¯ä»¥å‡å°‘é‡ç»˜çš„æ¬¡æ•°å’Œæ•°é‡ï¼Œä¼˜åŒ–æ€§èƒ½</p><p>å¦‚æœç»å¸¸éœ€è¦é‡ç»˜ï¼Œå¯ä»¥åœ¨cssä¸­ä½¿ç”¨will-changeæ›´å¤§ç¨‹åº¦å½±å“åˆ†å±‚ã€‚</p><h3 id="5-ç»˜åˆ¶"><a href="#5-ç»˜åˆ¶" class="headerlink" title="5.ç»˜åˆ¶"></a>5.ç»˜åˆ¶</h3><p>ä¸»çº¿ç¨‹æˆç»˜åˆ¶çš„æŒ‡ä»¤ï¼ˆä¸canvasç±»ä¼¼ï¼‰ï¼Œæ¯å±‚éƒ½ä¼šç”Ÿæˆå•ç‹¬çš„ç»˜åˆ¶æŒ‡ä»¤ã€‚æ¸²æŸ“ä¸»çº¿ç¨‹å·¥ä½œåˆ°æ­¤ä¸ºæ­¢ï¼Œå‰©ä½™æ­¥éª¤äº¤ç»™å…¶ä½™çº¿ç¨‹ã€‚</p><h3 id="6-åˆ†å—"><a href="#6-åˆ†å—" class="headerlink" title="6.åˆ†å—"></a>6.åˆ†å—</h3><p>å®Œæˆç»˜åˆ¶ä¹‹åï¼Œä¸»çº¿ç¨‹ä¼šæŠŠæ¯ä¸ªå›¾å±‚çš„ç»˜åˆ¶ä¿¡æ¯äº¤ç»™åˆæˆçº¿ç¨‹è¿›è¡Œåˆ’åˆ†å¿«æ“ä½œã€‚<br>åˆ†å—å°†æ¯ä¸€å±‚åˆ†ä¸ºæ›´å°çš„å—ï¼Œä¼˜å…ˆç»˜åˆ¶ç¦»è§†å£è¿‘çš„åŒºåŸŸã€‚<br>åˆ†å—å·¥ä½œäº¤ç»™åˆæˆçº¿ç¨‹å¤„ç†ï¼Œåˆæˆçº¿ç¨‹ä¹Ÿå¤„äºæ¸²æŸ“è¿›ç¨‹ä¸­ï¼Œå®ƒå¯ä»¥å¯åŠ¨è®¸å¤šçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹å¤„ç†åˆ†å—ã€‚ä¼šä»çº¿ç¨‹æ± ä¸­æŒ‘å–å¤šä¸ªçº¿ç¨‹å®Œæˆå·¥ä½œ</p><h3 id="7-å…‰æ …åŒ–"><a href="#7-å…‰æ …åŒ–" class="headerlink" title="7.å…‰æ …åŒ–"></a>7.å…‰æ …åŒ–</h3><p>æŠŠæ¯ä¸ªå—å˜æˆä½å›¾ï¼ŒåŒ…å«æ¯ä¸ªç‚¹çš„åƒç´ ä¿¡æ¯ï¼Œä¼˜å…ˆå¤„ç†é è¿‘è§†å£çš„å—ã€‚å…‰æ …åŒ–ä¼šåœ¨gpuä¸­è¿›è¡Œã€‚å…‰æ …åŒ–çš„ç»“æœå°±æ˜¯ä¸€å—ä¸€å—çš„ä½å›¾</p><h3 id="8-ç”»"><a href="#8-ç”»" class="headerlink" title="8.ç”»"></a>8.ç”»</h3><p>åˆæˆçº¿ç¨‹è®¡ç®—å‡ºæ¯ä¸ªä½å›¾åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼Œç”Ÿæˆquadä¿¡æ¯ï¼Œå¹¶æŠŠquadé€è¿›gpuï¼Œgpuå†å§”æ´¾ç»™å…¶ä»–ç¡¬ä»¶è¿›è¡Œè®¡ç®—</p><p>transformä¹Ÿåœ¨ç”»çš„è¿‡ç¨‹ä¸­è¿›è¡Œï¼Œä¸åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œï¼Œå› æ­¤transformæ•ˆç‡é«˜</p><p>quadï¼šæŒ‡å¼•ä¿¡æ¯ï¼Œæè¿°ä½å›¾çš„ä½ç½®è·ç¦»å±å¹•çš„è·ç¦»</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å› ä¸ºæ¸²æŸ“è¿›ç¨‹å¤„åœ¨æ²™ç›’ä¸­ï¼Œä¸ç¡¬ä»¶ç¯å¢ƒéš”ç¦»ï¼Œæé«˜å®‰å…¨æ€§ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å§”æ´¾ä»»åŠ¡ç»™ç¡¬ä»¶ï¼Œè¦å…ˆäº¤ç»™gpu<br></code></pre></td></tr></table></figure><h2 id="æ•´ä½“æµç¨‹"><a href="#æ•´ä½“æµç¨‹" class="headerlink" title="æ•´ä½“æµç¨‹"></a>æ•´ä½“æµç¨‹</h2><p><img src="https://s2.loli.net/2023/09/25/Cv7ms1q4aVnLSRY.png" alt="æ•´ä½“æµç¨‹"></p><h3 id="ques"><a href="#ques" class="headerlink" title="ques:"></a>ques:</h3><ol><li><p>ä»€ä¹ˆæ˜¯reflow</p><p> reflowçš„æœ¬è´¨å°±æ˜¯é‡æ–°è®¡ç®—layoutæ ‘ï¼Œlayoutæ ‘ä¹‹åçš„åˆ†å±‚ã€ç»˜åˆ¶ã€åˆ†å—ã€å…‰æ …åŒ–ã€ç”»éƒ½ä¼šæ ¹æ®æƒ…å†µå†³å®šé‡æ–°æ‰§è¡Œä¸å¦ã€‚</p> <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">ä¸ºäº†é¿å…layoutæ ‘çš„é‡å¤è®¡ç®—ï¼Œæµè§ˆå™¨å¼‚æ­¥å¤„ç†å¯¹layoutæ ‘çš„æ“ä½œï¼Œåœ¨jsæ‰§è¡Œå®Œä¹‹åï¼Œå–å‡º<span class="hljs-built_in">ref</span>lowçš„ä»»åŠ¡æ‰¹é‡å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆdomå…ƒç´ ä¿®æ”¹æ˜¯å¾®ä»»åŠ¡çš„åŸå› <br><br>ä¹Ÿå› æ­¤ï¼Œæµè§ˆå™¨è·å–domä¿¡æ¯æ—¶ï¼Œå¯èƒ½ä¼šå¾—åˆ°ä¿®æ”¹å‰çš„ä¿¡æ¯<br><br>ä¿®æ”¹é¢œè‰²ç­‰å±æ€§å¹¶ä¸ä¼šè§¦å‘<span class="hljs-built_in">ref</span>lowï¼Œå› ä¸ºå¹¶æ²¡æœ‰ä¿®æ”¹å‡ ä½•ä¿¡æ¯<br></code></pre></td></tr></table></figure></li><li><p>ä»€ä¹ˆæ˜¯repaint</p><p> repaintçš„æœ¬è´¨å°±æ˜¯é‡æ–°æ ¹æ®åˆ†å±‚ä¿¡æ¯é‡æ–°è®¡ç®—äº†ç»˜åˆ¶æŒ‡ä»¤ã€‚æ”¹åŠ¨äº†å¯è§å…ƒç´ çš„å±æ€§åï¼Œå°±ä¼šè§¦å‘repaintã€‚</p> <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">ç”±äºå¸ƒå±€çš„å‡ ä½•ä¿¡æ¯ä¹Ÿå±äºå¯è§å…ƒç´ çš„å±æ€§ï¼Œå› æ­¤<span class="hljs-built_in">ref</span>lowè§¦å‘ä¹Ÿä¸€å®šä¼šè§¦å‘repaint<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>æµè§ˆå™¨æ‰§è¡ŒåŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>æµè§ˆå™¨æ‰§è¡ŒåŸç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äº‹ä»¶å¾ªç¯å’Œraf</title>
    <link href="/2023/09/16/eventloop&amp;raf/"/>
    <url>/2023/09/16/eventloop&amp;raf/</url>
    
    <content type="html"><![CDATA[<h2 id="äº‹ä»¶å¾ªç¯å’Œraf"><a href="#äº‹ä»¶å¾ªç¯å’Œraf" class="headerlink" title="äº‹ä»¶å¾ªç¯å’Œraf"></a>äº‹ä»¶å¾ªç¯å’Œraf</h2><h3 id="ä¸€-ä¸ºä»€ä¹ˆéœ€è¦äº‹ä»¶å¾ªç¯"><a href="#ä¸€-ä¸ºä»€ä¹ˆéœ€è¦äº‹ä»¶å¾ªç¯" class="headerlink" title="ä¸€. ä¸ºä»€ä¹ˆéœ€è¦äº‹ä»¶å¾ªç¯"></a>ä¸€. ä¸ºä»€ä¹ˆéœ€è¦äº‹ä»¶å¾ªç¯</h3><p>ç”±äºjsæ˜¯<code>å•çº¿ç¨‹</code>æ‰§è¡Œçš„ï¼Œæ‰€ä»¥è®¾è®¡äº†äº‹ä»¶å¾ªç¯ç”¨äºå¤„ç†<code>å¼‚æ­¥å‡½æ•°</code></p><h3 id="äºŒ-äº‹ä»¶å¾ªç¯ä»‹ç»"><a href="#äºŒ-äº‹ä»¶å¾ªç¯ä»‹ç»" class="headerlink" title="äºŒ. äº‹ä»¶å¾ªç¯ä»‹ç»"></a>äºŒ. äº‹ä»¶å¾ªç¯ä»‹ç»</h3><h4 id="1-é˜Ÿåˆ—"><a href="#1-é˜Ÿåˆ—" class="headerlink" title="1. é˜Ÿåˆ—"></a>1. é˜Ÿåˆ—</h4><p>äº‹ä»¶å¾ªç¯ä¸­<code>è‡³å°‘</code>éœ€è¦ä¸¤ä¸ªé˜Ÿåˆ— â€“ <code>å®ä»»åŠ¡é˜Ÿåˆ—</code>ã€ <code>å¾®ä»»åŠ¡é˜Ÿåˆ—</code>ï¼Œå¯èƒ½æœ‰å…¶ä»–ä¸åŒçš„é˜Ÿåˆ—ï¼Œä¸åŒæµè§ˆå™¨æœ‰ä¸åŒçš„æ–¹æ¡ˆ</p><p>å…¶ä¸­<code>å®ä»»åŠ¡é˜Ÿåˆ—</code>ä¸»è¦åŒ…å«<code>ç‚¹å‡»äº‹ä»¶</code>ã€<code>è®¡æ—¶å™¨</code>ã€<code>ç½‘ç»œè¯·æ±‚</code>çš„å›è°ƒ<br><code>å¾®ä»»åŠ¡é˜Ÿåˆ—</code>ä¸»è¦åŒ…å«<code>Promise</code>ã€<code>async</code>ä¸­çš„<code>await</code>åçš„è¯­å¥</p><h4 id="2-é˜Ÿåˆ—æœºåˆ¶"><a href="#2-é˜Ÿåˆ—æœºåˆ¶" class="headerlink" title="2. é˜Ÿåˆ—æœºåˆ¶"></a>2. é˜Ÿåˆ—æœºåˆ¶</h4><p>æ¯ä¸ªå¾ªç¯ä¸­ï¼Œä¼šå…ˆåˆ¤æ–­å¾®ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºå°±ä¹‹è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ç›´è‡³é˜Ÿåˆ—ç©ºï¼Œç„¶åä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œå¦‚æœä¿®æ”¹äº†DOMï¼Œä¼šè§¦å‘é¡µé¢æ¸²æŸ“</p><p>å› æ­¤å¯ä»¥è¯´ï¼š é˜Ÿåˆ—ä¼˜å…ˆå¤„ç†å¾®ä»»åŠ¡</p><p><img src="https://s2.loli.net/2023/09/16/IfFu1Z4b2OEDSQt.png" alt="Alt text"></p><p>æ¥çœ‹é¢˜ğŸ˜€</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs arcade">async <span class="hljs-keyword">function</span> <span class="hljs-title function_">async1</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;a&#x27;</span>);<br>  await async2();<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;b&#x27;</span>);<br>&#125;<br><br>async <span class="hljs-keyword">function</span> <span class="hljs-title function_">async2</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;c&#x27;</span>)<br>&#125;<br><br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;d&#x27;</span>)<br>async1();<br><br>setTimeout(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;e&#x27;</span>)<br>&#125;,<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">new</span> Promise(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;f&#x27;</span>)<br>  resolve()<br>&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;g&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="ä¸‰-æ¥çœ‹æ¸²æŸ“ğŸ˜µ"><a href="#ä¸‰-æ¥çœ‹æ¸²æŸ“ğŸ˜µ" class="headerlink" title="ä¸‰. æ¥çœ‹æ¸²æŸ“ğŸ˜µ"></a>ä¸‰. æ¥çœ‹æ¸²æŸ“ğŸ˜µ</h4><p><img src="https://s2.loli.net/2023/09/16/AFozdM5Jt8nlwUK.png" alt="Alt text"></p><p>å‰é¢è¯´äº†setTimeoutæ˜¯å®ä»»åŠ¡ï¼Œé‚£ç»“åˆäº‹ä»¶é˜Ÿåˆ—çš„çŸ¥è¯†ï¼ŒsetTimeoutå‡½æ•°å°±éœ€è¦ç­‰å¾…ä¹‹å‰çš„æ‰€æœ‰å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œï¼Œé‚£å°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼š <code>setTimeoutå‡½æ•°è®¡æ—¶æ˜¯ä¸å‡†çš„ï¼</code></p><p>è¿˜è¦è¦çŸ¥é“æµè§ˆå™¨çš„é»˜è®¤æ¸²æŸ“é¢‘ç‡æ˜¯å›ºå®šçš„ï¼Œå¤§æ¦‚ä¸ºæ¯ç§’60å¸§</p><p><img src="https://s2.loli.net/2023/09/16/BDZiwp3UnmJo4LK.png" alt="Alt text"></p><p>æ‰€ä»¥ç”¨setTimeoutæ•´çš„åŠ¨ç”»å‡½æ•°æ‰§è¡Œé¢‘ç‡ä¼šä¸åŒï¼Œå¯èƒ½æ¯æ¬¡æ¸²æŸ“ä¸­æ‰§è¡Œçš„å‡½æ•°æ•°é‡ä¸åŒï¼Œçœ‹èµ·æ¥å°±ä¼šæœ‰æŠ–åŠ¨ï¼Œè¿˜æ²¡å®Œï¼</p><p>å¦‚æœäº‹ä»¶æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè¿˜ä¼šå¯¼è‡´ä¸¢å¸§ï¼Œå› ä¸ºäº‹ä»¶å¾ªç¯å’Œæ¸²æŸ“æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼jsè¿˜æ˜¯ä¸ªå•çº¿ç¨‹ï¼Œä¸¤å¤´é¡¾ä¸ä¸Š</p><p><img src="https://s2.loli.net/2023/09/16/Lp9UhITesmjkg4V.png" alt="Alt text"></p><p>å› æ­¤ï¼Œjså¼€å‘è€…ä»¬æœ‰äº†ä¸€ä¸ªå¤©æ‰çš„ç‚¹å­ï¼Œ<code>raf</code>åŠ¨ç”»</p><h4 id="å››-RAF"><a href="#å››-RAF" class="headerlink" title="å››. RAF"></a>å››. RAF</h4><p>RequestAnimationFrame æ˜¯ä¸€ä¸ªåœ¨ç°ä»£ Web å¼€å‘ä¸­å¹¿æ³›ä½¿ç”¨çš„ JavaScript æ–¹æ³•ï¼Œå®ƒç”¨äºåœ¨æµè§ˆå™¨çš„ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡ŒåŠ¨ç”»å¸§ï¼Œä»¥æä¾›æ›´å¹³æ»‘çš„åŠ¨ç”»æ•ˆæœã€‚è¿™ç§æ–¹æ³•é€šå¸¸ç”¨äºåˆ›å»ºç”¨ HTMLã€CSS å’Œ JavaScript ç¼–å†™çš„äº¤äº’å¼ç½‘é¡µåŠ¨ç”»ã€‚</p><p><img src="https://s2.loli.net/2023/09/16/n5L8I3qWsQbwer1.png" alt="Alt text"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;<br>    positionX += speed;<br>    <span class="hljs-keyword">if</span> (positionX &gt; <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>) &#123;<br>        positionX = -animatedElement.<span class="hljs-property">clientWidth</span>;<br>    &#125;<br>    <span class="hljs-title class_">Element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateX(<span class="hljs-subst">$&#123;positionX&#125;</span>px)`</span>;<br>    <span class="hljs-title function_">requestAnimationFrame</span>(animate);<br>&#125;<br><br><span class="hljs-title function_">animate</span>();<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>æµè§ˆå™¨æ‰§è¡ŒåŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>æµè§ˆå™¨æ‰§è¡ŒåŸç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSS</title>
    <link href="/2023/09/10/CSS/"/>
    <url>/2023/09/10/CSS/</url>
    
    <content type="html"><![CDATA[<h2 id="CSSğŸ˜€"><a href="#CSSğŸ˜€" class="headerlink" title="CSSğŸ˜€"></a>CSSğŸ˜€</h2><h3 id="1-CSSç®€ä»‹ğŸ˜¶â€ğŸŒ«ï¸"><a href="#1-CSSç®€ä»‹ğŸ˜¶â€ğŸŒ«ï¸" class="headerlink" title="1.CSSç®€ä»‹ğŸ˜¶â€ğŸŒ«ï¸"></a>1.CSSç®€ä»‹ğŸ˜¶â€ğŸŒ«ï¸</h3><p>CSS (Cascading Style Sheetsï¼Œå±‚å æ ·å¼è¡¨ï¼‰ï¼Œæ˜¯ä¸€ç§ç”¨æ¥ä¸ºç»“æ„åŒ–æ–‡æ¡£ï¼ˆå¦‚ HTML æ–‡æ¡£æˆ– XML åº”ç”¨ï¼‰æ·»åŠ æ ·å¼ï¼ˆå­—ä½“ã€é—´è·å’Œé¢œè‰²ç­‰ï¼‰çš„è®¡ç®—æœºè¯­è¨€ï¼Œæ˜¯å‰ç«¯æŠ€æœ¯ä¸­ååˆ†é‡è¦çš„ä¸€ç¯ğŸ¶ã€‚</p><p>é€šè¿‡ä½¿ç”¨ CSS æˆ‘ä»¬å¯ä»¥å¤§å¤§æå‡ç½‘é¡µå¼€å‘çš„å·¥ä½œæ•ˆç‡ï¼</p><hr><h3 id="2-CSSè¯­æ³•ä»‹ç»ğŸ˜—"><a href="#2-CSSè¯­æ³•ä»‹ç»ğŸ˜—" class="headerlink" title="2.CSSè¯­æ³•ä»‹ç»ğŸ˜—"></a>2.CSSè¯­æ³•ä»‹ç»ğŸ˜—</h3><p>CSS è§„åˆ™ç”±ä¸¤ä¸ªä¸»è¦çš„éƒ¨åˆ†æ„æˆï¼š<code>é€‰æ‹©å™¨</code>ï¼Œä»¥åŠä¸€æ¡æˆ–å¤šæ¡<code>å£°æ˜</code>:</p><p><code>é€‰æ‹©å™¨</code>é€šå¸¸æ˜¯æ‚¨éœ€è¦æ”¹å˜æ ·å¼çš„ <code>HTML å…ƒç´ </code>ã€‚</p><p>æ¯æ¡<code>å£°æ˜</code>ç”±ä¸€ä¸ª<code>å±æ€§</code>å’Œä¸€ä¸ª<code>å€¼</code>ç»„æˆã€‚</p><p><code>å±æ€§ï¼ˆpropertyï¼‰</code>æ˜¯æ‚¨å¸Œæœ›è®¾ç½®çš„æ ·å¼å±æ€§ï¼ˆstyle attributeï¼‰ã€‚æ¯ä¸ªå±æ€§æœ‰ä¸€ä¸ªå€¼ã€‚<em>å±æ€§å’Œå€¼è¢«å†’å·åˆ†å¼€</em>ã€‚ğŸ˜</p><hr><h3 id="3-å£°æ˜ğŸ«¥"><a href="#3-å£°æ˜ğŸ«¥" class="headerlink" title="3.å£°æ˜ğŸ«¥"></a>3.å£°æ˜ğŸ«¥</h3><p><code>CSSå£°æ˜</code>æ€»æ˜¯ä»¥åˆ†å·<code>;</code>ç»“æŸï¼Œ<code>å£°æ˜</code>æ€»ä»¥å¤§æ‹¬å·<code>&#123;&#125;</code>æ‹¬èµ·æ¥:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<span class="hljs-attribute">color</span>:red;<span class="hljs-attribute">text-align</span>:center;&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†è®©CSSå¯è¯»æ€§æ›´å¼ºï¼Œä½ å¯ä»¥æ¯è¡Œåªæè¿°ä¸€ä¸ªå±æ€§:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<br>    <span class="hljs-attribute">color</span>:red;<br>    <span class="hljs-attribute">text-align</span>:center;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="4-é€‰æ‹©å™¨ğŸŒŸ"><a href="#4-é€‰æ‹©å™¨ğŸŒŸ" class="headerlink" title="4.é€‰æ‹©å™¨ğŸŒŸ"></a>4.é€‰æ‹©å™¨ğŸŒŸ</h3><p>CSSé€‰æ‹©å™¨ç”¨äºé€‰æ‹©ä½ æƒ³è¦ä¸ºå…¶åº”ç”¨æ ·å¼çš„HTMLå…ƒç´ ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„CSSé€‰æ‹©å™¨åŠå…¶æè¿°ï¼š</p><ol><li><p><strong>é€šç”¨é€‰æ‹©å™¨</strong> (<code>*</code>):<br>é€‰æ‹©é¡µé¢ä¸Šçš„æ‰€æœ‰å…ƒç´ ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">* &#123;<br>  <span class="hljs-attribute">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>ç±»å‹é€‰æ‹©å™¨</strong> (æˆ–å…ƒç´ é€‰æ‹©å™¨):<br>é€‰æ‹©æ‰€æœ‰ç»™å®šçš„HTMLå…ƒç´ ç±»å‹ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<br>  <span class="hljs-attribute">color</span>: blue;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>ç±»é€‰æ‹©å™¨</strong> (<code>.</code>):<br>é€‰æ‹©æ‰€æœ‰å¸¦æœ‰æŒ‡å®šç±»å±æ€§çš„å…ƒç´ ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.highlight</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: yellow;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>IDé€‰æ‹©å™¨</strong> (<code>#</code>):<br>é€‰æ‹©å¸¦æœ‰æŒ‡å®šIDå±æ€§çš„å…ƒç´ ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-id">#header</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: gray;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>åä»£é€‰æ‹©å™¨</strong> (ç©ºæ ¼):<br>é€‰æ‹©ç‰¹å®šå…ƒç´ çš„åä»£ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">article</span> <span class="hljs-selector-tag">p</span> &#123;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>å­å…ƒç´ é€‰æ‹©å™¨</strong> (<code>&gt;</code>):<br>é€‰æ‹©ç‰¹å®šå…ƒç´ çš„ç›´æ¥å­å…ƒç´ ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">ul</span> &gt; <span class="hljs-selector-tag">li</span> &#123;<br>  <span class="hljs-attribute">list-style-type</span>: square;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨</strong> (<code>+</code>):<br>é€‰æ‹©ç´§æ¥åœ¨å¦ä¸€ä¸ªå…ƒç´ åçš„å…ƒç´ ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h2</span> + <span class="hljs-selector-tag">p</span> &#123;<br>  <span class="hljs-attribute">font-weight</span>: bold;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>å±æ€§é€‰æ‹©å™¨</strong>:<br>é€‰æ‹©å¸¦æœ‰æŒ‡å®šå±æ€§çš„å…ƒç´ ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">&quot;text&quot;</span>]</span> &#123;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¼ªç±»é€‰æ‹©å™¨</strong> (<code>:</code>):<br>é€‰æ‹©å…ƒç´ çš„ç‰¹å®šçŠ¶æ€ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">color</span>: green;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¼ªå…ƒç´ é€‰æ‹©å™¨</strong> (<code>::</code>):<br>é€‰æ‹©å…ƒç´ çš„ç‰¹å®šéƒ¨åˆ†ï¼Œå¦‚é¦–è¡Œæˆ–é¦–å­—æ¯ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span><span class="hljs-selector-pseudo">::first-line</span> &#123;<br>  <span class="hljs-attribute">font-weight</span>: bold;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>åˆ†ç»„é€‰æ‹©å™¨</strong>:<br>å°†å¤šä¸ªé€‰æ‹©å™¨åˆ†ç»„ä»¥åº”ç”¨ç›¸åŒçš„æ ·å¼ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span> &#123;<br>  <span class="hljs-attribute">font-family</span>: Arial, sans-serif;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>è¿™åªæ˜¯CSSé€‰æ‹©å™¨çš„åŸºç¡€ã€‚éšç€CSSçš„å‘å±•ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–çš„é€‰æ‹©å™¨å’Œç»„åˆæ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œä»¥æ»¡è¶³æ›´å¤æ‚çš„é€‰æ‹©éœ€æ±‚ã€‚</p><hr><h3 id="5-é€‰æ‹©å™¨æƒé‡ğŸ˜"><a href="#5-é€‰æ‹©å™¨æƒé‡ğŸ˜" class="headerlink" title="5.é€‰æ‹©å™¨æƒé‡ğŸ˜"></a>5.é€‰æ‹©å™¨æƒé‡ğŸ˜</h3><p>åœ¨CSSä¸­ï¼Œé€‰æ‹©å™¨çš„æƒé‡ï¼ˆæˆ–ä¼˜å…ˆçº§ï¼‰å†³å®šäº†å“ªäº›æ ·å¼è§„åˆ™å°†è¢«åº”ç”¨åˆ°å…ƒç´ ä¸Šï¼Œç‰¹åˆ«æ˜¯å½“å¤šä¸ªè§„åˆ™ä¸åŒä¸€ä¸ªå…ƒç´ åŒ¹é…æ—¶ã€‚é€‰æ‹©å™¨çš„æƒé‡æ˜¯åŸºäºå…¶ç±»å‹å’Œç»“æ„æ¥è®¡ç®—çš„ã€‚</p><p>ä»¥ä¸‹æ˜¯é€‰æ‹©å™¨æƒé‡çš„åŸºæœ¬è§„åˆ™ï¼š</p><ol><li><p><strong>ç±»å‹é€‰æ‹©å™¨å’Œä¼ªå…ƒç´ </strong> (ä¾‹å¦‚ <code>h1</code>, <code>::before</code>):</p><ul><li>æƒé‡: 0-0-1 &#x3D;&gt; 1</li></ul></li><li><p><strong>ç±»é€‰æ‹©å™¨ã€å±æ€§é€‰æ‹©å™¨å’Œä¼ªç±»</strong> (ä¾‹å¦‚ <code>.classname</code>, <code>[type=&quot;text&quot;]</code>, <code>:hover</code>):</p><ul><li>æƒé‡: 0-1-0 &#x3D;&gt; 2</li></ul></li><li><p><strong>IDé€‰æ‹©å™¨</strong> (ä¾‹å¦‚ <code>#idname</code>):</p><ul><li>æƒé‡: 1-0-0 &#x3D;&gt; 4</li></ul></li><li><p><strong>å†…è”æ ·å¼</strong> (ç›´æ¥åœ¨HTMLå…ƒç´ ä¸Šä½¿ç”¨çš„<code>style</code>å±æ€§):</p><ul><li>æƒé‡: 1-0-0-0 &#x3D;&gt; infinite</li></ul></li><li><p><strong>é€šç”¨é€‰æ‹©å™¨</strong> (<code>*</code>), <strong>ç»„åˆç¬¦</strong> (ä¾‹å¦‚ <code>+</code>, <code>&gt;</code>, <code>~</code>, ç©ºæ ¼) å’Œ <strong>å¦å®šä¼ªç±»</strong> (<code>:not()</code>) å¯¹æƒé‡æ²¡æœ‰å½±å“ã€‚</p></li><li><p><strong>é‡è¦æ€§</strong> (<code>!important</code>): å¦‚æœåœ¨æ ·å¼å£°æ˜åæ·»åŠ äº†<code>!important</code>ï¼Œåˆ™è¯¥å£°æ˜çš„æƒé‡ä¼šè¶…è¿‡å…¶ä»–ä»»ä½•å£°æ˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ª<code>!important</code>å£°æ˜ï¼Œé‚£ä¹ˆä¸Šè¿°æƒé‡è§„åˆ™ä»ç„¶é€‚ç”¨äºç¡®å®šå“ªä¸ªå£°æ˜æœ€é‡è¦ã€‚</p></li></ol><p>æƒé‡è®¡ç®—ç¤ºä¾‹ï¼š</p><ul><li><code>#id</code>: 1-0-0</li><li><code>.class</code>: 0-1-0</li><li><code>h1</code>: 0-0-1</li><li><code>#id .class h1</code>: 1-1-1 &#x3D;&gt; 7</li></ul><p>å½“å¤šä¸ªé€‰æ‹©å™¨ç›®æ ‡åŒä¸€ä¸ªå…ƒç´ å¹¶æœ‰å†²çªçš„æ ·å¼æ—¶ï¼Œæƒé‡è¾ƒé«˜çš„é€‰æ‹©å™¨çš„æ ·å¼å°†è¢«åº”ç”¨ã€‚å¦‚æœæƒé‡ç›¸åŒï¼Œé‚£ä¹ˆåœ¨CSSæ–‡ä»¶ä¸­æœ€åå‡ºç°çš„è§„åˆ™å°†è¢«åº”ç”¨ã€‚</p><p>ä¸ºäº†é¿å…æƒé‡é—®é¢˜å’Œå¤æ‚æ€§ï¼Œå»ºè®®å°½é‡ä½¿ç”¨ç®€å•çš„é€‰æ‹©å™¨ï¼Œå¹¶é¿å…è¿‡åº¦ä½¿ç”¨<code>!important</code>ã€‚</p><hr><h3 id="6-åŸºæœ¬å±æ€§"><a href="#6-åŸºæœ¬å±æ€§" class="headerlink" title="6.åŸºæœ¬å±æ€§"></a>6.åŸºæœ¬å±æ€§</h3><ol><li><p><strong>position</strong> : å®šä½ relativeï¼ˆé»˜è®¤ï¼‰ | absolute | fixed | sticky</p></li><li><p><strong>display</strong> : å…ƒç´ æ˜¾ç¤ºæ¨¡å¼ inline | block | inline-block | flex | grid â€¦</p></li></ol><p>â€¦</p><h3 id="6-å®æ“éƒ¨åˆ†ğŸ¤”"><a href="#6-å®æ“éƒ¨åˆ†ğŸ¤”" class="headerlink" title="6.å®æ“éƒ¨åˆ†ğŸ¤”"></a>6.å®æ“éƒ¨åˆ†ğŸ¤”</h3>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>cssåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>cssåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ES13 æ–°ç‰¹æ€§</title>
    <link href="/2023/08/30/New%20Document/"/>
    <url>/2023/08/30/New%20Document/</url>
    
    <content type="html"><![CDATA[<h1 id="ES13-æ–°ç‰¹æ€§"><a href="#ES13-æ–°ç‰¹æ€§" class="headerlink" title="ES13 æ–°ç‰¹æ€§"></a>ES13 æ–°ç‰¹æ€§</h1><p>ES13ï¼ˆä¹Ÿç§°ä¸º ES2020ï¼‰æ˜¯ ECMAScript æ ‡å‡†çš„æœ€æ–°ç‰ˆæœ¬ï¼Œäº 2020 å¹´ 6 æœˆå‘å¸ƒã€‚å®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œä»¥å¸®åŠ©å¼€å‘è€…æ›´è½»æ¾åœ°ç¼–å†™ä»£ç ã€‚ä»¥ä¸‹æ˜¯ä¸€äº› ES13 çš„æ–°ç‰¹æ€§ï¼š</p><h2 id="BigInt"><a href="#BigInt" class="headerlink" title="BigInt"></a><code>BigInt</code></h2><p><code>BigInt</code> æ˜¯ä¸€ç§æ–°çš„ JavaScript ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºä»»æ„ç²¾åº¦çš„æ•´æ•°ã€‚åœ¨æ—§ç‰ˆ JavaScript ä¸­ï¼Œ<code>Number</code> ç±»å‹åªèƒ½è¡¨ç¤º 2 çš„ 53 æ¬¡æ–¹ä»¥å†…çš„æ•´æ•°ï¼Œå¦‚æœéœ€è¦è¿›è¡Œæ›´å¤§çš„æ•°å­—è®¡ç®—ï¼Œå°±éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ã€‚è€Œ <code>BigInt</code> å¯ä»¥è¡¨ç¤ºä»»æ„é•¿åº¦çš„æ•´æ•°ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">const bigIntNum = <span class="hljs-number">9007199254740991</span>n;<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">typeof</span> bigIntNum); <span class="hljs-comment">// è¾“å‡º &quot;bigint&quot;</span><br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>BigInt</code> ç±»å‹çš„æ•°å­—éœ€è¦åŠ ä¸Šåç¼€ <code>n</code>ã€‚</p><h2 id="å¯é€‰é“¾æ“ä½œç¬¦"><a href="#å¯é€‰é“¾æ“ä½œç¬¦" class="headerlink" title="å¯é€‰é“¾æ“ä½œç¬¦"></a>å¯é€‰é“¾æ“ä½œç¬¦</h2><p>å¯é€‰é“¾æ“ä½œç¬¦æ˜¯ä¸€ç§æ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œç”¨äºç®€åŒ– JavaScript ä»£ç ä¸­çš„å±æ€§è®¿é—®ã€‚åœ¨æ—§ç‰ˆ JavaScript ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé€šè¿‡ &amp;&amp; è¿ç®—ç¬¦æ¥æ£€æŸ¥å¯¹è±¡çš„å±æ€§æ˜¯å¦å­˜åœ¨ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs inform7">if (<span class="hljs-keyword">person</span> &amp;&amp; <span class="hljs-keyword">person</span>.address &amp;&amp; <span class="hljs-keyword">person</span>.address.city) &#123;<br>  console.log(<span class="hljs-keyword">person</span>.address.city);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•è™½ç„¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯ä¼šè®©ä»£ç å˜å¾—å†—é•¿ï¼Œå°¤å…¶æ˜¯åœ¨è®¿é—®æ·±å±‚æ¬¡çš„å±æ€§æ—¶ã€‚å¯é€‰é“¾æ“ä½œç¬¦å¯ä»¥è®©æˆ‘ä»¬æ›´ç®€æ´åœ°æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">if</span> (person?.address?.city) &#123;<br>  <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(person.address.city);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>?.</code> è¡¨ç¤ºå¦‚æœ <code>person</code> æˆ–è€… <code>address</code> å±æ€§ä¸å­˜åœ¨ï¼Œå°±ä¸ä¼šå†å»è®¿é—® <code>city</code> å±æ€§ï¼Œé¿å…äº†å‡ºç° TypeErrorã€‚å½“ç„¶ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨è®¿é—®ä¸å­˜åœ¨çš„å±æ€§æ—¶ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä¹Ÿå¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦ï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">const city = person?.address?.city ?? <span class="hljs-string">&#x27;Unknown&#x27;</span>;<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(city);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>??</code> è¡¨ç¤ºå¦‚æœ <code>city</code> ä¸º null æˆ– undefinedï¼Œå°±ä¼šè¿”å› â€˜Unknownâ€™ã€‚</p><h2 id="Nullish-åˆå¹¶æ“ä½œç¬¦"><a href="#Nullish-åˆå¹¶æ“ä½œç¬¦" class="headerlink" title="Nullish åˆå¹¶æ“ä½œç¬¦"></a>Nullish åˆå¹¶æ“ä½œç¬¦</h2><p>Nullish åˆå¹¶æ“ä½œç¬¦æ˜¯ä¸€ç§æ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œç”¨äºè§£å†³ JavaScript ä¸­å˜é‡é»˜è®¤å€¼çš„é—®é¢˜ã€‚åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç”¨ || è¿ç®—ç¬¦æ¥ç»™å˜é‡èµ‹é»˜è®¤å€¼ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">const <span class="hljs-type">name</span> = person.name || <span class="hljs-string">&#x27;Unknown&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœå˜é‡çš„å€¼ä¸º 0 æˆ–è€…ç©ºå­—ç¬¦ä¸²ï¼Œè¿™ç§å†™æ³•å°±ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸ºè¿™äº›å€¼åœ¨é€»è¾‘ä¸Šæ˜¯å­˜åœ¨çš„ã€‚Nullish åˆå¹¶æ“ä½œç¬¦å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒåªä¼šåœ¨å˜é‡çš„å€¼ä¸º null æˆ– undefined æ—¶æ‰ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">const</span> <span class="hljs-keyword">name</span> = person.<span class="hljs-keyword">name</span> ?? <span class="hljs-string">&#x27;Unknown&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>??</code> è¡¨ç¤ºå¦‚æœ <code>name</code> ä¸º null æˆ– undefinedï¼Œå°±ä¼šè¿”å› â€˜Unknownâ€™ã€‚å¦‚æœ <code>name</code> çš„å€¼ä¸º 0 æˆ–ç©ºå­—ç¬¦ä¸²ï¼Œè¿™ç§å†™æ³•ä¾ç„¶ä¼šå°†å…¶è§†ä¸ºå­˜åœ¨</p><h2 id="ç±»çš„ç§æœ‰æ–¹æ³•-å±æ€§ï¼š"><a href="#ç±»çš„ç§æœ‰æ–¹æ³•-å±æ€§ï¼š" class="headerlink" title="ç±»çš„ç§æœ‰æ–¹æ³•&#x2F;å±æ€§ï¼š"></a>ç±»çš„ç§æœ‰æ–¹æ³•&#x2F;å±æ€§ï¼š</h2><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs leaf"><br>class MyClass &#123;<br>  <span class="hljs-punctuation">#</span><span class="hljs-keyword">myPrivateMethod</span><span class="hljs-params">()</span> &#123;<br>    console.log(&#x27;This is a private method&#x27;);<br>  &#125;<br>  <span class="hljs-punctuation">#</span><span class="hljs-keyword">privateName</span> = &#x27;lkq&#x27;<br>  myPublicMethod() &#123;<br>    console.log(&#x27;This is a public method&#x27;);<br>    this.<span class="hljs-punctuation">#</span><span class="hljs-keyword">myPrivateMethod</span><span class="hljs-params">()</span>;<br>  &#125;<br>&#125;<br><br>const myInstance = new MyClass();<br>myInstance.myPublicMethod(); <br>myInstance.<span class="hljs-punctuation">#</span><span class="hljs-keyword">myPrivateMethod</span><span class="hljs-params">()</span>; <br>console.log(myInstance.<span class="hljs-punctuation">#</span><span class="hljs-keyword">privateName</span>);<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç§æœ‰æ–¹æ³•<code>#myPrivateMethod()</code>ï¼Œå¹¶åœ¨å…¬å…±æ–¹æ³•<code>myPublicMethod()</code>ä¸­è°ƒç”¨å®ƒã€‚åœ¨åˆ›å»º<code>MyClass</code>çš„å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>myPublicMethod()</code>æ–¹æ³•ï¼Œä½†æ˜¯å°è¯•ç›´æ¥è°ƒç”¨ç§æœ‰æ–¹æ³•æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª<code>TypeError</code>ã€‚</p><ol start="2"><li>é™æ€æ–¹æ³•ï¼š</li></ol><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs scala"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParentClass</span> </span>&#123;<br>  static parentStaticMethod() &#123;<br>    console.log(&#x27;<span class="hljs-type">This</span> is a parent static method&#x27;);<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChildClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ParentClass</span> </span>&#123;<br>  static childStaticMethod() &#123;<br>    console.log(&#x27;<span class="hljs-type">This</span> is a child static method&#x27;);<br>    <span class="hljs-keyword">super</span>.parentStaticMethod();<br>  &#125;<br>&#125;<br><br><span class="hljs-type">ChildClass</span>.childStaticMethod(); <span class="hljs-comment">// è¾“å‡º: This is a child static method</span><br><span class="hljs-type">ChildClass</span>.parentStaticMethod(); <br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªçˆ¶ç±»<code>ParentClass</code>å’Œä¸€ä¸ªå­ç±»<code>ChildClass</code>ã€‚çˆ¶ç±»ä¸­æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•<code>parentStaticMethod()</code>ï¼Œå­ç±»ä¸­æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•<code>childStaticMethod()</code>ï¼Œå¹¶ä¸”å®ƒè°ƒç”¨äº†çˆ¶ç±»çš„é™æ€æ–¹æ³•ã€‚åœ¨è°ƒç”¨å­ç±»çš„é™æ€æ–¹æ³•æ—¶ï¼Œå®ƒå°†è¾“å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚</p><h2 id="awaitè¿ç®—ç¬¦"><a href="#awaitè¿ç®—ç¬¦" class="headerlink" title="awaitè¿ç®—ç¬¦"></a>awaitè¿ç®—ç¬¦</h2><p>åœ¨ JavaScript ä¸­ï¼Œawait è¿ç®—ç¬¦ç”¨äºæš‚åœæ‰§è¡Œï¼Œç›´åˆ° Promise è¢«è§£å†³ï¼ˆå±¥è¡Œæˆ–æ‹’ç»ï¼‰ã€‚</p><p>ä»¥å‰ï¼Œæˆ‘ä»¬åªèƒ½åœ¨ async å‡½æ•°ä¸­ä½¿ç”¨æ­¤è¿ç®—ç¬¦ - ä½¿ç”¨ async å…³é”®å­—å£°æ˜çš„å‡½æ•°ã€‚æˆ‘ä»¬æ— æ³•åœ¨å…¨çƒèŒƒå›´å†…è¿™æ ·åšã€‚</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><br>function setTimeoutAsync(timeout) &#123;<br> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">(resolve)</span> =&gt;</span> &#123;<br>   <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>     resolve();<br>   &#125;, timeout);<br> &#125;);<br>&#125;<br><span class="hljs-regexp">//</span> SyntaxError: <span class="hljs-keyword">await</span> <span class="hljs-keyword">is</span> only valid <span class="hljs-keyword">in</span> <span class="hljs-keyword">async</span> functions<br><span class="hljs-keyword">await</span> setTimeoutAsync(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ ES13ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ï¼š</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><br>function setTimeoutAsync(timeout) &#123;<br> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">(resolve)</span> =&gt;</span> &#123;<br>   <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>     resolve();<br>   &#125;, timeout);<br> &#125;);<br>&#125;<br><span class="hljs-regexp">//</span> Waits <span class="hljs-keyword">for</span> timeout - <span class="hljs-literal">no</span> error thrown<br><span class="hljs-keyword">await</span> setTimeoutAsync(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure><h2 id="at-æ–¹æ³•è¿›è¡Œç´¢å¼•"><a href="#at-æ–¹æ³•è¿›è¡Œç´¢å¼•" class="headerlink" title="at() æ–¹æ³•è¿›è¡Œç´¢å¼•"></a>at() æ–¹æ³•è¿›è¡Œç´¢å¼•</h2><p>æˆ‘ä»¬é€šå¸¸åœ¨ JavaScript ä¸­ä½¿ç”¨æ–¹æ‹¬å· ([]) æ¥è®¿é—®æ•°ç»„çš„ç¬¬ N ä¸ªå…ƒç´ ï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªç®€å•çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åªè®¿é—®æ•°ç»„çš„ N - 1 å±æ€§ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><br>const arr = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>];<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(arr[<span class="hljs-number">1</span>]); <span class="hljs-comment">// b</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨æ–¹æ‹¬å·è®¿é—®æ•°ç»„æœ«å°¾çš„ç¬¬ N ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ arr.length - N çš„ç´¢å¼•ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><br>const arr = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>];<br><span class="hljs-comment">// 1st element from the end</span><br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(arr[arr.<span class="hljs-built_in">length</span> - <span class="hljs-number">1</span>]); <span class="hljs-comment">// d</span><br><span class="hljs-comment">// 2nd element from the end</span><br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(arr[arr.<span class="hljs-built_in">length</span> - <span class="hljs-number">2</span>]); <span class="hljs-comment">// c</span><br></code></pre></td></tr></table></figure><p>æ–°çš„ at() æ–¹æ³•è®©æˆ‘ä»¬å¯ä»¥æ›´ç®€æ´ã€æ›´æœ‰è¡¨ç°åŠ›åœ°åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¦è®¿é—®æ•°ç»„æœ«å°¾çš„ç¬¬ N ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬åªéœ€å°†è´Ÿå€¼ -N ä¼ é€’ç»™ at()ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><br>const arr = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>];<br><span class="hljs-comment">// 1st element from the end</span><br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(arr.at(<span class="hljs-number">-1</span>)); <span class="hljs-comment">// d</span><br><span class="hljs-comment">// 2nd element from the end</span><br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(arr.at(<span class="hljs-number">-2</span>)); <span class="hljs-comment">// c</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>async å’Œ await</title>
    <link href="/2023/07/10/async/"/>
    <url>/2023/07/10/async/</url>
    
    <content type="html"><![CDATA[<h1 id="async-å’Œ-await"><a href="#async-å’Œ-await" class="headerlink" title="async å’Œ await"></a>async å’Œ await</h1><h2 id="1ã€asyncå‡½æ•°"><a href="#1ã€asyncå‡½æ•°" class="headerlink" title="1ã€asyncå‡½æ•°"></a>1ã€asyncå‡½æ•°</h2><p>å¼‚æ­¥å‡½æ•°å£°æ˜å£°æ˜ä¸€ä¸ªasync functionï¼Œå…¶ä¸­å‡½æ•°ä½“ä¸­å…è®¸ä½¿ç”¨ await å…³é”®å­—ã€‚async å’Œ await å…³é”®å­—å…è®¸ä»¥æ›´ç®€æ´çš„æ ·å¼ç¼–å†™å¼‚æ­¥ã€åŸºäº promise çš„è¡Œä¸ºï¼Œä»è€Œé¿å…äº†æ˜¾å¼é…ç½®æ‰¿è¯ºé“¾çš„éœ€è¦ã€‚</p><h2 id="2ã€Promise"><a href="#2ã€Promise" class="headerlink" title="2ã€Promise"></a>2ã€Promise</h2><p>Promise å¯¹è±¡è¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰åŠå…¶ç»“æœå€¼ã€‚Promiseæ‹¥æœ‰è‡ªå·±çš„state</p><h3 id="2-1ã€Promiseçš„state"><a href="#2-1ã€Promiseçš„state" class="headerlink" title="2-1ã€Promiseçš„state"></a>2-1ã€Promiseçš„state</h3><p><code>pending</code>: initial state, neither fulfilled nor rejected.</p><p><code>fulfilled</code>: meaning that the operation was completed successfully.</p><p><code>rejected</code>: meaning that the operation failed.</p><h3 id="2-2ã€Promiseçš„å·¥ä½œæµç¨‹"><a href="#2-2ã€Promiseçš„å·¥ä½œæµç¨‹" class="headerlink" title="2-2ã€Promiseçš„å·¥ä½œæµç¨‹"></a>2-2ã€Promiseçš„å·¥ä½œæµç¨‹</h3><p>pendingçŠ¶æ€ä¸­å¦‚æœæ‰§è¡Œè¢«rejectï¼Œé‚£ä¹ˆPromiseè¿›å…¥rejectedçŠ¶æ€ï¼Œå¹¶è°ƒç”¨.catchå‡½æ•°ï¼Œå¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œåˆ™è¿›å…¥fulfilledçŠ¶æ€ï¼Œå¹¶è°ƒç”¨.thenå‡½æ•°</p><h2 id="3ã€ä¸Taro-requestç»“åˆ"><a href="#3ã€ä¸Taro-requestç»“åˆ" class="headerlink" title="3ã€ä¸Taro.requestç»“åˆ"></a>3ã€ä¸Taro.requestç»“åˆ</h2><p>ç”±äºTaro.requestè¿”å›çš„æ˜¯ä¸€ä¸ªPromiseï¼Œå¦‚æœç›´æ¥å°†å…¶è¾“å‡ºï¼Œå°†ä¼šå¾—åˆ°åœ¨pendingçŠ¶æ€çš„Promiseï¼Œè€Œä¸æ˜¯å¸Œæœ›å¾—åˆ°çš„ç»“æœã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨asyncå‡½æ•°ï¼Œå¹¶ä½¿ç”¨awaitç­‰å¾…Promiseæ‰§è¡Œå®Œæ¯•ï¼Œåˆ™å¯è·å¾—.thenå‡½æ•°ä¸­æœŸæœ›çš„è¿”å›å€¼</p><pre><code class="hljs">async function InfoData() &#123;    const info = await Request(&#39;post&#39;,&#39;/project/games/find&#39;,Token,&#123;        &quot;crowd&quot;: `$&#123;crowdList[state.list[2]]&#125;`,        &#39;time&#39;:`$&#123;timeList[state.list[1]]&#125;`,        &quot;venue&quot;: `$&#123;placeList[state.list[0]]&#125;`,      &#125;)      setgameL(info.data.data)      console.log(&#39;info&#39;,info.data.data);      return info.data.data;  &#125;</code></pre><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒRequestæ˜¯å°è£…å¥½çš„è¯·æ±‚å‡½æ•°ï¼Œ.thenå›è°ƒè¿”å›æ‹¿åˆ°çš„æ•°æ®ï¼Œå¦‚æœç›´æ¥ä½¿ </p><pre><code class="hljs">info = Request(&#39;post&#39;,&#39;/project/games/find&#39;,Token,&#123;            &quot;crowd&quot;: `$&#123;crowdList[state.list[2]]&#125;`,            &#39;time&#39;:`$&#123;timeList[state.list[1]]&#125;`,            &quot;venue&quot;: `$&#123;placeList[state.list[0]]&#125;`,       &#125;)</code></pre><p>åˆ™ä¼šå¾—åˆ°ï¼š<code>Promise&lt;pending...&gt;</code>è¿™ä¸ªç»“æœ</p><h2 id="4ã€é—®é¢˜"><a href="#4ã€é—®é¢˜" class="headerlink" title="4ã€é—®é¢˜"></a>4ã€é—®é¢˜</h2><p>åœ¨ä¸‹é¢çš„ç¨‹åºä¸­ï¼Œè°ƒç”¨.thenå‡½æ•°å¯ä»¥æ­£å¸¸å¯¹dataListèµ‹å€¼ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨Taro.requestè‡ªå¸¦çš„successå›è°ƒåˆ™ä¸èƒ½æ­£å¸¸èµ‹å€¼</p><pre><code class="hljs"> dataList = await Taro.request(&#123;          url: &#39;http://116.204.121.9:65000/api/v1&#39;+url,           method: method,          header: &#123;            &#39;Authorization&#39;: Token?Token:&#39;&#39;,            &#39;Content-Type&#39;: &#39;application/json&#39;,            &#39;Accept&#39;: &#39;*/*&#39;,          &#125;,          data: JSON.stringify(body),                  &#125;).then((res) =&gt; &#123;          if(url === &#39;/login&#39; ) &#123;            if(res.statusCode !== 401) &#123;              Taro.setStorageSync(&#39;token&#39;,res.data.data.Token)              dataList = [res.data.data]            &#125; else &#123;              register()            &#125;               &#125; else &#123;            // console.log(&#39;iiiiiiiiiiiiiiiiiiiiiii&#39;,res);            res.data.data.qq?Taro.setStorageSync(&#39;nickName&#39;,res.data.data.qq):&#39;&#39;            res.data.data.qq?Taro.setStorageSync(&#39;url&#39;,res.data.data.photo):&quot;&quot;            // res.data.data.qq?Taro.setStorageSync(&#39;uid&#39;,res.data.data.uid):&#39;&#39;            return res           &#125;                  &#125;)</code></pre>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsåŸºç¡€</tag>
      
      <tag>taroå°ç¨‹åº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>useReducer å’Œ useContext</title>
    <link href="/2023/03/03/useReducer/"/>
    <url>/2023/03/03/useReducer/</url>
    
    <content type="html"><![CDATA[<h1 id="useReducer-å’Œ-useContext"><a href="#useReducer-å’Œ-useContext" class="headerlink" title="useReducer å’Œ useContext"></a>useReducer å’Œ useContext</h1><blockquote><p>useReducer æ˜¯ä¸€ä¸ª React Hookï¼Œå®ƒå…è®¸ä½ å‘ç»„ä»¶æ·»åŠ ä¸€ä¸ªåŒ–ç®€å™¨ã€‚</p><p>useContext æ˜¯ä¸€ä¸ª React Hookï¼Œå®ƒå…è®¸ä½ ä»ç»„ä»¶ä¸­è¯»å–å’Œè®¢é˜…ä¸Šä¸‹æ–‡ã€‚</p></blockquote><h2 id="useContextä½¿ç”¨æ–¹æ³•"><a href="#useContextä½¿ç”¨æ–¹æ³•" class="headerlink" title="useContextä½¿ç”¨æ–¹æ³•"></a>useContextä½¿ç”¨æ–¹æ³•</h2><p>1ã€åœ¨å…¨å±€createContext</p><p><code>const globalContext = createContext()</code></p><p>2ã€åœ¨éœ€è¦ä¼ é€’å‚æ•°çš„ç»„ä»¶å¤–é¢å¥—ä¸€å±‚Context.Providerï¼Œå¹¶æŠŠè¦ä¼ é€’çš„å‚æ•°å†™åœ¨valueä¸­</p><pre><code class="hljs">&lt;globalContext.Provider value=&quot;dark&quot;&gt;  &lt;Form /&gt;&lt;/globalContext.Provider&gt;</code></pre><p>3ã€åœ¨éœ€è¦æ¥å—å‚æ•°çš„ç»„ä»¶ä¸­ä½¿ç”¨useContext</p><pre><code class="hljs">function Form() &#123;  return (    &lt;Panel title=&quot;Welcome&quot;&gt;      &lt;Button&gt;Sign up&lt;/Button&gt;      &lt;Button&gt;Log in&lt;/Button&gt;    &lt;/Panel&gt;  );&#125;function Panel(&#123; title, children &#125;) &#123;  const theme = useContext(ThemeContext);  const className = &#39;panel-&#39; + theme;  return (    &lt;section className=&#123;className&#125;&gt;      &lt;h1&gt;&#123;title&#125;&lt;/h1&gt;      &#123;children&#125;    &lt;/section&gt;  )&#125;</code></pre><h2 id="ReduxåŸç†"><a href="#ReduxåŸç†" class="headerlink" title="ReduxåŸç†"></a>ReduxåŸç†</h2><p><img src="https://image.baidu.com/search/detail?ct=503316480&z=0&ipn=d&word=redux%E5%8E%9F%E7%90%86&step_word=&hs=0&pn=2&spn=0&di=7189064908862914561&pi=0&rn=1&tn=baiduimagedetail&is=0,0&istype=0&ie=utf-8&oe=utf-8&in=&cl=2&lm=-1&st=undefined&cs=3280256628,1358513824&os=3135708404,212282761&simid=3280256628,1358513824&adpicid=0&lpn=0&ln=307&fr=&fmq=1677853227002_R&fm=&ic=undefined&s=undefined&hd=undefined&latest=undefined&copyright=undefined&se=&sme=&tab=0&width=undefined&height=undefined&face=undefined&ist=&jit=&cg=&bdtype=0&oriquery=&objurl=https://img-blog.csdnimg.cn/fc5388fecf8449d49e771fac967579a8.gif&fromurl=ippr_z2C$qAzdH3FAzdH3Fks52_z&e3Bvf1g_z&e3BgjpAzdH3F4a_mabdnmb9AzdH3Fw6ptvsjAzdH3F1jpwtsfAzdH3F8d8c9c09a&gsm=1e&rpstart=0&rpnum=0&islist=&querylist=&nojc=undefined&dyTabStr=MCwzLDQsMSwyLDUsNiw3LDgsOQ==" alt="è¿™æ˜¯å›¾ç‰‡" title="photo"></p><p>uiæ“ä½œ -&gt; dispatchæ–¹æ³• -&gt; è¿›å…¥store,è°ƒç”¨å¯¹åº”reduceræ”¹å˜state</p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>1ã€åœ¨å¤–éƒ¨å®šä¹‰reduceræ–¹æ³•ï¼Œä»¥å¤„ç†dispatchä¼ é€’çš„action</p><pre><code class="hljs">const reducer = (prevState,action) =&gt; &#123;  let newState = &#123;...prevState&#125;  newstate.list[action.type-1] = action.value;  return newstate&#125;</code></pre><p>2ã€åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰stateå’Œdispatchæ–¹æ³•</p><p> <code>const [state, dispatch] = useReducer(reducer, initialState)</code></p><p>3ã€åœ¨éœ€è¦ä½¿ç”¨æˆ–æ”¹å˜è¯¥çŠ¶æ€çš„åœ°æ–¹ä½¿ç”¨useContextï¼Œå°†stateå’Œdispatchæ–¹æ³•ä¼ å…¥</p><pre><code class="hljs">&lt;globalContext.Provider value=&#123;&#123;       state,       dispatch &#125;&#125;&gt;    &lt;View id=&#39;filt&#39; &gt;        &lt;Gameselect text = &#39;åœºåœ°&#39; &gt;&lt;Placechild type=&#39;1&#39; ItemText = &#123;placeList&#125; func=&#123;Info&#125;&gt;&lt;/Placechild&gt;&lt;/Gameselect&gt;        &lt;Gameselect text = &#39;æ—¶é—´&#39;  &gt;&lt;Placechild type=&#39;2&#39; ItemText = &#123;timeList&#125; func=&#123;Info&#125;&gt;&lt;/Placechild&gt;&lt;/Gameselect&gt;        &lt;Gameselect text = &#39;äººæ•°&#39; &gt;&lt;Placechild  type = &#39;3&#39; ItemText = &#123;crowdList&#125; func=&#123;Info&#125;&gt;&lt;/Placechild&gt;&lt;/Gameselect&gt;                    &lt;/View&gt;           &lt;/globalContext.Provider&gt;</code></pre><p>4ã€åœ¨ç»„ä»¶ä¸­è°ƒç”¨dispatchæ–¹æ³•ï¼Œæ”¹å˜state</p><pre><code class="hljs">export function Placechild(props) &#123;  const &#123;dispatch&#125; = useContext(globalContext)  const &#123;state&#125; = useContext(globalContext)  // console.log(state);  const&#123;    type,    ItemText,    func  &#125; = props    return (    &lt;View&gt;      &#123;ItemText.map((text,index)=&gt;&#123;        return (          &lt;View onTap=&#123;async ()=&gt;&#123;            await dispatch(&#123;              type:`$&#123;type&#125;`,              value:`$&#123;index&#125;`            &#125;)            func(type-1,index)            &#125;&#125;&gt;            &lt;GameSelctItem type = &#123;type&#125; text = &#123;text&#125;  style = &#123;state.list[props.type-1]&#125; index =&#123;index&#125;/&gt;          &lt;/View&gt;        )      &#125;)&#125;          &lt;/View&gt;  )&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>reactåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>reactåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javascriptç¼–ç åŸåˆ™</title>
    <link href="/2023/01/07/howToWriteJS/"/>
    <url>/2023/01/07/howToWriteJS/</url>
    
    <content type="html"><![CDATA[<h1 id="Javascriptç¼–ç åŸåˆ™"><a href="#Javascriptç¼–ç åŸåˆ™" class="headerlink" title="Javascriptç¼–ç åŸåˆ™"></a>Javascriptç¼–ç åŸåˆ™</h1><h2 id="ä¸€ã€-å„å¸å…¶èŒ"><a href="#ä¸€ã€-å„å¸å…¶èŒ" class="headerlink" title="ä¸€ã€ å„å¸å…¶èŒ"></a>ä¸€ã€ å„å¸å…¶èŒ</h2><p>ç»“æ„è¡Œä¸ºåˆ†ç¦»ï¼Œjsä¸­å°½é‡å°‘å†™æ ·å¼ä¿®æ”¹ï¼Œå°½é‡åªä¿ç•™åŸºæœ¬é€»è¾‘ä»£ç ï¼Œç”¨classæ“ä½œcssï¼Œè¿™æ ·ä»£ç æ›´ä¸ºç®€æ´ï¼Œå¯è¯»æ€§æ›´å¼ºã€‚ç®€å•é€»è¾‘ç”šè‡³å¯ä»¥åªä½¿ç”¨csså®Œæˆã€‚æ€»ä¹‹åº”è¯¥é¿å…jsç›´æ¥æ“ä½œæ ·å¼</p><h2 id="äºŒã€-ç»„ä»¶å°è£…"><a href="#äºŒã€-ç»„ä»¶å°è£…" class="headerlink" title="äºŒã€ ç»„ä»¶å°è£…"></a>äºŒã€ ç»„ä»¶å°è£…</h2><p>æ³¨æ„ç»„ä»¶å¤ç”¨æ€§ã€æ‹“å±•æ€§ï¼Œé¿å…é‡å¤â€œé€ è½®å­â€ã€‚<br>ä»¥è½®æ’­å›¾ä¸ºä¾‹ï¼Œé¦–å…ˆå†™å¥½htmlç»“æ„</p><pre><code class="hljs">&lt;template&gt;      &lt;div class=&#39;xtx-carousel&#39;&gt;        &lt;ul class=&quot;carousel-body&quot;&gt;          &lt;!-- æ‰€æœ‰å›¾ç‰‡åˆ—è¡¨ --&gt;          &lt;li class=&quot;carousel-item fade&quot;&gt;            &lt;RouterLink to=&quot;/&quot;&gt;              &lt;img src=&quot;&quot; alt=&quot;&quot;&gt;            &lt;/RouterLink&gt;          &lt;/li&gt;        &lt;/ul&gt;        &lt;!-- å·¦ç®­å¤´ --&gt;        &lt;a href=&quot;javascript:;&quot; class=&quot;carousel-btn prev&quot;&gt;&lt;i class=&quot;iconfont icon-angle-left&quot;&gt;&lt;/i&gt;&lt;/a&gt;        &lt;!-- å³ç®­å¤´ --&gt;        &lt;a href=&quot;javascript:;&quot; class=&quot;carousel-btn next&quot;&gt;&lt;i class=&quot;iconfont icon-angle-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;        &lt;!-- è®¡æ•°å™¨ --&gt;        &lt;div class=&quot;carousel-indicator&quot;&gt;          &lt;span v-for=&quot;i in 5&quot; :key=&quot;i&quot;&gt;&lt;/span&gt;        &lt;/div&gt;      &lt;/div&gt;&lt;/template&gt;</code></pre><p>ä¹‹åå†™å¥½jsæ¡†æ¶ï¼Œå†³å®šè¡Œä¸ºè®¾è®¡</p><pre><code class="hljs">import &#123; ref &#125; from &#39;vue&#39;export default &#123;  name: &#39;swiper&#39;,  props: &#123;    sliders: &#123;      type: Array,      default: () =&gt; []    &#125;  &#125;,  setup () &#123;    // è®°å½•å›¾ç‰‡çš„ä¸‹æ ‡å€¼å˜é‡    const index = ref(0)     return &#123; index &#125;  &#125;&#125;</code></pre><p>æœ€åä½¿ç”¨csså®ç°å±•ç¤ºæ•ˆæœ</p><p>å°è£…å®Œæˆåçš„ç»„ä»¶å¼•ç”¨æ—¶åªç”¨å†™<code>&lt;Swiper&gt;&lt;Swiper/&gt;</code>,åœ¨reactã€vueä¸­è¿˜å¯ä»¥è¿›ä¸€æ­¥å°†è½®æ’­å†…å®¹å°è£…èµ·æ¥ï¼Œä½¿ç”¨<code>props.children</code>åŠ¨æ€æ›´æ”¹è½®æ’­å†…å®¹ï¼Œè¿›ä¸€æ­¥å¢å¼ºå¤ç”¨æ€§</p><h2 id="ä¸‰ã€-è¿‡ç¨‹æŠ½è±¡"><a href="#ä¸‰ã€-è¿‡ç¨‹æŠ½è±¡" class="headerlink" title="ä¸‰ã€ è¿‡ç¨‹æŠ½è±¡"></a>ä¸‰ã€ è¿‡ç¨‹æŠ½è±¡</h2><p>å¯ä»¥å°†å¤æ‚çš„è¿‡ç¨‹å°è£…æˆå‡½æ•°ï¼Œå½¢æˆé—­åŒ…ç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦åœ¨æ„è¿‡ç¨‹ç»†èŠ‚ï¼Œç±»ä¼¼äºapiçš„è°ƒç”¨ï¼Œå¯ä»¥é€‰æ‹©å‘½ä»¤å¼ã€å£°æ˜å¼çš„ç¼–ç¨‹æ–¹å¼</p><h2 id="å››ã€-ä»£ç è´¨é‡ä¼˜åŒ–"><a href="#å››ã€-ä»£ç è´¨é‡ä¼˜åŒ–" class="headerlink" title="å››ã€ ä»£ç è´¨é‡ä¼˜åŒ–"></a>å››ã€ ä»£ç è´¨é‡ä¼˜åŒ–</h2><h3 id="1ã€å‡å°‘å…¨å±€å˜é‡ä½¿ç”¨"><a href="#1ã€å‡å°‘å…¨å±€å˜é‡ä½¿ç”¨" class="headerlink" title="1ã€å‡å°‘å…¨å±€å˜é‡ä½¿ç”¨"></a>1ã€å‡å°‘å…¨å±€å˜é‡ä½¿ç”¨</h3><p>æ¯ä¸ª JavaScript æ‰§è¡Œç¯å¢ƒéƒ½æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡ ä¾‹å¦‚ï¼š æµè§ˆå™¨çª—å£çš„ window å¯¹è±¡, å¯åœ¨å‡½æ•°å¤–éƒ¨ä½¿ç”¨ this å…³é”®å­—è¿›è¡Œè®¿é—®ã€‚JavaScript ä¸­åœ¨å‡½æ•°å¤–éƒ¨åˆ›å»ºçš„æ¯ä¸€ä¸ªå˜é‡éƒ½æ˜¯å…¨å±€å˜é‡ï¼Œ å¯ä»¥åœ¨æ•´ä¸ªæ‰§è¡Œç¯å¢ƒä¸­çš„å„ä¸ªåœ°æ–¹ä½¿ç”¨ ä¾‹å¦‚ï¼šä¸‹é¢çš„å®šä¹‰ globalVar å˜é‡å¯ä»¥åœ¨ä»£ç å—ä¸­çš„å„ä¸ªéƒ¨åˆ†è®¿é—®ï¼Œ å³ä½¿åœ¨ä¸åŒçš„ script æ ‡ç­¾å†…ã€‚<br>è€Œåœ¨ function foo ä¸­å®šä¹‰çš„ localVar å˜é‡ï¼Œ å°±åªå±€é™äº foo å‡½æ•°çš„ä½œç”¨åŸŸå†…å¯ä»¥è®¿é—®</p><pre><code class="hljs">&lt;script&gt;    var globalVar = &#39;feifeiyu&#39;    function foo() &#123;        var localVar = &#39;feiyu&#39;        console.log(&#39;global foo:&#39;, globalVar) // =&gt; feifeiyu        console.log(&#39;local foo:&#39;, localVar)  // =&gt; feiyu    &#125;    console.log(&#39;global:&#39;, globalVar)  // =&gt; feifeiyu    console.log(&#39;global window1:&#39;, window.globalVar) // =&gt; feifeiyu    console.log(&#39;global window2:&#39;, window[&#39;globalVar&#39;])  // =&gt; feifeiyu    // console.log(&#39;local:&#39;, localVar) // error&lt;/script&gt;&lt;script&gt;    console.log(&#39;global2:&#39;, globalVar)&lt;/script&gt;</code></pre><p>ç”±ä¸Šä¾‹ä¸­æƒ³åˆ°ï¼Œ å¦‚æœä¸€ä¸ªé¡µé¢ä¸­å¦‚æœæœ‰ä¸¤å—ç‹¬ç«‹çš„ä»£ç ä¸­ï¼Œ åŒ…å«æœ‰ç›¸åŒåç§°çš„å˜é‡ï¼Œ ä½†å´æœ‰ç€ä¸åŒçš„ä½œç”¨æ—¶ï¼Œ ä¼šå¼•èµ·ç¨‹åºè¿è¡Œå‡ºé”™ã€‚åœ¨å…¶ä»–çš„ç¨‹åºä¸­ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¼•å…¥äº†å‘½åç©ºé—´çš„æ¦‚å¿µï¼Œ ä¾‹å¦‚ï¼š C++ æœ‰ä¸ªä¸“é—¨çš„å…³é”®å­— namespace æ¥å£°æ˜å‘½åç©ºé—´ã€‚åœ¨ JavaScript ä¸­æ²¡è¿™æ ·çš„å…³é”®å­—æ¥æ§åˆ¶å‘½åç©ºé—´ï¼Œ å› æ­¤ï¼Œ ä¸ºäº†é¿å…å˜é‡åœ¨å…¨å±€ä½œç”¨åŸŸä¸­å†²çªï¼Œ åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­åº”è¯¥å°½å¯èƒ½åœ°å‡å°‘å…¨å±€ä½œç”¨åŸŸä¸­çš„ä½¿ç”¨ã€‚å¦‚ä½•å‡å°‘å…¨å±€å˜é‡æ•°é‡ï¼Œ å¤§è‡´çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œ ä¸€ç§æ˜¯äººä¸ºå»æ„é€  JavaScript çš„å‘½åç©ºé—´ï¼Œ è¿™ç§æ¨¡å¼ç›¸å¯¹å¤æ‚ä¸å¸¸ç”¨; å¦ä¸€ç§æ˜¯é‡‡ç”¨è‡ªæ‰§è¡Œå³ä½¿å‡½æ•°(self-execting immediate funtionsl)æ¥å®ç°ã€‚</p><h3 id="2ã€-å…³æ³¨å˜é‡æå‡"><a href="#2ã€-å…³æ³¨å˜é‡æå‡" class="headerlink" title="2ã€ å…³æ³¨å˜é‡æå‡"></a>2ã€ å…³æ³¨å˜é‡æå‡</h3><p>å˜é‡æå‡æ˜¯ JavaScript ä»£ç ç¼–å†™ä¸­å®¹æ˜“å¿½ç•¥çš„ä¸€ä¸ªç‚¹ã€‚JavaScript å…è®¸åœ¨å‡½æ•°ä»»æ„åœ°æ–¹å£°æ˜å¤šä¸ªå˜é‡ï¼Œ æ— è®ºåœ¨å“ªé‡Œå£°æ˜ï¼Œ æ•ˆæœéƒ½ç­‰åŒäºåœ¨å‡½æ•°é¡¶éƒ¨å£°æ˜ï¼Œ è¿™å°±æ˜¯å˜é‡æå‡ï¼ˆhoisting)ã€‚å½“å…ˆä½¿ç”¨å˜é‡åå®šä¹‰å˜é‡ï¼Œå°†ä¼šå¯¼è‡´é€»è¾‘ä¸Šçš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼š</p><pre><code class="hljs">(function() &#123;    var myName = &#39;feifeiyu&#39;    function func() &#123;        console.log(&#39;myName 1:&#39;, myName)  // =&gt; myName 1: undefined        var myName = &#39;feiyu&#39;        console.log(&#39;myName 2:&#39;, myName)  // =&gt; myName 2: feiyu    &#125;&#125;())</code></pre><p>ä¸Šè¿°ä»£ç æ‰§è¡Œåï¼Œ å®‰è£…å¼€å‘è€…çš„æ„å›¾ï¼Œ ç¬¬ä¸€ä¸ªconsole è¾“å‡ºçš„åº”è¯¥æ˜¯ myName 1: feifeiyu, ç¬¬äºŒä¸ª console è¾“å‡ºçš„åº”è¯¥æ˜¯ feiyu, ç„¶è€Œæ„æƒ³ä¸åˆ°çš„ç»“æœå‡ºç°äº†ï¼Œ ç¬¬ä¸€ä¸ª console è¾“å‡ºçš„æ˜¯ undefinedã€‚ å¯¼è‡´è¿™ä¸ªçš„å…ƒå‡¶æ˜¯ JavaScript çš„å˜é‡æå‡ï¼Œ JavaScript è§£é‡Šå™¨åœ¨æ‰§è¡Œæ—¶ï¼Œ å‡½æ•°ä¸­çš„ myName ä¼šæå‡åˆ°å‡½æ•° func æœ€é¡¶éƒ¨å»å®šä¹‰ï¼Œ æœ¬è´¨ä¸Šè¿°ä»£ç æ˜¯æŒ‰å¦‚ä¸‹é€»è¾‘å»æ‰§è¡Œçš„ï¼š</p><pre><code class="hljs">(function() &#123;    var myName = &#39;feifeiyu&#39;    function func() &#123;        var myName  //æ­¤æ—¶ myName æ˜¯ undefined        console.log(&#39;myName 1:&#39;, myName)  // =&gt; myName 1: undefined        myName = &#39;feiyu&#39;        console.log(&#39;myName 2:&#39;, myName)  // =&gt; myName 2: feiyu    &#125;&#125;())</code></pre>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é‡å®šä¹‰thisçš„æ–¹æ³•</title>
    <link href="/2022/11/27/this/"/>
    <url>/2022/11/27/this/</url>
    
    <content type="html"><![CDATA[<h1 id="é‡å®šä¹‰thisçš„æ–¹æ³•"><a href="#é‡å®šä¹‰thisçš„æ–¹æ³•" class="headerlink" title="é‡å®šä¹‰thisçš„æ–¹æ³•"></a>é‡å®šä¹‰thisçš„æ–¹æ³•</h1><pre><code class="hljs">var name=&#39;åˆ˜æºå¿&#39;,age=&#39;19&#39;;var obj= &#123;    name=&#39;å¸…å“¥&#39;,    objage:this.age,    from:function(fr,to) &#123;        console.log(this.name + &quot;å¹´é¾„&quot; + this.age + &quot;æ¥è‡ª&quot; + fr + &quot;å»å¾€&quot; + to);    &#125;&#125;var lao_die= &#123;    name:lao_die,    age:99&#125;</code></pre><p>â€‹<br>â€‹</p><h3 id="call-apply-bind-ä¸‰ä¸ªæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°å‡ä¸ºthisçš„æŒ‡å‘-ä½†æ˜¯åé¢å‚æ•°æœ‰æ‰€ä¸åŒ"><a href="#call-apply-bind-ä¸‰ä¸ªæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°å‡ä¸ºthisçš„æŒ‡å‘-ä½†æ˜¯åé¢å‚æ•°æœ‰æ‰€ä¸åŒ" class="headerlink" title="call()&#x2F;apply()&#x2F;bind()ä¸‰ä¸ªæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°å‡ä¸ºthisçš„æŒ‡å‘,ä½†æ˜¯åé¢å‚æ•°æœ‰æ‰€ä¸åŒ"></a>call()&#x2F;apply()&#x2F;bind()ä¸‰ä¸ªæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°å‡ä¸ºthisçš„æŒ‡å‘,ä½†æ˜¯åé¢å‚æ•°æœ‰æ‰€ä¸åŒ</h3><h2 id="call"><a href="#call" class="headerlink" title="call()"></a>call()</h2><pre><code class="hljs">obj.from.call(lao_die,&#39;hang_zhou&#39;,&#39;wu_han&#39;);</code></pre><h3 id="call-çš„åé¢å‚æ•°ç›´æ¥æ”¾å…¥"><a href="#call-çš„åé¢å‚æ•°ç›´æ¥æ”¾å…¥" class="headerlink" title="call()çš„åé¢å‚æ•°ç›´æ¥æ”¾å…¥"></a>call()çš„åé¢å‚æ•°ç›´æ¥æ”¾å…¥</h3><h2 id="apply"><a href="#apply" class="headerlink" title="apply()"></a>apply()</h2><pre><code class="hljs">obj.from.apply(lao_die,[&#39;hang_zhou&#39;,&#39;wu_han&#39;]);</code></pre><h3 id="apply-çš„åé¢å‚æ•°è¦å¥—åœ¨ä¸­æ‹¬å·å†…"><a href="#apply-çš„åé¢å‚æ•°è¦å¥—åœ¨ä¸­æ‹¬å·å†…" class="headerlink" title="apply()çš„åé¢å‚æ•°è¦å¥—åœ¨ä¸­æ‹¬å·å†…"></a>apply()çš„åé¢å‚æ•°è¦å¥—åœ¨ä¸­æ‹¬å·å†…</h3><h2 id="bind"><a href="#bind" class="headerlink" title="bind()"></a>bind()</h2><pre><code class="hljs">obj.from.bind(lao_die,&#39;hang_zhou&#39;,&#39;wu_han&#39;)();</code></pre><h3 id="bind-æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥è¦åœ¨æœ«å°¾åŠ ä¸Š-è‡ªè°ƒç”¨æ‰èƒ½è¿è¡Œ"><a href="#bind-æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥è¦åœ¨æœ«å°¾åŠ ä¸Š-è‡ªè°ƒç”¨æ‰èƒ½è¿è¡Œ" class="headerlink" title="bind()æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥è¦åœ¨æœ«å°¾åŠ ä¸Š()è‡ªè°ƒç”¨æ‰èƒ½è¿è¡Œ"></a>bind()æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥è¦åœ¨æœ«å°¾åŠ ä¸Š()è‡ªè°ƒç”¨æ‰èƒ½è¿è¡Œ</h3>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°</title>
    <link href="/2022/11/07/arrowFunction/"/>
    <url>/2022/11/07/arrowFunction/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°"><a href="#ä¸€ã€ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°" class="headerlink" title="ä¸€ã€ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°"></a>ä¸€ã€ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°</h2><blockquote><p>ç®­å¤´å‡½æ•°è¡¨è¾¾å¼è¯­æ³•æ¯”å‡½æ•°è¡¨è¾¾å¼æ›´ç®€æ´ï¼Œå¹¶ä¸”æ²¡æœ‰è‡ªå·±çš„<code>this</code>ï¼Œ<code>arguments</code>ï¼Œ<code>super</code>æˆ–<code>new.target</code>ç­‰ï¼Œä¹Ÿä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°ã€‚ç®­å¤´å‡½æ•°è¡¨è¾¾å¼æ›´é€‚ç”¨äºé‚£äº›æœ¬æ¥éœ€è¦<code>åŒ¿åå‡½æ•°</code>çš„åœ°æ–¹ã€‚ </p></blockquote><h3 id="æ™®é€šå‡½æ•°ï¼Œå‡½æ•°çš„åå­—å«shuai-ge"><a href="#æ™®é€šå‡½æ•°ï¼Œå‡½æ•°çš„åå­—å«shuai-ge" class="headerlink" title="æ™®é€šå‡½æ•°ï¼Œå‡½æ•°çš„åå­—å«shuai_ge"></a>æ™®é€šå‡½æ•°ï¼Œå‡½æ•°çš„åå­—å«shuai_ge</h3><pre><code class="hljs">var x=&quot;shaui_ge&quot;function shuai_ge()&#123;    console.log(`$&#123;x=&quot;åˆ˜æºå¿&quot;&#125;`);&#125;</code></pre><h3 id="ç®­å¤´å‡½æ•°"><a href="#ç®­å¤´å‡½æ•°" class="headerlink" title="ç®­å¤´å‡½æ•°"></a>ç®­å¤´å‡½æ•°</h3><pre><code class="hljs"> var x=&quot;shuai_ge&quot;; (() =&gt; x=&quot;åˆ˜æºå¿&quot;)() console.log(x);</code></pre><h2 id="äºŒã€ç®­å¤´å‡½æ•°ä¸åŒ¿åå‡½æ•°"><a href="#äºŒã€ç®­å¤´å‡½æ•°ä¸åŒ¿åå‡½æ•°" class="headerlink" title="äºŒã€ç®­å¤´å‡½æ•°ä¸åŒ¿åå‡½æ•°"></a>äºŒã€ç®­å¤´å‡½æ•°ä¸åŒ¿åå‡½æ•°</h2><h3 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h3><pre><code class="hljs">function ()&#123;console.log(&quot;åˆ˜æºå¿&quot;);&#125;</code></pre><h3 id="è¿è¡ŒåŒ¿åå‡½æ•°-å•ç‹¬è¿è¡Œæ—¶ç»“å°¾åŠ ä¸Šæ‹¬å·"><a href="#è¿è¡ŒåŒ¿åå‡½æ•°-å•ç‹¬è¿è¡Œæ—¶ç»“å°¾åŠ ä¸Šæ‹¬å·" class="headerlink" title="è¿è¡ŒåŒ¿åå‡½æ•°(å•ç‹¬è¿è¡Œæ—¶ç»“å°¾åŠ ä¸Šæ‹¬å·)"></a>è¿è¡ŒåŒ¿åå‡½æ•°(å•ç‹¬è¿è¡Œæ—¶ç»“å°¾åŠ ä¸Šæ‹¬å·)</h3><pre><code class="hljs">(function ()&#123;    //æ­¤æ—¶ä¼šè¾“å‡ºåˆ˜æºå¿    console.log(&quot;åˆ˜æºå¿&quot;);&#125;)(//ä¼ å…¥çš„å€¼)</code></pre><h3 id="ç®­å¤´å‡½æ•°ç›¸å½“äºåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”ç®€åŒ–äº†å‡½æ•°å®šä¹‰"><a href="#ç®­å¤´å‡½æ•°ç›¸å½“äºåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”ç®€åŒ–äº†å‡½æ•°å®šä¹‰" class="headerlink" title="ç®­å¤´å‡½æ•°ç›¸å½“äºåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”ç®€åŒ–äº†å‡½æ•°å®šä¹‰"></a>ç®­å¤´å‡½æ•°ç›¸å½“äºåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”ç®€åŒ–äº†å‡½æ•°å®šä¹‰</h3><blockquote><p>ä½†å®é™…ä¸Šï¼Œç®­å¤´å‡½æ•°å’ŒåŒ¿åå‡½æ•°æœ‰ä¸ªæ˜æ˜¾çš„åŒºåˆ«ï¼šåŒ¿åå‡½æ•°çš„thisæŒ‡å‘æ‰§è¡Œæ—¶ä¸Šä¸‹æ–‡ï¼ˆç”±äºæ‰§è¡Œæ—¶çš„<code>å…¨å±€æ€§</code>ï¼Œthisä¸€èˆ¬æŒ‡å‘windowï¼‰ï¼›ç®­å¤´å‡½æ•°å†…éƒ¨çš„thisä¸çˆ¶çº§å…ƒç´ thisç»‘å®š</p></blockquote><h2 id="ä¸‰ã€this"><a href="#ä¸‰ã€this" class="headerlink" title="ä¸‰ã€this"></a>ä¸‰ã€this</h2><blockquote><h3 id="1ï¼šthisæ°¸è¿œæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼›"><a href="#1ï¼šthisæ°¸è¿œæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼›" class="headerlink" title="1ï¼šthisæ°¸è¿œæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼›"></a>1ï¼šthisæ°¸è¿œæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼›</h3></blockquote><blockquote><h3 id="2ï¼šthisçš„æŒ‡å‘å®Œå…¨å–å†³äºå‡½æ•°è°ƒç”¨çš„ä½ç½®ï¼›"><a href="#2ï¼šthisçš„æŒ‡å‘å®Œå…¨å–å†³äºå‡½æ•°è°ƒç”¨çš„ä½ç½®ï¼›" class="headerlink" title="2ï¼šthisçš„æŒ‡å‘å®Œå…¨å–å†³äºå‡½æ•°è°ƒç”¨çš„ä½ç½®ï¼›"></a>2ï¼šthisçš„æŒ‡å‘å®Œå…¨å–å†³äºå‡½æ•°è°ƒç”¨çš„ä½ç½®ï¼›</h3></blockquote><blockquote><h3 id="3ï¼šthisæŒ‡å‘å¯ä»¥åŠ¨æ€æ”¹å˜ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“thisæŒ‡å‘"><a href="#3ï¼šthisæŒ‡å‘å¯ä»¥åŠ¨æ€æ”¹å˜ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“thisæŒ‡å‘" class="headerlink" title="3ï¼šthisæŒ‡å‘å¯ä»¥åŠ¨æ€æ”¹å˜ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“thisæŒ‡å‘"></a>3ï¼šthisæŒ‡å‘å¯ä»¥åŠ¨æ€æ”¹å˜ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“thisæŒ‡å‘</h3></blockquote><p>eg1.</p><pre><code class="hljs">var A = &#123;    name: &#39;å¼ ä¸‰&#39;,    f: function () &#123;        console.log(&#39;å§“åï¼š&#39; + this.name);    &#125;&#125;;â€‹var B = &#123;    name: &#39;æå››&#39;&#125;;â€‹B.f = A.f;B.f()   // å§“åï¼šæå››A.f()   // å§“åï¼šå¼ ä¸‰</code></pre><p>eg2.</p><pre><code class="hljs">function foo() &#123;    console.log(this.a);&#125;var obj2 = &#123;    a: 2,    fn: foo&#125;;var obj1 = &#123;    a: 1,    o1: obj2&#125;;obj1.o1.fn(); // 2</code></pre><h3 id="thisçš„äº‹ä»¶ç»‘å®š"><a href="#thisçš„äº‹ä»¶ç»‘å®š" class="headerlink" title="thisçš„äº‹ä»¶ç»‘å®š"></a>thisçš„äº‹ä»¶ç»‘å®š</h3><pre><code class="hljs">&lt;input type=&quot;button&quot; value=&quot;æŒ‰é’®&quot; onclick=&quot;clickFun()&quot;&gt;&lt;script&gt;    function clickFun()&#123;        this // æ­¤å‡½æ•°çš„è¿è¡Œç¯å¢ƒåœ¨å…¨å±€windowå¯¹è±¡ä¸‹ï¼Œå› æ­¤thisæŒ‡å‘window;    &#125;&lt;/script&gt;â€‹&lt;input type=&quot;button&quot; value=&quot;æŒ‰é’®&quot; onclick=&quot;this&quot;&gt;&lt;!-- è¿è¡Œç¯å¢ƒåœ¨èŠ‚ç‚¹å¯¹è±¡ä¸­ï¼Œå› æ­¤thisæŒ‡å‘æœ¬èŠ‚ç‚¹å¯¹è±¡ --&gt;</code></pre><blockquote><p>å½“äº‹ä»¶è§¦å‘æ—¶ï¼Œå±æ€§å€¼å°±ä¼šä½œä¸ºJSä»£ç è¢«æ‰§è¡Œï¼Œå½“å‰è¿è¡Œç¯å¢ƒä¸‹æ²¡æœ‰clickFunå‡½æ•°ï¼Œå› æ­¤æµè§ˆå™¨å°±éœ€è¦è·³å‡ºå½“å‰è¿è¡Œç¯å¢ƒï¼Œåœ¨æ•´ä¸ªç¯å¢ƒä¸­å¯»æ‰¾ä¸€ä¸ªå«clickFunçš„å‡½æ•°å¹¶æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥å‡½æ•°å†…éƒ¨çš„thiså°±æŒ‡å‘äº†å…¨å±€å¯¹è±¡windowï¼›å¦‚æœä¸æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œç›´æ¥åœ¨å½“å‰èŠ‚ç‚¹å¯¹è±¡ç¯å¢ƒä¸‹ä½¿ç”¨thisï¼Œé‚£ä¹ˆæ˜¾ç„¶thiså°±ä¼šæŒ‡å‘å½“å‰èŠ‚ç‚¹å¯¹è±¡ï¼›</p></blockquote><h2 id="å››ã€åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°çš„thisæŒ‡å‘åŒºåˆ«"><a href="#å››ã€åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°çš„thisæŒ‡å‘åŒºåˆ«" class="headerlink" title="å››ã€åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°çš„thisæŒ‡å‘åŒºåˆ«"></a>å››ã€åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°çš„thisæŒ‡å‘åŒºåˆ«</h2><h3 id="eg1-åŒ¿åå‡½æ•°çš„å…¨å±€æ€§"><a href="#eg1-åŒ¿åå‡½æ•°çš„å…¨å±€æ€§" class="headerlink" title="eg1.åŒ¿åå‡½æ•°çš„å…¨å±€æ€§"></a>eg1.åŒ¿åå‡½æ•°çš„å…¨å±€æ€§</h3><pre><code class="hljs">function fun() &#123;    (function () &#123;        console.log(this);    &#125;)()&#125;fun();</code></pre><h3 id="eg2-åŒ¿åå‡½æ•°åœ¨objä¸­thisæŒ‡å‘å¯¹è±¡"><a href="#eg2-åŒ¿åå‡½æ•°åœ¨objä¸­thisæŒ‡å‘å¯¹è±¡" class="headerlink" title="eg2.åŒ¿åå‡½æ•°åœ¨objä¸­thisæŒ‡å‘å¯¹è±¡"></a>eg2.åŒ¿åå‡½æ•°åœ¨objä¸­thisæŒ‡å‘å¯¹è±¡</h3><pre><code class="hljs">var name = &#39;window&#39;var person = &#123;    name :&#39;Alan&#39;,    sayOne:function () &#123;            console.log(this.name)    &#125;,    sayTwo:function () &#123;        return function () &#123;            console.log(this.name)        &#125;    &#125;&#125;person.sayOne()person.sayTwo()()</code></pre><blockquote></blockquote><ul><li>å‡½æ•°å†…éƒ¨çš„thisæŒ‡å‘è°ƒç”¨è€…</li><li>sayOneè°ƒç”¨è€…æ˜¯personå¯¹è±¡ï¼Œæ‰€ä»¥thisæŒ‡å‘personï¼›</li></ul><ul><li>sayTwoçš„è°ƒç”¨è€…è™½ç„¶ä¹Ÿæ˜¯personå¯¹è±¡ï¼Œä½†æ˜¯åŒºåˆ«åœ¨äºè¿™æ¬¡è°ƒç”¨å¹¶æ²¡æœ‰æ‰“å‡ºthisè€Œæ˜¯åœ¨å…¨å±€è¿”å›äº†ä¸€ä¸ªåŒ¿åå‡½æ•°<br>,è€Œè¿™ä¸ªåŒ¿åå‡½æ•°ä¸æ˜¯ä½œä¸ºæŸä¸ªå¯¹è±¡çš„æ–¹æ³•æ¥è°ƒç”¨æ‰§è¡Œï¼Œæ˜¯åœ¨å…¨å±€æ‰§è¡Œï¼Œæœ€åçš„æ‰§è¡Œè€…å°±æ˜¯window</li></ul><h3 id="eg3-åŒ¿åå‡½æ•°æ€§è´¨è¿ç”¨"><a href="#eg3-åŒ¿åå‡½æ•°æ€§è´¨è¿ç”¨" class="headerlink" title="eg3.åŒ¿åå‡½æ•°æ€§è´¨è¿ç”¨"></a>eg3.åŒ¿åå‡½æ•°æ€§è´¨è¿ç”¨</h3><pre><code class="hljs">var name = &#39;window&#39;var person = &#123;    name :&#39;one&#39;,    wrap: function()&#123;        (function ()&#123;            console.log(this.name)// window        &#125;)()        function sum()&#123;            console.log(this.name)// window        &#125;        sum()ï¼Œ        good: function sum2() &#123;            console.log(this.name)        &#125;    &#125;&#125;person.wrap()person.good()</code></pre><blockquote><ul><li>functionæ˜¯è°ƒç”¨è‡ªèº«çš„åŒ¿åå‡½æ•° ï¼ŒthisæŒ‡å‘å…¨å±€ï¼Œsumè¢«functionè°ƒç”¨ï¼Œsumçš„thisæŒ‡å‘functionï¼Œä¹Ÿæ˜¯å…¨å±€</li><li>goodè¢«personç›´æ¥è°ƒç”¨ï¼ŒthisæŒ‡å‘person</li></ul></blockquote><h3 id="eg4-ç®­å¤´å‡½æ•°this"><a href="#eg4-ç®­å¤´å‡½æ•°this" class="headerlink" title="eg4.ç®­å¤´å‡½æ•°this"></a>eg4.ç®­å¤´å‡½æ•°this</h3><pre><code class="hljs">var name=&#39;window&#39;;var obj = &#123;    name:&#39;obj&#39;,    nameprintf:()=&gt;&#123;        console.log(this.name)    &#125;&#125;obj.nameprintf()</code></pre><blockquote><ul><li>nameprintfæ˜¯ç®­å¤´å‡½æ•°ï¼Œthisä¸çˆ¶çº§å…ƒç´ objçš„thisç»‘å®šï¼Œè€Œobjçš„thisæŒ‡å‘windowï¼Œå› æ­¤nameprintfçš„thisä¹ŸæŒ‡å‘window</li></ul></blockquote><h3 id="eg5-åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°ç»“åˆ"><a href="#eg5-åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°ç»“åˆ" class="headerlink" title="eg5.åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°ç»“åˆ"></a>eg5.åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°ç»“åˆ</h3><pre><code class="hljs">var name=&quot;window&quot;var obj=&#123;    num:4,    name:obj,    fn:function()&#123;          console.log(this.name);         (() =&gt; &#123;            console.log(this.name);        &#125;)();    &#125;&#125;obj.fn(); var w = obj.fn;w(); var obj1 = &#123;name:&#39;obj1&#39;, fn:obj.fn&#125;obj1.fn(); </code></pre><blockquote><ul><li>ç®­å¤´å‡½æ•°ä¸­çš„thisåŒ…å«åœ¨åŒ¿åå‡½æ•°ä¸­ï¼ŒåŒ¿åå‡½æ•°è¢«functionè°ƒç”¨ï¼Œå› æ­¤ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘ä¸functionä¸­çš„ç›¸åŒ</li><li>objè°ƒç”¨fnï¼Œå› æ­¤fnçš„thisæŒ‡å‘objï¼Œè¾“å‡ºä¸ºobj</li><li>w()æ˜¯æ–°åˆ›å»ºçš„å®šä¹‰åœ¨windowä¸‹çš„å˜é‡ï¼ŒthisæŒ‡å‘windowï¼Œè¾“å‡ºä¸ºwindow</li><li>obj1è°ƒç”¨objä¸­çš„fnå‡½æ•°ï¼Œå› æ­¤è°ƒç”¨å¯¹è±¡ä¸ºobj1ï¼ŒthisæŒ‡å‘obj1</li></ul></blockquote>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>jsåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>jsåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
